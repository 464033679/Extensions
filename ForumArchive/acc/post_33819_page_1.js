[{"Owner":"FunFetched","Date":"2017-11-05T05:43:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//playground.babylonjs.com/indexstable#XUS5AG%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/indexstable#XUS5AG#1_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn the example above_co_ the sphere is located directly above the torus. As you can see_co_ the shadow that it casts bleeds through the top of the torus and on to the lower portion. Is there any way to prevent this behavior? I have a game where the maps are generated as a single SPS that receives shadows_co_ but objects on upper floors cast shadows that bleed through onto any part of the mesh that_t_s under them_co_ such as lower floors.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn my attempts to get around this_co_ I created a custom shader that fades the shadow according to the difference between the shadow map depth and the depth of the caster. While it _qt_works_qt_ on the shadow from the object on the floor above (sans the aliasing)_co_ you can see where it cuts in to the shadow at the bottom of the attached image. The shadow at the bottom is being cast by an object on a lower level_co_ one that_t_s further from the shadow_t_s light source.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/59fea3b27d604_ScreenShot2017-11-04at10_37_20PM.png.68dd557aab672fc808419574287cae10.png_qt_ data-fileid_eq__qt_15552_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15552_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/59fea3b343bb7_ScreenShot2017-11-04at10_37_20PM.thumb.png.3c7c149c569c15dfb26074fc8ee0fb03.png_qt_ alt_eq__qt_59fea3b343bb7_ScreenShot2017-11-04at10_37_20PM.thumb.png.3c7c149c569c15dfb26074fc8ee0fb03.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-11-06T19:00:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWhat do you mean by bleed? The result seems correct to me (as the torus is not casting shadows)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/Capture.PNG.85e5f1fb3bd9a95c705ac9d3adbb13be.PNG_qt_ data-fileid_eq__qt_15560_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15560_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/Capture.thumb.PNG.644c8822946b5023ed66d437f9f8dfc6.PNG_qt_ alt_eq__qt_Capture.thumb.PNG.644c8822946b5023ed66d437f9f8dfc6.PNG_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"FunFetched","Date":"2017-11-06T19:24:32Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_194153_qt_ data-ipsquote-contentid_eq__qt_33819_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1509994850_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t2 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tWhat do you mean by bleed? The result seems correct to me (as the torus is not casting shadows)\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tIt_t_s _qt_correct_qt_ in that it_t_s behaving as expected. Since the sphere is between the light source and the torus_co_ any part of the torus that can_t_t _qt_see_qt_ the light is indeed in shadow.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHowever_co_ the lower part of the torus can_t_t _qt_see_qt_ the sphere_co_ either_co_ so technically_co_ it_t_s not the sphere that should be shadowing the lower part of the torus. The torus would instead be shadowing itself_co_ at least if I had self-shadowing activated. Obviously_co_ it_t_s not a bug_co_ just a behavioral issue that just so happens to be interfering with a special circumstance of my own creation.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCheck out the image below to see what I mean. Notice the ammo crate at the top_co_ and the shadow it casts on the surface immediately below it. At the bottom of the screen_co_ you can see that the same shadow is also visible on the floor below. This is because my map is a single mesh (an SPS).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a work-around in place now that isn_t_t perfect_co_ but it_t_s _qt_good enough for who it_t_s for_qt_. I_t_m fading the shadow in my custom shader according to the difference in depth between the shadow buffer and the fragment depth_co_ so the shadow at the bottom _qt_disappears_qt_. Of course_co_ it_t_s not actually gone_co_ as you can see in the image in my previous post. I_t_m getting around that now by placing the light right above the player_co_ so the shadow generator will ignore any meshes that are above it.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere are some special cases where it still doesn_t_t work quite right. For example_co_ if there were an ammo crate directly below in the following image_co_ the _qt_faded shadow_qt_ from the crate above would actually blot out the shadow from the crate below. I initially thought I could fix this by changing the depth buffer calculation for the shadow map to GL_GREATER_co_ so that only the objects furthest from the light would be considered. However_co_ I ended up with no shadow at all_co_ and couldn_t_t figure out how to make it work_co_ so I eventually settled for what I have right now.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/5a00b3b40e3cf_ScreenShot2017-11-06at11_10_05AM.png.513a3f2d8b9db6b7c170a8dac7161f10.png_qt_ data-fileid_eq__qt_15561_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15561_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/5a00b3b59c2ac_ScreenShot2017-11-06at11_10_05AM.thumb.png.7875b504699ab5488293495c50547c03.png_qt_ alt_eq__qt_5a00b3b59c2ac_ScreenShot2017-11-06at11_10_05AM.thumb.png.7875b504699ab5488293495c50547c03.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-11-06T19:51:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHey! in this case the best option is to make the ground (or the torus in your PG) as shadow caster_co_ but then you will deal with self-shadowing issues _lt_img alt_eq__qt__sm_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ title_eq__qt__sm_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"FunFetched","Date":"2017-11-06T19:51:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLet me illustrate what I_t_m talking about.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/shadows.png.186029d424ee09e8a49a70e236fe2f44.png_qt_ data-fileid_eq__qt_15563_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15563_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_11/shadows.thumb.png.785ae27476f3293a3ab2e6ee55c7da72.png_qt_ alt_eq__qt_shadows.thumb.png.785ae27476f3293a3ab2e6ee55c7da72.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDoes that help? Now_co_ to fix the behavior that is illustrated in the far-right pane_co_ I was thinking that I could change the depth calculation to GL_GREATER_co_ so that the sphere at the bottom (and thus_co_ farthest from the light)_co_ would get the last say as to the shadow buffer depth values at that location_co_ but instead_co_ I got no shadows at all. I tried futzing with a number of things_co_ but couldn_t_t figure out how to make it work.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"FunFetched","Date":"2017-11-06T19:55:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_194165_qt_ data-ipsquote-contentid_eq__qt_33819_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1509997866_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tJust now_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHey! in this case the best option is to make the ground (or the torus in your PG) as shadow caster_co_ but then you will deal with self-shadowing issues _lt_img alt_eq__qt__sm_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ title_eq__qt__sm_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tWell yeah_co_ that_t_s just it. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ I tried that_co_ and got some pretty wonky results_co_ though I haven_t_t spent much time trying to fix them yet. Plus_co_ I then have the issue of what to do with shadows disappearing at a distance. I can fade them gracefully_co_ and that might be okay. I_t_ll tinker with it some more. Ideally_co_ I was hoping to save some cycles and leave the map out of the shadow-casting calculations and just _qt_bake_qt_ some shading in there at some point.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"FunFetched","Date":"2017-11-06T19:57:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tAnyway_co_ thanks for your input! I just wanted to make sure I wasn_t_t missing something obvious.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-11-06T20:00:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYou were not_dd_)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne trick that may be worth the try_dd_ did you play with light.range to limit the range of the light it self? (hence limiting the range of the shadow)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"FunFetched","Date":"2017-11-06T20:03:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_194172_qt_ data-ipsquote-contentid_eq__qt_33819_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1509998418_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t1 minute ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tYou were not_dd_)\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tOne trick that may be worth the try_dd_ did you play with light.range to limit the range of the light it self? (hence limiting the range of the shadow)\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYeah_co_ that_t_s the _qt_solution_qt_ I_t_m rolling with right now. If my player is on the first floor_co_ for instance_co_ the light follows him just above his head_co_ below the second floor_co_ so the object on the floor above doesn_t_t get taken into account during shadow calculations. There are still some issues when you_t_re looking at both floors at the same time from an elevated position at a distance_co_ but it_t_s not a big deal.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2017-11-06T20:23:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHi guys.  Just for fun_co_ I want to remind about .included*/.excluded* properties on the shadowGen_t_s (or any other...) light.  At times_co_ mesh.material.emissiveColor can cover the lighting (in case that mesh has been pushed into _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/classes/3.1/light#excludedmeshes-abstractmesh-classes-3-1-abstractmesh-_qt_ rel_eq__qt_external nofollow_qt__gt_light.excludedMeshes_lt_/a_gt_).  .emissveColor can_t_t cast shadows_co_ though.  Ok_co_ impertinent Wingnut... out.  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_  (I_t_m a bit curious as-to what causes the bright circle_co_ pointed-to by the red arrow)\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]