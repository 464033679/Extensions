[{"Owner":"jerome","Date":"2015-02-08T14:19:48Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hello_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Did anyone here already coded some depth of field postprocess ?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I mean the same effect as with picture cameras _dd_ things/meshes before or beyond the depth of field set look blured_co_ things/meshes within the depth of field range look sharp_co_ at last normal  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ ._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I found this article here _dd_ _lt_a href_eq__qt_http_dd_//artmartinsh.blogspot.fr/2010/02/glsl-lens-blur-filter-with-bokeh.html_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//artmartinsh.blogspot.fr/2010/02/glsl-lens-blur-filter-with-bokeh.html_lt_/a_gt__lt_/p_gt__lt_p_gt_with this fragment shader GLSL code _dd_ _lt_a href_eq__qt_http_dd_//www.pasteall.org/10779_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.pasteall.org/10779_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_but I don_t_t really get how to port it to BJS shaders (maybe because I haven_t_t yet learnt anything about them  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ )_lt_/p_gt__lt_p_gt_ _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jahow","Date":"2015-02-08T18:56:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hey Jerome_co__lt_br_gt_ _lt_br_gt_I quickly hacked a depth-of-field effect for my current game project_co_ and it looks like this (also using BJS ambient occlusion effect)_dd__lt_br_gt__lt_a href_eq__qt_http_dd_//40.media.tumblr.com/944395855bece9a9385d74bd6cc16c1f/tumblr_nj8o8cREgD1u7ay33o1_1280.jpg_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//40.media.tumblr.com/944395855bece9a9385d74bd6cc16c1f/tumblr_nj8o8cREgD1u7ay33o1_1280.jpg_lt_/a_gt__lt_br_gt_ _lt_br_gt_The code (typescript) is as follows_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint lang-auto_qt__gt_var depth_texture _eq_ scene.enableDepthRenderer().getDepthMap()_sm_var depth_effect _eq_ new BABYLON.PostProcess(_qt_depth_render_qt__co_ _qt_./depth_render_qt__co_ [_t_focus_depth_t_]_co_ [_t_depthSampler_t_]_co_ 1.0_co_ camera_co_ BABYLON.Texture.TRILINEAR_SAMPLINGMODE_co_ engine_co_ true)_sm_depth_effect.onApply _eq_ (effect_dd_ BABYLON.Effect) _eq_&gt_sm_ {   effect.setTexture(_t_depthSampler_t__co_ depth_texture)_sm_   effect.setFloat(_t_focus_depth_t__co_ camera.radius / camera.maxZ)_sm_}_sm__lt_/pre_gt__lt_p_gt_And the fragment shader_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint lang-auto_qt__gt_#ifdef GL_ESprecision highp float_sm_#endif uniform sampler2D textureSampler_sm_uniform sampler2D depthSampler_sm_uniform float focus_depth_sm_varying vec2 vUV_sm_ vec4 sampleBox(float u_co_ float v_co_ float size) {  vec4 color _eq_ vec4(0.0_co_0.0_co_0.0_co_0.0)_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x - size_co_  vUV.y - size))  * 0.075_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x_co_  vUV.y - size))  * 0.1_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x + size_co_  vUV.y - size))  * 0.075_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x - size_co_  vUV.y))  * 0.1_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x_co_  vUV.y))  * 0.30_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x + size_co_  vUV.y))  * 0.1_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x - size_co_  vUV.y + size))  * 0.075_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x_co_  vUV.y + size))  * 0.1_sm_  color +_eq_ texture2D(textureSampler_co_ vec2(vUV.x + size_co_  vUV.y + size))  * 0.075_sm_  return color_sm_} void main(void){  float depth _eq_ texture2D(depthSampler_co_ vUV).r_sm_  float blur_amount _eq_ abs(depth-focus_depth)*20.0_sm_  if(depth &lt_sm_ depth-focus_depth) { blur_amount *_eq_ 10.0_sm_ }  blur_amount _eq_ clamp(blur_amount_co_ 0.0_co_ 1.0)_sm_   vec4 baseColor _eq_ texture2D(textureSampler_co_ vUV)_sm_  vec4 blurredColor _eq_ vec4(0.0_co_0.0_co_0.0_co_0.0)_sm_   float blurSize _eq_ 0.005*blur_amount_sm_  blurredColor _eq_ 0.75*sampleBox(vUV.x_co_ vUV.y_co_ blurSize*0.5) + 0.25*sampleBox(vUV.x_co_ vUV.y_co_ blurSize*1.0)_sm_   gl_FragColor _eq_ baseColor * (1.0 - blur_amount) + blurredColor * blur_amount_sm_}_lt_/pre_gt__lt_p_gt_It_t_s basically a progressive blur modulated by the depth of each pixel. A _t_focus depth_t_ is passed as argument (depth is a value between 0 and 1)_co_ and if the pixel is nearer or further from that depth_co_ it gets blurred._lt_br_gt_ _lt_br_gt_I_t_m quite happy with the result_co_ but I_t_ll probably improve it_co_ at least for performance. As you can see_co_ for every fragment (pixel)_co_ I_t_m sampling the texture 18 (!) times... Doing a 2-pass blur effect (horizontal and vertical) would probably be less expensive._lt_br_gt_ _lt_br_gt_Also someone else has made a DOF effect with BJS_co_ it_t_s right there_dd_ _lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/6557-babylon-projects/#entry61192_qt__gt_http_dd_//www.html5gamedevs.com/topic/6557-babylon-projects/#entry61192_lt_/a_gt__lt_br_gt_ _lt_br_gt_I haven_t_t had time to dive into its code though._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-02-08T19:10:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Waaaooowww_lt_/p_gt__lt_p_gt_really nice !!!_lt_/p_gt__lt_p_gt_ _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_p_gt_thank you_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jahow","Date":"2015-02-08T21:08:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_You_t_re welcome _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ For the record_co_ I think DK was hoping for someone to do a pull request with a depth of field effect!_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-02-09T07:33:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I can do it actually but I prefer when community is involved _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-02-09T08:20:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I wish I can do it_lt_/p_gt__lt_p_gt_Heu_co_ just wait for two or three geological eras until I can learn GLSL _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_laugh.png_qt_ alt_eq__qt__dd_lol_dd__qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jahow","Date":"2015-02-09T10:03:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_GLSL is not that hard_co_ and the stuff you can do with it is mind-boggling. Being able to use it in a web app is a wonderful thing_co_ and BJS makes it very easy_dd_ it literally took me 5 lines of typescript to include my custom postprocess shader._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I_t_ll work on a PR for this effect._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-02-09T10:44:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Ok I trust you_lt_/p_gt__lt_p_gt_Let me go in typescript first _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HugoMcPhee","Date":"2015-02-21T22:10:15Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi here_t_s the project with the Depth of Filed cut down to it_t_s depth of field bones_co_ _lt_a href_eq__qt_http_dd_//hugos.website/DepthOfFieldEffect_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//hugos.website/DepthOfFieldEffect_lt_/a_gt__lt_/p_gt__lt_p_gt_and the zip file can be downloaded here _lt_a href_eq__qt_http_dd_//hugos.website/DepthOfFieldEffect.zip_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//hugos.website/DepthOfFieldEffect.zip_lt_/a_gt_ (there may be some tweaks that can be made to make it better)_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I edited the Dof Image fragment shader of this to get it to work _lt_a href_eq__qt_http_dd_//www.nutty.ca/?page_id_eq_352&amp_sm_link_eq_depth_of_field_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.nutty.ca/?page_id_eq_352&amp_sm_link_eq_depth_of_field_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_strong_gt_*Updated* _lt_/strong_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The Dof now uses Babylon 2.0_t_s built in _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/page.php?p_eq_24825_qt_ rel_eq__qt_external nofollow_qt__gt_DepthRenderer_lt_/a_gt_ so the code is a little more simplified_co_ and there_t_s less extra files_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]