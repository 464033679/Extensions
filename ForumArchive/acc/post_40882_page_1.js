[{"Owner":"thoomaash","Date":"2018-10-26T12:14:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am using babylonjs to implement a 3D visualizations inside my app. The app allows a user to define a scene in a 2D view. The scene is static in the 3D view - meshesÂ cannot be moved_co_ edited etc.Â A user can interact with objects using mouse - selection by click_co_ hover on mouse move_co_ double click to open in another view. In my opinion the most natural way to present that something is happening when user moves mouse is to change meshesâ€™ colors.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tEverything works well (50-60 fps) when there isn_t_t much meshes â€“ 300-400. Unfortunately_co_ performance drops down when the scene becomes more complex â€“ about 4k meshes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIâ€™ve already tried improving performance by using_dd_\n_lt_/p_gt_\n\n_lt_ul_gt_\n\t_lt_li_gt_\n\t\tmesh instances (cause a lot of them have the same textureÂ and vertex data) - unfortunately I haven_t_t found a way to color a mesh instance on mouse selection. I found a method _lt_em_gt_set/updateVerticesData_lt_/em_gt_ but VertexData.ColorKind cannot be updated when mesh instances are used (an error occurs when I try to set argumentÂ makeItUnique to true)\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tmesh clones - it works like I expected because clones do not share material_co_ but the performance problem still exists\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tsolid particle system - when I started implementing and saw the results I was amazed and thought that I found a solution. But then I realized that I cannot use particles as parents for other meshes. Am IÂ right?\n\t_lt_/li_gt_\n_lt_/ul_gt_\n\n_lt_p_gt_\n\tIâ€™ve prepared a playground showing my problem. On the left-hand side of the scene (3 boxes) is my real use case. It shows how I use mesh parent system. On the right-hand side there are rendered boxes that represent objects in my scene.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//playground.babylonjs.com/indexStable.html#U0KFSU%235_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/indexStable.html#U0KFSU#5_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am afraid that I am bound to CPU due to having a lot of transparent textures and a lot of meshes. When I was profiling my scene a lot of CPU time was spent on recognizing which meshes are active (I freezed activemeshes on the scene by calling _lt_em_gt_scene.freezeActiveMeshes()_lt_/em_gt_). Now i get around 12/13 FPS (measured with Chrome DevTool/Rendering and FPS meter feature)_co_ CPU usage (in windows task manager) is around 35%_co_ GPU usage (in windows task manager) 19%.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there anything else I can do to have at leastÂ 25-30 FPS and still react to mouse operations?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank you in advance for any suggestionsÂ _lt_span class_eq__qt_ipsEmoji_qt__gt_ðŸ˜Ÿ_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_10/screenshot.png.850bb0363f935dd407ca483c5d84b48b.png_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_20659_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_10/screenshot.thumb.png.82b1305dd865516e8d99af2d41bfde96.png_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_screenshot.png_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2018-10-26T15:08:53Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/33189-thoomaash/?do_eq_hovercard_qt_ data-mentionid_eq__qt_33189_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/33189-thoomaash/_qt_ rel_eq__qt__qt__gt_@thoomaash_lt_/a_gt_Â and welcome to the forum. I am on a mobile currently and so am not sure how helpful my suggestions will be as PG is taking to long to load. I am not sure how you are using the parent child relationship. If you are moving or rotating the parent and expecting the child to move relatively then I dont think SPS will help. On the other hand you could relate a particle to a mesh using the particle id and the mesh id. That way on picking a particle or mesh you can make changes to the linked mesh or particle.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tÂ \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-10-26T15:22:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSome random ideas_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#353c41_sm_ font-size_dd_14px_sm_ text-align_dd_left_qt__gt_- mesh instances (cause a lot of them have the same textureÂ and vertex data)_dd_ This is the best option. You can still use a dummy mesh replacing the hovered instance (turn the instance off_co_ move the dummy mesh_co_ make it as you want and restore the instance when mouse leave)_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#353c41_sm_ font-size_dd_14px_sm_ text-align_dd_left_qt__gt_- SPS is also really great. Can you tell us more why you need parenting? As JonhK said_co_ there are also ideas here to explore_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"thoomaash","Date":"2018-10-26T15:47:48Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThank you Deltakosh and JohnK for ideas.\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_232910_qt_ data-ipsquote-contentid_eq__qt_40882_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1540566533_qt_ data-ipsquote-userid_eq__qt_14282_qt_ data-ipsquote-username_eq__qt_JohnK_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t21 minutes ago_co_ JohnK said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tIf you are moving or rotating the parent and expecting the child to move relatively then I dont think SPS will help\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYes_co_ it is exactly how I use it.Â \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_232913_qt_ data-ipsquote-contentid_eq__qt_40882_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1540567330_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t8 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tSPS is also really great. Can you tell us more why you need parenting?\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOn my scene are objects that can be nested. User can freely assemble various objects_co_ some of them have spaces to which you can put more objects - a lot of objects have modular structure.Â The simplest example is a cabinet_co_ to which we putÂ shelves_co_ arrange items on the shelves. At the moment of cabinet rotationÂ iÂ want everything inside to be rotated as well.\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_232913_qt_ data-ipsquote-contentid_eq__qt_40882_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1540567330_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t19 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tYou can still use a dummy mesh replacing the hovered instanc_lt_span_gt_ï»¿_lt_/span_gt_e (turn the instance off_co_ move the dummy mesh_co_ make it as you want and restore the instance when mouse leave)\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tProbably this is a great idea. I will have to test if switching dummy mesh with instanceÂ is fast enough to avoid blinking.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"thoomaash","Date":"2018-10-27T12:35:14Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNow i get about 25 FPS (10 more)Â with instances and huge improvement on draw calls (4000 -&gt_sm_ 350 draw calls).Â  Camera movementÂ looks much better now.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere is one more problem in my scene which result from my app logic.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tObjects on scene that has the same texture and mesh can have initially different colors. Pure performance still exists because i can only group for instances objects byÂ color.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there anything i can make for performance improvements in this specific case ? For example_dd_ can i set color on mesh instance or this can be only achieved on mesh cloneÂ ?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2018-10-27T14:59:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_232996_qt_ data-ipsquote-contentid_eq__qt_40882_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1540643714_qt_ data-ipsquote-userid_eq__qt_33189_qt_ data-ipsquote-username_eq__qt_thoomaash_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t2 hours ago_co_ thoomaash said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tFor example_dd_ can i set color on mesh instance or this can be only achieved on mesh clo_lt_span_gt_ï»¿_lt_span_gt_ï»¿_lt_/span_gt__lt_span_gt_ï»¿_lt_/span_gt__lt_/span_gt_n_lt_span_gt_ï»¿_lt_/span_gt_e_lt_span_gt_ï»¿_lt_/span_gt_Â ?_lt_span_gt_ï»¿_lt_/span_gt__lt_span_gt_ï»¿_lt_/span_gt__lt_span_gt_ï»¿_lt_span_gt_ï»¿_lt_span_gt_ï»¿_lt_span_gt_ï»¿_lt_span_gt_ï»¿_lt_/span_gt__lt_/span_gt__lt_/span_gt__lt_/span_gt__lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOnly clones can have a different color to the original.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"thoomaash","Date":"2018-10-27T15:49:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_233005_qt_ data-ipsquote-contentid_eq__qt_40882_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1540652398_qt_ data-ipsquote-userid_eq__qt_14282_qt_ data-ipsquote-username_eq__qt_JohnK_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t41 minutes ago_co_ JohnK said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tOnly clones can have a different color to the original.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOk_co_ thank you for help. In that case_co_ i have nothing else but aÂ mesh cloning solution.Â \n_lt_/p_gt_\n\n_lt_p_gt_\n\tÂ \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2018-10-27T15:57:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYou can set a particle to be a parent to other particlesÂ _lt_a href_eq__qt_https_dd_//doc.babylonjs.com/how_to/solid_particle_system#particle-parenting_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//doc.babylonjs.com/how_to/solid_particle_system#particle-parenting_lt_/a_gt_ . Don_t_t know if this helps as I am not clear on your data structure. Must find time to view your PG on a PC.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]