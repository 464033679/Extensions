[{"Owner":"Raggar","Date":"2017-08-16T12:19:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m looking for ways to optimize a scene I created in the Playground. This scene is based on previous work from another thread_co_ I just added some objects and logic to mimic a small game.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt uses native CannonJS for the PFS-camera and movement of the monster models. I used the code and model from the instances demo.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFrom line 16_co_ you can turn on and off physics for the monsters_co_ skeletal animations_co_ the skybox_co_ trees_co_ shadows_co_ procedural textures(grass)_co_ and whether or not the monsters should lookAt and follow the player.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs well as specify the amount of trees + the range and amount of monsters.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#FZZV7K%2323_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#FZZV7K#23_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m only hitting around ~30 FPS with this example. Is a scene such as this too heavy for WebGL and browsers?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe trees are instances_co_ so unless I clone and merge them_co_ I don_t_t see what could be changed there. Maybe a smaller_co_ compressed texture.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe monster models all have skeletons and animations_co_ so no instances or merging can be used here.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDisabling physics seems to give some FPS boost_co_ so maybe using a worker would do some good in this example. I_t_ll give this a try_co_ and see what effect it has on overall performance.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere_t_s a minimized version_co_ with most things stripped_co_ and 50 monsters without animations.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#FZZV7K%2324_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#FZZV7K#24_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-08-16T17:10:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tCan you try to run a profile session to see where the CPU is mostly used?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Raggar","Date":"2017-08-18T09:46:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m really bad at debugging performance.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img alt_eq__qt_HA0qsRO.png_qt_ class_eq__qt_ipsImage_qt_ src_eq__qt_http_dd_//i.imgur.com/HA0qsRO.png_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img alt_eq__qt_2spYH7R.png_qt_ class_eq__qt_ipsImage_qt_ src_eq__qt_http_dd_//i.imgur.com/2spYH7R.png_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img alt_eq__qt_kBhnyGd.png_qt_ class_eq__qt_ipsImage_qt_ src_eq__qt_http_dd_//i.imgur.com/kBhnyGd.png_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m trying something different to get a performance boost from the animated models_co_ as these seem to drop FPS rapidly when animations are playing.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSame with trees. I_t_ll try making simpler models_co_ small or compressed textures and maybe merge them instead of clones. Will merging have any gains over instances?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tEdit_dd_ Here_t_s a full capture_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img src_eq__qt_http_dd_//i.imgur.com/DW5zWvc.png_qt_ class_eq__qt_ipsImage_qt_ alt_eq__qt_DW5zWvc.png_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-08-18T15:14:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSo_co_ we must use an organized approach here _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t- First try to remove everything and start adding feature one by one until you see a real FPS drop\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- I_t_m concerned by the long call to updateDynamicVertexBuffer. Are you updating your meshes data dynamically?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- You have really high number of vertices (half a million). You should try to reduce this number a lot\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- Draw calls are good so keep using instances\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Raggar","Date":"2017-08-18T17:03:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tThe second playground I linked to(24)_co_ is a stripped down version. I_t_ll give it a try this weekend_co_ adding functionality one by one_co_ while trying to reduce the number of verts by simplifying the monsters as well as the trees. Maybe try the SPS Tree Generator_co_ as well as the Quick Tree Generator + instances or merging.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Raggar","Date":"2017-09-15T17:21:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWe_t_re hitting a month since I started this thread. For god knows what reason_co_ I suddenly wanted to make a fish tank with a neural network and genetic algorithms_co_ so I was kind of stuck in a weird loop doing that _lt_img alt_eq__qt__dd_P_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_tongue.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/tongue@2x.png 2x_qt_ title_eq__qt__dd_P_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn my particular project_co_ the individual models do not need to have different animations at different times_co_ so I tried comparing clones to instances.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tUsing clones_co_ I hit around 50FPS when having 40 models_co_ but hit the same FPS using ~250 instances. This is certainly an improvement.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tClones_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#2I6IG4%231_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#2I6IG4#1_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tInstances_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#2I6IG4_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#2I6IG4_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-09-15T21:00:24Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tGood news _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2017-09-15T21:05:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tJust a general note - you don_t_t need to add the render loop in the playground. Removing those lines (almost) doubles the FPS _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\there - _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#2I6IG4%232_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#2I6IG4#2_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Raggar","Date":"2017-09-15T21:32:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_188970_qt_ data-ipsquote-contentid_eq__qt_32407_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1505509540_qt_ data-ipsquote-userid_eq__qt_10310_qt_ data-ipsquote-username_eq__qt_RaananW_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t24 minutes ago_co_ RaananW said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tJust a general note - you don_t_t need to add the render loop in the playground. Removing those lines (almost) doubles the FPS _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\there - _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#2I6IG4%232_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#2I6IG4#2_lt_/a_gt_\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tLol. I tried with 80 clones_co_ and it stuck close to the 60FPS. Was I rendering twice or something_co_ then_co_ since it affected the performance that way?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2017-09-15T21:33:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_188981_qt_ data-ipsquote-contentid_eq__qt_32407_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1505511131_qt_ data-ipsquote-userid_eq__qt_22713_qt_ data-ipsquote-username_eq__qt_Raggar_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t1 minute ago_co_ Raggar said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tWas I rendering twice or something_co_ then_co_ since it affected the performance that way?\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYep_co_ you were rendering the entire scene twice... _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]