[{"Owner":"agmcleod","Date":"2014-12-15T00:47:25Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hello_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So I am in the process of converting my game from three.js to Babylon. I have a top down scene with a ground mesh_co_ and several cubes rendering on top. I have a _qt_player_qt_ cube that the camera is meant to follow_co_ which starts at 0_co_1_co_0. The camera is then set above it_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_this.camera _eq_ new BABYLON.FollowCamera(_qt_FollowCam_qt__co_ new BABYLON.Vector3(0_co_ 20_co_ 0)_co_ this.scene)_sm__lt_/pre_gt__lt_p_gt_I then set the camera to look at the player mesh_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_this.camera.target _eq_ this.player.mesh_sm__lt_/pre_gt__lt_p_gt_However_co_ the camera then flies back behind the player_co_ and slightly above_co_ looking at roughly a 45 degree angle. Any idea how to keep it above_co_ like I was simply rotating on the x axis instead?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-15T19:36:08Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_You should play with camera parameters to define distance and rotation limits_dd__lt_/p_gt__lt_p_gt_* rotationOffset_lt_/p_gt__lt_p_gt_* heightOffset_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-15T21:03:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Gave that a shot_co_ but the rotationOffset seems to rotate around the target_t_s Y axis_co_ as supposed to its X axis. If i set the rotation to 45 degrees for example_co_ i look directly at the cube_t_s corner_co_ as supposed to its side._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-16T13:50:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Tried working on my own version of the follow cam_co_ just keeping it really simple as i just need one view_dd_ top down. However it has not gone well_co_ and i think i am misunderstanding how the setTarget function in the parent_t_s TargetCamera is supposed to work._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The follow camera used angle calculation to adjust its position_co_ and would call setTarget(cameraTarget.position)_sm_ I however_co_ just need to keep the same X &amp_sm_ Z values as the target_co_ but about 20 Y above it. So here_t_s my code_dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_div_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_var __extends _eq_ this.__extends || function (d_co_  {  for (var p in  if (b.hasOwnProperty(p)) d[p] _eq_ b[p]_sm_  function __() { this.constructor _eq_ d_sm_ }  __.prototype _eq_ b.prototype_sm_  d.prototype _eq_ new __()_sm_}_sm_(function (BABYLON) {  var TopDownCamera _eq_ (function (_super) {    __extends(TopDownCamera_co_ _super)_sm_    function TopDownCamera(name_co_ position_co_ scene) {      _super.call(this_co_ name_co_ position_co_ scene)_sm_      this.radius _eq_ 12_sm_      this.rotationOffset _eq_ 0_sm_      this.heightOffset _eq_ 0_sm_      this.cameraAcceleration _eq_ 0.05_sm_      this.maxCameraSpeed _eq_ 20_sm_    }    TopDownCamera.prototype.getRadians _eq_ function (degrees) {      return degrees * Math.PI / 180_sm_    }_sm_    TopDownCamera.prototype.follow _eq_ function (cameraTarget) {      if (!cameraTarget)        return_sm_      this.position.x _eq_ cameraTarget.position.x_sm_      this.position.z _eq_ cameraTarget.position.z_sm_      this.setTarget(cameraTarget.position)_sm_    }_sm_    TopDownCamera.prototype._update _eq_ function () {      _super.prototype._update.call(this)_sm_      this.follow(this.target)_sm_    }_sm_    return TopDownCamera_sm_  })(BABYLON.TargetCamera)_sm_  BABYLON.TopDownCamera _eq_ TopDownCamera_sm_})(BABYLON || (BABYLON _eq_ {}))_sm__lt_/pre_gt__lt_p_gt_what happens it camera looks straight across_co_ not down at all_co_ even though the target position is right below it._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Now_co_ when i do some debugging and check out the setTarget call_co_ the _camMatrix property is all NaN. I think it_t_s because at one point there is a / by 0_co_ which results in Infinity. And then math is done on said Infinity in the invert() operation_co_ making the whole matrix NaN._lt_/p_gt__lt_/div_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-16T17:27:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Agree. I have more difficulty to help you on this camera as this is the only one I did not develop _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-16T18:24:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hey Delta_co_ I kind of have a solution._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So instead of using the follow camera_co_ i decided to use the target camera since it seems to define the cameraRotation behaviour. I simply apply an x rotation and I am able to point down_dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_div_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_this.camera _eq_ new BABYLON.TargetCamera(_qt_FollowCam_qt__co_ new BABYLON.Vector3(0_co_ 0_co_ 0)_co_ this.scene)_sm_this.player _eq_ new Player(this.scene)_sm_this.camera.parent _eq_ this.player_sm_this.camera.position.y _eq_ 20_sm_this.camera.cameraRotation.x _eq_ (Math.PI / 4)_sm__lt_/pre_gt__lt_p_gt_I_t_ll have to see how movement goes_co_ now that i have the camera attached to the player. My mouse input logic is still broken_co_ so i don_t_t know yet _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_/div_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-16T19:22:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Sounds good_dd_) could you share the code somewhere perhaps I can see where the problem is_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-16T20:37:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Yep_co_ all my babylonjs implementation has been to this branch_dd_ _lt_a href_eq__qt_https_dd_//github.com/agmcleod/threejstopdownplay/tree/feature/babylon_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/agmcleod/threejstopdownplay/tree/feature/babylon_lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-16T22:06:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Yes I mean a live server where I can debug between two meetings _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-16T22:51:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Ah lol. Just pushed it all here_dd_ _lt_a href_eq__qt_http_dd_//projects.agmprojects.com/topdown/_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//projects.agmprojects.com/topdown/_lt_/a_gt_. At the menu screen_co_ click the button on the top right_co_ then try to use the mouse to move the cube in the center around. It seems to sort of flicker at the moment_co_ but not really move anywhere. _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-17T23:13:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Sounds like the velocity vector is too big no?_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-18T03:42:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Don_t_t think so_co_ the numbers on coordinate projection must be wrong. I know when i had them in threejs_co_ a single coordinate would range between 30 and -30 or so. Im only getting 1.5 to -1.5 here. I fixed it to use unproject over project (whoops)_co_ but still not getting the mouse coordinates quite right._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_div_gt_ _lt_/div_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_ MouseControls.prototype.coordsAsVector _eq_ function (x_co_ y_co_ camera_co_ target) {    var vector _eq_ new BABYLON.Vector3(      ( x / window.innerWidth ) * 2 - 1_co_      - ( y / window.innerHeight ) * 2 + 1_co_      0.5    )_sm_    BABYLON.Vector3.Unproject(      vector_co_      window.innerWidth_co_      window.innerHeight_co_      window.scene.camera.getWorldMatrix()_co_      window.scene.scene.getViewMatrix()_co_      window.scene.camera.getProjectionMatrix()    )_sm_    var dir _eq_ vector.subtract(camera.position).normalize()_sm_    var distance _eq_ - camera.position.y / dir.y_sm_    target.copyFromFloats(camera.position.x_co_ camera.position.y_co_ camera.position.z)    return target.add(dir.multiplyByFloats(distance_co_ distance_co_ distance))_sm__sm_  }_lt_/pre_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-18T16:57:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Did you published your fix?_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-18T20:06:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Just pushed it up now._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2014-12-18T20:17:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_div_gt_What I can see so far_dd__lt_/div_gt__lt_br_gt__lt_div_gt_- mesh.moveWithCollisions move with a vector of (17_co_ 0_co_ -9)_lt_/div_gt__lt_br_gt__lt_div_gt_- then mesh.position is set to 17_co_ 0.5_co_ -9_lt_/div_gt__lt_br_gt__lt_div_gt_- almost immediatley the mesh is moved with a (-17_co_0_co_ 9)_lt_/div_gt__lt_br_gt__lt_div_gt_- so mesh.position is reverted to (0_co_ 0.5_co_ 0)_lt_/div_gt__lt_br_gt__lt_div_gt_ _lt_/div_gt__lt_br_gt__lt_div_gt_ _lt_/div_gt__lt_br_gt__lt_div_gt_So visual result is as expected _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/div_gt__lt_br_gt__lt_div_gt_ _lt_/div_gt__lt_br_gt__lt_div_gt_My first thinking would be_dd_ is (17_co_ 0_co_ -9) not too much??_lt_/div_gt__lt_br_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"agmcleod","Date":"2014-12-19T01:21:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Figured it out. In the end the best thing to do was use more high level functions of babylon. Instead of my own function_co_ im passing the mouse coords to scene.pick()_co_ and use the resulting hit coordinates to get it to work. I saw the picking collisions in the wiki_co_ but didn_t_t think of this application. I also dropped down the velocity to 10% of what it was._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]