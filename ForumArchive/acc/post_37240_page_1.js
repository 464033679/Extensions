[{"Owner":"captainleighwalker","Date":"2018-04-25T18:48:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tDear friends\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am pulling my hair out with a model imported from 3Ds max. When I use csg subtract the lighting on the new mesh looks different as if the vertices are in a different position to the original mesh. Or is it the normals.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have reproduced it here _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe difference is a lot worse on the mesh I am working with. It is a lot darker after the operation.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAny help?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks in advance\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pryme8","Date":"2018-04-25T19:08:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U%231_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U#1_lt_/a_gt__lt_br /_gt_\n\t_lt_br /_gt_\n\tI do not see anything noticeable.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-25T19:24:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOn my playground you can easily compare the original mesh and subtracted mesh and the lighting is looking different\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Arte","Date":"2018-04-25T19:32:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi from me_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAfter 2 sec... _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U%232_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U#2_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-25T20:18:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe problem is something to do with normal are different after subtract.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf I do convertToFlatShadedMesh then it looks like same. The problem is my mesh has curved surfaces.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHow can I get around this problem?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-25T20:38:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tCan you try to recreate the normals with mesh.createNormals(true) ?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-25T20:50:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt does sort the lighting out but its making the curves faceted (the bottom is the original mesh)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.png.16e5490961953b0b1497593a86e47f2d.png_qt_ data-fileid_eq__qt_18008_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_18008_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.thumb.png.1861301a1c8e18d6bb9f370a9b271aa0.png_qt_ alt_eq__qt_image.thumb.png.1861301a1c8e18d6bb9f370a9b271aa0.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is how it looks after using subtract \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.png.dac3727ff1feeb65af9c748edab11fd3.png_qt_ data-fileid_eq__qt_18009_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_18009_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.thumb.png.f6456d0098e68dc1a3680fb46957f803.png_qt_ alt_eq__qt_image.thumb.png.f6456d0098e68dc1a3680fb46957f803.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t get how this works or if it would have any affect but when drawing normal positions they seem to be in different position and rotation on _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U%233_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U#3_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-25T21:05:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tUnfortunately this is not an easy one and the CSG algorithm does not help a lot. \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tcan you share a repro on the playground with only your mesh? I_t_ll try to see how we can make sure the createNormals does not lose the smoothing\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-26T08:30:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tPlease see _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U%235_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U#5_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou have to replace var data with below as the file was too big. Thanks.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_________________________\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ve realised you get a different set of normals if you are using intersect depending on which mesh you intersect from.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSee _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#EFXZ8U%234_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#EFXZ8U#4_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you swap  bCSG.intersect(aCSG)_sm_for  aCSG.intersect(bCSG)_sm_ The normal are ok\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-26T21:29:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk unfortunately this is because of the CSG _lt_span_gt__lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt__gt_ it will separate the face and thus losing the smoothness_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span_gt_I have no solution for you this time (unless than digging into CSG to try to fix this behavior)_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-26T21:32:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tCould there be a way to recalculate normals and join vertices back together based on a threshold angle between the faces?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-26T21:50:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThere is an hope here_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//doc.babylonjs.com/snippets/minimise_vertices_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/snippets/minimise_vertices_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you do that and then run createNormals again it could work (not tested but worth the try)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"captainleighwalker","Date":"2018-04-26T22:00:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tnope! haha\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.png.d5137b558978352648ca76e895300910.png_qt_ data-fileid_eq__qt_18028_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_18028_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_04/image.thumb.png.b3a09599ac53f77ec09d35bdbca394b9.png_qt_ alt_eq__qt_image.thumb.png.b3a09599ac53f77ec09d35bdbca394b9.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-27T00:13:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tErf_dd_(\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]