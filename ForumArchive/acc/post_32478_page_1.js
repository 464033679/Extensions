[{"Owner":"focomoso","Date":"2017-08-20T22:50:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m trying to convert a 3d point to the 2d screen coordinates. Everything seems to work fine_co_ except that engine.getRenderWidth() and engine.getRenderHeight() are returning exactly double the actual canvas width and height so my points are coming back twice as big.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI tried to create a playground for this_co_ but could not reproduce the problem.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDoes anyone have any ideas what might make the renderWidth and height come back doubled?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"focomoso","Date":"2017-08-21T00:30:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI figured out the issue_co_ but not a work around. This only happens on my mac_t_s retina display. On a non-retina the sizes come back as expected. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tEdit_dd_ It only happens when the engine is created on the retina display. If start the engine on a regular display and then move it to retina. Everything works fine. If I start the engine on a retina display and then move over to regular_co_ I get this doubled size. So_co_ there must be something funky going on when the engine initializes and those values are set...\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-08-21T04:37:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tretina display has window.devicePixelRation of 2.  Look at setting the engine.setScalingLevel(...)_co_ if you change after engine is initialized?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tJust reading a bit and if that_t_s the case when changing displays then the window.resize is not fired.  Looks like you would need something in the game loop to check window width/height.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"focomoso","Date":"2017-08-21T18:45:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI found a fix. If you check engine.getHardwareScalingLevel()_co_ it_t_ll be .5 on the retina and 1 on regular displays.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI think this qualifies as a bug because it means that engine.getRenderWidth() / height give unexpected results on retina displays (and I haven_t_t even tested other hi-res displays). It should take the hardwareScaling into account as scene.pointerX and Y apparently do.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-08-22T23:12:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tDo you start your engine with adaptToDeviceRatio _dd_ true?  (last constructor parameter default _eq_ false for Engine_dd_ _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/classes/3.0/engine_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/classes/3.0/engine_lt_/a_gt_).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t think the engine resize event is triggered when you switch displays as I don_t_t think there is a listener for that in the browser_co_ but only on resize.  It_t_s an obvious over simplification_co_ but did you try something in your game loop like_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_scene.registerBeforeRender(() _eq_&gt_sm_\n   engine.setHardwareScalingLevel(1.0/window.devicePixelRatio)\n)_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tIf you look in the engine constructor that behaviour makes sense. _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/babylon.engine.ts#L772_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/babylon.engine.ts#L772_lt_/a_gt__lt_br /_gt_\n\tMaybe if adaptToDeviceRatio is true that should be default behaviour in BabylonJS?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"SvenFrankson","Date":"2017-08-23T10:38:59Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWhy don_t_t you use _lt_strong_gt_canvas.clientHeight_lt_/strong_gt_ and _lt_strong_gt_canvas.clientWidth_lt_/strong_gt_ ? Unless I misunderstood your issue_co_ it_t_s the value you_t_re looking for.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t(or _lt_strong_gt_engine.getRenderingCanvas().clientWidth_lt_/strong_gt__co_ if for some reason you can_t_t access the canvas object directly_co_ like in the playground)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFor what it worth_co_ to me_co_ it does make sense that the renderWidth is different from the canvas width when you_t_re working on a device with a pixel ratio not equal to 1. The engine renders on a texture_co_ which resolution is set in hardware pixel. If you wan_t_t to CSS this texture or mouse over it_co_ it_t_s expressed in logical pixels.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a lot of issues with the concept of pixel ratio lately_co_ when I got my first screen with a pixel ratio &gt_sm_ 1. These articles were kinda helpful _dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//alistapart.com/article/a-pixel-identity-crisis_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//alistapart.com/article/a-pixel-identity-crisis_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs well as brianzinn inputs here _dd_ \n_lt_/p_gt_\n_lt_iframe allowfullscreen_eq__qt__qt_ data-controller_eq__qt_core.front.core.autosizeiframe_qt_ data-embedcontent_eq__qt__qt_ data-embedid_eq__qt_embed2857283191_qt_ scrolling_eq__qt_no_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/32458-mobile-canvas-resolution/?do_eq_embed_qt_ style_eq__qt_height_dd_325px_sm_max-width_dd_502px_sm__qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tGood luck !\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-08-23T14:48:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI think this is solved.  There is a question in _qt_bugs_qt_ forum and looks like this was for BJS 2.5.  Oddly enough my window.devicePixelRatio is 2.5 _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"SvenFrankson","Date":"2017-08-23T15:52:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk maybe I misunderstood the issue ^^\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere_t_s a playground were hardwareScaling is forced to 0.5 _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#EE38I5%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#EE38I5#1_lt_/a_gt_ _co_ I think it displays the values focomoso described in his first post\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt_t_s _lt_strong_gt_canvas.clientHeight_lt_/strong_gt__co_ which takes into account the device pixel ratio (not canvas.height _co_as I thought)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-08-23T16:43:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tNo_co_ it_t_s more likely me that would misunderstand an issue!  I thought it was an issue switching screens with different pixel ratios.  When I switch screens my devicePixelRatio switches from 1 and 2.5_co_ although hardware scaling does not change.  At least with engine settings in that PG...\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]