[{"Owner":"yorke","Date":"2017-10-12T11:48:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi all_co_ in order to improve the performance of a scene built dinamically_co_ I_t_m facing this problem_dd_ is it possible to have one material_co_ to which is applied one texture_co_ using different uScale e vScale depending on the mesh to which that material is applied?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI need this because I have a 3d model of a city with many street segments_co_ each segment having quite different length from each others. Now_co_ those segments are textured_dd_ if I use the same uScale for them all_co_ the road texture would appear _qt_stretched_qt_ or _qt_shrinked_qt_ depending on the length of the segment on which the material is applied_co_ while I want it to appear uniform.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can bypass this problem assigning one different material for every street segment and setting uScale according to its length_co_ but in the end the amount of materials and textures grows dramatically and scene performance falls down at 3 - 4 fps. Any ideas of how reducing the number of materials?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThose are the actual stats for a mid-sized city_dd_ Total meshes 7309 - Total vertices 170688 - Total materials 7309 - Total textures 3834\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAny ideas on how to solve this?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks in advance_co_ cheers\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2017-10-12T14:22:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tIf you_t_re using two materials relying on the same texture_co_ it doesn_t_t really change the performance.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"yorke","Date":"2017-10-12T14:40:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk for 2 materials_co_ but 7k materials really don_t_t affect performances? On another thread i read a user having problems with 2k materials_co_ and he was told of decreasing their amount.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOtherwise_co_ what could cause the performance problem_co_ based on the numbers I posted and your experience? Too many meshes? Vertices?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMeshes are basically Ribbons for streets and ExtrudePolygon for buildings.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt_t_s impossible for me to replicate this in a PG (it also would crosspost on open street map site)_co_ so I try to paste a screenshot of the scene in wireframe. No other computations are done_co_ after having built the scene. 6 fps in wireframe_co_ fps decrease at 3-4 with solid rendering\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15196_qt_ height_eq__qt_449_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/image.png.c1ea74468355946347502d21824946fc.png_qt_ width_eq__qt_996_qt_ alt_eq__qt_image.png.c1ea74468355946347502d21824946fc.png_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2017-10-12T14:53:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tyep_co_ 7K materials must really impact the perfs_co_ you_t_re right.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-10-12T14:53:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe material count is directly linked to the draw calls. So if you have 7000 materials you could end up with 7000 draw calls which is FAR too much even for advanced gfx cards\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI really suggest that you merge meshes using the same (or compatible) materials to reduce your draw calls\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"yorke","Date":"2017-10-12T15:04:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFirst of all thanks to both of you for your quick replies _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_191739_qt_ data-ipsquote-contentid_eq__qt_33396_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1507820017_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t2 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tThe material count is directly linked to the draw calls. So if you have 7000 materials you could end up with 7000 draw calls which is FAR too much even for advanced gfx cards\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tI really suggest that you merge meshes using the same (or compatible) materials to reduce your draw calls\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tThe problem is just here_dd_ I don_t_t know how to use the same material for all road segments_co_ so I_t_m using a material per segment.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBasically all roads would have to use the same material (texture is the same for them all)_co_ but I don_t_t know how to let segment A use a different uScale than segment B_co_ in order to not stretch or shrink texture appearance according to segment length. E.g. if segment A is longer 10 times than segment B_co_ and they use the same material and so the same uScale_co_ texture results larger 10 times on segment A than on segment B. Is there another way to draw repeated textures on a surface not using uScale/vScale?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-10-13T18:35:53Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIn this case you should not use the uScale/vScale from the texture. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou should leave it to 1 and instead update the uv coordinates of the mesh\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2017-10-14T04:18:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tIf you use ribbons_co_ you can customize your own UVs with the optional parameter uvs _dd_ _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/classes/3.0/meshbuilder#static-createribbon-name-options-scene-rarr-mesh-classes-3-0-mesh-_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/classes/3.0/meshbuilder#static-createribbon-name-options-scene-rarr-mesh-classes-3-0-mesh-_lt_/a_gt_\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"yorke","Date":"2017-10-16T08:49:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tTnx for your suggestion Jerome. I tried to use those options (I didn_t_t know them)_co_ but they seem to work for _lt_span style_eq__qt_color_dd_#000000_sm__qt__gt_BABYLON.MeshBuilder.CreatePolygon but not for _lt_/span_gt__lt_span style_eq__qt_color_dd_#000000_sm__qt__gt_BABYLON.MeshBuilder.CreateRibbon._lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere are two PGs in which I tried to set UVs to repeat texture on a 10x10 grid_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFor Polygons it works_dd_ _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#4G18GY%238_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#4G18GY#8_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFor Ribbons_co_ it seems to not work_co_ grid still appears to be 1x1_dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#165IV6%2383_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#165IV6#83_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAm I missing something?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2017-10-16T09:08:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tyep _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#165IV6%2384_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#165IV6#84_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthe sideOrientation values_co_ like the frontUvs and backUvs ones_co_ because they build the internal ribbon geometry_co_ must declared at construction time.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe ribbon update method can only change then the vertex positions_co_ colors or uvs.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"yorke","Date":"2017-10-16T12:30:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWoah finally I got it working...  I got crazy because I was using BABYLON.Mesh.CreateRibbon instead of BABYLON._lt_strong_gt_MeshBuilder_lt_/strong_gt_.CreateRibbon and I couldn_t_t figure why pathArray[0] was undefined_co_ what a n00b _lt_img alt_eq__qt__dd_P_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_tongue.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/tongue@2x.png 2x_qt_ title_eq__qt__dd_P_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tMany thanks jerome_co_ that did the trick_co_ tnx for your time\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]