[{"Owner":"fenomas","Date":"2018-02-20T08:12:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi_co_ quick questions. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a big scene (500+ meshes)_co_ over a reasonably large area_co_ which uses octrees. My use case is_co_ I_t_d like to add many _lt_em_gt_short-range_lt_/em_gt_ point lights to the scene - think fireflies - that have a small _qt_range_qt_ property and thus only affect a small number of meshes. In other words_co_ the scene would have more than 4 lights_co_ but each mesh will be lit by fewer than 4 lights.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy questions_dd_\n_lt_/p_gt_\n\n_lt_ol_gt_\n\t_lt_li_gt_\n\t\tIs it correct to assume that a light_t_s _lt_strong_gt_range_lt_/strong_gt_ property does not interact with the _qt_4 lights per mesh_qt_ limitation? In other words_co_ if I add a point light with _lt_strong_gt_range_eq_1_lt_/strong_gt_ to my scene_co_ every mesh in the scene is _qt_lit_qt_ by that light even if they are far away_co_ right?_lt_br /_gt_\n\t\t \n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tIt looks like the correct/only way to do what I_t_m asking for is to add meshes to each light_t_s _lt_strong_gt_includedOnlyMeshes_lt_/strong_gt_ array. Is this right?_lt_br /_gt_\n\t\t \n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tIs it correct to assume that _lt_strong_gt_includedOnlyMeshes_lt_/strong_gt_ doesn_t_t know about octrees or parent/child relationships? In other words_co_ if I want a point light to only affect the meshes in a particular octree_co_ I need to add all those meshes to the light_t_s _lt_strong_gt_includedOnlyMeshes_lt_/strong_gt_ array_co_ and their children_co_ right?\n\t_lt_/li_gt_\n_lt_/ol_gt_\n\n_lt_p_gt_\n\tThanks!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2018-02-20T16:02:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSlow response to question 1. The demo is a little rough and ready but in the following scene a number of _t_planets_t_ are each lit by their own _t_sun_t_. The range on the _t_sun_t_ is such that it lights only its own planet.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/indexstable#2KUJS7%231_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/indexstable#2KUJS7#1_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-02-20T16:28:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI see nothing involving the .range of a light _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Materials/babylon.materialHelper.ts#L500_qt_ rel_eq__qt_external nofollow_qt__gt_where they get bound_lt_/a_gt_.  There is a _lightSources property of AbstractMesh.  It can updated _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Mesh/babylon.abstractMesh.ts#L509_qt_ rel_eq__qt_external nofollow_qt__gt_in_lt_/a_gt_.  I would look into that first_co_ cause I am not sure when / if this gets called.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIncludeOnlyMeshes for each light seems like another way to go.  If it helps_co_ the max can also be changed at the material level. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne thing I do is attach a point light to a camera_co_ which moves / rotates to match the light to the camera in a scene.beforeCameraRender.  This can really reduce the number of lights needed in the first place.  Does a part of the scene really need to have a light when it is not on the frame.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-20T19:40:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t1. Unfortunately no. The range is used to compute the quantity of energy received but not to remove a mesh from a light_t_s activeMeshes list (mainly because the cost to evaluate to distance to the mesh is prohibitive)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t2. Correct\n_lt_/p_gt_\n\n_lt_p_gt_\n\t3. Correct\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMore about how lights are tied to meshes here_dd_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Lights/babylon.light.ts#L406_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Lights/babylon.light.ts#L406_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-02-20T20:44:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t canAffectMesh in link from _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ (where the _lt_span_gt_includedOnlyMeshes_lt_/span_gt_ is evaluated) is in done in a loop of _lt_span_gt_this_lt_/span_gt_._lt_span_gt_getScene_lt_/span_gt_()._lt_span_gt_lights_lt_/span_gt__co_ so you need to make sure that lights with the _lt_span_gt_includedOnlyMeshes_lt_/span_gt_ are early in the array or all the slots could get filled up with lights that are too far away.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"fenomas","Date":"2018-02-21T05:12:08Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks folks_co_ I think I have the general idea..\n_lt_/p_gt_\n\n_lt_p_gt_\n\tLots o_t_ lights_dd_ _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#WJWSNL_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#WJWSNL_lt_/a_gt_  _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tFollow up question for _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt__dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf a light has an _lt_span style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#353c41_sm_font-size_dd_14px_sm__qt__gt__lt_strong_gt_includedOnlyMeshes_lt_/strong_gt_ array_co_ and all of the included meshes are not rendered (e.g. due to frustum culling)_co_ that light won_t_t have any performance impact on the scene since it_t_s not bound to any meshes_co_ right? _lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#353c41_sm_font-size_dd_14px_sm__qt__gt_Or in other words_co_ if I maintain an accurate list of included meshes for a light_co_ I assume there_t_s no need to disable the light when its outside the view frustum?_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-21T16:46:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis is correct. Lights are only impacting performance at render time\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]