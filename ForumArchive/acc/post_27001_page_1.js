[{"Owner":"royibernthal","Date":"2016-12-12T14:21:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_strong_gt_The scene_dd__lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a scene with 21 textured very low poly (300-400 poly count) models with skeletons and animations.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOut of which I null the skeleton of 20 of the models_co_ in order for bjs to avoid calculating their bones. (done to increase performance)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhenever I_t_m playing the animation of any of the 20 models (happens seldom)_co_ I_t_m temporarily setting their skeleton back for the period of the animation.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe remaining model plays animation in a loop.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a pretty strong computer (runs latest hardcore 3d games).\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_The problem_dd__lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe game mostly runs very smoothly_co_ but in the beginning_co_ I suspect before each model was visible on the screen and/or each animation was played for the first time_co_ or something of the sort_co_ there are a few freezes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tA freeze is mostly 0.1-0.3 seconds but can even get to 3-5 seconds.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAfter a few of these freezes occur (typically 2-3 freezes after game initialization)_co_ the game keeps playing smoothly with no more freezes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThroughout the game different models are displayed_co_ but always in the format I displayed above (20 mostly with no skeleton_co_ seldom play animations_co_ 1 plays animation in loop).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m suspecting the reason behind these freezes is garbage collection - which for some reason happens only a few times and then stops.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCould bjs be doing lazy initialization of certain things only when they need to be used and after each initialization which happens on the run there_t_s enough garbage to trigger a garbage collection? e.g. bjs initializing certain things only before playing an animation for the first time. Such a thing would explain the freezes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHopefully I gave you enough info to solve this without a PG / profiling.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-12-12T15:07:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIf it only happens when loading meshes_co_ it is due to the buffer initialization_co_ which is_co_ very very sadly_co_ synchronous.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tyou can notice such pauses when loading the scenes on babylonjs.com as well - see that the loading symbol stops turning and freezes for a very short period of times. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tLong pauses are caused due to large number of vertices (depends on the amount of calculations needed. For example when loading an .obj file_co_ babylon needs to convert OBJ Vertex format to Babylon vertex format. This is also synchronous and depends on the amount of data).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is just an assumption thou! If you have a way to actually show your scene_co_ it will be easier to tell you if that_t_s the problem.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-12T15:44:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSharing the scene would be problematic for me as it_t_d reveal confidential information_co_ so as much as I would like to_co_ I can_t_t at the moment.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a preloader that loads the meshes before I_t_m showing anything_co_ after everything is loaded and the game starts - there are freezes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tbtw_co_ are you by any chance originally from Israel?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-12-12T15:54:25Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWith a name like this? My parents either didn_t_t love me at all_co_ OR they are somehow Israeli related _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_. So_co_ yes_co_ originally.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAbout the scene - Will be hard to check the freezes without seeing it. If you are sure the meshes are preloaded_co_ and sure that the meshes buffers (and WebGL buffers) are created pre-render_co_ then something else works synchronous and blocking your scene for a while. Are you making any heavy calculations / array traversals / object initialization / Hummus making / etc that might create a (relative) heavy load?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-12-12T15:58:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tYou could enable OpenGL see if you get a better results. This is not a end client solution_co_ but then you have a direction to work with. TextureBufferSize.  And when not_co_ you have to do some scene optimizations. _lt_br /_gt_\n\tGook Luck.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-12T16:46:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYeah your name gave you up _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m starting the game once the AssetsManager finishes loading all assets_co_ including meshes. Is it possible that the mesh buffers and WebGL buffers are not already created at that point?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m not making any heavy calculations / hummus. Once the scene is created I_t_m not initializing anything else_co_ unless my actions cause initializations under the hood which I don_t_t know about. As for array traversals - going over an array of 20 meshes every frame_co_ which is negligible.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn my scene I_t_m changing every frame the position and scaling of the meshes_co_ and swapping meshes with other (already loaded) meshes. That_t_s about all I_t_m doing_co_ could it be an issue?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-12-12T16:53:25Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNope_co_ shouldn_t_t be an issue. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAgain_co_ these are only suggestions as it_t_s hard to debug without actually debugging_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere is a way to initialize (and load) meshes when they are first visible. Might be something you sry without knowing? Can you check that all meshes are ready prior to the first frame render?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-12T16:55:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe lags that you are seeing are probably caused by the shaders.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is how things work internally_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- The very first time a mesh uses a new material_co_ the shader is compiled. This is (not my fault _dd_)) a synchronous task\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- It will freeze everything on your screen for a few milliseconds\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- Next renders will be faster as compilation is kept in memory\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy advice_dd_ do not start rendering until all material.isReady(mesh) are not true.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BitOfGold","Date":"2016-12-12T17:10:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tJust one idea_dd_ when I_t_m watching video on my other monitors with a good encoding (like x265 HEVC)_co_ all webgl FPS suffers periodic lags in every 1-2s._lt_br /_gt_\n\tSometimes even a facebook video in another browser causes lags._lt_br /_gt_\n\tJust one thing to clear out as NOT beeing the problem...\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"fenomas","Date":"2016-12-12T17:31:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNo need to theorize about this stuff_sm_ get to know your browser_t_s profiling features. Modern browsers can tell you exactly how long they spend on GCs_co_ rendering_co_ specific JS functions_co_ etc.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn Chrome_co_ you want to open devtools_co_ go to either the Timeline or Profile tab_co_ and hit the circle in the upper left to start/stop recording a profile.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-12T17:56:59Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThere_t_s one freeze that always happens - right before I set the skeletons of 5 of the meshes and play animations in all of them in parallel_co_ for the first time. (profile below in reply to fenomas)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tRaanan - Yeah I understand these are only suggestions based on the info available to you_co_ if I_t_t_t_ll turn out impossible to solve it like that I might be able to share the source code in private_co_ if that works for you.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould that be possible given I_t_m explicitly preloading all meshes using AssetsManager before rendering them?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBy checking if all meshes are ready do you mean what Deltakosh suggested? If so see my reply to him below.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tDeltakosh - I checked mesh.material.isReady(mesh) for all meshes and they_t_re all true before I begin testing.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tBitOfGold - I have no video open on my computer while testing.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tfenomas - I have zero experience with the browser_t_s profiling features_co_ but let_t_s see if I got this right_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI think that the problem is with requestAnimationFrame which at the freeze point took 506.86ms and dropped the fps to 1.89 from an average of 36.52 (out of a max of 60).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere are also Minor GCs all over the place_co_ the max for a single GC I think is 25.11ms.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tJust in case_co_ I uploaded the recorded profile for you to take a look as well.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/applications/core/interface/file/attachment.php?id_eq_10708_qt_ data-fileid_eq__qt_10708_qt_ rel_eq__qt__qt__gt_profile.json_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe freeze point in this profile is the one I mentioned in the first line of this reply.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-12T18:04:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tBeware_co_ you must do the test AFTER attaching the skeletons to the meshes as this will trigger a new compilation (The shader has to add support for bones hence a recompilation)\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-12T19:20:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNow for the sake of testing I_t_m no longer setting/unsetting the skeletons_co_ the skeletons are always set.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould setting them_co_ waiting for shader compilation (material.isReady?)_co_ and unsetting them be the right way to initialize everything before rendering? In order to later be able to freely set/unset them.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould unsetting a skeleton once the shader has already added support for bones even improve the performance or is doing such a thing completely redundant?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat same freeze no longer happens when skeletons are always set_co_ however when I play the game a little longer another freeze happens before an animation that occurs a little later on.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe following come one after the other in the new freeze point_dd_\n_lt_/p_gt_\n\n_lt_ul_gt__lt_li_gt_\n\t\trequestAnimationFrame - 526.66ms\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tNon-incremental GC - 305.31ms (Too many bytes allocated)\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tMinor GC - 28.32ms (Too many bytes allocated)\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tNon-incremental GC - 210.21ms (Dead global revived)\n\t_lt_/li_gt_\n_lt_/ul_gt__lt_p_gt_\n\tUploaded again the recorded profile_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.dropbox.com/s/cro3ve00k00dsa7/profile.json?dl_eq_0_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.dropbox.com/s/cro3ve00k00dsa7/profile.json?dl_eq_0_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn another profiling a shorter freeze occurred_co_ completely unrelated to animation_dd_\n_lt_/p_gt_\n\n_lt_ul_gt__lt_li_gt_\n\t\tIncremental GC - 212.61ms\n\t_lt_/li_gt_\n_lt_/ul_gt__lt_p_gt_\n\tRecorded profile for that one_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/applications/core/interface/file/attachment.php?id_eq_10720_qt_ data-fileid_eq__qt_10720_qt_ rel_eq__qt__qt__gt_profile.json_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-12T21:20:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t\t\tWould setting them_co_ waiting for shader compilation (material.isReady?)_co_ and unsetting them be the right way to initialize everything before rendering? In order to later be able to freely set/unset them.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYes\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm_float_dd_none_sm__qt__gt_Would unsetting a skeleton once the shader has already added support for bones even improve the performance or is doing such a thing completely redundant?_lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYes as a mesgh with skeleton is slower (because of skeleton computation)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-12T23:14:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m trying to grasp what_t_s going on.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tImmediately after AssetsManager finishes loading meshes_co_ skeletons are automatically set on the loaded meshes. mesh.isReady() and mesh.material.isReady(mesh) both return true. (allegedly reporting that shaders with support for bones have been compiled?)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFollowing that I null the skeletons_co_ in order to avoid skeleton computation when not needed.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThen when I set them back before animating the models the freeze/lag occurs as if the shaders support for bones is just now being compiled_co_ and previously the mesh.isReady() and mesh.material.isReady(mesh) falsely reported true.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDoes it make sense?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso_co_ were you able to deduce anything from the profiles I described in my previous reply? The problem seems to be more complicated than compiling shaders with support for bones_co_ or alternatively_co_ there is more than one problem causing lags.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-13T00:24:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tFollowing that I null the skeletons_co_ in order to avoid skeleton computation when not needed.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYou then need to wait for the material to be ready for this configuration as well\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-14T01:48:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m now waiting for material to be ready for both configurations - first waiting for with bones_co_ then for without bones.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere are no longer freezes before playing animations for the first time_co_ but there are freezes immediately when beginning to render meshes without bones.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy guess is my check for material ready is valid for with bones_co_ but not for without bones_co_ and here_t_s why_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAt first_co_ by default_co_ meshes are loaded with bones_co_ I simply avoid nulling their skeletons until the material is ready (material starts as not ready when AssetsManager finishes loading the meshes).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOnce the material is ready for that configuration_co_ I_t_m nulling the skeletons_co_ if I check for material ready immediately after nulling the skeletons it_t_ll still return true_co_ as if for the previous configuration (with bones). It still returns true after a tiny setTimeout.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhen starting to render_co_ apparently the configuration without bones still hasn_t_t been compiled_co_ and results in small freezes. (or at least that_t_s my interpretation of the freezes)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAm I correct to assume that the configuration without bones hasn_t_t been compiled yet even though checking for material ready after nulling the skeletons returns true? If so_co_ is there a way for me to make sure that bjs is already tracking the compilation of the new configuration without the bones so that I know when checking for material ready will give me a relevant result?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_EDIT_dd_ _lt_/strong_gt_I started the rendering the meshes with skeletons by mistake_co_ which is probably the reason there was enough time to compile the shaders with bones support_co_ and not lag before starting an animation.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHowever now when I start rendering the meshes on the screen without skeletons (after checking of course for material ready for both configurations)_co_ there are freezes again.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAll this leads me to believe that when meshes stay in a certain configuration enough time (e.g. with bones) it_t_ll be compiled and there won_t_t be future freezes_co_ but that I can_t_t really trust material.isReady().\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt_t_s highly likely though that I fail to understand something or I keep missing something - in which case it_t_d be great if you could help me understand what_t_s going on.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-14T20:15:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tTo dig into this more deeply can you provide a simple repro on the PG?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWe could then analyze what is going on\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-15T00:59:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWould sending a link to the source code in private work for you?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can_t_t make it public because it contains confidential information_co_ and I doubt I can effectively create a simplified repro in a PG without revealing that information.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-15T16:06:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tNot really. I_t_m not always available and having a public PG is really useful for the community to help.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-15T16:18:32Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSomething like that_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#11BH6Z%23189_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#11BH6Z#189_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-15T17:02:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYes I understand_co_ what I see in the PG you linked to is more or less what I_t_m doing but there_t_s more going on.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t know how to simplify the repro while still maintaining the issue and without revealing my confidential information_co_ otherwise I would have already made a PG.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can ZIP the source_co_ once you get a few minutes to answer you can simply unzip and run it immediately_co_ not much different from running a PG online_co_ takes an extra 1-2 minutes to download and that_t_s it.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSorry for insisting_co_ I really can_t_t find a way around sharing it in private_co_ hopefully you_t_ll find the request reasonable.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-12-15T21:07:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tIt is reasonable _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ send it to davca@microsoft.com (But please make the sample as simple as possible_co_ I don_t_t want to spend ages debugging through no relevant code)\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"royibernthal","Date":"2016-12-16T00:42:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tThanks for understanding _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ Sent\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]