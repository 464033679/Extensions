[{"Owner":"BlackMojito","Date":"2018-01-23T15:36:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI have some doubt about the depth shader. The output seems not to be the depth value in NDC space_co_ nor the value like gl_FragCoord.z. So what it is about? Please correct me if I am wrong. _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_gl_Position _eq_ viewProjection * finalWorld * vec4(position_co_ 1.0)_sm_\n\t\nvDepthMetric _eq_ ((gl_Position.z + depthValues.x) / (depthValues.y))_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-23T21:25:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe value is in linear space\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSee here an example on how to use it_dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BlackMojito","Date":"2018-01-24T03:13:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_202364_qt_ data-ipsquote-contentid_eq__qt_35246_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516742746_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t5 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHello!\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tThe value is in linear space\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tSee here an example on how to use it_dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_lt_/a_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tThank you _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_. Hummm...I am really confused. As far as I understand_co_  the z component in projection space (some sort of 1/Zviewspace) is linear in screen space (for interpolation reason) but non linear as depth. So this is for convert it again to a linear depth but mapped in [0_co_ 1]?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe value of vDepthMetric is \n_lt_/p_gt_\n\n_lt_p_gt_\n\t1 - ((far - gl_Position.z) / (far + near)). I am not sure why it is linear again. Maybe it is a stupid question though...Thanks in advance for more explanation. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne more question_co_ is gl_FragCoord.z the interpolation result of z in projection space?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BlackMojito","Date":"2018-01-24T09:03:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_202364_qt_ data-ipsquote-contentid_eq__qt_35246_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516742746_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t8 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHello!\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tThe value is in linear space\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tSee here an example on how to use it_dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_lt_/a_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tHi _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt__co_ the sample you gave was about the SSAO2_co_ it uses the GeometryBufferRenderer which is based on the shader geometry.vertex.fx and geometry.fragment.fx.  Please see the links below. Here we output directly depth in view space (although I don_t_t understand why we need to divide z by w because w should always be 1.0 here). It works perfectly with the SSAO2 sample as it construct a viewRay in View space.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.vertex.fx#L40_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.vertex.fx#L40_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.fragment.fx#L30_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.fragment.fx#L30_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy initial question is about depth.vertex.fx and depth.fragment.fx_co_ which I believe are used by DepthRenderer. Then the output of DepthRenderer is used by SSAO effect. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tin depth.vertex.fx\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_gl_Position _eq_ viewProjection * finalWorld * vec4(position_co_ 1.0)_sm_\n\t\nvDepthMetric _eq_ ((gl_Position.z + depthValues.x) / (depthValues.y))_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_pre_gt_\n_lt_code_gt_float depth _eq_ texture2D(textureSampler_co_ vUV).r_sm_\nvec3 position _eq_ vec3(vUV_co_ depth)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BlackMojito","Date":"2018-01-24T09:19:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_202364_qt_ data-ipsquote-contentid_eq__qt_35246_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516742746_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t8 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHello!\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tThe value is in linear space\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tSee here an example on how to use it_dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ssao2.fragment.fx#L43_lt_/a_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tHi _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt__co_ the sample you gave was about the SSAO2_co_ it uses the GeometryBufferRenderer which is based on the shader geometry.vertex.fx and geometry.fragment.fx.  Please see the links below. Here we output directly depth in view space. This should be the linear depth. It works with the SSAO2 sample as it construct a viewRay in View space.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.vertex.fx#L40_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.vertex.fx#L40_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.fragment.fx#L30_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/1dd71f9e125247a54c315d870b979ee0ec731433/src/Shaders/geometry.fragment.fx#L30_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy initial question is about depth.vertex.fx and depth.fragment.fx_co_ which I believe are used by DepthRenderer. Then the output of DepthRenderer is used by SSAO effect. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tin depth.vertex.fx\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_gl_Position _eq_ viewProjection * finalWorld * vec4(position_co_ 1.0)_sm_\n\t\nvDepthMetric _eq_ ((gl_Position.z + depthValues.x) / (depthValues.y))_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tin ssao.fragment.fx\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_float depth _eq_ texture2D(textureSampler_co_ vUV).r_sm_\nvec3 position _eq_ vec3(vUV_co_ depth)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tAs we know that vUV is [0_co_ 1]_co_ so should be the _qt_depth_qt_. My question is why we don_t_t directly use gl_FragCoord.z? Why we use the _qt_vDepthMetric_qt_?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BlackMojito","Date":"2018-01-24T09:50:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/11802-luaacro/?do_eq_hovercard_qt_ data-mentionid_eq__qt_11802_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/11802-luaacro/_qt_ rel_eq__qt__qt__gt_@Luaacro_lt_/a_gt__co_ would you please help answer the question as you are the implementer of SSAO? \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-24T17:10:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello unfortunately gl_FragCoord.z is NOT linear\n_lt_/p_gt_\n\n_lt_p_gt_\n\tcheck the answer here_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//stackoverflow.com/questions/13711252/what-does-gl-fragcoord-z-gl-fragcoord-w-represent_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//stackoverflow.com/questions/13711252/what-does-gl-fragcoord-z-gl-fragcoord-w-represent_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_em_gt_(z _eq_ (clip.z/clip.w)/2 + 0.5)_lt_/em_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]