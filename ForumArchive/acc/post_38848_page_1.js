[{"Owner":"Ardafravash","Date":"2018-07-15T00:25:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi Guys_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am new to Babylon and been given a task to apply pbr Material to obj files after they are imported in an already existing babylon project.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI cant figure it out how to do this and I was thinking if any of you lads could help me on this. This project contains two js files_co_ one called render and other one is loadfile. I dont know how and in which class to define PBR material _co_ adjust the PBR attributes and where to force the loaded obj files to use the defined PBR material. I would be grateful if you help me on this.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-07-15T16:27:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi - Welcome to the forum!  What you are asking is going to depend on a couple of factors.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t1. Version of BabylonJS  OBJ loader_lt_br /_gt_\n\t2. If your OBJ files are already loading a Material.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo_co_ if you look at the OBJ loader latest version_co_ the parseSolid() method waits until all the materials are loaded before returning (blocking)_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/loaders/src/OBJ/babylon.objFileLoader.ts#L906_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/loaders/src/OBJ/babylon.objFileLoader.ts#L906_lt_/a_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m assuming you are on an older version_co_ since it_t_s an existing project and this is a really new change._lt_br /_gt_\n\t_lt_br /_gt_\n\tWhat this means for working with an OBJ file with material using an _lt_strong_gt_older_lt_/strong_gt_ version of BabylonJS can be quite confusing_co_ because if you assign a material in your _lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#66d9ef_sm_font-size_dd_14px_sm__qt__gt_function_lt_span_gt_﻿_lt_/span_gt__lt_/span_gt__lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#f92672_sm_font-size_dd_14px_sm__qt__gt_ _lt_/span_gt__lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#a6e22e_sm_font-size_dd_14px_sm__qt__gt_initmesh_lt_/span_gt__lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#f8f8f2_sm_font-size_dd_14px_sm__qt__gt_( _lt_span_gt_﻿_lt_/span_gt_mesh_lt_span_gt_﻿_lt_/span_gt_ )_lt_span_gt_﻿_lt_/span_gt__lt_/span_gt_ then it will be overwritten when the MTL file loads asynchronously.  You can see if your OBJ file is loading materials from the OBJ file text contents_co_ but you can also see in the network tab if a .MTL file is being loaded.  I_t_m pretty sure that if you set a material in initmesh(mesh) and the MTL file loads on older versions that the PBR material you assign in initMesh() will get overwritten - at least on slower connections.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo_co_ 3 options that I can see_dd__lt_br /_gt_\n\t1. Upgrade OBJ Loader. Set PBR material in initMesh function._lt_br /_gt_\n\t2. Remove materials from OBJ files.  You should do this anyway to save bandwidth_co_ if the materials aren_t_t needed.  For any OBJ loader version.  Set PBR Material in initMesh._lt_br /_gt_\n\t3. Write a hacky looping setTimeout() from initMesh() that checks if your mesh has a material assigned.  This is really not a good option - especially if the MTL file failed to load it would never complete.  This option is more to understand the async nature of Materials loading._lt_br /_gt_\n\t_lt_br /_gt_\n\tYou will need to figure out a way to see if the meshes should have a PBR material on them.  You can use mesh.name or some other way.  Then follow this playground (PG)_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#8MGKWK%230_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#8MGKWK#0_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Ardafravash","Date":"2018-07-16T06:04:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tproject is using \n_lt_/p_gt_\n\n_lt_p_gt_\n\tbabylon.objFileLoader.min.js\n_lt_/p_gt_\n\n_lt_p_gt_\n\thow can i do that?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-07-16T06:09:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tget the nightly here_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/dist/preview%20release/loaders/babylon.objFileLoader.min.js_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/dist/preview release/loaders/babylon.objFileLoader.min.js_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Ardafravash","Date":"2018-07-16T10:20:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOne more question_dd_)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\thow can i get object name in task loaded meshes?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy obj contains many parts and i want to assign the pbr to items by name _co_ so i want to loop through meshes. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tHow i vould loop through _lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#f8f8f2_sm__qt__gt_loadedMeshes _lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#23241f_sm_color_dd_#f8f8f2_sm__qt__gt_and find object name door?_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-07-16T16:06:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYou could have a giant switch statement in your initmesh_co_ but maybe better to flow something through from the original caller.  The other problem with initMesh is you don_t_t know which OBJ file_co_ so you could have the same _t_name_t_ on a mesh from different OBJ files.  You_t_ll perhaps want to start with on your onSuccess() callback declaration_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_task.onSuccess _eq_ function(task) { task.loadedMeshes.forEach( initmesh_co_ this )_sm_}_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tI think I would change that a bit to something like - make sure the correct _t_this_t_ context is going through and you can use ES6 arrow functions_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\ttask.onSuccess _eq_ (task) _eq_&gt_sm_ {_lt_br /_gt_\n\t  task.loadedMeshes.forEach(loadedMesh _eq_&gt_sm_ initMesh(loadedMesh_co_ arrayPBR))_lt_br /_gt_\n\t}_lt_br /_gt_\n\tThen you could do something like_dd__lt_br /_gt_\n\tloadobj( _qt_P_MedDensitySideText_qt__co_ _qt_Side Text_qt_ _co_ [_qt_pbr_mesh_name_1_qt__co_ _qt_pbr_mesh_name_2_qt_)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAdd a param to initMesh for the mesh names (mesh.name in array) to add the PBR material.  Something like that maybe._lt_br /_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2018-07-17T16:16:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNot sure if this will answer any questions_co_ but this is how people done it_co_ back in the good old days_dd_ _lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/24210-textures-not-loaded/_qt_ rel_eq__qt__qt__gt_http_dd_//www.html5gamedevs.com/topic/24210-textures-not-loaded/_lt_/a_gt__lt_br /_gt_\n\tthey call me - the M a s t e r of cloning.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br /_gt_\n\tLinks are broken_co_ was hosting stuff on Gdrive_co_ and it quit some of the service (or something)\n_lt_/p_gt_\n\n_lt_ul_gt_\n\t_lt_li_gt_\n\t\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#95MJI8%237_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#95MJI8#7_lt_/a_gt_\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#RBMUC%2313_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#RBMUC#13_lt_/a_gt_\n\t_lt_/li_gt_\n_lt_/ul_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]