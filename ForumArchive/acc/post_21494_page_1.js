[{"Owner":"Numa","Date":"2016-03-27T05:34:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi there_co_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m working on a little project where I do a lot of parenting and swapping parents/children around_co_ etc..\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there an easy way to preserve a child_t_s world position when changing its parent? I_t_m really new to Babylon so I don_t_t always know what_t_s available to me.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf this doesn_t_t exist how would I go about it? Inverse the parent_t_s world matrix and apply to it its child? If someone has an example handy I_t_d appreciate _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n_lt_p_gt_\n\tThanks!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-03-27T19:14:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello_co_ we_t_ve got you covered _sm_D\n_lt_/p_gt_\n\n_lt_p_gt_\n\tJust use mesh.getAbsolutePosition() before removing the parent and then mesh.setAbsolutePosition() after setting the new parent\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-03-28T05:35:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGreat_co_ that works_co_ thanks!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-06T00:26:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t2 questions on this_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t1. Do I need to call updateWorldMatrix() after setting the parent or after setting the new position? on both child and parent?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t2. What about rotation and scale? There is no getAbsoluteRotation() / Scaling\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there an easy trick to only change the parenting without moving the object at all? Would multiplying the child_t_s world matrix by the the inverted parent_t_s world matrix do it?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks! (also_co_ a little bool to preserve original matrix or not when parenting would be great _dd_D)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-04-06T00:40:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_123903_qt_ data-ipsquote-contentid_eq__qt_21494_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1459902416_qt_ data-ipsquote-userid_eq__qt_20501_qt_ data-ipsquote-username_eq__qt_Numa_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t12 minutes ago_co_ Numa said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tWould multiplying the child_t_s world matrix by the the inverted parent_t_s world matrix?\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\thave you tried it?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-06T01:07:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYes I did and it didn_t_t seem to work. I_t_m only asking for someone to confirm the theory here. If I tried it and it didn_t_t work_co_ does it mean my code is wrong? or is there a bug in Babylon? or is it not the way to go at all? _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m very new to Babylon and Coming from Unity I make a lot of assumptions about how things work _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt_ And later realize I need to do some special handling when working at a lower level.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo_co_ is that the way to go?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-04-06T10:38:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_123908_qt_ data-ipsquote-contentid_eq__qt_21494_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1459904823_qt_ data-ipsquote-userid_eq__qt_20501_qt_ data-ipsquote-username_eq__qt_Numa_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t10 hours ago_co_ Numa said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_float_dd_none_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_Yes I did and it didn_t_t seem to work. I_t_m only asking for someone to confirm the theory here._lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tIt sounds right to me.  Can you create a PG?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-07T05:12:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m looking into it_co_ I think it_t_ll work. I_t_m wondering why there is a getAbsolutePosition_co_ but nothing for rotation and scale... instead I have to get the world matrix and decompose it because there is a getWorldMatrix but no setter_co_ so I have to set each component manually.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ll post updates later_co_ I_t_m onto a different problem now _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-04-07T16:10:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHello NUma_co_ getAbsolutePosition is fast and can be called often. In the contrary_co_ extracting rotation and scaling is slow_co_ time and memory intensive so I prefer not expose a simple function _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-07T18:36:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tThat makes sense_co_ how would I go about getting and setting the absolute rotation and scale then? Or even better_co_ is there a way to set the world matrix directly? I tried doing myMesh._worldMatrix _eq_ myWorldMatrix but it didn_t_t seem to have an effect even if I called computeWorldMatrix(true)\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-04-07T19:03:38Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tPlease create a PG of your failed attempt.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tEdit_dd_  You can_t_t set the world matrix directly for meshes.  You can with bones.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-11T02:48:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFixed it_co_ the problem was that computeWorldMatrix() doesn_t_t go down the hierarchy (I assumed it would)_co_ so after changing parents none of the children would be aware of the change. I had to add something like_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_function UpdateWorldMatrix(object)\n{\n    object.computeWorldMatrix(true)_sm_\n\n    for (var i _eq_ 0_sm_ i &lt_sm_ object.getChildren().length_sm_ i++) {\n        UpdateWorldMatrix(object.getChildren()[i])_sm_\n    }\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tnote that you need to check that the hierarchy is valid beforehand to avoid running into infinite loops in some sneaky scenarios like (A---&gt_sm_ B ---&gt_sm_ C ---&gt_sm_ A).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat_t_s an area where Babylon could really use some improvement _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ beside the .parent _eq_  _co_ everything has to be handled manually. I might contribute some code later when I feel more comfortable with the library _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAll it needs is a object.Attach(parent_co_ keepWorldTransform) function that handles the attaching / detaching / propagating updated matrices_co_ and lets you choose whether you want your child to keep its world or local transform.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is what the matrix operations look like if you want to preserve the world position after changing parents_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_function Attach(object_co_ parent) {\n\n    object.parent _eq_ parent_sm_\n\n    // Get parent_t_s inverse matrix\n    var invertParentWorldMatrix _eq_ object.parent.getWorldMatrix().clone()_sm_\n    invertParentWorldMatrix.invert()_sm_\n\n    // Combine it with the child_t_s\n    var newWorldMatrix _eq_ object.getWorldMatrix().multiply(invertParentWorldMatrix)_sm_\n\n    // Apply it\n    var components _eq_ decomposeTranslationRotationScalingMatrix(newWorldMatrix)_sm_\n    object.position _eq_ components.translation_sm_\n    object.rotationQuaternion _eq_ components.rotation_sm_\n    object.scaling _eq_ components.scaling_sm_\n\n    // Update matrix\n    UpdateWorldMatrix(object)_sm_\n}\n\nfunction decomposeTranslationRotationScalingMatrix(matrix)\n{\n    var innerMatrix _eq_ matrix.clone()_sm_\n\n    // Translation\n    var positionX _eq_ innerMatrix.m[12]_sm_\n    var positionY _eq_ innerMatrix.m[13]_sm_\n    var positionZ _eq_ innerMatrix.m[14]_sm_\n\n    var translation _eq_ new BABYLON.Vector3(positionX_co_ positionY_co_ positionZ)_sm_\n    var translationMatrixInv _eq_ BABYLON.Matrix.Translation(-positionX_co_ -positionY_co_ -positionZ)_sm_\n\n    //\n    // Scaling\n    var scalingX _eq_ Math.sqrt(innerMatrix.m[0] * innerMatrix.m[0] + innerMatrix.m[1] * innerMatrix.m[1] + innerMatrix.m[2] * innerMatrix.m[2])_sm_\n    var scalingY _eq_ Math.sqrt(innerMatrix.m[4] * innerMatrix.m[4] + innerMatrix.m[5] * innerMatrix.m[5] + innerMatrix.m[6] * innerMatrix.m[6])_sm_\n    var scalingZ _eq_ Math.sqrt(innerMatrix.m[8] * innerMatrix.m[8] + innerMatrix.m[9] * innerMatrix.m[9] + innerMatrix.m[10] * innerMatrix.m[10])_sm_\n\n    var scaling _eq_ new BABYLON.Vector3(scalingX_co_ scalingY_co_ scalingZ)_sm_\n\n    //\n    // Rotation\n    var rotationMatrix _eq_ innerMatrix.multiply(translationMatrixInv)_sm_\n\n    // Normalize to remove scaling.\n    if (scalingX) {\n        rotationMatrix.m[0] /_eq_ scalingX_sm_\n        rotationMatrix.m[1] /_eq_ scalingX_sm_\n        rotationMatrix.m[2] /_eq_ scalingX_sm_\n    }\n    if (scalingY) {\n        rotationMatrix.m[4] /_eq_ scalingY_sm_\n        rotationMatrix.m[5] /_eq_ scalingY_sm_\n        rotationMatrix.m[6] /_eq_ scalingY_sm_\n    }\n    if (scalingZ) {\n        rotationMatrix.m[8] /_eq_ scalingZ_sm_\n        rotationMatrix.m[9] /_eq_ scalingZ_sm_\n        rotationMatrix.m[10] /_eq_ scalingZ_sm_\n    }\n\n    //\n    var rotationX _eq_ Math.asin(-rotationMatrix.m[9])_sm_\n    var rotationY _eq_ Math.atan2(rotationMatrix.m[8]_co_ rotationMatrix.m[10])_sm_\n    var rotationZ _eq_ Math.atan2(rotationMatrix.m[1]_co_ rotationMatrix.m[5])_sm_\n\n    var quaternion _eq_ new BABYLON.Quaternion.FromRotationMatrix(rotationMatrix)_sm_\n\n    var result _eq_ {\n        translation_dd_ translation_co_\n        scaling_dd_ scaling_co_\n        rotation_dd_ quaternion\n    }_sm_\n\n    return result_sm_\n}\n\nfunction UpdateWorldMatrix(object)\n{\n    object.computeWorldMatrix(true)_sm_\n\n    for (var i _eq_ 0_sm_ i &lt_sm_ object.getChildren().length_sm_ i++) {\n        UpdateWorldMatrix(object.getChildren()[i])_sm_\n    }\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tThanks for your help everyone _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tNuma\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-04-11T21:26:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tActually there is no need to go down the hiearchy.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAll matrices are rebuilt (if needed) on every frame. If you want to force a complete update of a specific mesh_co_ you can just do_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_scene.incrementRenderId()_sm_\nobject.computeWorldMatrix(true)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tincrementRenderId just simulates a new frame to invalidate all caches\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-11T22:25:59Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOh ahah perfect very nice trick! There is no way I could have found out on my own though _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI needed to refresh some matrices early because I_t_m doing several coordinates calculations within one frame before I can render it. All good now_co_ I_t_ll remember that trick next time! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-04-11T22:32:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tMy pleasure _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-17T17:08:53Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20501_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/_qt_ rel_eq__qt__qt__gt_@Numa_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTrying to do something similar myself_co_ for my Vishva project.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI found there is a Matrix.decompose() function available\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//doc.babylonjs.com/classes/2.3/Matrix#decompose-scale-rotation-translation-rarr-boolean_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/classes/2.3/Matrix#decompose-scale-rotation-translation-rarr-boolean_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSomething like below seems to work for me\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_function Attach(object_co_ parent) {\n  var invParentMatrix _eq_ Matrix.Invert(parent.getWorldMatrix())_sm_  \n  var newMatrix _eq_ object.getWorldMatrix().multiply(invParentMatrix)_sm_\n  object.parent _eq_ parent_sm_\n  newMatrix.decompose(object.scaling_co_ object.rotationQuaternion_co_ object.position)_sm_\n\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-04-17T18:33:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tNice_co_ didn_t_t know about that one.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-05-02T19:18:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20501_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/_qt_ rel_eq__qt__qt__gt_@Numa_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDid you run into this issue?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/22271-matrix-decompose-issue/_qt_ rel_eq__qt__qt__gt_http_dd_//www.html5gamedevs.com/topic/22271-matrix-decompose-issue/_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-05-03T02:28:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tdamn_co_ no I haven_t_t but I definitely will one day. Did the last proposed solution work for you?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m not using the decompose function_co_ I_t_m using my own which basically does the same thing but returns all 3 components separately. I then assign them back to the object.  (see snippet in one of my posts above) Maybe you could do that and assign the correct scale separately? I don_t_t know if that would work.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-05T12:18:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m posting the latest solution here to make it easy for others who have this issue_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%2313_qt_ rel_eq__qt_external nofollow_qt_ style_eq__qt_color_dd_rgb(173_co_20_co_87)_sm_text-decoration_dd_underline_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#13_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe parentMesh function only adds the extra mesh to the parent if the parent has been scaled.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Sigmus","Date":"2017-03-10T00:03:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis seems like the most fitting thread I found for the problem I_t_m currently having_co_ so here it goes_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m currently building an object viewer with an ArcRotateCamera. I want the user to be able to position two of the light sources I have in the scene (one point light and one spot light) by attaching them to the camera and detaching them with a button click. Being the BabylonJS-Newbie that I am (actually this whole 3D stuff is quite new to me_co_ I_t_m a web developer and this is my first project using any 3D engine at all) I assumed that simply assigning null to the parent would do the trick but of course that wasn_t_t the case_co_ as the light immediately jumped back to its initial position after it was detached from the camera. A quick google search led me here and the content of this thread helped me to achive what I wanted for the point light like this_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_var pos _eq_ myPointLight.getAbsolutePosition()_sm_\nmyPointLight.parent _eq_ null_sm_\nmyPointLight.position _eq_ pos_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tsetAbsolutePosition wasn_t_t available_co_ by the way. I assumed that is the case because I_t_m working with a light here and not with a mesh_co_ so I simply assiged it to position and it worked_co_ the point light now gets correctly returned to the position it had when it was last attached.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut when I tried it for the spot light_co_ things got very weird_co_ as I wasn_t_t really sure what to do to correctly read and then restore its rotation. Normally_co_ the spot light recieves a direction and not a rotation_co_ but grabbing that before the null assignment and re-applying it didn_t_t work. Same for rotation or rotationQuaternion. So apparently it won_t_t work without doing some serious math. The last time I actually had to do those kind of calculations was 15 years ago at my university of applied sciences and I_t_m afraid I don_t_t remember much of it. So_co_ any help would be greatly appreciated.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOh_co_ and I hope this is the correct place to ask this question. Most of the answers in this thread apply to problems with meshes in parent/child relations and I assume things work quite a bit different with lights_co_ but since my problem still fits this thread_t_s title_co_ it didn_t_t seem appropriate to open a new discussion for this...\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-03-10T00:27:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello and welcome..this is the perfect place for it\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWe will help you find a solution. Can you please create a simple playground that highlights your issue? _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Sigmus","Date":"2017-03-10T08:18:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi Deltakosh. Here it is_dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1EZHCT%230_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1EZHCT#0_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs you can see_co_ the scene has a point light and a spot light attached to the camera. The first right-click in the scene drops the point light at its current position. The second right-click is supposed to do the same for the spot light_co_ but instead it shows the weirdest behavior_co_ totally unpredictable. It only works if the camera wasn_t_t moved at all.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2017-03-10T15:45:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1EZHCT%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1EZHCT#1_lt_/a_gt_\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-03-10T15:47:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tThanks _lt_span_gt__lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4289_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/_qt_ rel_eq__qt__qt__gt_@adam_lt_/a_gt__lt_/span_gt_\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]