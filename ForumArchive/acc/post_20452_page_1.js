[{"Owner":"simon_bg","Date":"2016-02-11T08:07:08Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_br_gt_\n\tHello guys_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a problem related with material swapping and asynchronous texture loading.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br_gt_\n\tI have a tiled map_co_ and when zooming in the visible tiles swap to a material with a higher resolution image texture. The thing is_co_ the tiled map I have is pretty huge_co_ it has lots of tiles and the images are heavy. What I did until now is just initializing all the materials and textures during the loading screen_co_ loading both the low and the high resolution tile images. Then_co_ the tile swapping works really smooth and is practically unnoticeable. The problem is_co_ for big scenes it takes just too much time loading all these images at the start.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo lurking around the babylon.js source code_co_ I_t_ve found the flag _lt_em_gt_useDelayedTextureLoading _lt_/em_gt_in the Scene class._lt_br_gt_\n\tI use _lt_strong_gt_scene.useDelayedTextureLoading _eq_ true_lt_/strong_gt__co_ and still initialize the textures at the beginning (which is really fast now_co_ of course)_co_ but the images are actually loaded when they are really needed (when swapping the tiles)_co_ which is cool.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe thing is_co_ the swapping is not that smooth now_co_ the tile material _qt_disappears_qt_ for a fraction of second and then appears with a new_co_ higher resolution. Having multiple tiles disappearing almost at the same time is very noticeable.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ve set up a demo here. It_t_s a very simplified version of what I have_co_ but you should see the tiles disappearing for a moment when zooming in the camera for the first time_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1XBLWB%23116_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1XBLWB#116_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br_gt_\n\tSo I tried to solve this in this way_dd__lt_br_gt_\n\tCreate a _qt_buffer_qt_ mesh_co_ hidden somewhere under the map and when it_t_s time to switch a tile with a higher resolution image I apply the material on the buffer mesh first_co_ so the _qt_special effect_qt_ of the disappearing material takes place there. Then_co_ once the texture is fully loaded_co_ I would use the texture.onLoad() method and apply the loaded texture on the right tile. But... it looks like when scene.useDelayedTextureLoading flag is set to true_co_ the Texture constructor callbacks onLoad and onError are ignored?.. _lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n_lt_p_gt_\n\tSo.. I thought it was time to ask you for advice _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt_ . Maybe you have an idea of how can I fix my solution_co_ or you can come up with a different solution_co_ anything would help. Maybe I_t_m just complicating the whole thing too much.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks!!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-02-11T16:57:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis seems smart but if the mesh is hidden it will never trigger the texture load _lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-12T07:25:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOh shoot! _lt_img alt_eq__qt__dd_o_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_ohmy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/ohmy@2x.png 2x_qt_ title_eq__qt__dd_o_qt_ width_eq__qt_20_qt__gt_ You_t_re right._lt_br_gt__lt_br_gt_\n\tSome other ideas I had is having a _qt_placeholder_qt_ for my texture_co_ like when the right texture is loading it just would show the placeholder texture instead of disappearing._lt_br_gt_\n\tWould it be possible to implement?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOr even having two textures overlapping_co_ so when one texture disappears the other is still there_co_ if it makes any sense._lt_br_gt__lt_br_gt_\n\tAlso_co_ what does the _qt_buffer_qt_ in the texture constructor means?\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_new Texture(url_co_ scene_co_ noMipmap_co_ invertY_co_ samplingMode_co_ onLoad_co_ onError_co_ buffer_co_ deleteBuffer)_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tCould it help me using it in any way?_lt_br_gt__lt_br_gt_\n\tThe best solution I think would be still to just leave the current texture until the new texture is fully loaded_co_ but again_co_ I don_t_t know how to do it _lt_img alt_eq__qt__dd_huh_dd__qt_ data-emoticon_eq__qt_true_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_huh.png_qt_ title_eq__qt__dd_huh_dd__qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-12T08:06:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_116294_qt_ data-ipsquote-contentid_eq__qt_20452_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1455209837_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t15 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tif the mesh is hidden it will never trigger the texture load\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tAnd also... if instead of hiding it under the map_co_ I place it somewhere the camera can see it_co_ but make it very_co_ very small_co_ so it would be undetectable? _lt_img alt_eq__qt__dd_lol_dd__qt_ data-emoticon_eq__qt_true_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_laugh.png_qt_ title_eq__qt__dd_lol_dd__qt__gt_ Kind of a nasty solution_co_ but desperate times call for desperate measures haha\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luaacro","Date":"2016-02-12T10:44:32Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi simon ! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n_lt_p_gt_\n\tThe buffer is used (and optional) to load a texture from an array buffer (DDS or TGA) or a base 64 string (PNG_co_ JPG). The url must begin with _qt_data_dd__qt_ like _qt_data_dd_myTextureName_qt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe last parameter tells if the buffer (array buffer or base64 string) should be deleted after the texture was initialized\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-12T11:18:59Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOh ok_co_ got it. So I think it wouldn_t_t help in my case_co_ but thanks anyway for your response_co_ Luaacro!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-02-12T17:40:15Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHere are some ideas_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- You can have a mesh with a material where alpha _eq_ 0 (so not visible BUT rendered) which can host your texture\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- You can also think about using diffuseTexture AND ambientTexture to alternate between your layers\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-12T18:09:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOkay_co_ thanks! I_t_ll try this out _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-15T08:08:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI still don_t_t get why when scene.useDelayedTextureLoading flag is activated_co_ the Texture onLoad() callback is never triggered though _lt_img alt_eq__qt__dd_huh_dd__qt_ data-emoticon_eq__qt_true_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_huh.png_qt_ title_eq__qt__dd_huh_dd__qt__gt__lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br_gt_\n\tLike here_co__lt_br_gt__lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1XBLWB%23119_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1XBLWB#119_lt_/a_gt__lt_br_gt__lt_br_gt_\n\tthe onLoad() never gets called_co_ but if I delete the line 37 with  scene.useDelayedTextureLoading _eq_ true_sm_ it does get triggered.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-02-16T03:54:24Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHum this is because we don_t_t call it when using delayed flag. I_t_ll fix it for next commit\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-02-16T03:59:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/commit/72305fd782512917b610be8ed75f3dc16a4ce2dd_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/commit/72305fd782512917b610be8ed75f3dc16a4ce2dd_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"simon_bg","Date":"2016-02-17T07:23:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGreat! Thanks_co_ Deltakosh!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]