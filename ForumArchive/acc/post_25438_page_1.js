[{"Owner":"negrant","Date":"2016-09-26T10:25:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_div style_eq__qt_table-layout_dd_fixed_sm_width_dd_1475px_sm_line-height_dd_1.6_sm_color_dd_rgb(39_co_42_co_52)_sm_font-size_dd_14px_sm_margin-bottom_dd_20px_sm_margin-top_dd_0px_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t_lt_p style_eq__qt_margin-top_dd_0px_sm__qt__gt_\n\t\tHi guys_co_ I have little problem.\n\t_lt_/p_gt_\n\n\t_lt_p style_eq__qt_margin-top_dd_0px_sm__qt__gt_\n\t\tThere is a function_co_ that rotates bone\n\t_lt_/p_gt_\n\n\t_lt_pre_gt_\n_lt_code_gt_// type script function \npublic static rotateBone(bone_dd_ BABYLON.Bone_co_ quat_dd_ BABYLON.Quaternion)_dd_ void {\n\n        var result _eq_ bone.getLocalMatrix()_sm_\n\n        var xx _eq_ quat.x * quat.x_sm_\n        var yy _eq_ quat.y * quat.y_sm_\n        var zz _eq_ quat.z * quat.z_sm_\n        var xy _eq_ quat.x * quat.y_sm_\n        var zw _eq_ quat.z * quat.w_sm_\n        var zx _eq_ quat.z * quat.x_sm_\n        var yw _eq_ quat.y * quat.w_sm_\n        var yz _eq_ quat.y * quat.z_sm_\n        var xw _eq_ quat.x * quat.w_sm_\n\n        result.m[0] _eq_ 1.0 - (2.0 * (yy + zz))_sm_\n        result.m[1] _eq_ 2.0 * (xy + zw)_sm_\n        result.m[2] _eq_ 2.0 * (zx - yw)_sm_\n        result.m[3] _eq_ 0_sm_\n        result.m[4] _eq_ 2.0 * (xy - zw)_sm_\n        result.m[5] _eq_ 1.0 - (2.0 * (zz + xx))_sm_\n        result.m[6] _eq_ 2.0 * (yz + xw)_sm_\n        result.m[7] _eq_ 0_sm_\n        result.m[8] _eq_ 2.0 * (zx + yw)_sm_\n        result.m[9] _eq_ 2.0 * (yz - xw)_sm_\n        result.m[10] _eq_ 1.0 - (2.0 * (yy + xx))_sm_\n        result.m[11] _eq_ 0_sm_\n\n        result.m[15] _eq_ 1.0_sm_\n    }_lt_/code_gt__lt_/pre_gt_\n\n\t_lt_p_gt_\n\t\tBut this function rotates bone in local space_co_ and I need rotetes bone in world space. What I should change in function?\n\t_lt_/p_gt_\n_lt_/div_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-09-26T16:09:02Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tYou can get a world space quaternion and transform it to a local space quaternion using inverse world matrix\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"negrant","Date":"2016-09-26T19:17:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_145487_qt_ data-ipsquote-contentid_eq__qt_25438_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1474906142_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t3 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tYou can get a world space quaternion and transform it to a local space quaternion using inverse world matrix\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tCan you explain me more clearly? Because I am confusing in quternions and matrixes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t1. How can I get world space quaternion from bone?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t2. When I get world quaternion_co_ than I should change desired angle and convert new quaternion in local quaternion?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t3. How to convert world quaternion to local and apply it to bone?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-09-26T23:32:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t1. bone.getWorldMatrix()\n_lt_/p_gt_\n\n_lt_p_gt_\n\t2. Matrix.Invert(bone.getWorldMatrix())\n_lt_/p_gt_\n\n_lt_p_gt_\n\t3.var finalQuat _eq_ Quaternion.FromRotationMatrix(Matrix.Invert(bone.getWorldMatrix()))\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"negrant","Date":"2016-09-27T10:59:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_145541_qt_ data-ipsquote-contentid_eq__qt_25438_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1474932742_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t11 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t1. bone.getWorldMatrix()\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t2. Matrix.Invert(bone.getWorldMatrix())\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t3.var finalQuat _eq_ Quaternion.FromRotationMatrix(Matrix.Invert(bone.getWorldMatrix()))\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOkay_co_ I wrote code_co_ and nothing happens\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_var worldMat _eq_ this.boneTorsoDown.getWorldMatrix()_sm_\n\nworldMat _eq_ worldMat.multiply(BABYLON.Matrix.RotationX(r))_sm_\n\nvar localMat _eq_ BABYLON.Matrix.Invert(worldMat)_sm_\n\nvar quat _eq_ BABYLON.Quaternion.FromRotationMatrix(localMat)_sm_\n\nvar result _eq_ this.boneTorsoDown.getLocalMatrix()_sm_\n\t\t\nvar xx _eq_ quat.x * quat.x_sm_\nvar yy _eq_ quat.y * quat.y_sm_\nvar zz _eq_ quat.z * quat.z_sm_\nvar xy _eq_ quat.x * quat.y_sm_\nvar zw _eq_ quat.z * quat.w_sm_\nvar zx _eq_ quat.z * quat.x_sm_\nvar yw _eq_ quat.y * quat.w_sm_\nvar yz _eq_ quat.y * quat.z_sm_\nvar xw _eq_ quat.x * quat.w_sm_\n\nresult.m[0] _eq_ 1.0 - (2.0 * (yy + zz))_sm_\nresult.m[1] _eq_ 2.0 * (xy + zw)_sm_\nresult.m[2] _eq_ 2.0 * (zx - yw)_sm_\nresult.m[3] _eq_ 0_sm_\nresult.m[4] _eq_ 2.0 * (xy - zw)_sm_\nresult.m[5] _eq_ 1.0 - (2.0 * (zz + xx))_sm_\nresult.m[6] _eq_ 2.0 * (yz + xw)_sm_\nresult.m[7] _eq_ 0_sm_\nresult.m[8] _eq_ 2.0 * (zx + yw)_sm_\nresult.m[9] _eq_ 2.0 * (yz - xw)_sm_\nresult.m[10] _eq_ 1.0 - (2.0 * (yy + xx))_sm_\nresult.m[11] _eq_ 0_sm_\n\nresult.m[15] _eq_ 1.0_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-09-27T12:40:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe only way I was able to get the WorldMatrix for a bone was by using the Mesh worldMatrix and the absoluteTransform of the bone.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTake a look at the SkeletonViewer_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Debug/babylon.skeletonViewer.ts#L40_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Debug/babylon.skeletonViewer.ts#L40_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-09-28T16:38:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tYes Adam is correct. bone.getWorldMatrix is not enough as the bone matrix is applied to mesh world matrix\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]