[{"Owner":"Stalker","Date":"2015-11-27T16:43:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi!_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I_t_m trying to create various units for different players_co_ each player can have multiple units_co_ all from the same model._lt_/p_gt__lt_p_gt_Because materials can_t_t be per instance_co_ only per mesh (WebGL limitation if I know correctly)_co_ I create a clone of a model for each player_co_ change the material and afterwards I_t_m doing instancing from those clones._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_My problem is_co_ that when I do this everything disappears (first it flickers and completely blank scene afterwards). Everything is visible again if bounding boxes are turned back on_co_ but instances from clones aren_t_t shown_co_ only bounding boxes are at correct locations (attached first image). What am I doing wrong that this happens or is a bug?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_A minimal example on plunkr_dd_ _lt_a href_eq__qt_http_dd_//plnkr.co/edit/yOaBtmu9NaOQpoULo6pv?p_eq_preview_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//plnkr.co/edit/yOaBtmu9NaOQpoULo6pv?p_eq_preview_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_strong_gt_EDIT_dd_ _lt_/strong_gt_Example uses BJS version 2.2_co_ but 2.3 suffers for the same problem._lt_/p_gt__lt_p_gt__lt_strong_gt_EDIT2_dd_ _lt_/strong_gt_Added second image that renders exactly the same scene_co_ the only difference is checked option for bounding boxed in debug layer._lt_/p_gt__lt_p_gt__lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_11_2015/post-17157-0-16048900-1448642530.png_qt_ rel_eq__qt_external nofollow_qt__gt__lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_11_2015/post-17157-0-16048900-1448642530_thumb.png_qt_ data-fileid_eq__qt_5673_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_post-17157-0-16048900-1448642530_thumb.p_qt__gt__lt_/a_gt__lt_/p_gt__lt_p_gt__lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_11_2015/post-17157-0-04625300-1448648009.jpg_qt_ rel_eq__qt_external nofollow_qt__gt__lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_11_2015/post-17157-0-04625300-1448648009_thumb.jpg_qt_ data-fileid_eq__qt_5675_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_post-17157-0-04625300-1448648009_thumb.j_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"BitOfGold","Date":"2015-11-27T18:03:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Does the instance disappear when the mesh is out of the frustrum?_lt_br_gt_(I think the frustrum check is made per mesh and not per instances.)_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Stalker","Date":"2015-11-27T18:17:14Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Instance checking is per frustum I believe._lt_/p_gt__lt_p_gt_And the problem is a little beyond just mesh and instance_co_ because everything (also ground and other completely unrelated things) are missing _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ alt_eq__qt__dd_(_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_. I attached an image to original post_co_ where exact scene is rendered with bounding boxes on and off. _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2015-11-27T19:23:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_The problem is the fact that you are reusing the material in both clones (running clone doesn_t_t clone the material as well)._lt_/p_gt__lt_p_gt_Here is a working example _dd_ _lt_a href_eq__qt_http_dd_//plnkr.co/edit/ytaLCOSNtECGaHm4UMXY?p_eq_preview_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//plnkr.co/edit/ytaLCOSNtECGaHm4UMXY?p_eq_preview_lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Stalker","Date":"2015-11-27T22:49:42Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Thanks a lot! I blindly believed that clone clones entire structure._lt_br_gt_Is there any simple way of creating deep clone for material (including all submaterials)? Or is a loop the way?_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Temechon","Date":"2015-11-28T07:42:48Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_You can use material.clone(_qt_newmat_qt_) _dd_ _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/classes/2.2/MultiMaterial#clone-name-rarr-multimaterial-classes-2-2-multimaterial-_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/classes/2.2/MultiMaterial#clone-name-rarr-multimaterial-classes-2-2-multimaterial-_lt_/a_gt__lt_/p_gt__lt_p_gt_However_co_ it won_t_t clone all submaterial. Maybe this could be added easily in the engine. I_t_ll think about it._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Edit_dd_ I added a new parameter in MultiMaterial.clone (waiting for approval). You will be able to use it in the next nightly build._lt_/p_gt__lt_p_gt_Basically_co_ you can use it like this_dd_ _lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_myMultiMaterial.clone(_qt_newname_qt__co_ true)_sm__lt_/pre_gt__lt_p_gt_This will clone the multimaterial and also clone all of its submaterials._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Stalker","Date":"2015-11-28T09:56:53Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Instead of waiting I created the build myself and it works _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_!_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Thanks a lot!_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Swiftwork","Date":"2016-09-14T08:15:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi and excuse me for necroing an old post_co_ however I seem to be facing a similar issue and the suggested solution seems ineffective for me. Only the last cloned mesh is able to create instances.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is a playground demonstrating the issue _lt_a href_eq__qt_http_dd_//babylonjs-playground.com/#29SZC0%236_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//babylonjs-playground.com/#29SZC0#6_lt_/a_gt_ (try removing the 3rd instance)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI hope it isn_t_t just my naivety that is the problem _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tRegards Swiftwork\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-09-14T15:36:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthis is because clones are sharing the same geometry (for performance reasons)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut in your case you do not want that as you are using instances with clones.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tso simple fix_dd_ _lt_a href_eq__qt_http_dd_//babylonjs-playground.com/#29SZC0%237_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//babylonjs-playground.com/#29SZC0#7_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Swiftwork","Date":"2016-09-14T15:45:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tIt_t_s always the simple things that get me_co_ thank you for your aid _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_. Guess this necro will serve as a reference for others that face the same issue in the future!\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Swiftwork","Date":"2016-09-14T15:58:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI jumped the gun a little_co_ It seems as if the mesh loses its multimaterial or uv mapping if makeGeometryUnique() is called. Is this intended? Can it be avoided? I am trying to achieve a _qt_carbon copy_qt_ of the original mesh with all preferences intact as sort of a base for future instancing.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_Edit_dd__lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t fully understand what I am doing yet but it seem as if the issue with mulitmaterials can be solved by re-referencing or copying the original model_t_s subMeshes_co_ which appears to be have been lost or removed when makeGeometryUnique() is called._lt_br /_gt__lt_a href_eq__qt_http_dd_//babylonjs-playground.com/#29SZC0%238_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//babylonjs-playground.com/#29SZC0#8_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t\t\t\n\n_lt_span class_eq__t_ipsType_reset ipsType_medium ipsType_light_t_ data-excludequote_gt_\n\t_lt_strong_gt_Edited _lt_time datetime_eq__t_2016-09-14T16_dd_47_dd_33Z_t_ title_eq__t_09/14/2016 04_dd_47  PM_t_ data-short_eq__t_2 yr_t__gt_September 14_co_ 2016_lt_/time_gt_ by Swiftwork_lt_/strong_gt_\n\t\n\t\t_lt_br_gt_Solved issue by adding clone.subMeshes _eq_ original.subMeshes\n\t\n\t\n_lt_/span_gt_\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-09-14T19:34:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tyep you found the issue _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ making a mesh unique resets its state\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]