[{"Owner":"PeapBoy","Date":"2016-10-19T16:11:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi everybody ! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tThis week I faced with a strange behaviour. I generally lose time looking for a solution on my own_co_ I did it again_co_ but today I have the unpleasant feeling to be powerless. _lt_br /_gt__lt_br /_gt_\n\tI_t_m trying to precompute kind of PCSS map (soft shadows) to get nice-looking shadows in static scenes._lt_br /_gt_\n\tFor this purpose_co_ I use renderTargetTextures with refreshRate _eq_ RENDER_ONCE._lt_br /_gt_\n\tAnd I use three shaders_co_ called in this order _dd_\n_lt_/p_gt_\n\n_lt_ol_gt__lt_li_gt_\n\t\tThe one of shadowGenerator which gives me the shadowMap of the blockers.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tThe PCSS one_co_ which uses the shadowMap and gives me a PCSSMap.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tThe material_t_s shader_co_ which simply display the PCSSMap in real time.\n\t_lt_/li_gt_\n_lt_/ol_gt__lt_p_gt_\n\t_lt_br /_gt_\n\tAfter each renderTargetTexture created_co_ I call scene.customTargets() to order the calls._lt_br /_gt_\n\tOkay _dd_ This works great ! _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tNow_co_ I would like to correct small artifacts and I need to repeat step 1 &amp_sm_ 2 for each blocker separatly._lt_br /_gt_\n\tAnd here comes the drama._lt_br /_gt__lt_br /_gt_\n\tLet_t_s take a look at the new call order _dd_\n_lt_/p_gt_\n\n_lt_ul_gt__lt_li_gt_\n\t\t_lt_strong_gt_1._lt_/strong_gt_ ShadowGenerator creates blockerMap with the first blocker.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_2._lt_/strong_gt_ PCSSGenerator creates PCSSMap for the first blocker.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_1bis._lt_/strong_gt_ ShadowGenerator creates blockerMap with the second blocker.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_2bis._lt_/strong_gt_ PCSSGenerator creates PCSSMap for the second blocker AND mix it with last PCSSMap (the first one).\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_1ter._lt_/strong_gt_ ShadowGenerator creates blockerMap with the third blocker.\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_2ter._lt_/strong_gt_ PCSSGenerator creates PCSSMap for the third blocker AND mix it with last PCSSMap (the second one).\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_3._lt_/strong_gt_ Display result.\n\t_lt_/li_gt_\n_lt_/ul_gt__lt_p_gt_\n\t_lt_br /_gt_\n\tMy issue is _dd__lt_em_gt_ _lt_strong_gt_I can_t_t grab the last PCSSMap._lt_/strong_gt__lt_/em_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br /_gt_\n\tAfter a few tests_co_ I highlighted when my issue appears and when it doesn_t_t._lt_br /_gt__lt_br /_gt_\n\tSo here is a big simplification of my PCSS fragment shader (it only outputs one of the two textures it takes in uniform) _dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_uniform samplerCube blockerMap_sm_\nuniform samplerCube previousPCSSMap_sm_\n\n// This function samples the blockerMap. We don_t_t mind about the result.\nfloat sampleFunction() {\n for (int i _eq_ 0.0_sm_ i &lt_sm_ POISSON_COUNT_sm_ i++) {\n  vec4 sample _eq_ textureCube(blockerMap_co_ direction)_sm_\n }\n return 1.0_sm_\n}\n\nvoid main(void) {\n // To fill\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tAnd here are 4 usecases _dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t1. It returns blockerMap_co_ everything is OK.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_void main(void) {\n //sampleFunction()_sm_\n gl_FragColor _eq_ textureCube(blockerMap_co_ direction)_sm_\n //gl_FragColor _eq_ textureCube(previousPCSSMap_co_ direction)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t2. It returns the previous PCSSMap_co_ everything is OK.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_void main(void) {\n //sampleFunction()_sm_\n //gl_FragColor _eq_ textureCube(blockerMap_co_ direction)_sm_\n gl_FragColor _eq_ textureCube(previousPCSSMap_co_ direction)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t3. It returns the blockerMap_co_ everything is OK.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_void main(void) {\n sampleFunction()_sm_\n gl_FragColor _eq_ textureCube(blockerMap_co_ direction)_sm_\n //gl_FragColor _eq_ textureCube(previousPCSSMap_co_ direction)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t4. It returns the blockerMap instead of the previous PCSSMap_co_ what_t_s wrong ?\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_void main(void) {\n sampleFunction()_sm_\n //gl_FragColor _eq_ textureCube(blockerMap_co_ direction)_sm_\n gl_FragColor _eq_ textureCube(previousPCSSMap_co_ direction)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t_lt_br /_gt__lt_br /_gt_\n\tAs you can see_co_ sampleFunction() works with blockerMap and has absolutely no contact with the previousPCSSMap. However_co_ the previousPCSSMap seems to be replaced by the blockerMap and I have absolutely no idea how it_t_s possible._lt_br /_gt_\n\tAs it_t_s nonsense_co_ I dare coming here begging for your help... _lt_img alt_eq__qt__dd_unsure_dd__qt_ data-emoticon_eq__qt__qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_unsure.png_qt_ title_eq__qt__dd_unsure_dd__qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tSome more info _dd__lt_br /_gt_\n\t- I use shadowGenerator from Babylon._lt_br /_gt_\n\t- I use my own PCSSGenerator. But this one is a CC of shadowGenerator. The unique difference is the shader which is called._lt_br /_gt_\n\t- The last shader (material_t_s one) only displays the result_co_ the issue should not come from here._lt_br /_gt_\n\t- I verified 1000 times_co_ I don_t_t send blockerMap in previousPCSSMap in my code. Maybe it does in a dark side of the library_co_ but I don_t_t think so._lt_br /_gt_\n\t- I systematically empty my cache between each shader modification._lt_br /_gt_\n\t- Of course_co_ my PCSS shader contains a lot of calculations and uniforms I didn_t_t show here. But I really commented a lot my code to obtain something really close to the usecase above. I_t_m working on isolating the issue in a new project._lt_br /_gt__lt_br /_gt_\n\tThanks ! _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tPeapBoy\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pryme8","Date":"2016-10-19T16:24:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\twhoa_co_ um I think we have a way to prebake shadow maps already _lt_span_gt__lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/8492-jcpalmer/?do_eq_hovercard_qt_ data-mentionid_eq__qt_8492_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/8492-jcpalmer/_qt_ rel_eq__qt__qt__gt_@JCPalmer_lt_/a_gt_ might know.  If I had more time this morning I would be on this for you as I need to do it at some point here in the very near future._lt_/span_gt_\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-19T16:33:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHi Pryme8 !_lt_br /_gt__lt_br /_gt_\n\tIt could be very interesting_co_ I would be glad to hear about it. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt_\n\tThough_co_ I_t_m not sure the issue comes from shadows in general_co_ but just in my way to order and use successive shader passes. (Maybe I should take a look to how works PostProcesses in BabylonJS)._lt_br /_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2016-10-19T16:36:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tNo_co_ sorry I never needed to do that.  I vaguely recall a performance thing where you can turn it off after done once.  Not a pre-bake_co_ but close.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pryme8","Date":"2016-10-19T16:37:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tOhh I get it now_co_ is it because the previous one is being updated faster then the GL can output_co_ and is referencing the wrong one?_lt_br /_gt__lt_br /_gt_\n\tWhy do you need the previous one? Why not just modify your shader to do the multi passes that your speaking of?_lt_br /_gt__lt_br /_gt_\n\tSorry if im off basis im just glancing at this as I try to get work done this morning._lt_br /_gt__lt_br /_gt_\n\tBut nice to meet you btw_co_ looks like your doing some decently high end stuff and we love guys like you _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pryme8","Date":"2016-10-19T16:38:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_147990_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1476895000_qt_ data-ipsquote-userid_eq__qt_8492_qt_ data-ipsquote-username_eq__qt_JCPalmer_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tJust now_co_ JCPalmer said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tNo_co_ sorry I never needed to do that.  I vaguely recall a performance thing where you can turn it off after done once.  Not a pre-bake_co_ but close.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYeah thats kinda what I thought was how it was done_co_ Im trying to remember who was doing the prebaked shadows in the scene... I thought it was you my bad.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-19T17:05:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_147992_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1476895108_qt_ data-ipsquote-userid_eq__qt_19199_qt_ data-ipsquote-username_eq__qt_Pryme8_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t4 minutes ago_co_ Pryme8 said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_147990_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1476895000_qt_ data-ipsquote-userid_eq__qt_8492_qt_ data-ipsquote-username_eq__qt_JCPalmer_qt__gt_\n\t\t\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t\t\t6 minutes ago_co_ JCPalmer said_dd_\n\t\t\t_lt_/div_gt_\n\n\t\t\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t\t\t_lt_p_gt_\n\t\t\t\t\tNo_co_ sorry I never needed to do that.  I vaguely recall a performance thing where you can turn it off after done once.  Not a pre-bake_co_ but close.\n\t\t\t\t_lt_/p_gt_\n\t\t\t_lt_/div_gt_\n\t\t_lt_/blockquote_gt_\n\n\t\t_lt_p_gt_\n\t\t\tYeah thats kinda what I thought was how it was done_co_ Im trying to remember who was doing the prebaked shadows in the scene... I thought it was you my bad.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tAre you talking about the refresh rate of the renderTargetTexture which is used for shadows particularly ? _dd__t_)_lt_br /_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_147991_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1476895063_qt_ data-ipsquote-userid_eq__qt_19199_qt_ data-ipsquote-username_eq__qt_Pryme8_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t6 minutes ago_co_ Pryme8 said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tOhh I get it now_co_ is it because the previous one is being updated faster then the GL can output_co_ and is referencing the wrong one?_lt_br /_gt__lt_br /_gt_\n\t\t\tWhy do you need the previous one? Why not just modify your shader to do the multi passes that your speaking of?_lt_br /_gt__lt_br /_gt_\n\t\t\tSorry if im off basis im just glancing at this as I try to get work done this morning._lt_br /_gt__lt_br /_gt_\n\t\t\tBut nice to meet you btw_co_ looks like your doing some decently high end stuff and we love guys like you _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tMy lack of knowledge about how GL behaves internally is maybe the main problem._lt_br /_gt_\n\tSo I_t_m not really sure to understand your first note._lt_br /_gt__lt_br /_gt_\n\tDoing all the stuff in only one PCSS pass works fine. But I saw some artifacts. And I_t_m quite sure there is no way to get rid of these artifacts in one pass because these artifacts are totally due by the volonty to prebake PCSS_co_ they don_t_t appear in real time PCSS._lt_br /_gt_\n\tSo I_t_m trying to do something really energy intensive _dd_ Bake PCSS for each blocker separately. I would only have to mix all my PCSSMaps together at the end and bye bye the artifacts._lt_br /_gt_\n\tRather than keeping in memory all the maps and mix them at the end_co_ I just mix immediately the new map with the last one. It remains the same._lt_br /_gt_\n\tI can_t_t deal with each blocker separately in the same shader pass_co_ can I ? If I can do the multipasses in my shader_co_ I would be very interested in how to do it ! _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt_\n\tBy blocker_co_ I mean each mesh taken into acount in shadow generation._lt_br /_gt__lt_br /_gt_\n\tThank you a lot to take time about that haha ! _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tI_t_m still a newbie in general. But I work on PCSS and possible optimisations for two months so maybe I will finally get interesting results. _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pryme8","Date":"2016-10-19T17:25:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\twhat about maybe running the shadows once_co_ and then saving the buffer from that_co_ and then maybe do it again and then combine the results of the two somehow?_lt_br /_gt__lt_br /_gt_\n\tIm still kinda shaky on what it is your trying to accomplish_co_ you just want nice soft shadows in your scene that are not being recomputed every frame right?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-10-19T17:42:48Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tInteresting! Do you mind sharing it in the playground? I would love to help but I need a repro case\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-19T18:15:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI can_t_t really explain _lt_em_gt_why_lt_/em_gt_ I need to work with each blocker separately. Because I would need to explain all my code._lt_br /_gt_\n\tPrebaking PCSS (instead of using the real time one of nVidia) involves a compromise _dd_ a mesh can_t_t be blocker and receiver in the same time. This compromise leads to small artifacts in case of self-shadowing and in case of blocker receiving shadow after all._lt_br /_gt_\n\tI tried some tricks to get rid of these artifacts_co_ and everything failed._lt_br /_gt_\n\tRepeating PCSS computation for each blocker separately_co_ rather than working with the original shadowMap (with all the blockers_co_ _lt_strong_gt_hiding_lt_/strong_gt_ each other)_co_ is really dumb (too energy intensive_co_ it won_t_t work with a lot of blockers). But it will resolve all the artifacts for sure._lt_br /_gt__lt_br /_gt_\n\tSo_co_ if I understand well. Running the shadows once means calling shadowGenerator (for all blockers) once. Saving buffer means saving the shadowMap._lt_br /_gt_\n\tBut then I can_t_t combine the results_co_ because I already lost some precious info _dd_ the depth of blockers hidden behind the closest blocker (which depth is in the shadowMap)._lt_br /_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_148012_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1476898968_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t29 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tInteresting! Do you mind sharing it in the playground? I would love to help but I need a repro case\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI_t_m working on reproducing the case in a separate_co_ really minimal_co_ project. If the problem appears again_co_ I_t_ll try to make a PG ! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt_\n\tBut I_t_ll do that tomorrow_co_ it_t_s night here. _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-21T14:24:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tRight !_lt_br /_gt__lt_br /_gt_\n\tHello guys _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tHere is the PG _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2317_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#17_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAt the top of the code_co_ there is the shader I use to receive and output the shadowMap (I called it PCSS_co_ but it absolutely doesn_t_t perform PCSS here _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt_)_lt_br /_gt_\n\tThen_co_ there is the PCSSGenerator prototype_co_ which simply herits from ShadowGenerator and changes its customRenderFunction to fit my needs._lt_br /_gt_\n\tAnd finally_co_ the createScene() function._lt_br /_gt__lt_br /_gt_\n\tLook for _qt__lt_strong_gt_CUSTOM PART_lt_/strong_gt__qt_ words to see relevant code.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo_co_ what am I doing here ?_lt_br /_gt_\n\tI_t_m just trying to chain shaders to highlight my problem._lt_br /_gt_\n\tFirst I create a _lt_strong_gt_shadowMap_lt_/strong_gt__lt_strong_gt_1_lt_/strong_gt_ with ShadowGenerator_co_ then I pass the_lt_strong_gt_ shadowMap1_lt_/strong_gt_ to PCSSGenerator which does nothing else than outputing the _lt_strong_gt_shadowMap1_lt_/strong_gt__co_ now called PCSSMap._lt_br /_gt_\n\tSecondly_co_ I create another_lt_strong_gt_ shadowMap _lt_/strong_gt_(_lt_strong_gt_2_lt_/strong_gt_) (of another mesh_co_ to see the difference)_co_ then I pass it to another PCSSGenerator._lt_br /_gt_\n\tThis time_co_ I ask the PCSSGenerator to output the last PCSSMap_co_ rather than the _lt_strong_gt_shadowMap2_lt_/strong_gt_._lt_br /_gt_\n\tFinally_co_ I never get the PCSSMap_co_ but always the_lt_strong_gt_ shadowMap2_lt_/strong_gt_._lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m quite disappointed. I_t_m clearly doing something wrong_co_ since in the PG_co_ we can see it doesn_t_t work at all._lt_br /_gt_\n\tBut in my project_co_ I have the strange behaviour I explained above _dd_ sometimes it works_co_ sometimes it doesn_t_t_co_ which made me think I wasn_t_t really doing nonsense._lt_br /_gt__lt_br /_gt_\n\tHope I_t_m clear. Thank you for your help _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tPeapBoy\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-21T21:39:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello_lt_br /_gt__lt_br /_gt_\n\tI kind of scroll trough this post_co_ two things_dd__lt_br /_gt__lt_br /_gt_\n\t1_dd_ I would code a very basic shader and see how it works_lt_br /_gt__lt_br /_gt_\n\t2_dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2318_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#18_lt_/a_gt__lt_br /_gt__lt_br /_gt_\n\tAlso here\n_lt_/p_gt_\n_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/24542-spot-light-passing-through-objects/?do_eq_embed&amp_sm_comment_eq_140513&amp_sm_embedComment_eq_140513&amp_sm_embedDo_eq_findComment#comment-140513_qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T08:01:48Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_148362_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1477085971_qt_ data-ipsquote-userid_eq__qt_21965_qt_ data-ipsquote-username_eq__qt_Nabroski_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tOn 21/10/2016 at 11_dd_39 PM_co_ Nabroski said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHello_lt_br /_gt__lt_br /_gt_\n\t\t\tI kind of scroll trough this post_co_ two things_dd__lt_br /_gt__lt_br /_gt_\n\t\t\t1_dd_ I would code a very basic shader and see how it works_lt_br /_gt__lt_br /_gt_\n\t\t\t2_dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2318_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#18_lt_/a_gt__lt_br /_gt__lt_br /_gt_\n\t\t\tAlso here\n\t\t_lt_/p_gt_\n\t\t_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/24542-spot-light-passing-through-objects/?do_eq_embed&amp_sm_comment_eq_140513&amp_sm_embedComment_eq_140513&amp_sm_embedDo_eq_findComment#comment-140513_qt__gt__lt_/iframe_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tHi @Nabroski !_lt_br /_gt__lt_br /_gt_\n\tThanks for your help _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt_\n\tI took a look at your link..._lt_br /_gt_\n\tI_t_m really sorry_co_ I should never have spoken about shadows. Because now everybody focus on it and 90% of the thread talks about that. _lt_img alt_eq__qt__dd_unsure_dd__qt_ data-emoticon_eq__qt__qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_unsure.png_qt_ title_eq__qt__dd_unsure_dd__qt_ /_gt__lt_br /_gt_\n\tMy issue is not about shadows but about how Babylon (or just WebGL) references textures when chaining shaders._lt_br /_gt_\n\tAnd I faced with that issue when working on a specific version of PCSS_co_ so I spoke about PCSS._lt_br /_gt__lt_br /_gt_\n\tActually_co_ I just get the wrong texture in input of my shader_co_ when calling shadowGenerators one after another and trying to use the result of the previous shadowGenerator in the next shadowGenerator (using a custom shader of course)._lt_br /_gt__lt_br /_gt_\n\tIf anybody has an idea... I_t_m sure I_t_m just missing a basic WebGL internal behaviour or Babylon internal behaviour about texture referencing. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tPeapBoy\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-24T09:36:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tJust to make myself more clear_co_ this rings look for me like you are using the wrong  shadowmap generator. 4 or 5 types in babylonjs are you sure you are using the right one.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2016_10/Unbenannt.JPG.396740adbd9068c167a64444ee63bf89.JPG_qt_ data-fileid_eq__qt_9988_qt_ rel_eq__qt__qt__gt__lt_img alt_eq__qt_Unbenannt.JPG_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_9988_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2016_10/Unbenannt.JPG.396740adbd9068c167a64444ee63bf89.JPG_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T10:05:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tOh._lt_br /_gt__lt_br /_gt_\n\tI just didn_t_t mind about shadow acne in this PG _dd_ bias equals 0._lt_br /_gt_\n\tI didn_t_t want to add more code than needed. The custom shader  (without bias) replaces the original shadowMap shader._lt_br /_gt_\n\tIn my project I don_t_t have this.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-24T10:07:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHello_lt_br /_gt__lt_br /_gt_\n\tjust a question_co_ what is the desired result ? \n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T10:23:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi_co__lt_br /_gt__lt_br /_gt_\n\tI just made this to highlight where I speak about the _qt_wrong texture I get_qt_._lt_br /_gt__lt_br /_gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_9992_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2016_10/TextureReferenceBug.png.4df39756c9262d7f0deb1720cf347842.png_qt_ alt_eq__qt_TextureReferenceBug.png_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tTo simplify things_co_ the desired result is just to display an older renderTargetTexture. Generally it works. But in this specific usecase_co_ I always get the wrong texture and I cannot figure out why.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-24T10:43:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tYou have to use the words customVertexShader_co_ customFragmentShader otherwise you get a conflict with the default one_co_ -- if i remember right. but this is only a playground thing_lt_br /_gt__lt_br /_gt_\n\twhere is the documentation for this ?_lt_br /_gt_\n\tthis._scene.getEngine().createEffect(_qt_PCSS_qt__co_ attribs_co_ [_qt_world_qt__co_ _qt_mBones_qt__co_ _qt_viewProjection_qt__co_ _qt_diffuseMatrix_qt__co_ _qt_lightPos_qt__co_ _qt_depthValues_qt_]_co_ [_qt_diffuseSampler_qt__co_ _qt_blockerMap_qt_]_co_ join)_sm__lt_br /_gt__lt_br /_gt_\n\tcan you recreate the playground with the first shader working ? i just want to see how it looks _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T14:04:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_148610_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1477305807_qt_ data-ipsquote-userid_eq__qt_21965_qt_ data-ipsquote-username_eq__qt_Nabroski_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t3 hours ago_co_ Nabroski said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\twhere is the documentation for this ?_lt_br /_gt_\n\t\t\tthis._scene.getEngine().createEffect(_qt_PCSS_qt__co_ attribs_co_ [_qt_world_qt__co_ _qt_mBones_qt__co_ _qt_viewProjection_qt__co_ _qt_diffuseMatrix_qt__co_ _qt_lightPos_qt__co_ _qt_depthValues_qt_]_co_ [_qt_diffuseSampler_qt__co_ _qt_blockerMap_qt_]_co_ join)_sm_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI_t_m taking a look at this_co_ maybe there_t_s something I didn_t_t see._lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_148610_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1477305807_qt_ data-ipsquote-userid_eq__qt_21965_qt_ data-ipsquote-username_eq__qt_Nabroski_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t3 hours ago_co_ Nabroski said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tcan you recreate the playground with the first shader working ? i just want to see how it looks _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tBy _qt_the first shader_qt__co_ do you mean the PASS 1 of my picture ?_lt_br /_gt_\n\tIt_t_s the original shadowGenerator_co_ so the original shadowMap shader._lt_br /_gt__lt_br /_gt_\n\tAnd it gives this _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2320_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#20_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou can comment and uncomment each pass at the end of the PG ! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-24T16:08:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHello_lt_br /_gt__lt_br /_gt_\n\tcan you also modify your PG with the words costom everywhere in the shader_lt_br /_gt_\n\ti would do it by myself but i dont understand this this._scene.getEngine().createEffect(_qt_PCSS_qt__co_ attribs_co_ [_qt_world_qt__co_ _qt_mBones_qt__co_ _qt_viewProjection_qt__co_ _qt_diffuseMatrix_qt__co_ _qt_lightPos_qt__co_ _qt_depthValues_qt_]_co_ [_qt_diffuseSampler_qt__co_ _qt_blockerMap_qt_]_co_ join)_sm__lt_br /_gt__lt_br /_gt_\n\tlike here_lt_br /_gt__lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1YHPOU%230_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1YHPOU#0_lt_/a_gt__lt_br /_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T17:04:32Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWow ! It_t_s possible to write the shader without the annoying quotes !? _lt_img alt_eq__qt__dd_blink_dd__qt_ data-emoticon_eq__qt__qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_blink.png_qt_ title_eq__qt__dd_blink_dd__qt_ /_gt__lt_br /_gt_\n\tSooooooo coooool ! _lt_img alt_eq__qt__dd_lol_dd__qt_ data-emoticon_eq__qt__qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_laugh.png_qt_ title_eq__qt__dd_lol_dd__qt_ /_gt__lt_br /_gt_\n\tI_t_ll remember that for the next time_co_ thank you !_lt_br /_gt__lt_br /_gt_\n\tRenaming PCSS by custom_co_ we get that _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2322_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#22_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_148674_qt_ data-ipsquote-contentid_eq__qt_25849_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1477325307_qt_ data-ipsquote-userid_eq__qt_21965_qt_ data-ipsquote-username_eq__qt_Nabroski_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t42 minutes ago_co_ Nabroski said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\ti would do it by myself but i dont understand this this._scene.getEngine().createEffect(_qt_PCSS_qt__co_ attribs_co_ [_qt_world_qt__co_ _qt_mBones_qt__co_ _qt_viewProjection_qt__co_ _qt_diffuseMatrix_qt__co_ _qt_lightPos_qt__co_ _qt_depthValues_qt_]_co_ [_qt_diffuseSampler_qt__co_ _qt_blockerMap_qt_]_co_ join)_sm__lt_br /_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tAs you can see in the last PG_co_ I replaced _qt_PCSS_qt_ by _qt_custom_qt_._lt_br /_gt__lt_br /_gt_\n\tI didn_t_t invent this line. PCSSGenerator is exactly the same as ShadowGenerator. I overloaded some of its functions to fit my needs. And actually_co_ the unique difference with original ShadowGenerator on this line is the name of the shader we call _dd_ that_t_s why I replaced _qt_PCSS_qt_ by _qt_custom_qt_._lt_br /_gt_\n\tThis call creates the effect_co_ so I think it means it inserts the defines_co_ compiles the shaders and links the attributes and uniforms._lt_br /_gt__lt_br /_gt_\n\tOh wait..._lt_br /_gt_\n\tI made a mistake in the PG !!!_lt_br /_gt_\n\t(THANK YOU_co_ you made me look at this line !)_lt_br /_gt_\n\tI forgot to add _qt_PCSSMap_qt_ to the sampler list._lt_br /_gt_\n\tNow it works _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2323_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#23_lt_/a_gt__lt_br /_gt_\n\tBut it works in the PG_co_ still not in my project. So_co_ actually I just lost my repro case _lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tIn my project_co_ the issue of _qt_wrong texture referenced_qt_ seems to appear randomly (and I was surprised that it wasn_t_t working at all in the PG_co_ now I know why). So maybe I won_t_t be able to reproduce the issue in the PG...\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nabroski","Date":"2016-10-24T17:52:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tHello_lt_br /_gt__lt_br /_gt_\n\tPlease zip all relevant code and data (less is better) witch reproduces the issue and upload it somewhere share a link per pn or here in the forum. I also pass few deadlines and hope to get sleep for few hours. I will reply tomorrow._lt_br /_gt__lt_br /_gt_\n\tBest \n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-24T18:01:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI_t_ll try to do that !_lt_br /_gt_\n\tGood luck for your deadlines.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"PeapBoy","Date":"2016-10-25T13:24:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGOT IT !!!_lt_br /_gt__lt_br /_gt_\n\tHello ! _lt_img alt_eq__qt__dd_P_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_tongue.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/tongue@2x.png 2x_qt_ title_eq__qt__dd_P_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tTrying to reproduce the bug_co_ I found the mistake. But let_t_s see the bug in action (yes_co_ I finally could reproduce it !) _dd__lt_br /_gt_\n\tHere is the repro case _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2327_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#27_lt_/a_gt__lt_br /_gt__lt_br /_gt_\n\tAt _lt_strong_gt_line 49_lt_/strong_gt__co_ comment and uncomment the line and... look at my nightmare._lt_br /_gt_\n\tAs you can see_co_ commenting or uncommenting an useless line_co_ totally changes the shader behaviour !_lt_br /_gt_\n\tThat_t_s exactly what I wanted to highlight in my previous posts._lt_br /_gt_\n\tNote that I slightly changed the PCSSGenerator to be as close as possible to my real project_co_ even though it_t_s harder to understand. Now_co_ it includes the shadowGenerator pass_co_ that_t_s why there are only two passes left._lt_br /_gt__lt_br /_gt_\n\tNow here is my mistake _dd_ I put the uniform _qt_previousPass_qt_ (containing the last pass in a textureCube) in the uniform list... Instead of the_lt_em_gt_ sampler_lt_/em_gt_ list._lt_br /_gt_\n\tI finally can display my last pass. _lt_img alt_eq__qt__dd_rolleyes_dd__qt_ data-emoticon_eq__qt__qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_rolleyes.gif_qt_ title_eq__qt__dd_rolleyes_dd__qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tWorking PG _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#17Y5UV%2328_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#17Y5UV#28_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_Nevertheless_co_ I_t_m really curious about this behaviour. If anybody understands this... It would be very interesting to understand why WebGL replaces a texture by another instead of throwing an error or a warning. And it would be even more interesting to understand why it links the good texture_co_ or not_co_  when sampling it (that_t_s what does the line to comment)._lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNote that my mistake didn_t_t avoid the shader to receive the texture_co_ it was passed as an uniform anyway_co_ and we can be sure of that because when we comment the line_co_ we see the good texture. That_t_s why I still don_t_t understand this behaviour.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_em_gt_Is there a shader parsing or anything like that_co_ which involves a texture to be linked or not_co_ whether it_t_s sampled or not in the shader ?_lt_/em_gt__lt_br /_gt__lt_br /_gt__lt_br /_gt_\n\tHowever_co_ thank you so much_co_ you helped me a lot to find my mistake. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt__lt_br /_gt_\n\tPeapBoy\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br /_gt__lt_br /_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-10-25T16:24:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tsamplers are actually pretty dumb_co_ they just work in order of declaration and they are statefull\n_lt_/p_gt_\n\n_lt_p_gt_\n\tso if you declare samp1_co_ samp2 and samp3_co_ it is up to you to set the right texture in slot 1_co_ 2 and 3 _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tif you forgot something then the sampler will just read the currently bind texture\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]