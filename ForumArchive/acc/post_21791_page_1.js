[{"Owner":"Flomotion","Date":"2016-04-08T12:31:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m trying to make my scene lighter because it keeps crashing on some phones (not on my iPhone 6 but unfortunately it does crash on iPhone 6 of client). So I_t_m wondering how to optimise my scene. I have many objects in it. Many of those objects I have created instances of.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould it be a good idea to merge all objects? Or only objects that use the same textures?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnd is it good to merge a group of instances of the same object? Or doesn_t_t that make a difference?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnd what about textures.. what is most demanding for the renderer and memory? Many textures or many objects or large textures?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMany questions.. just would like to find out what_t_s the most important.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2016-04-08T14:14:08Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tnot easy to answer without the scene ... _dd_-p\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWell_co_ the browser profiler is your friend _co_ like the debug layer.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTry to catch where the CPU and the RAM are the most requested in the profiler.  You will have some hints at the JS function level\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe debug layer will help you to understand how many objects_co_ textures_co_ and draw calls are managed and where the time is spent. So it_t_s a good lead to reduce what is the most consuming (reducing draw calls has a huge immediate impact for instance). Those ara hints at the BJS (and a little at the WebGL) level\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"OMAR","Date":"2016-04-08T14:44:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThere_t_s been a similar discussion on the forums here_dd_ \n_lt_/p_gt_\n_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/21427-how-to-optimize-performance-or-the-keep-the-fans-off-thread/?do_eq_embed_qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\tThere is probably no such thing as _qt_most important_qt__co_ usually it_t_s the combination of many things that can _qt_de-optimize_qt_ your WebGL apps.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTake care! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"meteoritool","Date":"2016-04-08T14:57:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tDo you have lights ? shadows ? on your scene ?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Flomotion","Date":"2016-04-09T11:59:24Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks for the replies. Here_t_s the scene_dd_ _lt_a href_eq__qt_http_dd_//spark.amsterdam/experienceiframe/floor-low.html_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//spark.amsterdam/experienceiframe/floor-low.html_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere are no shadows. 1 hemispheric light. Also did mesh.freezeWorldMatrix()_sm_ on all meshes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn the discussion mentioned by _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20291-omar/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20291_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20291-omar/_qt_ rel_eq__qt__qt__gt_@OMAR_lt_/a_gt_ I saw_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- In a general manner_co_ try to reduce or completely avoid instancing new objects because it adds pressure to the garbage collector (which is fully CPU based)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSince I make a lot of instances of single objects in the scene. Would it be better to connect them all and not instance them? It will make the babylon file a lot bigger to load.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOr would merging the instances help? I tried many things but no real difference in the debugger.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"meteoritool","Date":"2016-04-09T13:34:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIn my opinion (but I_t_m not super expert) instances are indeed better ! Using instances for geometries that are the same is at the same time clever and and makes your scene lighter !_lt_br /_gt_\n\tI think you should instantiate as much as you can !_lt_br /_gt_\n\tSo_co_ I_t_ve looked at you scene_co_ very nice looking _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt_  using the debuglayer_co_ after unchecking all options_co_ the scene still hardly reaches 60fps even with my somewhat powerful computer ...\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo there is indeed optimizing needed IMHO here... \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_124348_qt_ data-ipsquote-contentid_eq__qt_21791_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1460203164_qt_ data-ipsquote-userid_eq__qt_16218_qt_ data-ipsquote-username_eq__qt_Flomotion_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t1 hour ago_co_ Flomotion said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t- In a general manner_co_ try to reduce or completely avoid instancing new objects because it adds pressure to the garbage collector (which is fully CPU based)\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tBe careful ! This piece of advice misses an important element _dd_ you shouldn_t_t instance new objects_co_ yes_co_ but only AFTER the run(renderLoop) !!! You can set up anything you want BEFORE you run the renderloop ! It changes the sense of this advice obvy _sm_-)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso_co_ try to check what your scene _qt_registers before render_qt_ to check how much it computes at each frame_co_ some js/babylon objects could maybe exist OUTSIDE (before) the renderloop\n_lt_/p_gt_\n\n_lt_p_gt_\n\tPointLIghts and Shadows use a lot of power ... so you scene does not contain any of them_co_ good ! Have you tried using Directionnal Light maybe ? I guess that wouldn_t_t change a lot anyways _dd_/\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHave you tried to use LOD meshes ? setting sometimes mesh.addLODLevel(50_co_ null) to make invisible meshes disappear is good ..._lt_br /_gt_\n\tHave you tried to decimate meshes with too much/unnecessary vertices ?_lt_br /_gt__lt_br /_gt_\n\tIf you use renderLists for mirror/water_co_ try to make the list dynamic so that only visible meshes would be in the renderList\n_lt_/p_gt_\n\n_lt_p_gt_\n\talso maybe you could _qt_control_qt_ the resolution of the screen_co_ full rendering on my retina computer might be unnecessary ... _lt_br /_gt_\n\tMaybe try to downgrade the resolution and apply antialiasing  postprocess ? is it better ?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t have any other comment so far ... I myself LOVE the possibilities of BABYLON.js but that goes along with a lot of side-knowledges_co_ I_t_m also looking for ways to optimize / deal with memory / etc... finally with time this framework is always very satisfying _lt_img alt_eq__qt_^_^_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_happy.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/happy@2x.png 2x_qt_ title_eq__qt_^_^_qt_ width_eq__qt_20_qt_ /_gt_ look at the sponza demo_co_ it might have some good tricks also_co_ if you know how to backward-read code ! Good luck !\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-04-09T14:28:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_124348_qt_ data-ipsquote-contentid_eq__qt_21791_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1460203164_qt_ data-ipsquote-userid_eq__qt_16218_qt_ data-ipsquote-username_eq__qt_Flomotion_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t2 hours ago_co_ Flomotion said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\ttry to reduce or completely avoid instancing new objects\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tIn other words_co_ try to avoid creating new objects on every frame.  Don_t_t confuse this with using instance meshes in BJS.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"fenomas","Date":"2016-04-10T12:45:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tTop three rules for optimization_dd_\n_lt_/p_gt_\n\n_lt_ol_gt__lt_li_gt_\n\t\tProfile\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tPROFILE\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\t_lt_strong_gt_PROFILE!!!!!_lt_/strong_gt_\n\t_lt_/li_gt_\n_lt_/ol_gt__lt_p_gt_\n\tUntil you profile any attempts at optimization are just shots in the dark. There are a million things you could speed up_co_ and 97% of them won_t_t help because they_t_re not part of the bottleneck!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo_dd_ open your scene in Chrome_co_ hit ctrl+shifti+J to open the dev tools_co_ then go to the _qt_Profiles_qt_ tab and make sure _qt_Collect JS CPU profile_qt_ is selected. Once there_co_ hit the little start button in the upper left_co_ wander around your scene a bit_co_ then stop the profile (same button as before) and interpret the results.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf the GC is the issue (I_t_ll bet you $50 it_t_s not!) then the JS profile will say so. If the JS profile shows most of the time spent as _qt_Idle_qt_ then CPU isn_t_t the issue and you_t_ll need to look at how you_t_re stressing the GPU. Otherwise_co_ you_t_ll see where the JS is spending all its time. If it_t_s in your app code then you have bugs to fix_sm_ if it_t_s in the babylon code then knowing what_t_s slow will give you hints what to fix. E.g. if it_t_s spending all its time selecting objects to render then try using octrees. If it_t_s spending all its time in transform functions try freezing the world matrices of objects that don_t_t move_co_ etc. And of course_co_ if it_t_s not really spending its time anywhere in particular_co_ just spread out everywhere_co_ then it may be that your scene is just really heavy. _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]