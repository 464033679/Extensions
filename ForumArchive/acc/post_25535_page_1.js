[{"Owner":"0l4f","Date":"2016-10-01T08:01:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello forum!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFirst post here_co_ and I_t_m starting off with -probably- a newbie question_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m trying to optimize an experiment that uses a lot of textured planes_co_ cloned with _lt_strong_gt_createInstance_lt_/strong_gt__co_ but I_t_m getting weird z-sorting issues - as you can see here_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//rocketclowns.com/canvas/babylon2/_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//rocketclowns.com/canvas/babylon2/_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe leaves are created with _lt_strong_gt_createInstance_lt_/strong_gt__co_ like this_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_var leavesMaterial _eq_ new BABYLON.StandardMaterial(_qt_leavesTexture_qt__co_ scene)_sm_\nleavesMaterial.diffuseTexture _eq_ new BABYLON.Texture(_qt_textures/viny_leaves.png_qt__co_ scene)_sm_\nleavesMaterial.diffuseTexture.hasAlpha _eq_ true_sm_\nleavesMaterial.useAlphaFromDiffuseTexture _eq_ true_sm_\n\nvar leaves _eq_ BABYLON.Mesh.CreatePlane(_qt_plane_qt__co_ 75.0_co_ scene)_sm_\nleaves.scaling.y _eq_ 0.71_sm_\nleaves.material _eq_ leavesMaterial_sm_\n\nfor (var l _eq_ 0_sm_ l &lt_sm_ 128_sm_ l++) {\t\t\t\n\n    var newLeavesInstance _eq_ leaves.createInstance(_qt_iLeaves_qt_ + l)_sm_\n\n    newLeavesInstance.position.x _eq_ 32 + Math.random() * 96_sm_\n    newLeavesInstance.position.z _eq_ Math.random() * 256_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAm I overlooking something that causes the weird z-sorting behaviour?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tMany thanks in advance _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"0l4f","Date":"2016-10-01T13:49:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNarrowed it down_dd_ z-sorting issue only occurs with \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_useAlphaFromDiffuseTexture _eq_ true_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tin combination with\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_createInstance_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ve attached an image showing the behaviour.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs this a bug?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there a workaround for this scenario?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks again!\n_lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2016_10/instancesBug.jpg.0c450f521c4ff8bef296605e8f6cea04.jpg_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_9692_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2016_10/instancesBug.thumb.jpg.857ae98b167e621dbdfa78cb54a8c723.jpg_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_instancesBug.jpg_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-10-01T14:18:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe only fix that I know of is not to use instances when your mesh is not opaque.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI don_t_t think it_t_s a bug.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2016-10-01T14:48:15Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\teverything is explained here _dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//doc.babylonjs.com/tutorials/Transparency_and_How_Meshes_Are_Rendered_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/tutorials/Transparency_and_How_Meshes_Are_Rendered_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-10-01T14:58:23Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tThere is a lot of good info there_co_ but no mention of instances.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2016-10-01T15:11:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tyou_t_re right_co_ but I guess this is the same principle under the hood\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"0l4f","Date":"2016-10-02T05:31:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHey jerome and adam_co_ thanks for the info!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe link jerome posted clears up a lot_co_ especially this part_dd_\n_lt_/p_gt_\n\n_lt_ul style_eq__qt_color_dd_rgb(0_co_0_co_0)_sm_font-family_dd_Roboto_sm_font-size_dd_medium_sm_font-style_dd_normal_sm_font-weight_dd_300_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt__lt_li_gt_\n\t\tAvoid having heavily-stretched alpha blended meshes (i.e. large planes)_sm_ since the center of its bounding sphere is used for depth sorting_co_ doing this may result in a mesh being sorted as far away from the camera but actually closer to many other meshes.\n\t_lt_/li_gt_\n_lt_/ul_gt__lt_p_gt_\n\tI think that_t_s what we_t_re seeing here?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-10-03T15:07:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tAlmost correct _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ Actually the problem here is that instances are not sorted at all because they are rendered in on batch (hence the performance gain)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tInstances are really powerful but rather limited (Especially in your case). So my suggestion will be to use clones here instead of instances\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"0l4f","Date":"2016-10-04T08:55:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHey Deltakosh!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks for the info and the suggestion! Cloning turns out to be THE solution in this case_dd_ performance gain while retaining z-order _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tUpdated demo using cloning here_dd_  _lt_a href_eq__qt_http_dd_//rocketclowns.com/canvas/babylon2cloning/_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//rocketclowns.com/canvas/babylon2cloning/_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2016-10-04T09:48:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\treally nice\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]