[{"Owner":"Ericky14","Date":"2018-03-01T18:38:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a pretty complex scene built and I am having very heavy lag issues. Even though I have a lot of meshes_co_ they are all instances of default ones... so I don_t_t think there_t_s any reason I should be getting only ~10 FPS. Could anyone provide me with any sort of clue as to why my performance is so low?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBy the way_co_ each of those cylinders are composed of many layers of cylinders. There_t_s usually 3 cylinders (the middle one_co_ the border_co_ and the outline) and under them could be at least 3 others stacked (the ones that look like shadows). Aside from that_co_ each little _qt_group_qt_ that you see in the screenshot has a _qt_mapMesh_qt_ object which the cylinders are parented to. All those mapMeshes are parented to a worldMesh. For the GUI text and images_co_ each letter/image is an instance of a previously generated text/image. Each letter is parented to a wordMesh_co_ which is then parented to a labelMesh_co_ which is then parented to the mapMesh or the cylinder in the case of the ones on top of it.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe background with a gridMaterial has size 300 x 300 and gridRatio of 4. There_t_s also a linear fog which starts at the end of the camera (usually 50 units apart from cylinders in the y axis) and ends at 50 units after that and has a density of 0.01.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAfter this scene is fully generated_co_ there isn_t_t much coding running at all... no animations or anything_co_ it_t_s pretty static. However_co_ I cannot freeze world matrices because I might need to move the cylinders.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI appreciate any help_co_ really stuck on how to improve performance here and not degrade the quality of my scene.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a98488a3d439_ScreenShot2018-03-01at1_24_36PM.png.f085f8eb2c863f7ce3ee23b7a069a47a.png_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_17261_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a98488c54d37_ScreenShot2018-03-01at1_24_36PM.thumb.png.c6e8f4f402524d714e5dee4cd052256c.png_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_Screen Shot 2018-03-01 at 1.24.36 PM.png_qt__gt__lt_/a_gt__lt_/p_gt_\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a98488f5c5f1_ScreenShot2018-03-01at1_23_54PM.png.0306c0a11fad55982774235dc02c2c4c.png_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_17262_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a984890023e7_ScreenShot2018-03-01at1_23_54PM.thumb.png.c30a5ea3928617c3aa774d87a6955e3f.png_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_Screen Shot 2018-03-01 at 1.23.54 PM.png_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2018-03-02T03:51:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi E14!  Umm... start by turning off the fog.  Any improvements?  Change lighting to a single hemisphericLight.  Any changes? \n_lt_/p_gt_\n\n_lt_p_gt_\n\tNext_co_ remove the icons/numbers from tops of cylinders.  Check speeds.  Remove other/all labels.  Check again.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYour vertices count seems sane_co_ but your TOTAL meshes_co_ materials_co_ and textures... looks heavy.  (But I_t_m no expert.)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYour label-making system... for the text... seems...  heavy_co_ boggy_co_ gruesome.  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_  Perhaps too much parenting.  Too complex.  Too much _qt_letter_qt_ and _qt_word_qt_ wrangling.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhen you turn off labels_co_ does the FPS look better?  I think you need to use Babylon GUI for your labeling.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNarrow it down... find the bog log.  Finding it is fairly easy.  Fixing it... that might be tougher.  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBabylonJS GUI system_co_ using its mesh-tracking system... might be a better route (for labels).  Use JS to _qt_generate_qt_ the label as much as possible.  Perhaps_co_ using imageButtons.  Have you sniffed-around in _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/How_To/Gui_qt_ rel_eq__qt_external nofollow_qt__gt_our GUI system_lt_/a_gt_?  Perhaps it can reduce your file loads a bit_co_ or a lot. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tJust some ideas.  Others will surely comment soon.  BTW... I think data visualization_co_ especially _qt_drill-able_qt_... is a very cool use of BJS.  I love it.  I suspect your vertical-stacked cylinders will be drillable.  Click on a stack_co_ you get a new cam view showing the stack_co_ new labels_co_ and waiting for user to click-to-drill even further.  (speculation)  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Ericky14","Date":"2018-03-02T14:06:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello Wingnut_co_ thanks for replying.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFirst of all_co_ nice speculation haha. They are drillable_co_ I_t_ve already got that going.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhat did you mean by using JS to _qt_generate_qt_ the labels? I just instantiate them using the GUI and then create instances of that mesh.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso_co_ if I didn_t_t use this label system and only used BABYLON_t_s GUI to generate each word/text_co_ initialization time for this scene would take over 20 seconds... So_co_ not sure imageButtons will do much for me as they will be individual textures and take longer to generate.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI was able to get ~30 fps by removing all labels. That still seems low to me_co_ is there no other way to improve the scene? Vertice count still high. I will try to improve the label system.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a99591154b1c_ScreenShot2018-03-02at8_59_10AM.png.f4ea53f14051046844f71ca0f59b41a7.png_qt_ data-fileid_eq__qt_17276_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_17276_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_03/5a99591264498_ScreenShot2018-03-02at8_59_10AM.thumb.png.38433c09f98e20758807193794cebc16.png_qt_ alt_eq__qt_5a99591264498_ScreenShot2018-03-02at8_59_10AM.thumb.png.38433c09f98e20758807193794cebc16.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Ericky14","Date":"2018-03-02T14:22:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tBy the way_co_ I forgot to mention_co_ the scene is draggable on the x-z plane of course. Do you guys think its feasible at all to delete meshes outside viewport and make them appear when they come in the viewport? Or is that something already implemented in BABYLON?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-03-02T18:33:42Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWe need to understand what is causing the lag.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo using f12 profiler can help here\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\talso try to flag each mesh with mesh.alwaysSelectAsActiveMesh _eq_ true. This will avoid the frustum clipping step which can be expensive with so many meshes\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso if previous idea works_co_ just flag the scene with scene.freezeActiveMeshes() as it will remove the mesh selection phase giving you even more free CPU\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]