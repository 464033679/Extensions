[{"Owner":"qqdarren","Date":"2015-06-12T13:26:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I_t_m adding a VolumetricLightScatteringPostProcess on mouse click_co_ and there is a noticeable screen flash when I do this. It is the screen going all black for one frame._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I am actually adding two of them (one each to two different meshes)_co_ and the flash is longer (at least twice as long). (So I tried adding some more_co_ and it gets longer and longer - but the FPS is plummeting by this point_co_ so harder to be objective.)_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Previously I was actually adding them at app initialization_co_ with decay set to 0_co_ then just setting decay when they were needed. But I realized they still use CPU in that case_co_ so I am now not creating the object until it is needed._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_BTW_co_ the CPU load is quite significant_dd_ I_t_m getting 45 to 55fps before_co_ then with one VolumetricLightScatteringPostProcess added it drops to 30-35fps_co_ and with two of them it drops to 18-22fps.  (i.e. 50 -&gt_sm_ 33 -&gt_sm_ 20)  (Not a problem as they only run for a few seconds_sm_ but it is a problem if they run _lt_em_gt_all_lt_/em_gt_ the time.)_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So_co_ my first question is if the screen flash is a bug that can be fixed_co_ or just tough?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_And_co_ if tough_co_ is there a way to pre-create the objects (so I can have the screen flash when it does not matter)_co_ but still not have them use any CPU until I am ready?_lt_br_gt__lt_br_gt_P.S. I guess I mean GPU_co_ not CPU_co_ as according to _t_top_t_ the load average does not change_co_ nor do the CPU% shown by Firefox or Xorg. But when I add the effect the FPS goes down and the CPU core temperatures go up!! I_t_m developing on a nothing-special notebook_co_ i7-4702MQ with integrated Intel HD Graphics 4600._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2015-06-12T14:16:02Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi Q!  Hey_co_ how does this demo look/act for you?   _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1BAPRM%2318_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1BAPRM#18_lt_/a_gt__lt_/p_gt__lt_p_gt_Click on those mesh_co_ if you please. The VLS rays should project from the bullet holes._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I had 20 VLS bullet hole beams clicked onto the mesh_co_ and still at 59 fps._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_But_co_ all the VLS/godrays in the above demo... are _lt_u_gt_instances_lt_/u_gt_ of a _qt_papa_qt_ godray-diator_co_ which is located way out in the country.  (pan camera a bit... you_t_ll see tiny dot flashes from papa godray). _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_You might not be using instances_co_ so your mileage may vary._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Is it possible for you to create a playground scene that shows the issue_co_ Q?  thx._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"qqdarren","Date":"2015-06-12T16:40:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_The difference is I don_t_t create the godrays until the first click. I_t_ve hacked your demo_co_ and I can see the flash on the first click_dd__lt_/p_gt__lt_p_gt_    _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1BAPRM%2327_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1BAPRM#27_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I added a wireframe grid to make it easier to see_co_ though it is literally just one frame. Also because the background gets lighter_co_ it is hard to spot._lt_br_gt__lt_br_gt_BTW_co_ I get 35-50fps on your demo (_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1BAPRM%2318_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1BAPRM#18_lt_/a_gt_) in Firefox. It does not change however bullet holes I shoot in the crate. But if I change so the godrays are not created then I get 60fps_co_ and then it drops to the 35-50fps rate after the first click.  Conclusion_dd_ the god rays are what are taking the time. _lt_br_gt__lt_br_gt_Under Chromium I get 60fps either way. (My own code also has notably better FPS under Chromium...)  Conclusion_dd_ Chrome is quicker than Firefox for WebGL stuff!_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2015-06-12T17:08:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_hunh_co_ interesting.  *scratch scratch*  Thanks for showing me/us that_co_ Q._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luaacro","Date":"2015-06-16T14:35:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi qqdarren !_lt_/p_gt__lt_p_gt_For your questions _dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt__lt_strong_gt__qt_So_co_ my first question is if the screen flash is a bug that can be fixed_co_ or just tough?_qt__lt_/strong_gt__lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt_I can_t_t reproduce the bug and I can_t_t see the bug in the demo provided in this topic _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ alt_eq__qt__dd_(_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt_ _lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt__lt_strong_gt_And_co_ if tough_co_ is there a way to pre-create the objects (so I can have the screen flash when it does not matter)_co_ but still not have them use any CPU until I am ready ?_lt_/strong_gt__lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt_The method should be to unattach the post-process from the camera. Then_co_ it_t_ll save performances._lt_/p_gt__lt_p style_eq__qt_color_dd_rgb(40_co_40_co_40)_sm_font-family_dd_helvetica_co_ arial_co_ sans-serif_sm__qt__gt_The post-process is CPU and GPU computed. When the post-process is _lt_span_gt_created_lt_/span_gt__co_ an internal pass is rendered every frame into a render target texture. Also_co_ if the post-process is attached to a camera_co_ the GPU will execute the post-process on every pixel_co_ even if decay _eq_ 0.0_sm_._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"qqdarren","Date":"2015-06-16T15:22:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Thanks for the idea. I tried passing camera as null_co_ to set it later_co_ but instantly get a JavaScript error This line_dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/d7d3c34b15166bc2198c988e49896b08283826ef/Babylon/PostProcess/babylon.volumetricLightScatteringPostProcess.js#L52_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/d7d3c34b15166bc2198c988e49896b08283826ef/Babylon/PostProcess/babylon.volumetricLightScatteringPostProcess.js#L52_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I then tried creating the object_co_ then setting camera to null_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_godrays _eq_ new BABYLON.VolumetricLightScatteringPostProcess(_t_godrays_t__co_1_co_ camera_co_ Q_co_ 50_co_ BABYLON.Texture.BILINEAR_SAMPLINGMODE_co_ engine_co_ true)_sm_godrays.camera _eq_ null_sm__lt_/pre_gt__lt_p_gt_But that seems to have no effect_co_ as the objects are still glowing._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_...a bit more searching_co_ and I suspect you are telling me to use one of the functions described here? _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/wiki/How-to-use-PostProcessRenderPipeline_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/wiki/How-to-use-PostProcessRenderPipeline_lt_/a_gt_   However I don_t_t explicitly have a PostProcessRenderPipelineManager_dd_ do I need to create one_co_ or is one already existing behind the scenes? _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luaacro","Date":"2015-06-16T18:44:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I think _qt_detachPostProcess_qt_ and _qt_attachPostProcess_qt_ are better _dd_ _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/page.php?p_eq_24457_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/page.php?p_eq_24457_lt_/a_gt__lt_/p_gt__lt_p_gt_By passing the _qt_godrays_qt_ reference to the functions_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luaacro","Date":"2015-06-16T18:46:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Oh_co_ and I_t_ll fix the constructor to enable this post-process for rendering pipelines. This is an error from me  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"qqdarren","Date":"2015-06-16T21:58:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Thanks_co_ Luaacro - camera.detachPostProcess() and camera.attachPostProcess() did work. But they cause the camera to give a nasty jerk_sm_ I might be out of time for a few days_co_ but I will try to set up a playground minimal example._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luaacro","Date":"2015-06-23T14:59:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Fixed_co_ you can now use the post-process in a rendering pipeline._lt_/p_gt__lt_p_gt_If _qt_camera_qt_ is undefined or null_co_ you must provide the _qt_scene_qt_ reference into the constructor _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]