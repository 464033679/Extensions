[{"Owner":"thrice","Date":"2017-02-20T19:16:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI am having performance issues (bad enough to make the game unplayable)_co_ when using the canvas 2d library. I am wondering if there are better ways to do what I am currently (surely there must be). For context_dd_ building a card game.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe issue manifests itself as soon as I tried using canvas2d with my card object. Each players deck consists of 60 cards_co_ so there_t_s at least 120 parent card meshes. The following code is what_t_s causing the slow down.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_      this.babylon _eq_ this.$children.plane.babylon_sm_\n      this.babylon.parent _eq_ this.parentPlane.babylon_sm_\n      this.babylon.position _eq_ new BABYLON.Vector3(0_co_ -0.2_co_ 0)_sm_\n      this.babylon.material _eq_ new BABYLON.StandardMaterial(_qt_attribute_game_text_qt__co_ this.scene.babylon)_sm_\n\n      this.canvas _eq_ new BABYLON.WorldSpaceCanvas2D(this.scene.babylon_co_ new BABYLON.Size(150_co_ 150)_co_ {\n        id_dd_ _qt_PlaneCanvas_qt__co_\n        cachingStrategy_dd_ BABYLON.Canvas2D.CACHESTRATEGY_CANVAS_co_\n        customWorldSpaceNode_dd_ this.babylon_co_\n        backgroundFill_dd_ _qt_transparent_qt__co_\n        isPickable_dd_ false_co_\n        children_dd_\n        [\n          new BABYLON.Text2D(this.card.gameText() || _qt_ _qt__co_ {\n            defaultFontColor_dd_ new BABYLON.Color4(0_co_ 0_co_ 0_co_ 1)_co_\n            marginAlignment_dd_ _qt_h_dd_center_co_ v_dd_center_qt__co_\n            fontName_dd_ _qt_16pt Helvetica_qt__co_\n            fontSuperSample_dd_ false\n          })\n        ]\n      })_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tIn example above_co_ this.babylon is a plane.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI was using tracked node_co_ but then I found an example setting customWorldSpaceNode per above_co_ and that seemed like the ideal way for me to do things since I am trying to render text atop the plane which exists in my game (and tracked node brings all text to the top which I_t_d like  to avoid).\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnyways_co_ my question is_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there some obvious setting I am missing that could speed it up_co_ or is this a bad idea to instantiate that many WorldSpaceCanvas2d nodes in general? (it sounds like an expensive object_co_ however I would think the caching strategy would be preventing the performance issues I am seeing. Or anyone have any alternate/better ideas?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"thrice","Date":"2017-02-20T19:29:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tMore info_dd_ With that one block of code above (which creates 120 or so world space canvas objects)_co_ FPS fluctuates consistently from 10-40 (40 being rare) - Without it_co_ FPS is consistently 35-45\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-02-21T17:33:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_span_gt_Ping _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/18979-nockawa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_18979_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/18979-nockawa/_qt_ rel_eq__qt__qt__gt_@Nockawa_lt_/a_gt_ and _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4289_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/_qt_ rel_eq__qt__qt__gt_@adam_lt_/a_gt__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nockawa","Date":"2017-02-21T17:53:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYES ! (well_co_ I think you will not share my happy thoughts...) but I_t_m glad I_t_m having performance issues reported! _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m going to help you as much as I can to solve this_co_ perf are top priority for me.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut first_co_ I need more info about what you_t_re trying to achieve and why you chose the design you came up with.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere are the questions_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t1) why you need to rely on WorldSpaceCanvas (WSC) instead of Screen Space? \n_lt_/p_gt_\n\n_lt_p_gt_\n\t2) what kind of content do you display in these canvas?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI know there_t_s currently a big perf improvement I can make for (WSC) rendering_co_ because right now if you have 120 WSC it will end up with 120 Draw Calls to render the 120 planes. But I could rely on InstancedMesh (when you use the default WSC Node_co_ which is a Plane of a given size) to greatly reduce the Draw Calls. If you create 120 WSC with the same size it would end up with 1 draw call at best_co_ and maybe few more at worst (I can explain that if you want).\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"thrice","Date":"2017-02-23T04:52:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/18979-nockawa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_18979_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/18979-nockawa/_qt_ rel_eq__qt__qt__gt_@Nockawa_lt_/a_gt_ haha I_t_ve never met anyone so excited to debug performance issues_co_ I admire your eagerness to do so.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo first things first_dd_ it was largely an ID10T error on my part_co_ the jist of it is_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI essentially have hover states attached to my cards_co_ which trigger a zoom animation on a copy of the card to show the card being hovered. - When I converted over to canvas2d_co_ the text was blocking the plane below which had the hover states_co_ in certain small areas_co_ which was leading to the hover animation being called pretty much everytime the mouse was being moved even a pixel. So tl_sm_dr_sm_ _co_ by setting enableInteraction to false_co_ along with throttling the hover_co_ it largely solved my performance issues.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat being said_co_ it_t_s rendering around 45-59 now_co_ so still not 60_co_ but truthfully I don_t_t fully remember if it was at 60 before switching to canvas2d.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe reason I am creating so many world space canvases_co_ is something I am still struggling with. Basically_co_ I am trying to figure out a predictable way of rendering text within a corresponding plane of a certain shape. You can see my issue easier than I can explain_dd_ (disclaimer_co_ using placeholder images)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img alt_eq__qt_Screenshot%202017-02-22%2020.18.30.png?r_qt_ class_eq__qt_ipsImage_qt_ src_eq__qt_https_dd_//www.dropbox.com/s/9m3rrsa1hl9kq3u/Screenshot%202017-02-22%2020.18.30.png?raw_eq_true_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo basically each card has potentially 4 attributes_co_ a name_co_ and a description. I am trying to position the attributes at each corner of the 3d plane_co_ and the description on the bottom part of the card. So_dd_ I am using the world space canvas with customWorldSpacenode to paint the text attributes transparently over the top of the 3d plane (which has actions and what not attached)_co_ because the size of the 2d canvas per card needs to change_co_ depending on the size of the screen. So I have a bunch of methods on my plane controller for attempting to get the size of the card plane on screen_co_ then I am doing the following to get to what you see in the screenshot\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_      plane.material _eq_ new BABYLON.StandardMaterial(_qt_transparent_background_qt__co_ this.scene.babylon)_sm_\n      plane.material.diffuseTexture _eq_ new BABYLON.DynamicTexture(_qt_transparent_texture_qt__co_ this.parentPlane.sizeOnScreen().height_co_ this.scene.babylon_co_ true)_sm_\n      plane.material.diffuseTexture.hasAlpha _eq_ true_sm_\n\n      this.canvas _eq_ new BABYLON.WorldSpaceCanvas2D(this.scene.babylon_co_ new BABYLON.Size(this.parentPlane.sizeOnScreen().width_co_ this.parentPlane.sizeOnScreen().height)_co_ {\n        id_dd_ _qt_PlaneCanvas_qt__co_\n        cachingStrategy_dd_ BABYLON.Canvas2D.CACHESTRATEGY_CANVAS_co_\n        customWorldSpaceNode_dd_ this.$children.plane.babylon_co_\n        backgroundFill_dd_ _qt_transparent_qt__co_\n        isPickable_dd_ false_co_\n        enableInteraction_dd_ false_co_\n        children_dd_\n        [\n          new BABYLON.Text2D(this.cost().toString()_co_ {\n            marginAlignment_dd_ _qt_h_dd_left_co_ v_dd_top_qt__co_\n            fontName_dd_ _qt_8pt Arial_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ -2_co_\n            x_dd_ 8\n          })_co_\n          new BABYLON.Text2D(this.fate().toString()_co_ {\n            marginAlignment_dd_ _qt_h_dd_right_co_ v_dd_top_qt__co_\n            fontName_dd_ _qt_8pt Helvetica_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ -2_co_\n            x_dd_ -8\n          })_co_\n          new BABYLON.Text2D(this.health().toString()_co_ {\n            marginAlignment_dd_ _qt_h_dd_right_co_ v_dd_bottom_qt__co_\n            fontName_dd_ _qt_8pt Helvetica_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ 2_co_\n            x_dd_ -8\n          })_co_\n          new BABYLON.Text2D(this.attack().toString()_co_ {\n            marginAlignment_dd_ _qt_h_dd_left_co_ v_dd_bottom_qt__co_\n            fontName_dd_ _qt_8pt Arial_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ 2_co_\n            x_dd_ 8\n          })_co_\n          new BABYLON.Text2D(this.card.gameText() || _qt_ _qt__co_ {\n            defaultFontColor_dd_ new BABYLON.Color4(0_co_ 0_co_ 0_co_ 1)_co_\n            marginAlignment_dd_ _qt_h_dd_center_co_ v_dd_top_qt__co_\n            fontName_dd_ _qt_4pt Helvetica_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ -39\n          })_co_\n          new BABYLON.Text2D(this.card.name_co_ {\n            // defaultFontColor_dd_ new BABYLON.Color4(0_co_ 0_co_ 0_co_ 1)_co_\n            marginAlignment_dd_ _qt_h_dd_center_co_ v_dd_top_qt__co_\n            fontName_dd_ _qt_4pt Helvetica_qt__co_\n            fontSuperSample_dd_ true_co_\n            y_dd_ -33\n          })_co_\n        ]\n      })_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tAs you can however see from the screenshot_co_ things aren_t_t working terribly well. Positions are still off slightly_co_ and in order to use the actual screen size of the plane for the width/height_co_ I am having to set the font sizes extremely small which results in things looking pretty bad.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI guess I am wondering if you have any better ideas as how to structure things. I guess_co_ the root of my struggles come down to having to set a plane size in babylon that is a relative percentage_co_ and then having to create canvases in pixels which are absolute.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Nockawa","Date":"2017-02-23T10:20:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk_co_ so_co_ let_t_s do this step by step\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you need text to be displayed following the plane a of 3D object_co_ so not following the plane of the viewport_dd_ then a WorldSpaceCanvas (WSC for short) must be used. So I think you made the right decision here.\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm_float_dd_none_sm__qt__gt_So_dd_ I am using the world space canvas with customWorldSpacenode to paint the text attributes transparently over the top of the 3d plane (which has actions and what not attached)_lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tRight! But then you said_dd_\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm_float_dd_none_sm__qt__gt_..._co_ because the size of the 2d canvas per card needs to change_co_ depending on the size of the screen._lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tthere you lost me. Why the size of the WSC is related to the size of the screen?\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm_float_dd_none_sm__qt__gt_As you can however see from the screenshot_co_ things aren_t_t working terribly well. Positions are still off slightly_co_ and in order to use the actual screen size of the plane for the width/height_co_ I am having to set the font sizes extremely small which results in things looking_lt_span_gt_ _lt_/span_gt__lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tFirst_co_ use the latest preview version I_t_ve commit 1-2 days ago (see _lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/22552-canvas2d-main-post/?do_eq_findComment&amp_sm_comment_eq_158655_qt_ rel_eq__qt__qt__gt_this post_lt_/a_gt__co_ an you should follow its thread). Alignment/Positioning is way more reliable now._lt_br /_gt_\n\tNow concerning your _qt_extremely small_qt__co_ yes_co_ that_t_s something I_t_ve realized few weeks ago_co_ when you set the size of your WSC it_t_s in pixel but it must match the 3D World Coordinates and something (well_co_ most of the time I should say) these two coordinates systems are totally unrelated. But you need to keep the ratio between the 3D world plane and the WSC that is created. So I_t_ve introduced lately the _qt_unitScaleFactor_qt_ setting at the WSC_t_s construction_co_ to apply a scale factor on the WSC that will be created.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tExample_dd_ you need a WSC to be 40x80 in 3D world coordinates (for instance this is the size of your 3D card)_co_ but in order to display text correctly you need a bigger surface_co_ if it_t_s something like 120*240 then you have to set a unitScaleFactor of 3. This way you_t_re dealing with a WSC that is _qt_more suited_qt_ for text rendering/fontsize.\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\tQuote\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm_float_dd_none_sm__qt__gt_I guess I am wondering if you have any better ideas as how to structure things. I guess_co_ the root of my struggles come down to having to set a plane size in babylon that is a relative percentage_co_ and then having to create canvases in pixels which are absolute._lt_/span_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI hope that my answer above is the solution to this. tell me if I_t_m correct.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_About Performances_lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBecause it_t_s like size_co_ it matters after all_co_ no matter what they say! If your WSC_t_s content don_t_t change (in your case if the text is pretty much static) it won_t_t be rendered... To say it more clearly_dd_ the WSC_t_s is rendered only if there are changes made. So if there_t_re none_co_ it_t_s rendered one time for good._lt_br /_gt_\n\tThen after the deal is it will add one draw call to draw your custom node. If you have 120 custom node_co_ then it_t_s 120 Draw Calls_co_ I don_t_t think it would slow things down that much. but if it_t_s a concern and that you manage to make all your card_t_s WSC with the same size_co_ then you should use Mesh.createInstance() to create a InstancedMesh in order to make your 120 Draw Calls just a single one!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut first thing first_dd_ quality/fidelity_co_ then perf. So let_t_s solve the positioning/text quality first.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne last thing_co_ once the font size you set is pretty good (at least 14px) try to use the signedDistanceField mode instead of the superSample one.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]