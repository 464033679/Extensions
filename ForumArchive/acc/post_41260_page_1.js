[{"Owner":"logunov","Date":"2018-11-14T07:13:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGood day_co_ Sir. First_co_ I want to say T_lt_span style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#353c41_sm_font-size_dd_14px_sm__qt__gt_hanks to everyone_co_ who spent time to read this_co_ I will be glad and happy to hear any advices or notes about this issue._lt_/span_gt__lt_br /_gt_\n\tHere is a PG_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#AI1MQC%232_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#AI1MQC#2_lt_/a_gt__lt_br /_gt_\n\tPlease_co_ hide the SetEnviroment()_co_ getPointsArray() and cameraMoveAnimation() functions bodies to make code more readable_co_ I specially out them from main code._lt_br /_gt_\n\t_lt_br /_gt_\n\tAs you can see_co_ there is 2 important lines_dd_ 82 and 83._lt_br /_gt_\n\t_lt_br /_gt_\n\tEach points from _qt_points_qt_ array is a real data from real project_co_ that is not random numbers. _lt_br /_gt_\n\tSo_co_ the camera should move from_dd_ point1 to point2_co_ then point2 to point3_co_ then point3 to point4_co_  and so on._lt_br /_gt_\n\tThere is no problems in start points_co_ it_t_s moving smoothly_co_ but at point7 to point8 (and some others) camera rotates around itself. (Playground setted by default to reproduce this)._lt_br /_gt_\n\tIt look like... flipping possible. I am using pivot method to create camera_co_ and I can not use ArcRotateCamera in real project_co_ because in some points it_t_s broken because of gimbal look_co_ for example_co_ at point8 as I remember_co_ it will dispose_co_ and then appear_co_ ArcRotateCamera was first_co_ what I tried._lt_br /_gt_\n\t_lt_br /_gt_\n\tSo_co_ the question is_dd_ how to prevent camera flipping around itself? _lt_br /_gt_\n\t_lt_br /_gt_\n\t_eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__lt_br /_gt_\n\tupd_dd_ I tested a little more_co_ if I am using lookAt method without animation and just setting new quaternion_co_ it reproduces the same problem_co_ but I don_t_t have any idea why it happens and why it_t_s changing rotation angle._lt_br /_gt_\n\t_eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__lt_br /_gt_\n\tupd2_dd_ I made additional example_co_ which shows problem from outside_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#X66D1S%231_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#X66D1S#1_lt_/a_gt__lt_br /_gt_\n\tAs you can see_co_ big red sphere doing strange movement but if you change animation arguments in lines 82 and 83 from points[7]_co_ points[8] to points[6]_co_ points[7]_co_ sphere will do exactly what I needed_co_ so what is it? Why it happens? How can I prevent this? \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"logunov","Date":"2018-11-14T10:45:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#X66D1S%232_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#X66D1S#2_lt_/a_gt_ here is additional demonstration_co_ why I can not use ArcRotateСamera or Euler angles. _lt_br /_gt_\n\tIn this example I changed method to use rotation instead of rotationQuaternion and when animation finishing camera immediately dying (I don_t_t know how to call this phenomenon_co_ gimbal lock probably_lt_br /_gt_\n\t_lt_br /_gt_\n\t_eq__eq__eq__eq__eq__eq__eq__eq__eq__eq__lt_br /_gt_\n\tUpd_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#X66D1S%236_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#X66D1S#6_lt_/a_gt__lt_br /_gt_\n\tI though problem was in pivot method_co_ but when I changed method to position from quaternions (not effective_co_ but better_co_ than nothing)_co_ it_t_s still flip in certain points. _lt_br /_gt_\n\t_lt_br /_gt_\n\tI have no idea why camera is flipping. _lt_br /_gt_\n\t_lt_br /_gt_\n\t_eq__eq__eq__eq__eq__lt_br /_gt_\n\tUpd_dd__lt_br /_gt_\n\tWell_co_ some time passed_co_ so I need to say sorry for my manners of question. I hadn_t_t time to make some etiquette. _lt_br /_gt_\n\t_lt_br /_gt_\n\tThanks to everyone_co_ who spent time to read this_co_ I will be glad and happy to hear any advices or notes about this issue._lt_br /_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-11-14T15:41:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello and welcome!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo first of all I would highly recommend to provide simpler PG without all the noise (like removing unnecessary functions _lt_span_gt__dd_))_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can see that you are doing a lot of custom maths so I guess the problem is in your math_co_ correct? Can you describe your algorithm? What is the goal? Can you isolate just the problem itself?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"logunov","Date":"2018-11-14T16:15:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThank you_co_ _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt__co_ for the advice and answer. _lt_br /_gt_\n\tThere is isolated code_co_ and there is _lt_strong_gt_no custom math_lt_/strong_gt__dd_ _lt_br /_gt_\n\tgood result_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#AI1MQC%237_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#AI1MQC#7_lt_/a_gt__lt_br /_gt_\n\tbad result_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#AI1MQC%236_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#AI1MQC#6_lt_/a_gt__lt_br /_gt_\n\tOne method_co_ but different arguments._lt_br /_gt_\n\tI added some comments and removed unnecessary code. \n_lt_/p_gt_\n\n_lt_p_gt_\n\t1) Setting pivot_lt_br /_gt_\n\t2) Setting camera parent to pivot_lt_br /_gt_\n\t3) Pivot looks at startPoint on sphere surface_lt_br /_gt_\n\t4) Cloning pivot_co_ making clone lookAt end point_lt_br /_gt_\n\t5) Passing pivot.RotationQuaternion and cloned pivot.RotatingQuaternion (after lookAt method) to animator_lt_br /_gt_\n\t6) Getting camera rotation around itself_lt_br /_gt_\n\t_lt_br /_gt_\n\t_lt_strong_gt_If I pas another two points on the same sphere_co_ it works perfectly. _lt_/strong_gt__lt_br /_gt_\n\tI would be glad to use another points_co_ but It is impossible in real code. _lt_br /_gt_\n\t_lt_br /_gt_\n\tMore detail explanation_dd_ _lt_br /_gt_\n\tPoints - is just a points on sphere surface_co_ which I am moving my player_co_ and camera should look perpendicular _lt_strong_gt_to tile under player_lt_/strong_gt_. Camera moving from tile to tile_co_ but follows player. _lt_br /_gt_\n\tIt is turn-based game_co_ so my player moving asynchronous to camera movement and camera moving on her own around sphere surface_co_ but I_lt_strong_gt_ can not use ArcRotateCamera_co_ because it have gimbal lock and the same issue._lt_/strong_gt__lt_br /_gt_\n\t_lt_br /_gt_\n\tIn this playground camera rotates around itself and change angle of view.  For example_co_ camera was perpendicular to the player_co_ and there was some stone behind him. _lt_br /_gt_\n\tWhen I moving through _lt_strong_gt_BABYLON.Animation_co_ _lt_/strong_gt_it rotates around itself and stone now in the upper part of screen. In the playground you can see it like light reflection drawing arcus_co_ but if I change _lt_br /_gt_\n\t_lt_br /_gt_\n\tAgain_co_ thx everyone who spent time to read. \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-11-14T17:03:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m so sorry but what is wrong with 2nd playground? I see the camera rotating. Isn_t_t it expected? what would you expect? (it is though to say as data points are kind of random _lt_span_gt__dd_))_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"logunov","Date":"2018-11-14T17:15:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ maybe video will explain better_co_ than words _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_br /_gt_\n\t_lt_br /_gt_\n\tAfter movement_co_ starting on 0_dd_20 to 0_dd_23 camera changes angle of view_co_ and there is much of this points on the sphere. _lt_br /_gt_\n\tI can_t_t find a reason_co_ why it happens. And I have no idea how to prevent this rotation._lt_br /_gt_\n\t_lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_div class_eq__qt_ipsEmbeddedVideo_qt__gt_\n\t_lt_div_gt_\n\t\t_lt_iframe allowfullscreen_eq__qt_true_qt_ frameborder_eq__qt_0_qt_ height_eq__qt_270_qt_ src_eq__qt_https_dd_//www.youtube.com/embed/QoNCyHloE_I?start_eq_20&amp_sm_feature_eq_oembed_qt_ width_eq__qt_480_qt__gt__lt_/iframe_gt_\n\t_lt_/div_gt_\n_lt_/div_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-11-14T18:09:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWell why do you need to rotate the camera? In your example rotation the mesh should be perfect no?\n_lt_/p_gt_\n\n_lt_p_gt_\n\ti think the problem is coming from the way the camera is building its viewMatrix and its relation to upvector (the problem will really be visible when you are almost perpendicular to upVector)_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Cameras/babylon.targetCamera.ts#L370_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Cameras/babylon.targetCamera.ts#L370_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"logunov","Date":"2018-11-15T09:12:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThank you for the tip_co_ I will try to figure out what_t_s happening during linear transformations with camera._lt_br /_gt_\n\tAbout mesh rotation_co_ the snake on the sphere surface is not a mesh but dynamically changing object_co_ because of some game triggers_co_ so there is no possibility to follow it with camera (in my view_co_ maybe it is possible)._lt_br /_gt_\n\tIf I am trying to use pseudo-mesh_co_ wich moves from points to points_co_ that target camera or follow camera do not move around sphere surface_co_ but in angle to it. ArcRotateCamera and ArcFollowCamera both dying in certain positions_co_ maybe I did something wrong with it_co_ I will check it better. \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-11-15T17:38:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tok make sense_co_ can you try to repro on a simpler isolated data? So we can check the maths?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]