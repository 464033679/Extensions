[{"Owner":"ozRocker","Date":"2018-01-18T07:01:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m struggling with getting this girl to walk and make facial expressions.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf I separate the head_co_ the head moves when using the _qt_pout_qt_ morph.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2311_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#11_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf I apply to the whole body_co_ the rest pose is applied to the walk.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2315_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#15_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tBoth work fine in Blender though.  Is there something else I need to do to get morphing working with armature animation?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-01-18T20:38:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI do not know.  When I morph with a skeleton in QI_co_ the base vertices / normals are recomputed on the CPU_co_ &amp_sm_ resent to GPU.  In this scenario_co_ the skeleton weights being applied in the shader are blissfully unaware of the change.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou are not running the default shader set with a custom material.  There I see morphing is done before bone influence in default.  You might want to just use a standard material_co_ not one that changes.  This will show whether this a general problem or just with custom materials.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBTW_co_ I never had the need to switch my texture for _lt_a href_eq__qt_https_dd_//palmer-jc.github.io/scenes/QueuedInterpolation/automaton/index.html_qt_ rel_eq__qt_external nofollow_qt__gt_toons_lt_/a_gt_ (change expression in the dropdown).  If you are going to show full characters without zoom_co_ this might be just an expense without any real payoff that you can see.  Just sayin.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-01-18T22:34:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_201909_qt_ data-ipsquote-contentid_eq__qt_35148_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516307934_qt_ data-ipsquote-userid_eq__qt_8492_qt_ data-ipsquote-username_eq__qt_JCPalmer_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t1 hour ago_co_ JCPalmer said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tYou are not running the default shader set with a custom material.  There I see morphing is done before bone influence in default.  You might want to just use a standard material_co_ not one that changes.  This will show whether this a general problem or just with custom materials.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tok_co_ here_t_s the playground without any custom material. The morph problem can be seen here as well.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2316_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#16_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-18T23:49:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIt should work in a whole body approach_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCan you make sure that the morph targets are all the same but the head?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBones work at matrix level where morph targets work at geometry so they SHOULD be compatible\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-18T23:51:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tAlso another test_dd_ can you try with all morph targets identical to the source?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-01-19T00:24:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_201950_qt_ data-ipsquote-contentid_eq__qt_35148_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516319516_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t35 minutes ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tAlso another test_dd_ can you try with all morph targets identical to the source?\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOk_co_ this playground has a morph target applied to the whole body_co_ but the target is exactly the same as the source (no change)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2317_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#17_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt looks like its applying the rest pose to the animation\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-19T23:36:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOn it!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-19T23:47:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk so it seems that there is a data issue.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tLet me try to show you why.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you run this PG_dd_ _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME#18_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#18_lt_/a_gt__co_ you will see that skeletons are disabled but still the target and the source are not the same. Seems like the target is based on T pose while the source is on the first animation frame\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-01-20T03:18:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_202030_qt_ data-ipsquote-contentid_eq__qt_35148_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516405624_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t3 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tOk so it seems that there is a data issue.\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tLet me try to show you why.\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tIf you run this PG_dd_ _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2318_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#18_lt_/a_gt__co_ you will see that skeletons are disabled but still the target and the source are not the same. Seems like the target is based on T pose while the source is on the first animation frame\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tAh ok.  Do you know how I can fix that?  I thought morph targets were relative_co_ so the values for everything would be zero_co_ apart from the face that changes.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-01-20T16:30:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThinking out loud.  Shapekeys are based on the actual values of the vertices.  The actual positions are not read when the position values are exported.  They are a read from a copy made using a _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Exporters/blob/master/Blender/src/babylon-js/mesh.py#L517_qt_ rel_eq__qt_external nofollow_qt__gt_bmesh_lt_/a_gt_.  The bmesh copy has the advantage of having all modifiers already applied like Mirror or sub-surface smoothing.  An armature is also implemented as a modifier.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe process currently processes all armatures first &amp_sm_ along with any actions (animations).  The frame number is then set back to what it was.  All meshes are then processed with the settings of the modifiers_co_ in your case also the first frame.  It never made a difference before.  For my morphing_co_ I never exported with an action_co_ though Tower of Babel can.  I just set the armature to the rest pose before exporting_co_ and got the poses from an armature pose library exported separately.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI wonder if just before creating the bmesh_dd_\n_lt_/p_gt_\n\n_lt_ul_gt_\n\t_lt_li_gt_\n\t\tset the currentAction to None\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\twent into pose mode\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tselected all bones\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tcleared all transforms\n\t_lt_/li_gt_\n_lt_/ul_gt_\n\n_lt_p_gt_\n\tIf this does not just destroy the export_co_ all morph targets &amp_sm_ the main vertices would be as if from the rest pose.  Afterward_co_ maybe set currentAction back to what it was. \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-01-21T04:17:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_202070_qt_ data-ipsquote-contentid_eq__qt_35148_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1516465833_qt_ data-ipsquote-userid_eq__qt_8492_qt_ data-ipsquote-username_eq__qt_JCPalmer_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t11 hours ago_co_ JCPalmer said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tThinking out loud.  Shapekeys are based on the actual values of the vertices.  The actual positions are not read when the position values are exported.  They are a read from a copy made using a _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Exporters/blob/master/Blender/src/babylon-js/mesh.py#L517_qt_ rel_eq__qt_external nofollow_qt__gt_bmesh_lt_/a_gt_.  The bmesh copy has the advantage of having all modifiers already applied like Mirror or sub-surface smoothing.  An armature is also implemented as a modifier.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOk_co_ your thoughts gave me an idea.  I did this with my virtual world.  I had a mesh .babylon file and I had an animation .babylon file and I was able to apply the animation to the mesh.  I used this technique as a workaround for this.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhat I did here was create a .babylon file with meshes and skeleton (but no animation) and morph target.  I was able to separate head from body so I only have to apply morph targets to the head_co_ which is a smaller mesh.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI then created a .babylon file with mesh and animation.  I removed morph targets from that.  I only need the animation but you can_t_t export Blender project that doesn_t_t have a mesh_co_ or has a mesh but its empty.  I basically cleared out the mesh data by hand (editing the text file).  This cut a 3.3MB file to 122KB so it only has the animation data.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI then load both files and copy the animation to the morph target meshes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou can see it here _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2320_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#20_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-01-22T15:56:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWoot! this works very well!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCongrats\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-01-22T16:54:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNice work around.  I did try to implement what I talked about on Saturday.  My first attempt only worked when you exported when the armature was selected when you did the export.  Then tried to select the armature in code &amp_sm_ got errors_co_ and gave up for the day.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne improvement on the 2 export solution might be to have the armature be the only thing in the currently selected layer.  Check the _t_currently select layers_t_ box in the custom exporter properties on the Scene tab.  Or adding a _t_Only armatures / animations_t_ check box on Scene exporter properties seems like it might be useful &amp_sm_ easy to implement as well.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNot working on this right now_co_ but will pick it up again during a break.  Having quite a difficult time finishing my Blender Kinect Mocap project.  The pipeline turned out to be the easy part.  Getting the resulting data transformed without destroying the mesh is difficult.  I foresee frequent break opportunities_co_ unfortunately._lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt_ /_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]