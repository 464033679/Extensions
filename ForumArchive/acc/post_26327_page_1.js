[{"Owner":"Numa","Date":"2016-11-11T09:55:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi there_co_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m trying to rotate a mesh around a specific point. I use the setPivotMatrix + translate back and it works great_co_ as long as the mesh isn_t_t already scaled or rotated. If it is_co_ the mesh jumps to a wrong position before it starts rotating.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI took care of the scale but can_t_t figure out how to handle the rotation. Here_t_s what I have_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_    \n    var position _eq_ new BABYLON.Vector3(10_co_ 10_co_ 10)_sm_\n\n    // Mesh position relative to pivot point\n    var relativePosition _eq_ mesh.position.subtract(position)_sm_\n\n    // Set pivot matrix\n    mesh.setPivotMatrix(BABYLON.Matrix.Translation(relativePosition.x * (1 / mesh.scaling.x)_co_\n                                                   relativePosition.y * (1 / mesh.scaling.y)_co_\n                                                   relativePosition.z * (1 / mesh.scaling.z)))_sm_\n\n    // Translate back\n    mesh.position _eq_ mesh.position.add(new BABYLON.Vector3(-relativePosition.x_co_\n                                                          -relativePosition.y_co_\n                                                          -relativePosition.z))_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks guys\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2016-11-11T17:55:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tAm working on the same problem (well the rotation one) as is _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/16694-digihz-data/?do_eq_hovercard_qt_ data-mentionid_eq__qt_16694_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/16694-digihz-data/_qt_ rel_eq__qt__qt__gt_@DigiHz Data_lt_/a_gt_\n_lt_/p_gt_\n_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/26132-getpivotmatrix-xyz-local-values/?do_eq_embed_qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\thave an idea why and where it goes wrong but will take a few days to confirm (or not) that I can produce a solution.  If I get rotation solved_co_ scaling will probably follow.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"DigiHz Data","Date":"2016-11-13T04:14:08Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLook at my updated PG about a possible solution.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#M0UJB_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#M0UJB_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-11-13T04:23:42Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLooking good!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhy do we need pick a specific axis? let_t_s say I want my pivot to be (3_co_ 4_co_ 5) instead of 0_co_ 0_co_ 0_co_ could I just pass the (0_co_ 0_co_ 0).subtract(3_co_ 4_co_ 5) vector instead? Would that work?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"DigiHz Data","Date":"2016-11-13T04:31:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI can not tell you about that_co_ sorry_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tyou can figure it out from the code in the PG i think.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2016-11-15T16:37:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20501_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/_qt_ rel_eq__qt__qt__gt_@Numa_lt_/a_gt_ and _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/16694-digihz-data/?do_eq_hovercard_qt_ data-mentionid_eq__qt_16694_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/16694-digihz-data/_qt_ rel_eq__qt__qt__gt_@DigiHz Data_lt_/a_gt_ after days playing around with setPivotMatrix I suddenly felt very foolish as I realised the approach was wrong and I had in fact produced the basis of a solution back in May 2015 in the post below (back in the days when I was new to BJS and was misinterpreting many things and was working on an un-necessary solution to something dealt with much easier - so nothing changes does it)\n_lt_/p_gt_\n_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/14601-multiple-rotations-not-as-expected/?do_eq_embed&amp_sm_comment_eq_83140&amp_sm_embedComment_eq_83140&amp_sm_embedDo_eq_findComment_qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\tHowever as wrong headed as that solution was it was the solution to the pivot problem.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere are two methods one for rotating around a pivot and one for scaling from a pivot both of which allow you to move the pivot and the mesh using just .position. If you would both like to test them out and see if they fail anywhere this would be very useful. (After all I though I had found a solution previously and it failed). \n_lt_/p_gt_\n\n_lt_p_gt_\n\tOf course anyone else is welcome to test them out as well.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_The Rotation Method _lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\trotateAroundPivot takes three parameters - the position of the pivot (Vector3)_co_ an axis (Vector3)  to rotate around and the angle (number as radians) to rotate. Rotations are accumulative.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.Mesh.prototype.rotateAroundPivot _eq_ function(pivotPoint_co_ axis_co_ angle) {\n\t\tif(!this._rq) {\n\t\t\tthis._rq _eq_ BABYLON.Quaternion.Identity()_sm_\n\t\t}\t\t\n\t\tvar _p _eq_ new BABYLON.Quaternion(this.position.x - pivotPoint.x_co_ this.position.y - pivotPoint.y_co_ this.position.z - pivotPoint.z_co_ 0)_sm_\n\t\taxis.normalize()_sm_\n\t\tvar _q _eq_ BABYLON.Quaternion.RotationAxis(axis_co_angle)_sm_  //form quaternion rotation\t\t\n\t\tvar _qinv _eq_ BABYLON.Quaternion.Inverse(_q)_sm_\t\n\t\tvar _pdash _eq_ _q.multiply(_p).multiply(_qinv)_sm_\n\t\tthis.position _eq_ new BABYLON.Vector3(pivotPoint.x + _pdash.x_co_ pivotPoint.y + _pdash.y_co_ pivotPoint.z + _pdash.z)_sm_\n\t\tthis.rotationQuaternion _eq_ this._rq.multiply(_q)_sm_\n\t\tthis._rq _eq_ this.rotationQuaternion_sm_\n\t}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_strong_gt_Scaling Method_lt_/strong_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tscaleFromPivot takes four parameters the position of the pivot (Vector3) and the scale for x_co_ y_co_ z axes as numbers. The numbers used set the current scale of the mesh based on its original size with the pivot as centre of enlargement.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.Mesh.prototype.scaleFromPivot _eq_ function(pivotPoint_co_ sx_co_ sy_co_ sz) {\n\t\tvar _sx _eq_ sx / this.scaling.x_sm_\n\t\tvar _sy _eq_ sy / this.scaling.y_sm_\n\t\tvar _sz _eq_ sz / this.scaling.z_sm_\n\t\tthis.scaling _eq_ new BABYLON.Vector3(sx_co_ sy_co_ sz)_sm_\t\n\t\tthis.position _eq_ new BABYLON.Vector3(pivotPoint.x + _sx * (this.position.x - pivotPoint.x)_co_ pivotPoint.y + _sy * (this.position.y - pivotPoint.y)_co_ pivotPoint.z + _sz * (this.position.z - pivotPoint.z))_sm_\n\t}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tHere is a playground to try it out\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1MKHR9_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1MKHR9_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-11-17T01:31:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks _lt_span_gt__lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/14282-johnk/?do_eq_hovercard_qt_ data-mentionid_eq__qt_14282_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/14282-johnk/_qt_ rel_eq__qt__qt__gt_@JohnK_lt_/a_gt_ !! That worked for me. I had to change that first line though_dd__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_font-weight_dd_bold_sm_color_dd_rgb(249_co_38_co_114)_sm_font-family_dd_monospace_co_ monospace_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_pre_sm_word-spacing_dd_0px_sm__qt__gt_this_lt_/span_gt__lt_span style_eq__qt_color_dd_rgb(248_co_248_co_242)_sm_font-family_dd_monospace_co_ monospace_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_pre_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(35_co_36_co_31)_sm_float_dd_none_sm__qt__gt_._rq _eq_ BABYLON.Quaternion.Identity()_sm__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\twith\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_font-weight_dd_bold_sm_color_dd_rgb(249_co_38_co_114)_sm_font-family_dd_monospace_co_ monospace_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_pre_sm_word-spacing_dd_0px_sm__qt__gt_this_lt_/span_gt__lt_span style_eq__qt_color_dd_rgb(248_co_248_co_242)_sm_font-family_dd_monospace_co_ monospace_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_pre_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(35_co_36_co_31)_sm_float_dd_none_sm__qt__gt_._rq _eq_ this.rotationQuaternion_sm__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\totherwise if the object was already rotated it would mess things up.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank you so much!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2016-11-17T09:26:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20501_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20501-numa/_qt_ rel_eq__qt__qt__gt_@Numa_lt_/a_gt_ thank you for pointing this out. I had assumed that my methods would be applied from the start and all rotations would take place using them. In practice your correction would only work if previous rotations had been done using mesh.rotate. If a rotation was set just using mesh.rotation then this.rotationQuaternion would be undefined.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHopefully between us we now have it working correctly in all cases using the modified code below.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.Mesh.prototype.rotateAroundPivot _eq_ function(pivotPoint_co_ axis_co_ angle) {\n\tif(!this._rotationQuaternion) {\n\t     this._rq _eq_ BABYLON.Quaternion.RotationYawPitchRoll(this.rotation.y_co_ this.rotation.x_co_ this.rotation.z)_sm_\n\t}\t\t\n\tvar _p _eq_ new BABYLON.Quaternion(this.position.x - pivotPoint.x_co_ this.position.y - pivotPoint.y_co_ this.position.z - pivotPoint.z_co_ 0)_sm_\n\taxis.normalize()_sm_\n\tvar _q _eq_ BABYLON.Quaternion.RotationAxis(axis_co_angle)_sm_  //form quaternion rotation\t\t\n\tvar _qinv _eq_ BABYLON.Quaternion.Inverse(_q)_sm_\t\n\tvar _pdash _eq_ _q.multiply(_p).multiply(_qinv)_sm_\n\tthis.position _eq_ new BABYLON.Vector3(pivotPoint.x + _pdash.x_co_ pivotPoint.y + _pdash.y_co_ pivotPoint.z + _pdash.z)_sm_\n\tthis.rotationQuaternion _eq_ this._rq.multiply(_q)_sm_\n\tthis._rq _eq_ this.rotationQuaternion_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tNew PG _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1MKHR9%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1MKHR9#1_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tPlease feel free to test again and once more thank you for the feedback.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jmb462","Date":"2018-09-02T19:57:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi here_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m planning to make a rubik_t_s cube with babylon. I_t_m new to babylon and javascript.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m using your function to rotate the face around the cube axis.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is my playground _lt_span_gt__dd_ http_dd_//www.babylonjs-playground.com/#1MKHR9#62_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe _qt_u_qt_ key rotate the upper face.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe _qt_r_qt_ key rotate the right face.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs long as I rotate only the upper face or only the right face_co_ everything is ok.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut_co_ if you press _qt_u_qt_ once_co_ then _qt_r_qt_ once_co_ some pieces rotate both around the world axis (as i wish) AND around the piece axis.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI really don_t_t understand why because I only use your function RotateAroundPivot once .\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDo someone have an idea why ?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tJMB\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]