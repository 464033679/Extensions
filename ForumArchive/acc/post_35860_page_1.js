[{"Owner":"ozRocker","Date":"2018-02-22T03:16:25Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_ve discovered that this playground doesn_t_t run on iPhone 6+ _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2328_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#28_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI get this error_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_[Error] WebGL_dd_ ERROR_dd_ too many uniforms\ncompileShader\ni (babylon.js_dd_4_dd_31855)\nt (babylon.js_dd_4_dd_31705)\ncreateShaderProgram (babylon.js_dd_6_dd_18019)\n_prepareEffect (babylon.js_dd_1_dd_10164)\n(anonymous function) (babylon.js_dd_1_dd_4037)\npromiseReactionJob\n[Error] BJS - [14_dd_06_dd_47]_dd_ Unable to compile effect_dd_\n_ErrorEnabled (babylon.js_dd_4_dd_8244)\n_prepareEffect (babylon.js_dd_1_dd_10998)\n(anonymous function) (babylon.js_dd_1_dd_4037)\npromiseReactionJob\n[Error] BJS - [14_dd_06_dd_47]_dd_ Uniforms_dd_  world_co_ view_co_ viewProjection_co_ vEyePosition_co_ vLightsType_co_ vAmbientColor_co_ vDiffuseColor_co_ vSpecularColor_co_ vEmissiveColor_co_ vFogInfos_co_ vFogColor_co_ pointSize_co_ vDiffuseInfos_co_ vAmbientInfos_co_ vOpacityInfos_co_ vReflectionInfos_co_ vEmissiveInfos_co_ vSpecularInfos_co_ vBumpInfos_co_ vLightmapInfos_co_ vRefractionInfos_co_ mBones_co_ vClipPlane_co_ diffuseMatrix_co_ ambientMatrix_co_ opacityMatrix_co_ reflectionMatrix_co_ emissiveMatrix_co_ specularMatrix_co_ bumpMatrix_co_ normalMatrix_co_ lightmapMatrix_co_ refractionMatrix_co_ diffuseLeftColor_co_ diffuseRightColor_co_ opacityParts_co_ reflectionLeftColor_co_ reflectionRightColor_co_ emissiveLeftColor_co_ emissiveRightColor_co_ refractionLeftColor_co_ refractionRightColor_co_ vReflectionPosition_co_ vReflectionSize_co_ logarithmicDepthConstant_co_ vTangentSpaceParams_co_ vLightData0_co_ vLightDiffuse0_co_ vLightSpecular0_co_ vLightDirection0_co_ vLightGround0_co_ lightMatrix0_co_ shadowsInfo0_co_ depthValues0_co_ morphTargetInfluences_co_ diffuseSampler_co_ ambientSampler_co_ opacitySampler_co_ reflectionCubeSampler_co_ reflection2DSampler_co_ emissiveSampler_co_ specularSampler_co_ bumpSampler_co_ lightmapSampler_co_ refractionCubeSampler_co_ refraction2DSampler_co_ shadowSampler0\n_ErrorEnabled (babylon.js_dd_4_dd_8244)\n_prepareEffect (babylon.js_dd_1_dd_11041)\n(anonymous function) (babylon.js_dd_1_dd_4037)\npromiseReactionJob\n_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tI think the max number of uniforms on iPhone 6+ is 64.  My mesh has a skeleton but there_t_s only 24 bones.  Are the 3 morph targets pushing it over the edge?  Is there something I can do to reduce uniforms?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-22T16:45:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI know this is a shame. You can turn off GPU skeleton with mesh.computeBonesUsingShaders _eq_ false\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-22T16:46:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI know this is a shame. You can turn off GPU skeleton with mesh.computeBonesUsingShaders _eq_ false\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCan you also give me the list of defines? It should be dumped in the console as well. This will help me pointing you out to some optimizations\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-22T22:13:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_205714_qt_ data-ipsquote-contentid_eq__qt_35860_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1519317969_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t5 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tI know this is a shame. You can turn off GPU skeleton with mesh.computeBonesUsingShaders _eq_ false\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tCan you also give me the list of defines? It should be dumped in the console as well. This will help me pointing you out to some optimizations\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI tried using CPU for bones but that doesn_t_t work.  There is a problem with the morph target _lt_a href_eq__qt_https_dd_//playground.babylonjs.com/#BDG7ME%2330_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//playground.babylonjs.com/#BDG7ME#30_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe list of uniforms is from the error message above_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t[Error] BJS - [14_dd_06_dd_47]_dd_ Uniforms_dd_  world_co_ view_co_ viewProjection_co_ vEyePosition_co_ vLightsType_co_ vAmbientColor_co_ vDiffuseColor_co_ vSpecularColor_co_ vEmissiveColor_co_ vFogInfos_co_ vFogColor_co_ pointSize_co_ vDiffuseInfos_co_ vAmbientInfos_co_ vOpacityInfos_co_ vReflectionInfos_co_ vEmissiveInfos_co_ vSpecularInfos_co_ vBumpInfos_co_ vLightmapInfos_co_ vRefractionInfos_co_ mBones_co_ vClipPlane_co_ diffuseMatrix_co_ ambientMatrix_co_ opacityMatrix_co_ reflectionMatrix_co_ emissiveMatrix_co_ specularMatrix_co_ bumpMatrix_co_ normalMatrix_co_ lightmapMatrix_co_ refractionMatrix_co_ diffuseLeftColor_co_ diffuseRightColor_co_ opacityParts_co_ reflectionLeftColor_co_ reflectionRightColor_co_ emissiveLeftColor_co_ emissiveRightColor_co_ refractionLeftColor_co_ refractionRightColor_co_ vReflectionPosition_co_ vReflectionSize_co_ logarithmicDepthConstant_co_ vTangentSpaceParams_co_ vLightData0_co_ vLightDiffuse0_co_ vLightSpecular0_co_ vLightDirection0_co_ vLightGround0_co_ lightMatrix0_co_ shadowsInfo0_co_ depthValues0_co_ morphTargetInfluences_co_ diffuseSampler_co_ ambientSampler_co_ opacitySampler_co_ reflectionCubeSampler_co_ reflection2DSampler_co_ emissiveSampler_co_ specularSampler_co_ bumpSampler_co_ lightmapSampler_co_ refractionCubeSampler_co_ refraction2DSampler_co_ shadowSampler0_lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there a way to remove some of those?  I_t_m not using bump/normal maps for this\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-22T22:27:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNot the uniform but the defines (they filter the uniforms. The list you get defines all the uniforms unfiltered)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMorph target consumes a lot of uniforms with the _qt__lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#353c41_sm_ font-size_dd_14px_sm_ text-align_dd_start_qt__gt_morphTargetInfluences_qt__lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-02-22T22:46:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tTechnically_co_ I think the minimum # of uniforms that must be supported is 128_co_ which is what iOS uses.  Each bone matrix takes 4_co_ so 24 * 4 - 128 leaves 32 for everything else.  One thing you might do is reduce your max simultaneous lights for the material.  In the Blender exporter_co_ it is in the Mesh section_co_ but it is applied on the materials for the mesh.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-22T22:55:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_205770_qt_ data-ipsquote-contentid_eq__qt_35860_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1519339595_qt_ data-ipsquote-userid_eq__qt_8492_qt_ data-ipsquote-username_eq__qt_JCPalmer_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t10 minutes ago_co_ JCPalmer said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tTechnically_co_ I think the minimum # of uniforms that must be supported is 128_co_ which is what iOS uses.  Each bone matrix takes 4_co_ so 24 * 4 - 128 leaves 32 for everything else.  One thing you might do is reduce your max simultaneous lights for the material.  In the Blender exporter_co_ it is in the Mesh section_co_ but it is applied on the materials for the mesh.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI don_t_t have any lights in the .babylon file.  Its just _qt_lights_qt__dd_[].  Or am I looking in the wrong place?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI only have a point light which is in the playground.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-22T22:59:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIs there a way to print the total number of uniforms being used?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-02-23T16:02:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSince you only have one light in the scene_co_ export all meshes using this armature with max simultaneous lights set to 1.  You can also dump shadows_co_ if you can live without them.  I do not know a mechanical way to get the number of uniforms used.  Probably would not help.  You are over.  You really need to know where to cut.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_17154_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_02/maxLights.jpg.01e366b4f1617086cfd4829dd6da8aa9.jpg_qt_ alt_eq__qt_maxLights.jpg.01e366b4f1617086cfd4829dd6da8aa9.jpg_qt_ /_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-23T17:19:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tCan you dump here the entire error message? It will contain the defines that I can use to determine which uniforms are used _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_1_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-24T00:49:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_205830_qt_ data-ipsquote-contentid_eq__qt_35860_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1519406340_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t7 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tCan you dump here the entire error message? It will contain the defines that I can use to determine which uniforms are used _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_pre_gt_\n_lt_code_gt_[Error] WebGL_dd_ ERROR_dd_ too many uniforms\n\tcompileShader\n\ti (babylon.js_dd_4_dd_31855)\n\tt (babylon.js_dd_4_dd_31705)\n\tcreateShaderProgram (babylon.js_dd_6_dd_18019)\n\t_prepareEffect (babylon.js_dd_1_dd_10164)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Unable to compile effect_dd_\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_10998)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Uniforms_dd_  world_co_ view_co_ viewProjection_co_ vEyePosition_co_ vLightsType_co_ vAmbientColor_co_ vDiffuseColor_co_ vSpecularColor_co_ vEmissiveColor_co_ vFogInfos_co_ vFogColor_co_ pointSize_co_ vDiffuseInfos_co_ vAmbientInfos_co_ vOpacityInfos_co_ vReflectionInfos_co_ vEmissiveInfos_co_ vSpecularInfos_co_ vBumpInfos_co_ vLightmapInfos_co_ vRefractionInfos_co_ mBones_co_ vClipPlane_co_ diffuseMatrix_co_ ambientMatrix_co_ opacityMatrix_co_ reflectionMatrix_co_ emissiveMatrix_co_ specularMatrix_co_ bumpMatrix_co_ normalMatrix_co_ lightmapMatrix_co_ refractionMatrix_co_ diffuseLeftColor_co_ diffuseRightColor_co_ opacityParts_co_ reflectionLeftColor_co_ reflectionRightColor_co_ emissiveLeftColor_co_ emissiveRightColor_co_ refractionLeftColor_co_ refractionRightColor_co_ vReflectionPosition_co_ vReflectionSize_co_ logarithmicDepthConstant_co_ vTangentSpaceParams_co_ vLightData0_co_ vLightDiffuse0_co_ vLightSpecular0_co_ vLightDirection0_co_ vLightGround0_co_ lightMatrix0_co_ shadowsInfo0_co_ depthValues0_co_ morphTargetInfluences_co_ diffuseSampler_co_ ambientSampler_co_ opacitySampler_co_ reflectionCubeSampler_co_ reflection2DSampler_co_ emissiveSampler_co_ specularSampler_co_ bumpSampler_co_ lightmapSampler_co_ refractionCubeSampler_co_ refraction2DSampler_co_ shadowSampler0\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11041)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Attributes_dd_  position_co_ normal_co_ matricesIndices_co_ matricesWeights_co_ position0\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11121)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Vertex shader_dd_ default\n1\t#define DIFFUSEDIRECTUV 0\n2\t#define AMBIENTDIRECTUV 0\n3\t#define OPACITYDIRECTUV 0\n4\t#define EMISSIVEDIRECTUV 0\n5\t#define SPECULARDIRECTUV 0\n6\t#define BUMPDIRECTUV 0\n7\t#define SPECULARTERM\n8\t#define NORMAL\n9\t#define NUM_BONE_INFLUENCERS 4\n10\t#define BonesPerMesh 33\n11\t#define LIGHTMAPDIRECTUV 0\n12\t#define MORPHTARGETS\n13\t#define NUM_MORPH_INFLUENCERS 1\n14\t#define VIGNETTEBLENDMODEMULTIPLY\n15\t#define SAMPLER3DGREENDEPTH\n16\t#define SAMPLER3DBGRMAP\n17\t#define LIGHT0\n18\t#define POINTLIGHT0\n19\t\n20\t#define SHADER_NAME vertex_dd_default\n21\tprecision highp float_sm_\n22\t\n23\tuniform mat4 viewProjection_sm_\n24\tuniform mat4 view_sm_\n25\t#ifdef DIFFUSE\n26\tuniform mat4 diffuseMatrix_sm_\n27\tuniform vec2 vDiffuseInfos_sm_\n28\t#endif\n29\t#ifdef AMBIENT\n30\tuniform mat4 ambientMatrix_sm_\n31\tuniform vec2 vAmbientInfos_sm_\n32\t#endif\n33\t#ifdef OPACITY\n34\tuniform mat4 opacityMatrix_sm_\n35\tuniform vec2 vOpacityInfos_sm_\n36\t#endif\n37\t#ifdef EMISSIVE\n38\tuniform vec2 vEmissiveInfos_sm_\n39\tuniform mat4 emissiveMatrix_sm_\n40\t#endif\n41\t#ifdef LIGHTMAP\n42\tuniform vec2 vLightmapInfos_sm_\n43\tuniform mat4 lightmapMatrix_sm_\n44\t#endif\n45\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n46\tuniform vec2 vSpecularInfos_sm_\n47\tuniform mat4 specularMatrix_sm_\n48\t#endif\n49\t#ifdef BUMP\n50\tuniform vec3 vBumpInfos_sm_\n51\tuniform mat4 bumpMatrix_sm_\n52\t#endif\n53\t#ifdef POINTSIZE\n54\tuniform float pointSize_sm_\n55\t#endif\n56\t\n57\t\n58\t#define CUSTOM_VERTEX_BEGIN\n59\tattribute vec3 position_sm_\n60\t#ifdef NORMAL\n61\tattribute vec3 normal_sm_\n62\t#endif\n63\t#ifdef TANGENT\n64\tattribute vec4 tangent_sm_\n65\t#endif\n66\t#ifdef UV1\n67\tattribute vec2 uv_sm_\n68\t#endif\n69\t#ifdef UV2\n70\tattribute vec2 uv2_sm_\n71\t#endif\n72\t#ifdef VERTEXCOLOR\n73\tattribute vec4 color_sm_\n74\t#endif\n75\tconst float PI_eq_3.1415926535897932384626433832795_sm_\n76\tconst float LinearEncodePowerApprox_eq_2.2_sm_\n77\tconst float GammaEncodePowerApprox_eq_1.0/LinearEncodePowerApprox_sm_\n78\tconst vec3 LuminanceEncodeApprox_eq_vec3(0.2126_co_0.7152_co_0.0722)_sm_\n79\tmat3 transposeMat3(mat3 inMatrix) {\n80\tvec3 i0_eq_inMatrix[0]_sm_\n81\tvec3 i1_eq_inMatrix[1]_sm_\n82\tvec3 i2_eq_inMatrix[2]_sm_\n83\tmat3 outMatrix_eq_mat3(\n84\tvec3(i0.x_co_i1.x_co_i2.x)_co_\n85\tvec3(i0.y_co_i1.y_co_i2.y)_co_\n86\tvec3(i0.z_co_i1.z_co_i2.z)\n87\t)_sm_\n88\treturn outMatrix_sm_\n89\t}\n90\t\n91\tmat3 inverseMat3(mat3 inMatrix) {\n92\tfloat a00_eq_inMatrix[0][0]_co_a01_eq_inMatrix[0][1]_co_a02_eq_inMatrix[0][2]_sm_\n93\tfloat a10_eq_inMatrix[1][0]_co_a11_eq_inMatrix[1][1]_co_a12_eq_inMatrix[1][2]_sm_\n94\tfloat a20_eq_inMatrix[2][0]_co_a21_eq_inMatrix[2][1]_co_a22_eq_inMatrix[2][2]_sm_\n95\tfloat b01_eq_a22*a11-a12*a21_sm_\n96\tfloat b11_eq_-a22*a10+a12*a20_sm_\n97\tfloat b21_eq_a21*a10-a11*a20_sm_\n98\tfloat det_eq_a00*b01+a01*b11+a02*b21_sm_\n99\treturn mat3(b01_co_(-a22*a01+a02*a21)_co_(a12*a01-a02*a11)_co_\n100\tb11_co_(a22*a00-a02*a20)_co_(-a12*a00+a02*a10)_co_\n101\tb21_co_(-a21*a00+a01*a20)_co_(a11*a00-a01*a10))/det_sm_\n102\t}\n103\tfloat computeFallOff(float value_co_vec2 clipSpace_co_float frustumEdgeFalloff)\n104\t{\n105\tfloat mask_eq_smoothstep(1.0-frustumEdgeFalloff_co_1.0_co_clamp(dot(clipSpace_co_clipSpace)_co_0._co_1.))_sm_\n106\treturn mix(value_co_1.0_co_mask)_sm_\n107\t}\n108\tvec3 applyEaseInOut(vec3 x){\n109\treturn x*x*(3.0-2.0*x)_sm_\n110\t}\n111\tvec3 toLinearSpace(vec3 color)\n112\t{\n113\treturn pow(color_co_vec3(LinearEncodePowerApprox))_sm_\n114\t}\n115\tvec3 toGammaSpace(vec3 color)\n116\t{\n117\treturn pow(color_co_vec3(GammaEncodePowerApprox))_sm_\n118\t}\n119\tfloat square(float value)\n120\t{\n121\treturn value*value_sm_\n122\t}\n123\tfloat getLuminance(vec3 color)\n124\t{\n125\treturn clamp(dot(color_co_LuminanceEncodeApprox)_co_0._co_1.)_sm_\n126\t}\n127\t\n128\tfloat getRand(vec2 seed) {\n129\treturn fract(sin(dot(seed.xy _co_vec2(12.9898_co_78.233)))*43758.5453)_sm_\n130\t}\n131\tvec3 dither(vec2 seed_co_vec3 color) {\n132\tfloat rand_eq_getRand(seed)_sm_\n133\tcolor+_eq_mix(-0.5/255.0_co_0.5/255.0_co_rand)_sm_\n134\tcolor_eq_max(color_co_0.0)_sm_\n135\treturn color_sm_\n136\t}\n137\t#if NUM_BONE_INFLUENCERS&gt_sm_0\n138\tuniform mat4 mBones[BonesPerMesh]_sm_\n139\tattribute vec4 matricesIndices_sm_\n140\tattribute vec4 matricesWeights_sm_\n141\t#if NUM_BONE_INFLUENCERS&gt_sm_4\n142\tattribute vec4 matricesIndicesExtra_sm_\n143\tattribute vec4 matricesWeightsExtra_sm_\n144\t#endif\n145\t#endif\n146\t\n147\t#ifdef INSTANCES\n148\tattribute vec4 world0_sm_\n149\tattribute vec4 world1_sm_\n150\tattribute vec4 world2_sm_\n151\tattribute vec4 world3_sm_\n152\t#else\n153\tuniform mat4 world_sm_\n154\t#endif\n155\t#ifdef MAINUV1\n156\tvarying vec2 vMainUV1_sm_\n157\t#endif\n158\t#ifdef MAINUV2\n159\tvarying vec2 vMainUV2_sm_\n160\t#endif\n161\t#if defined(DIFFUSE) &amp_sm_&amp_sm_ DIFFUSEDIRECTUV _eq__eq_ 0\n162\tvarying vec2 vDiffuseUV_sm_\n163\t#endif\n164\t#if defined(AMBIENT) &amp_sm_&amp_sm_ AMBIENTDIRECTUV _eq__eq_ 0\n165\tvarying vec2 vAmbientUV_sm_\n166\t#endif\n167\t#if defined(OPACITY) &amp_sm_&amp_sm_ OPACITYDIRECTUV _eq__eq_ 0\n168\tvarying vec2 vOpacityUV_sm_\n169\t#endif\n170\t#if defined(EMISSIVE) &amp_sm_&amp_sm_ EMISSIVEDIRECTUV _eq__eq_ 0\n171\tvarying vec2 vEmissiveUV_sm_\n172\t#endif\n173\t#if defined(LIGHTMAP) &amp_sm_&amp_sm_ LIGHTMAPDIRECTUV _eq__eq_ 0\n174\tvarying vec2 vLightmapUV_sm_\n175\t#endif\n176\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM) &amp_sm_&amp_sm_ SPECULARDIRECTUV _eq__eq_ 0\n177\tvarying vec2 vSpecularUV_sm_\n178\t#endif\n179\t#if defined(BUMP) &amp_sm_&amp_sm_ BUMPDIRECTUV _eq__eq_ 0\n180\tvarying vec2 vBumpUV_sm_\n181\t#endif\n182\t\n183\tvarying vec3 vPositionW_sm_\n184\t#ifdef NORMAL\n185\tvarying vec3 vNormalW_sm_\n186\t#endif\n187\t#ifdef VERTEXCOLOR\n188\tvarying vec4 vColor_sm_\n189\t#endif\n190\t#if defined(BUMP) || defined(PARALLAX)\n191\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL) \n192\tvarying mat3 vTBN_sm_\n193\t#endif\n194\t#endif\n195\t\n196\t#ifdef CLIPPLANE\n197\tuniform vec4 vClipPlane_sm_\n198\tvarying float fClipDistance_sm_\n199\t#endif\n200\t#ifdef FOG\n201\tvarying vec3 vFogDistance_sm_\n202\t#endif\n203\t#ifdef LIGHT0\n204\tuniform vec4 vLightData0_sm_\n205\tuniform vec4 vLightDiffuse0_sm_\n206\t#ifdef SPECULARTERM\n207\tuniform vec3 vLightSpecular0_sm_\n208\t#else\n209\tvec3 vLightSpecular0_eq_vec3(0.)_sm_\n210\t#endif\n211\t#ifdef SHADOW0\n212\t#if defined(SHADOWCUBE0)\n213\tuniform samplerCube shadowSampler0_sm_\n214\t#else\n215\tvarying vec4 vPositionFromLight0_sm_\n216\tvarying float vDepthMetric0_sm_\n217\tuniform sampler2D shadowSampler0_sm_\n218\tuniform mat4 lightMatrix0_sm_\n219\t#endif\n220\tuniform vec4 shadowsInfo0_sm_\n221\tuniform vec2 depthValues0_sm_\n222\t#endif\n223\t#ifdef SPOTLIGHT0\n224\tuniform vec4 vLightDirection0_sm_\n225\t#endif\n226\t#ifdef HEMILIGHT0\n227\tuniform vec3 vLightGround0_sm_\n228\t#endif\n229\t#ifdef PROJECTEDLIGHTTEXTURE0\n230\tuniform mat4 textureProjectionMatrix0_sm_\n231\tuniform sampler2D projectionLightSampler0_sm_\n232\t#endif\n233\t#endif\n234\t#ifdef LIGHT1\n235\tuniform vec4 vLightData1_sm_\n236\tuniform vec4 vLightDiffuse1_sm_\n237\t#ifdef SPECULARTERM\n238\tuniform vec3 vLightSpecular1_sm_\n239\t#else\n240\tvec3 vLightSpecular1_eq_vec3(0.)_sm_\n241\t#endif\n242\t#ifdef SHADOW1\n243\t#if defined(SHADOWCUBE1)\n244\tuniform samplerCube shadowSampler1_sm_\n245\t#else\n246\tvarying vec4 vPositionFromLight1_sm_\n247\tvarying float vDepthMetric1_sm_\n248\tuniform sampler2D shadowSampler1_sm_\n249\tuniform mat4 lightMatrix1_sm_\n250\t#endif\n251\tuniform vec4 shadowsInfo1_sm_\n252\tuniform vec2 depthValues1_sm_\n253\t#endif\n254\t#ifdef SPOTLIGHT1\n255\tuniform vec4 vLightDirection1_sm_\n256\t#endif\n257\t#ifdef HEMILIGHT1\n258\tuniform vec3 vLightGround1_sm_\n259\t#endif\n260\t#ifdef PROJECTEDLIGHTTEXTURE1\n261\tuniform mat4 textureProjectionMatrix1_sm_\n262\tuniform sampler2D projectionLightSampler1_sm_\n263\t#endif\n264\t#endif\n265\t#ifdef LIGHT2\n266\tuniform vec4 vLightData2_sm_\n267\tuniform vec4 vLightDiffuse2_sm_\n268\t#ifdef SPECULARTERM\n269\tuniform vec3 vLightSpecular2_sm_\n270\t#else\n271\tvec3 vLightSpecular2_eq_vec3(0.)_sm_\n272\t#endif\n273\t#ifdef SHADOW2\n274\t#if defined(SHADOWCUBE2)\n275\tuniform samplerCube shadowSampler2_sm_\n276\t#else\n277\tvarying vec4 vPositionFromLight2_sm_\n278\tvarying float vDepthMetric2_sm_\n279\tuniform sampler2D shadowSampler2_sm_\n280\tuniform mat4 lightMatrix2_sm_\n281\t#endif\n282\tuniform vec4 shadowsInfo2_sm_\n283\tuniform vec2 depthValues2_sm_\n284\t#endif\n285\t#ifdef SPOTLIGHT2\n286\tuniform vec4 vLightDirection2_sm_\n287\t#endif\n288\t#ifdef HEMILIGHT2\n289\tuniform vec3 vLightGround2_sm_\n290\t#endif\n291\t#ifdef PROJECTEDLIGHTTEXTURE2\n292\tuniform mat4 textureProjectionMatrix2_sm_\n293\tuniform sampler2D projectionLightSampler2_sm_\n294\t#endif\n295\t#endif\n296\t#ifdef LIGHT3\n297\tuniform vec4 vLightData3_sm_\n298\tuniform vec4 vLightDiffuse3_sm_\n299\t#ifdef SPECULARTERM\n300\tuniform vec3 vLightSpecular3_sm_\n301\t#else\n302\tvec3 vLightSpecular3_eq_vec3(0.)_sm_\n303\t#endif\n304\t#ifdef SHADOW3\n305\t#if defined(SHADOWCUBE3)\n306\tuniform samplerCube shadowSampler3_sm_\n307\t#else\n308\tvarying vec4 vPositionFromLight3_sm_\n309\tvarying float vDepthMetric3_sm_\n310\tuniform sampler2D shadowSampler3_sm_\n311\tuniform mat4 lightMatrix3_sm_\n312\t#endif\n313\tuniform vec4 shadowsInfo3_sm_\n314\tuniform vec2 depthValues3_sm_\n315\t#endif\n316\t#ifdef SPOTLIGHT3\n317\tuniform vec4 vLightDirection3_sm_\n318\t#endif\n319\t#ifdef HEMILIGHT3\n320\tuniform vec3 vLightGround3_sm_\n321\t#endif\n322\t#ifdef PROJECTEDLIGHTTEXTURE3\n323\tuniform mat4 textureProjectionMatrix3_sm_\n324\tuniform sampler2D projectionLightSampler3_sm_\n325\t#endif\n326\t#endif\n327\t\n328\t#ifdef MORPHTARGETS\n329\tuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS]_sm_\n330\t#endif\n331\t#ifdef MORPHTARGETS\n332\tattribute vec3 position0_sm_\n333\t#ifdef MORPHTARGETS_NORMAL\n334\tattribute vec3 normal0_sm_\n335\t#endif\n336\t#ifdef MORPHTARGETS_TANGENT\n337\tattribute vec3 tangent0_sm_\n338\t#endif\n339\t#endif\n340\t\n341\t#ifdef REFLECTIONMAP_SKYBOX\n342\tvarying vec3 vPositionUVW_sm_\n343\t#endif\n344\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n345\tvarying vec3 vDirectionW_sm_\n346\t#endif\n347\t#ifdef LOGARITHMICDEPTH\n348\tuniform float logarithmicDepthConstant_sm_\n349\tvarying float vFragmentDepth_sm_\n350\t#endif\n351\t#define CUSTOM_VERTEX_DEFINITIONS\n352\tvoid main(void) {\n353\t#define CUSTOM_VERTEX_MAIN_BEGIN\n354\tvec3 positionUpdated_eq_position_sm_\n355\t#ifdef NORMAL \n356\tvec3 normalUpdated_eq_normal_sm_\n357\t#endif\n358\t#ifdef TANGENT\n359\tvec4 tangentUpdated_eq_tangent_sm_\n360\t#endif\n361\t#ifdef MORPHTARGETS\n362\tpositionUpdated+_eq_(position0-position)*morphTargetInfluences[0]_sm_\n363\t#ifdef MORPHTARGETS_NORMAL\n364\tnormalUpdated+_eq_(normal0-normal)*morphTargetInfluences[0]_sm_\n365\t#endif\n366\t#ifdef MORPHTARGETS_TANGENT\n367\ttangentUpdated.xyz+_eq_(tangent0-tangent.xyz)*morphTargetInfluences[0]_sm_\n368\t#endif\n369\t#endif\n370\t\n371\t#ifdef REFLECTIONMAP_SKYBOX\n372\tvPositionUVW_eq_positionUpdated_sm_\n373\t#endif \n374\t#define CUSTOM_VERTEX_UPDATE_POSITION\n375\t#define CUSTOM_VERTEX_UPDATE_NORMAL\n376\t#ifdef INSTANCES\n377\tmat4 finalWorld_eq_mat4(world0_co_world1_co_world2_co_world3)_sm_\n378\t#else\n379\tmat4 finalWorld_eq_world_sm_\n380\t#endif\n381\t#if NUM_BONE_INFLUENCERS&gt_sm_0\n382\tmat4 influence_sm_\n383\tinfluence_eq_mBones[int(matricesIndices[0])]*matricesWeights[0]_sm_\n384\t#if NUM_BONE_INFLUENCERS&gt_sm_1\n385\tinfluence+_eq_mBones[int(matricesIndices[1])]*matricesWeights[1]_sm_\n386\t#endif \n387\t#if NUM_BONE_INFLUENCERS&gt_sm_2\n388\tinfluence+_eq_mBones[int(matricesIndices[2])]*matricesWeights[2]_sm_\n389\t#endif \n390\t#if NUM_BONE_INFLUENCERS&gt_sm_3\n391\tinfluence+_eq_mBones[int(matricesIndices[3])]*matricesWeights[3]_sm_\n392\t#endif \n393\t#if NUM_BONE_INFLUENCERS&gt_sm_4\n394\tinfluence+_eq_mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0]_sm_\n395\t#endif \n396\t#if NUM_BONE_INFLUENCERS&gt_sm_5\n397\tinfluence+_eq_mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1]_sm_\n398\t#endif \n399\t#if NUM_BONE_INFLUENCERS&gt_sm_6\n400\tinfluence+_eq_mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2]_sm_\n401\t#endif \n402\t#if NUM_BONE_INFLUENCERS&gt_sm_7\n403\tinfluence+_eq_mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3]_sm_\n404\t#endif \n405\tfinalWorld_eq_finalWorld*influence_sm_\n406\t#endif\n407\tgl_Position_eq_viewProjection*finalWorld*vec4(positionUpdated_co_1.0)_sm_\n408\tvec4 worldPos_eq_finalWorld*vec4(positionUpdated_co_1.0)_sm_\n409\tvPositionW_eq_vec3(worldPos)_sm_\n410\t#ifdef NORMAL\n411\tmat3 normalWorld_eq_mat3(finalWorld)_sm_\n412\t#ifdef NONUNIFORMSCALING\n413\tnormalWorld_eq_transposeMat3(inverseMat3(normalWorld))_sm_\n414\t#endif\n415\tvNormalW_eq_normalize(normalWorld*normalUpdated)_sm_\n416\t#endif\n417\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n418\tvDirectionW_eq_normalize(vec3(finalWorld*vec4(positionUpdated_co_0.0)))_sm_\n419\t#endif\n420\t\n421\t#ifndef UV1\n422\tvec2 uv_eq_vec2(0._co_0.)_sm_\n423\t#endif\n424\t#ifndef UV2\n425\tvec2 uv2_eq_vec2(0._co_0.)_sm_\n426\t#endif\n427\t#ifdef MAINUV1\n428\tvMainUV1_eq_uv_sm_\n429\t#endif\n430\t#ifdef MAINUV2\n431\tvMainUV2_eq_uv2_sm_\n432\t#endif\n433\t#if defined(DIFFUSE) &amp_sm_&amp_sm_ DIFFUSEDIRECTUV _eq__eq_ 0\n434\tif (vDiffuseInfos.x _eq__eq_ 0.)\n435\t{\n436\tvDiffuseUV_eq_vec2(diffuseMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n437\t}\n438\telse\n439\t{\n440\tvDiffuseUV_eq_vec2(diffuseMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n441\t}\n442\t#endif\n443\t#if defined(AMBIENT) &amp_sm_&amp_sm_ AMBIENTDIRECTUV _eq__eq_ 0\n444\tif (vAmbientInfos.x _eq__eq_ 0.)\n445\t{\n446\tvAmbientUV_eq_vec2(ambientMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n447\t}\n448\telse\n449\t{\n450\tvAmbientUV_eq_vec2(ambientMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n451\t}\n452\t#endif\n453\t#if defined(OPACITY) &amp_sm_&amp_sm_ OPACITYDIRECTUV _eq__eq_ 0\n454\tif (vOpacityInfos.x _eq__eq_ 0.)\n455\t{\n456\tvOpacityUV_eq_vec2(opacityMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n457\t}\n458\telse\n459\t{\n460\tvOpacityUV_eq_vec2(opacityMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n461\t}\n462\t#endif\n463\t#if defined(EMISSIVE) &amp_sm_&amp_sm_ EMISSIVEDIRECTUV _eq__eq_ 0\n464\tif (vEmissiveInfos.x _eq__eq_ 0.)\n465\t{\n466\tvEmissiveUV_eq_vec2(emissiveMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n467\t}\n468\telse\n469\t{\n470\tvEmissiveUV_eq_vec2(emissiveMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n471\t}\n472\t#endif\n473\t#if defined(LIGHTMAP) &amp_sm_&amp_sm_ LIGHTMAPDIRECTUV _eq__eq_ 0\n474\tif (vLightmapInfos.x _eq__eq_ 0.)\n475\t{\n476\tvLightmapUV_eq_vec2(lightmapMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n477\t}\n478\telse\n479\t{\n480\tvLightmapUV_eq_vec2(lightmapMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n481\t}\n482\t#endif\n483\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM) &amp_sm_&amp_sm_ SPECULARDIRECTUV _eq__eq_ 0\n484\tif (vSpecularInfos.x _eq__eq_ 0.)\n485\t{\n486\tvSpecularUV_eq_vec2(specularMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n487\t}\n488\telse\n489\t{\n490\tvSpecularUV_eq_vec2(specularMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n491\t}\n492\t#endif\n493\t#if defined(BUMP) &amp_sm_&amp_sm_ BUMPDIRECTUV _eq__eq_ 0\n494\tif (vBumpInfos.x _eq__eq_ 0.)\n495\t{\n496\tvBumpUV_eq_vec2(bumpMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n497\t}\n498\telse\n499\t{\n500\tvBumpUV_eq_vec2(bumpMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n501\t}\n502\t#endif\n503\t#if defined(BUMP) || defined(PARALLAX)\n504\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL)\n505\tvec3 tbnNormal_eq_normalize(normalUpdated)_sm_\n506\tvec3 tbnTangent_eq_normalize(tangentUpdated.xyz)_sm_\n507\tvec3 tbnBitangent_eq_cross(tbnNormal_co_tbnTangent)*tangentUpdated.w_sm_\n508\tvTBN_eq_mat3(finalWorld)*mat3(tbnTangent_co_tbnBitangent_co_tbnNormal)_sm_\n509\t#endif\n510\t#endif\n511\t#ifdef CLIPPLANE\n512\tfClipDistance_eq_dot(worldPos_co_vClipPlane)_sm_\n513\t#endif\n514\t#ifdef FOG\n515\tvFogDistance_eq_(view*worldPos).xyz_sm_\n516\t#endif\n517\t#ifdef SHADOWS\n518\t#if defined(SHADOW0) &amp_sm_&amp_sm_ !defined(SHADOWCUBE0)\n519\tvPositionFromLight0_eq_lightMatrix0*worldPos_sm_\n520\tvDepthMetric0_eq_((vPositionFromLight0.z+depthValues0.x)/(depthValues0.y))_sm_\n521\t#endif\n522\t#endif\n523\t#ifdef SHADOWS\n524\t#if defined(SHADOW1) &amp_sm_&amp_sm_ !defined(SHADOWCUBE1)\n525\tvPositionFromLight1_eq_lightMatrix1*worldPos_sm_\n526\tvDepthMetric1_eq_((vPositionFromLight1.z+depthValues1.x)/(depthValues1.y))_sm_\n527\t#endif\n528\t#endif\n529\t#ifdef SHADOWS\n530\t#if defined(SHADOW2) &amp_sm_&amp_sm_ !defined(SHADOWCUBE2)\n531\tvPositionFromLight2_eq_lightMatrix2*worldPos_sm_\n532\tvDepthMetric2_eq_((vPositionFromLight2.z+depthValues2.x)/(depthValues2.y))_sm_\n533\t#endif\n534\t#endif\n535\t#ifdef SHADOWS\n536\t#if defined(SHADOW3) &amp_sm_&amp_sm_ !defined(SHADOWCUBE3)\n537\tvPositionFromLight3_eq_lightMatrix3*worldPos_sm_\n538\tvDepthMetric3_eq_((vPositionFromLight3.z+depthValues3.x)/(depthValues3.y))_sm_\n539\t#endif\n540\t#endif\n541\t\n542\t#ifdef VERTEXCOLOR\n543\t\n544\tvColor_eq_color_sm_\n545\t#endif\n546\t#ifdef POINTSIZE\n547\tgl_PointSize_eq_pointSize_sm_\n548\t#endif\n549\t#ifdef LOGARITHMICDEPTH\n550\tvFragmentDepth_eq_1.0+gl_Position.w_sm_\n551\tgl_Position.z_eq_log2(max(0.000001_co_vFragmentDepth))*logarithmicDepthConstant_sm_\n552\t#endif\n553\t#define CUSTOM_VERTEX_MAIN_END\n554\t}\n555\t\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_dumpShadersSource (babylon.js_dd_1_dd_6720)\n\t_prepareEffect (babylon.js_dd_1_dd_11195)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Fragment shader_dd_ default\n1\t#define DIFFUSEDIRECTUV 0\n2\t#define AMBIENTDIRECTUV 0\n3\t#define OPACITYDIRECTUV 0\n4\t#define EMISSIVEDIRECTUV 0\n5\t#define SPECULARDIRECTUV 0\n6\t#define BUMPDIRECTUV 0\n7\t#define SPECULARTERM\n8\t#define NORMAL\n9\t#define NUM_BONE_INFLUENCERS 4\n10\t#define BonesPerMesh 33\n11\t#define LIGHTMAPDIRECTUV 0\n12\t#define MORPHTARGETS\n13\t#define NUM_MORPH_INFLUENCERS 1\n14\t#define VIGNETTEBLENDMODEMULTIPLY\n15\t#define SAMPLER3DGREENDEPTH\n16\t#define SAMPLER3DBGRMAP\n17\t#define LIGHT0\n18\t#define POINTLIGHT0\n19\t\n20\t#define SHADER_NAME fragment_dd_default\n21\tprecision highp float_sm_\n22\tuniform vec4 vDiffuseColor_sm_\n23\t#ifdef SPECULARTERM\n24\tuniform vec4 vSpecularColor_sm_\n25\t#endif\n26\tuniform vec3 vEmissiveColor_sm_\n27\t\n28\t#ifdef DIFFUSE\n29\tuniform vec2 vDiffuseInfos_sm_\n30\t#endif\n31\t#ifdef AMBIENT\n32\tuniform vec2 vAmbientInfos_sm_\n33\t#endif\n34\t#ifdef OPACITY \n35\tuniform vec2 vOpacityInfos_sm_\n36\t#endif\n37\t#ifdef EMISSIVE\n38\tuniform vec2 vEmissiveInfos_sm_\n39\t#endif\n40\t#ifdef LIGHTMAP\n41\tuniform vec2 vLightmapInfos_sm_\n42\t#endif\n43\t#ifdef BUMP\n44\tuniform vec3 vBumpInfos_sm_\n45\tuniform vec2 vTangentSpaceParams_sm_\n46\t#endif\n47\t#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\n48\tuniform mat4 view_sm_\n49\t#endif\n50\t#ifdef REFRACTION\n51\tuniform vec4 vRefractionInfos_sm_\n52\t#ifndef REFRACTIONMAP_3D\n53\tuniform mat4 refractionMatrix_sm_\n54\t#endif\n55\t#ifdef REFRACTIONFRESNEL\n56\tuniform vec4 refractionLeftColor_sm_\n57\tuniform vec4 refractionRightColor_sm_\n58\t#endif\n59\t#endif\n60\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n61\tuniform vec2 vSpecularInfos_sm_\n62\t#endif\n63\t#ifdef DIFFUSEFRESNEL\n64\tuniform vec4 diffuseLeftColor_sm_\n65\tuniform vec4 diffuseRightColor_sm_\n66\t#endif\n67\t#ifdef OPACITYFRESNEL\n68\tuniform vec4 opacityParts_sm_\n69\t#endif\n70\t#ifdef EMISSIVEFRESNEL\n71\tuniform vec4 emissiveLeftColor_sm_\n72\tuniform vec4 emissiveRightColor_sm_\n73\t#endif\n74\t\n75\t#ifdef REFLECTION\n76\tuniform vec2 vReflectionInfos_sm_\n77\t#ifdef REFLECTIONMAP_SKYBOX\n78\t#else\n79\t#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\n80\tuniform mat4 reflectionMatrix_sm_\n81\t#endif\n82\t#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) &amp_sm_&amp_sm_ defined(REFLECTIONMAP_CUBIC)\n83\tuniform vec3 vReflectionPosition_sm_\n84\tuniform vec3 vReflectionSize_sm_ \n85\t#endif\n86\t#endif\n87\t#ifdef REFLECTIONFRESNEL\n88\tuniform vec4 reflectionLeftColor_sm_\n89\tuniform vec4 reflectionRightColor_sm_\n90\t#endif\n91\t#endif\n92\t#if defined(BUMP) || !defined(NORMAL)\n93\t#extension GL_OES_standard_derivatives _dd_ enable\n94\t#endif\n95\t#define CUSTOM_FRAGMENT_BEGIN\n96\t#ifdef LOGARITHMICDEPTH\n97\t#extension GL_EXT_frag_depth _dd_ enable\n98\t#endif\n99\t\n100\t#define RECIPROCAL_PI2 0.15915494\n101\tuniform vec3 vEyePosition_sm_\n102\tuniform vec3 vAmbientColor_sm_\n103\t\n104\tvarying vec3 vPositionW_sm_\n105\t#ifdef NORMAL\n106\tvarying vec3 vNormalW_sm_\n107\t#endif\n108\t#ifdef VERTEXCOLOR\n109\tvarying vec4 vColor_sm_\n110\t#endif\n111\t#ifdef MAINUV1\n112\tvarying vec2 vMainUV1_sm_\n113\t#endif\n114\t#ifdef MAINUV2\n115\tvarying vec2 vMainUV2_sm_\n116\t#endif\n117\t\n118\tconst float PI_eq_3.1415926535897932384626433832795_sm_\n119\tconst float LinearEncodePowerApprox_eq_2.2_sm_\n120\tconst float GammaEncodePowerApprox_eq_1.0/LinearEncodePowerApprox_sm_\n121\tconst vec3 LuminanceEncodeApprox_eq_vec3(0.2126_co_0.7152_co_0.0722)_sm_\n122\tmat3 transposeMat3(mat3 inMatrix) {\n123\tvec3 i0_eq_inMatrix[0]_sm_\n124\tvec3 i1_eq_inMatrix[1]_sm_\n125\tvec3 i2_eq_inMatrix[2]_sm_\n126\tmat3 outMatrix_eq_mat3(\n127\tvec3(i0.x_co_i1.x_co_i2.x)_co_\n128\tvec3(i0.y_co_i1.y_co_i2.y)_co_\n129\tvec3(i0.z_co_i1.z_co_i2.z)\n130\t)_sm_\n131\treturn outMatrix_sm_\n132\t}\n133\t\n134\tmat3 inverseMat3(mat3 inMatrix) {\n135\tfloat a00_eq_inMatrix[0][0]_co_a01_eq_inMatrix[0][1]_co_a02_eq_inMatrix[0][2]_sm_\n136\tfloat a10_eq_inMatrix[1][0]_co_a11_eq_inMatrix[1][1]_co_a12_eq_inMatrix[1][2]_sm_\n137\tfloat a20_eq_inMatrix[2][0]_co_a21_eq_inMatrix[2][1]_co_a22_eq_inMatrix[2][2]_sm_\n138\tfloat b01_eq_a22*a11-a12*a21_sm_\n139\tfloat b11_eq_-a22*a10+a12*a20_sm_\n140\tfloat b21_eq_a21*a10-a11*a20_sm_\n141\tfloat det_eq_a00*b01+a01*b11+a02*b21_sm_\n142\treturn mat3(b01_co_(-a22*a01+a02*a21)_co_(a12*a01-a02*a11)_co_\n143\tb11_co_(a22*a00-a02*a20)_co_(-a12*a00+a02*a10)_co_\n144\tb21_co_(-a21*a00+a01*a20)_co_(a11*a00-a01*a10))/det_sm_\n145\t}\n146\tfloat computeFallOff(float value_co_vec2 clipSpace_co_float frustumEdgeFalloff)\n147\t{\n148\tfloat mask_eq_smoothstep(1.0-frustumEdgeFalloff_co_1.0_co_clamp(dot(clipSpace_co_clipSpace)_co_0._co_1.))_sm_\n149\treturn mix(value_co_1.0_co_mask)_sm_\n150\t}\n151\tvec3 applyEaseInOut(vec3 x){\n152\treturn x*x*(3.0-2.0*x)_sm_\n153\t}\n154\tvec3 toLinearSpace(vec3 color)\n155\t{\n156\treturn pow(color_co_vec3(LinearEncodePowerApprox))_sm_\n157\t}\n158\tvec3 toGammaSpace(vec3 color)\n159\t{\n160\treturn pow(color_co_vec3(GammaEncodePowerApprox))_sm_\n161\t}\n162\tfloat square(float value)\n163\t{\n164\treturn value*value_sm_\n165\t}\n166\tfloat getLuminance(vec3 color)\n167\t{\n168\treturn clamp(dot(color_co_LuminanceEncodeApprox)_co_0._co_1.)_sm_\n169\t}\n170\t\n171\tfloat getRand(vec2 seed) {\n172\treturn fract(sin(dot(seed.xy _co_vec2(12.9898_co_78.233)))*43758.5453)_sm_\n173\t}\n174\tvec3 dither(vec2 seed_co_vec3 color) {\n175\tfloat rand_eq_getRand(seed)_sm_\n176\tcolor+_eq_mix(-0.5/255.0_co_0.5/255.0_co_rand)_sm_\n177\tcolor_eq_max(color_co_0.0)_sm_\n178\treturn color_sm_\n179\t}\n180\t\n181\t#ifdef LIGHT0\n182\tuniform vec4 vLightData0_sm_\n183\tuniform vec4 vLightDiffuse0_sm_\n184\t#ifdef SPECULARTERM\n185\tuniform vec3 vLightSpecular0_sm_\n186\t#else\n187\tvec3 vLightSpecular0_eq_vec3(0.)_sm_\n188\t#endif\n189\t#ifdef SHADOW0\n190\t#if defined(SHADOWCUBE0)\n191\tuniform samplerCube shadowSampler0_sm_\n192\t#else\n193\tvarying vec4 vPositionFromLight0_sm_\n194\tvarying float vDepthMetric0_sm_\n195\tuniform sampler2D shadowSampler0_sm_\n196\tuniform mat4 lightMatrix0_sm_\n197\t#endif\n198\tuniform vec4 shadowsInfo0_sm_\n199\tuniform vec2 depthValues0_sm_\n200\t#endif\n201\t#ifdef SPOTLIGHT0\n202\tuniform vec4 vLightDirection0_sm_\n203\t#endif\n204\t#ifdef HEMILIGHT0\n205\tuniform vec3 vLightGround0_sm_\n206\t#endif\n207\t#ifdef PROJECTEDLIGHTTEXTURE0\n208\tuniform mat4 textureProjectionMatrix0_sm_\n209\tuniform sampler2D projectionLightSampler0_sm_\n210\t#endif\n211\t#endif\n212\t#ifdef LIGHT1\n213\tuniform vec4 vLightData1_sm_\n214\tuniform vec4 vLightDiffuse1_sm_\n215\t#ifdef SPECULARTERM\n216\tuniform vec3 vLightSpecular1_sm_\n217\t#else\n218\tvec3 vLightSpecular1_eq_vec3(0.)_sm_\n219\t#endif\n220\t#ifdef SHADOW1\n221\t#if defined(SHADOWCUBE1)\n222\tuniform samplerCube shadowSampler1_sm_\n223\t#else\n224\tvarying vec4 vPositionFromLight1_sm_\n225\tvarying float vDepthMetric1_sm_\n226\tuniform sampler2D shadowSampler1_sm_\n227\tuniform mat4 lightMatrix1_sm_\n228\t#endif\n229\tuniform vec4 shadowsInfo1_sm_\n230\tuniform vec2 depthValues1_sm_\n231\t#endif\n232\t#ifdef SPOTLIGHT1\n233\tuniform vec4 vLightDirection1_sm_\n234\t#endif\n235\t#ifdef HEMILIGHT1\n236\tuniform vec3 vLightGround1_sm_\n237\t#endif\n238\t#ifdef PROJECTEDLIGHTTEXTURE1\n239\tuniform mat4 textureProjectionMatrix1_sm_\n240\tuniform sampler2D projectionLightSampler1_sm_\n241\t#endif\n242\t#endif\n243\t#ifdef LIGHT2\n244\tuniform vec4 vLightData2_sm_\n245\tuniform vec4 vLightDiffuse2_sm_\n246\t#ifdef SPECULARTERM\n247\tuniform vec3 vLightSpecular2_sm_\n248\t#else\n249\tvec3 vLightSpecular2_eq_vec3(0.)_sm_\n250\t#endif\n251\t#ifdef SHADOW2\n252\t#if defined(SHADOWCUBE2)\n253\tuniform samplerCube shadowSampler2_sm_\n254\t#else\n255\tvarying vec4 vPositionFromLight2_sm_\n256\tvarying float vDepthMetric2_sm_\n257\tuniform sampler2D shadowSampler2_sm_\n258\tuniform mat4 lightMatrix2_sm_\n259\t#endif\n260\tuniform vec4 shadowsInfo2_sm_\n261\tuniform vec2 depthValues2_sm_\n262\t#endif\n263\t#ifdef SPOTLIGHT2\n264\tuniform vec4 vLightDirection2_sm_\n265\t#endif\n266\t#ifdef HEMILIGHT2\n267\tuniform vec3 vLightGround2_sm_\n268\t#endif\n269\t#ifdef PROJECTEDLIGHTTEXTURE2\n270\tuniform mat4 textureProjectionMatrix2_sm_\n271\tuniform sampler2D projectionLightSampler2_sm_\n272\t#endif\n273\t#endif\n274\t#ifdef LIGHT3\n275\tuniform vec4 vLightData3_sm_\n276\tuniform vec4 vLightDiffuse3_sm_\n277\t#ifdef SPECULARTERM\n278\tuniform vec3 vLightSpecular3_sm_\n279\t#else\n280\tvec3 vLightSpecular3_eq_vec3(0.)_sm_\n281\t#endif\n282\t#ifdef SHADOW3\n283\t#if defined(SHADOWCUBE3)\n284\tuniform samplerCube shadowSampler3_sm_\n285\t#else\n286\tvarying vec4 vPositionFromLight3_sm_\n287\tvarying float vDepthMetric3_sm_\n288\tuniform sampler2D shadowSampler3_sm_\n289\tuniform mat4 lightMatrix3_sm_\n290\t#endif\n291\tuniform vec4 shadowsInfo3_sm_\n292\tuniform vec2 depthValues3_sm_\n293\t#endif\n294\t#ifdef SPOTLIGHT3\n295\tuniform vec4 vLightDirection3_sm_\n296\t#endif\n297\t#ifdef HEMILIGHT3\n298\tuniform vec3 vLightGround3_sm_\n299\t#endif\n300\t#ifdef PROJECTEDLIGHTTEXTURE3\n301\tuniform mat4 textureProjectionMatrix3_sm_\n302\tuniform sampler2D projectionLightSampler3_sm_\n303\t#endif\n304\t#endif\n305\t\n306\t\n307\tstruct lightingInfo\n308\t{\n309\tvec3 diffuse_sm_\n310\t#ifdef SPECULARTERM\n311\tvec3 specular_sm_\n312\t#endif\n313\t#ifdef NDOTL\n314\tfloat ndl_sm_\n315\t#endif\n316\t}_sm_\n317\tlightingInfo computeLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec3 diffuseColor_co_vec3 specularColor_co_float range_co_float glossiness) {\n318\tlightingInfo result_sm_\n319\tvec3 lightVectorW_sm_\n320\tfloat attenuation_eq_1.0_sm_\n321\tif (lightData.w _eq__eq_ 0.)\n322\t{\n323\tvec3 direction_eq_lightData.xyz-vPositionW_sm_\n324\tattenuation_eq_max(0._co_1.0-length(direction)/range)_sm_\n325\tlightVectorW_eq_normalize(direction)_sm_\n326\t}\n327\telse\n328\t{\n329\tlightVectorW_eq_normalize(-lightData.xyz)_sm_\n330\t}\n331\t\n332\tfloat ndl_eq_max(0._co_dot(vNormal_co_lightVectorW))_sm_\n333\t#ifdef NDOTL\n334\tresult.ndl_eq_ndl_sm_\n335\t#endif\n336\tresult.diffuse_eq_ndl*diffuseColor*attenuation_sm_\n337\t#ifdef SPECULARTERM\n338\t\n339\tvec3 angleW_eq_normalize(viewDirectionW+lightVectorW)_sm_\n340\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n341\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n342\tresult.specular_eq_specComp*specularColor*attenuation_sm_\n343\t#endif\n344\treturn result_sm_\n345\t}\n346\tlightingInfo computeSpotLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec4 lightDirection_co_vec3 diffuseColor_co_vec3 specularColor_co_float range_co_float glossiness) {\n347\tlightingInfo result_sm_\n348\tvec3 direction_eq_lightData.xyz-vPositionW_sm_\n349\tvec3 lightVectorW_eq_normalize(direction)_sm_\n350\tfloat attenuation_eq_max(0._co_1.0-length(direction)/range)_sm_\n351\t\n352\tfloat cosAngle_eq_max(0._co_dot(lightDirection.xyz_co_-lightVectorW))_sm_\n353\tif (cosAngle&gt_sm__eq_lightDirection.w)\n354\t{\n355\tcosAngle_eq_max(0._co_pow(cosAngle_co_lightData.w))_sm_\n356\tattenuation*_eq_cosAngle_sm_\n357\t\n358\tfloat ndl_eq_max(0._co_dot(vNormal_co_lightVectorW))_sm_\n359\t#ifdef NDOTL\n360\tresult.ndl_eq_ndl_sm_\n361\t#endif\n362\tresult.diffuse_eq_ndl*diffuseColor*attenuation_sm_\n363\t#ifdef SPECULARTERM\n364\t\n365\tvec3 angleW_eq_normalize(viewDirectionW+lightVectorW)_sm_\n366\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n367\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n368\tresult.specular_eq_specComp*specularColor*attenuation_sm_\n369\t#endif\n370\treturn result_sm_\n371\t}\n372\tresult.diffuse_eq_vec3(0.)_sm_\n373\t#ifdef SPECULARTERM\n374\tresult.specular_eq_vec3(0.)_sm_\n375\t#endif\n376\t#ifdef NDOTL\n377\tresult.ndl_eq_0._sm_\n378\t#endif\n379\treturn result_sm_\n380\t}\n381\tlightingInfo computeHemisphericLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec3 diffuseColor_co_vec3 specularColor_co_vec3 groundColor_co_float glossiness) {\n382\tlightingInfo result_sm_\n383\t\n384\tfloat ndl_eq_dot(vNormal_co_lightData.xyz)*0.5+0.5_sm_\n385\t#ifdef NDOTL\n386\tresult.ndl_eq_ndl_sm_\n387\t#endif\n388\tresult.diffuse_eq_mix(groundColor_co_diffuseColor_co_ndl)_sm_\n389\t#ifdef SPECULARTERM\n390\t\n391\tvec3 angleW_eq_normalize(viewDirectionW+lightData.xyz)_sm_\n392\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n393\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n394\tresult.specular_eq_specComp*specularColor_sm_\n395\t#endif\n396\treturn result_sm_\n397\t}\n398\tvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler_co_mat4 textureProjectionMatrix){\n399\tvec4 strq_eq_textureProjectionMatrix*vec4(vPositionW_co_1.0)_sm_\n400\tstrq/_eq_strq.w_sm_\n401\tvec3 textureColor_eq_texture2D(projectionLightSampler_co_strq.xy).rgb_sm_\n402\t#ifdef PBR\n403\ttextureColor_eq_toLinearSpace(textureColor)_sm_\n404\t#endif\n405\treturn textureColor_sm_\n406\t}\n407\t#ifdef SHADOWS\n408\t#ifndef SHADOWFLOAT\n409\tfloat unpack(vec4 color)\n410\t{\n411\tconst vec4 bit_shift_eq_vec4(1.0/(255.0*255.0*255.0)_co_1.0/(255.0*255.0)_co_1.0/255.0_co_1.0)_sm_\n412\treturn dot(color_co_bit_shift)_sm_\n413\t}\n414\t#endif\n415\tfloat computeShadowCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_vec2 depthValues)\n416\t{\n417\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n418\tfloat depth_eq_length(directionToLight)_sm_\n419\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n420\tdepth_eq_clamp(depth_co_0._co_1.0)_sm_\n421\tdirectionToLight_eq_normalize(directionToLight)_sm_\n422\tdirectionToLight.y_eq_-directionToLight.y_sm_\n423\t#ifndef SHADOWFLOAT\n424\tfloat shadow_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n425\t#else\n426\tfloat shadow_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n427\t#endif\n428\tif (depth&gt_sm_shadow)\n429\t{\n430\treturn darkness_sm_\n431\t}\n432\treturn 1.0_sm_\n433\t}\n434\tfloat computeShadowWithPCFCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float mapSize_co_float darkness_co_vec2 depthValues)\n435\t{\n436\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n437\tfloat depth_eq_length(directionToLight)_sm_\n438\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n439\tdepth_eq_clamp(depth_co_0._co_1.0)_sm_\n440\tdirectionToLight_eq_normalize(directionToLight)_sm_\n441\tdirectionToLight.y_eq_-directionToLight.y_sm_\n442\tfloat visibility_eq_1._sm_\n443\tvec3 poissonDisk[4]_sm_\n444\tpoissonDisk[0]_eq_vec3(-1.0_co_1.0_co_-1.0)_sm_\n445\tpoissonDisk[1]_eq_vec3(1.0_co_-1.0_co_-1.0)_sm_\n446\tpoissonDisk[2]_eq_vec3(-1.0_co_-1.0_co_-1.0)_sm_\n447\tpoissonDisk[3]_eq_vec3(1.0_co_-1.0_co_1.0)_sm_\n448\t\n449\t#ifndef SHADOWFLOAT\n450\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[0]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n451\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[1]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n452\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[2]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n453\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[3]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n454\t#else\n455\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[0]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n456\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[1]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n457\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[2]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n458\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[3]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n459\t#endif\n460\treturn min(1.0_co_visibility+darkness)_sm_\n461\t}\n462\tfloat computeShadowWithESMCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_float depthScale_co_vec2 depthValues)\n463\t{\n464\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n465\tfloat depth_eq_length(directionToLight)_sm_\n466\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n467\tfloat shadowPixelDepth_eq_clamp(depth_co_0._co_1.0)_sm_\n468\tdirectionToLight_eq_normalize(directionToLight)_sm_\n469\tdirectionToLight.y_eq_-directionToLight.y_sm_\n470\t#ifndef SHADOWFLOAT\n471\tfloat shadowMapSample_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n472\t#else\n473\tfloat shadowMapSample_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n474\t#endif\n475\tfloat esm_eq_1.0-clamp(exp(min(87._co_depthScale*shadowPixelDepth))*shadowMapSample_co_0._co_1.-darkness)_sm_ \n476\treturn esm_sm_\n477\t}\n478\tfloat computeShadowWithCloseESMCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_float depthScale_co_vec2 depthValues)\n479\t{\n480\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n481\tfloat depth_eq_length(directionToLight)_sm_\n482\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n483\tfloat shadowPixelDepth_eq_clamp(depth_co_0._co_1.0)_sm_\n484\tdirectionToLight_eq_normalize(directionToLight)_sm_\n485\tdirectionToLight.y_eq_-directionToLight.y_sm_\n486\t#ifndef SHADOWFLOAT\n487\tfloat shadowMapSample_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n488\t#else\n489\tfloat shadowMapSample_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n490\t#endif\n491\tfloat esm_eq_clamp(exp(min(87._co_-depthScale*(shadowPixelDepth-shadowMapSample)))_co_darkness_co_1.)_sm_\n492\treturn esm_sm_\n493\t}\n494\tfloat computeShadow(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float frustumEdgeFalloff)\n495\t{\n496\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n497\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n498\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n499\t{\n500\treturn 1.0_sm_\n501\t}\n502\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n503\t#ifndef SHADOWFLOAT\n504\tfloat shadow_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n505\t#else\n506\tfloat shadow_eq_texture2D(shadowSampler_co_uv).x_sm_\n507\t#endif\n508\tif (shadowPixelDepth&gt_sm_shadow)\n509\t{\n510\treturn computeFallOff(darkness_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n511\t}\n512\treturn 1._sm_\n513\t}\n514\tfloat computeShadowWithPCF(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float mapSize_co_float darkness_co_float frustumEdgeFalloff)\n515\t{\n516\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n517\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n518\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n519\t{\n520\treturn 1.0_sm_\n521\t}\n522\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n523\tfloat visibility_eq_1._sm_\n524\tvec2 poissonDisk[4]_sm_\n525\tpoissonDisk[0]_eq_vec2(-0.94201624_co_-0.39906216)_sm_\n526\tpoissonDisk[1]_eq_vec2(0.94558609_co_-0.76890725)_sm_\n527\tpoissonDisk[2]_eq_vec2(-0.094184101_co_-0.92938870)_sm_\n528\tpoissonDisk[3]_eq_vec2(0.34495938_co_0.29387760)_sm_\n529\t\n530\t#ifndef SHADOWFLOAT\n531\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[0]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n532\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[1]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n533\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[2]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n534\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[3]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n535\t#else\n536\tif (texture2D(shadowSampler_co_uv+poissonDisk[0]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n537\tif (texture2D(shadowSampler_co_uv+poissonDisk[1]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n538\tif (texture2D(shadowSampler_co_uv+poissonDisk[2]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n539\tif (texture2D(shadowSampler_co_uv+poissonDisk[3]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n540\t#endif\n541\treturn computeFallOff(min(1.0_co_visibility+darkness)_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n542\t}\n543\tfloat computeShadowWithESM(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float depthScale_co_float frustumEdgeFalloff)\n544\t{\n545\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n546\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n547\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n548\t{\n549\treturn 1.0_sm_\n550\t}\n551\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n552\t#ifndef SHADOWFLOAT\n553\tfloat shadowMapSample_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n554\t#else\n555\tfloat shadowMapSample_eq_texture2D(shadowSampler_co_uv).x_sm_\n556\t#endif\n557\tfloat esm_eq_1.0-clamp(exp(min(87._co_depthScale*shadowPixelDepth))*shadowMapSample_co_0._co_1.-darkness)_sm_\n558\treturn computeFallOff(esm_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n559\t}\n560\tfloat computeShadowWithCloseESM(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float depthScale_co_float frustumEdgeFalloff)\n561\t{\n562\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n563\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n564\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n565\t{\n566\treturn 1.0_sm_\n567\t}\n568\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_ \n569\t#ifndef SHADOWFLOAT\n570\tfloat shadowMapSample_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n571\t#else\n572\tfloat shadowMapSample_eq_texture2D(shadowSampler_co_uv).x_sm_\n573\t#endif\n574\tfloat esm_eq_clamp(exp(min(87._co_-depthScale*(shadowPixelDepth-shadowMapSample)))_co_darkness_co_1.)_sm_\n575\treturn computeFallOff(esm_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n576\t}\n577\t#endif\n578\t\n579\t\n580\t#ifdef DIFFUSE\n581\t#if DIFFUSEDIRECTUV _eq__eq_ 1\n582\t#define vDiffuseUV vMainUV1\n583\t#elif DIFFUSEDIRECTUV _eq__eq_ 2\n584\t#define vDiffuseUV vMainUV2\n585\t#else\n586\tvarying vec2 vDiffuseUV_sm_\n587\t#endif\n588\tuniform sampler2D diffuseSampler_sm_\n589\t#endif\n590\t#ifdef AMBIENT\n591\t#if AMBIENTDIRECTUV _eq__eq_ 1\n592\t#define vAmbientUV vMainUV1\n593\t#elif AMBIENTDIRECTUV _eq__eq_ 2\n594\t#define vAmbientUV vMainUV2\n595\t#else\n596\tvarying vec2 vAmbientUV_sm_\n597\t#endif\n598\tuniform sampler2D ambientSampler_sm_\n599\t#endif\n600\t#ifdef OPACITY \n601\t#if OPACITYDIRECTUV _eq__eq_ 1\n602\t#define vOpacityUV vMainUV1\n603\t#elif OPACITYDIRECTUV _eq__eq_ 2\n604\t#define vOpacityUV vMainUV2\n605\t#else\n606\tvarying vec2 vOpacityUV_sm_\n607\t#endif\n608\tuniform sampler2D opacitySampler_sm_\n609\t#endif\n610\t#ifdef EMISSIVE\n611\t#if EMISSIVEDIRECTUV _eq__eq_ 1\n612\t#define vEmissiveUV vMainUV1\n613\t#elif EMISSIVEDIRECTUV _eq__eq_ 2\n614\t#define vEmissiveUV vMainUV2\n615\t#else\n616\tvarying vec2 vEmissiveUV_sm_\n617\t#endif\n618\tuniform sampler2D emissiveSampler_sm_\n619\t#endif\n620\t#ifdef LIGHTMAP\n621\t#if LIGHTMAPDIRECTUV _eq__eq_ 1\n622\t#define vLightmapUV vMainUV1\n623\t#elif LIGHTMAPDIRECTUV _eq__eq_ 2\n624\t#define vLightmapUV vMainUV2\n625\t#else\n626\tvarying vec2 vLightmapUV_sm_\n627\t#endif\n628\tuniform sampler2D lightmapSampler_sm_\n629\t#endif\n630\t#ifdef REFRACTION\n631\t#ifdef REFRACTIONMAP_3D\n632\tuniform samplerCube refractionCubeSampler_sm_\n633\t#else\n634\tuniform sampler2D refraction2DSampler_sm_\n635\t#endif\n636\t#endif\n637\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n638\t#if SPECULARDIRECTUV _eq__eq_ 1\n639\t#define vSpecularUV vMainUV1\n640\t#elif SPECULARDIRECTUV _eq__eq_ 2\n641\t#define vSpecularUV vMainUV2\n642\t#else\n643\tvarying vec2 vSpecularUV_sm_\n644\t#endif\n645\tuniform sampler2D specularSampler_sm_\n646\t#endif\n647\t\n648\t#ifdef FRESNEL\n649\tfloat computeFresnelTerm(vec3 viewDirection_co_vec3 worldNormal_co_float bias_co_float power)\n650\t{\n651\tfloat fresnelTerm_eq_pow(bias+abs(dot(viewDirection_co_worldNormal))_co_power)_sm_\n652\treturn clamp(fresnelTerm_co_0._co_1.)_sm_\n653\t}\n654\t#endif\n655\t\n656\t#ifdef REFLECTION\n657\t#ifdef REFLECTIONMAP_3D\n658\tuniform samplerCube reflectionCubeSampler_sm_\n659\t#else\n660\tuniform sampler2D reflection2DSampler_sm_\n661\t#endif\n662\t#ifdef REFLECTIONMAP_SKYBOX\n663\tvarying vec3 vPositionUVW_sm_\n664\t#else\n665\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n666\tvarying vec3 vDirectionW_sm_\n667\t#endif\n668\t#endif\n669\t#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\n670\tvec3 parallaxCorrectNormal( vec3 vertexPos_co_vec3 origVec_co_vec3 cubeSize_co_vec3 cubePos ) {\n671\t\n672\tvec3 invOrigVec_eq_vec3(1.0_co_1.0_co_1.0)/origVec_sm_\n673\tvec3 halfSize_eq_cubeSize*0.5_sm_\n674\tvec3 intersecAtMaxPlane_eq_(cubePos+halfSize-vertexPos)*invOrigVec_sm_\n675\tvec3 intersecAtMinPlane_eq_(cubePos-halfSize-vertexPos)*invOrigVec_sm_\n676\t\n677\tvec3 largestIntersec_eq_max(intersecAtMaxPlane_co_intersecAtMinPlane)_sm_\n678\t\n679\tfloat distance_eq_min(min(largestIntersec.x_co_largestIntersec.y)_co_largestIntersec.z)_sm_\n680\t\n681\tvec3 intersectPositionWS_eq_vertexPos+origVec*distance_sm_\n682\t\n683\treturn intersectPositionWS-cubePos_sm_\n684\t}\n685\t#endif\n686\tvec3 computeReflectionCoords(vec4 worldPos_co_vec3 worldNormal)\n687\t{\n688\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n689\tvec3 direction_eq_vDirectionW_sm_\n690\tfloat t_eq_clamp(direction.y*-0.5+0.5_co_0._co_1.0)_sm_\n691\tfloat s_eq_atan(direction.z_co_direction.x)*RECIPROCAL_PI2+0.5_sm_\n692\t#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\n693\treturn vec3(1.0-s_co_t_co_0)_sm_\n694\t#else\n695\treturn vec3(s_co_t_co_0)_sm_\n696\t#endif\n697\t#endif\n698\t#ifdef REFLECTIONMAP_EQUIRECTANGULAR\n699\tvec3 cameraToVertex_eq_normalize(worldPos.xyz-vEyePosition.xyz)_sm_\n700\tvec3 r_eq_reflect(cameraToVertex_co_worldNormal)_sm_\n701\tfloat t_eq_clamp(r.y*-0.5+0.5_co_0._co_1.0)_sm_\n702\tfloat s_eq_atan(r.z_co_r.x)*RECIPROCAL_PI2+0.5_sm_\n703\treturn vec3(s_co_t_co_0)_sm_\n704\t#endif\n705\t#ifdef REFLECTIONMAP_SPHERICAL\n706\tvec3 viewDir_eq_normalize(vec3(view*worldPos))_sm_\n707\tvec3 viewNormal_eq_normalize(vec3(view*vec4(worldNormal_co_0.0)))_sm_\n708\tvec3 r_eq_reflect(viewDir_co_viewNormal)_sm_\n709\tr.z_eq_r.z-1.0_sm_\n710\tfloat m_eq_2.0*length(r)_sm_\n711\treturn vec3(r.x/m+0.5_co_1.0-r.y/m-0.5_co_0)_sm_\n712\t#endif\n713\t#ifdef REFLECTIONMAP_PLANAR\n714\tvec3 viewDir_eq_worldPos.xyz-vEyePosition.xyz_sm_\n715\tvec3 coords_eq_normalize(reflect(viewDir_co_worldNormal))_sm_\n716\treturn vec3(reflectionMatrix*vec4(coords_co_1))_sm_\n717\t#endif\n718\t#ifdef REFLECTIONMAP_CUBIC\n719\tvec3 viewDir_eq_normalize(worldPos.xyz-vEyePosition.xyz)_sm_\n720\t\n721\tvec3 coords_eq_reflect(viewDir_co_worldNormal)_sm_\n722\t#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\n723\tcoords_eq_parallaxCorrectNormal(worldPos.xyz_co_coords_co_vReflectionSize_co_vReflectionPosition)_sm_\n724\t#endif\n725\tcoords_eq_vec3(reflectionMatrix*vec4(coords_co_0))_sm_\n726\t#ifdef INVERTCUBICMAP\n727\tcoords.y*_eq_-1.0_sm_\n728\t#endif\n729\treturn coords_sm_\n730\t#endif\n731\t#ifdef REFLECTIONMAP_PROJECTION\n732\treturn vec3(reflectionMatrix*(view*worldPos))_sm_\n733\t#endif\n734\t#ifdef REFLECTIONMAP_SKYBOX\n735\treturn vPositionUVW_sm_\n736\t#endif\n737\t#ifdef REFLECTIONMAP_EXPLICIT\n738\treturn vec3(0_co_0_co_0)_sm_\n739\t#endif\n740\t}\n741\t#endif\n742\t#ifdef EXPOSURE\n743\tuniform float exposureLinear_sm_\n744\t#endif\n745\t#ifdef CONTRAST\n746\tuniform float contrast_sm_\n747\t#endif\n748\t#ifdef VIGNETTE\n749\tuniform vec2 vInverseScreenSize_sm_\n750\tuniform vec4 vignetteSettings1_sm_\n751\tuniform vec4 vignetteSettings2_sm_\n752\t#endif\n753\t#ifdef COLORCURVES\n754\tuniform vec4 vCameraColorCurveNegative_sm_\n755\tuniform vec4 vCameraColorCurveNeutral_sm_\n756\tuniform vec4 vCameraColorCurvePositive_sm_\n757\t#endif\n758\t#ifdef COLORGRADING\n759\t#ifdef COLORGRADING3D\n760\tuniform highp sampler3D txColorTransform_sm_\n761\t#else\n762\tuniform sampler2D txColorTransform_sm_\n763\t#endif\n764\tuniform vec4 colorTransformSettings_sm_\n765\t#endif\n766\t#if defined(COLORGRADING) &amp_sm_&amp_sm_ !defined(COLORGRADING3D)\n767\t\n768\tvec3 sampleTexture3D(sampler2D colorTransform_co_vec3 color_co_vec2 sampler3dSetting)\n769\t{\n770\tfloat sliceSize_eq_2.0*sampler3dSetting.x_sm_ \n771\t#ifdef SAMPLER3DGREENDEPTH\n772\tfloat sliceContinuous_eq_(color.g-sampler3dSetting.x)*sampler3dSetting.y_sm_\n773\t#else\n774\tfloat sliceContinuous_eq_(color.b-sampler3dSetting.x)*sampler3dSetting.y_sm_\n775\t#endif\n776\tfloat sliceInteger_eq_floor(sliceContinuous)_sm_\n777\t\n778\t\n779\tfloat sliceFraction_eq_sliceContinuous-sliceInteger_sm_\n780\t#ifdef SAMPLER3DGREENDEPTH\n781\tvec2 sliceUV_eq_color.rb_sm_\n782\t#else\n783\tvec2 sliceUV_eq_color.rg_sm_\n784\t#endif\n785\tsliceUV.x*_eq_sliceSize_sm_\n786\tsliceUV.x+_eq_sliceInteger*sliceSize_sm_\n787\tsliceUV_eq_clamp(sliceUV_co_0._co_1.)_sm_\n788\tvec4 slice0Color_eq_texture2D(colorTransform_co_sliceUV)_sm_\n789\tsliceUV.x+_eq_sliceSize_sm_\n790\tsliceUV_eq_clamp(sliceUV_co_0._co_1.)_sm_\n791\tvec4 slice1Color_eq_texture2D(colorTransform_co_sliceUV)_sm_\n792\tvec3 result_eq_mix(slice0Color.rgb_co_slice1Color.rgb_co_sliceFraction)_sm_\n793\t#ifdef SAMPLER3DBGRMAP\n794\tcolor.rgb_eq_result.rgb_sm_\n795\t#else\n796\tcolor.rgb_eq_result.bgr_sm_\n797\t#endif\n798\treturn color_sm_\n799\t}\n800\t#endif\n801\tvec4 applyImageProcessing(vec4 result) {\n802\t#ifdef EXPOSURE\n803\tresult.rgb*_eq_exposureLinear_sm_\n804\t#endif\n805\t#ifdef VIGNETTE\n806\t\n807\tvec2 viewportXY_eq_gl_FragCoord.xy*vInverseScreenSize_sm_\n808\tviewportXY_eq_viewportXY*2.0-1.0_sm_\n809\tvec3 vignetteXY1_eq_vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw_co_1.0)_sm_\n810\tfloat vignetteTerm_eq_dot(vignetteXY1_co_vignetteXY1)_sm_\n811\tfloat vignette_eq_pow(vignetteTerm_co_vignetteSettings2.w)_sm_\n812\t\n813\tvec3 vignetteColor_eq_vignetteSettings2.rgb_sm_\n814\t#ifdef VIGNETTEBLENDMODEMULTIPLY\n815\tvec3 vignetteColorMultiplier_eq_mix(vignetteColor_co_vec3(1_co_1_co_1)_co_vignette)_sm_\n816\tresult.rgb*_eq_vignetteColorMultiplier_sm_\n817\t#endif\n818\t#ifdef VIGNETTEBLENDMODEOPAQUE\n819\tresult.rgb_eq_mix(vignetteColor_co_result.rgb_co_vignette)_sm_\n820\t#endif\n821\t#endif\n822\t#ifdef TONEMAPPING\n823\tconst float tonemappingCalibration_eq_1.590579_sm_\n824\tresult.rgb_eq_1.0-exp2(-tonemappingCalibration*result.rgb)_sm_\n825\t#endif\n826\t\n827\tresult.rgb_eq_toGammaSpace(result.rgb)_sm_\n828\tresult.rgb_eq_clamp(result.rgb_co_0.0_co_1.0)_sm_\n829\t#ifdef CONTRAST\n830\t\n831\tvec3 resultHighContrast_eq_applyEaseInOut(result.rgb)_sm_\n832\tif (contrast&lt_sm_1.0) {\n833\t\n834\tresult.rgb_eq_mix(vec3(0.5_co_0.5_co_0.5)_co_result.rgb_co_contrast)_sm_\n835\t} else {\n836\t\n837\tresult.rgb_eq_mix(result.rgb_co_resultHighContrast_co_contrast-1.0)_sm_\n838\t}\n839\t#endif\n840\t\n841\t#ifdef COLORGRADING\n842\tvec3 colorTransformInput_eq_result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy_sm_\n843\t#ifdef COLORGRADING3D\n844\tvec3 colorTransformOutput_eq_texture(txColorTransform_co_colorTransformInput).rgb_sm_\n845\t#else\n846\tvec3 colorTransformOutput_eq_sampleTexture3D(txColorTransform_co_colorTransformInput_co_colorTransformSettings.yz).rgb_sm_\n847\t#endif\n848\tresult.rgb_eq_mix(result.rgb_co_colorTransformOutput_co_colorTransformSettings.www)_sm_\n849\t#endif\n850\t#ifdef COLORCURVES\n851\t\n852\tfloat luma_eq_getLuminance(result.rgb)_sm_\n853\tvec2 curveMix_eq_clamp(vec2(luma*3.0-1.5_co_luma*-3.0+1.5)_co_vec2(0.0)_co_vec2(1.0))_sm_\n854\tvec4 colorCurve_eq_vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative_sm_\n855\tresult.rgb*_eq_colorCurve.rgb_sm_\n856\tresult.rgb_eq_mix(vec3(luma)_co_result.rgb_co_colorCurve.a)_sm_\n857\t#endif\n858\treturn result_sm_\n859\t}\n860\t#ifdef BUMP\n861\t#if BUMPDIRECTUV _eq__eq_ 1\n862\t#define vBumpUV vMainUV1\n863\t#elif BUMPDIRECTUV _eq__eq_ 2\n864\t#define vBumpUV vMainUV2\n865\t#else\n866\tvarying vec2 vBumpUV_sm_\n867\t#endif\n868\tuniform sampler2D bumpSampler_sm_\n869\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL) \n870\tvarying mat3 vTBN_sm_\n871\t#endif\n872\t#ifdef OBJECTSPACE_NORMALMAP\n873\tuniform mat4 normalMatrix_sm_\n874\t#endif\n875\t\n876\tmat3 cotangent_frame(vec3 normal_co_vec3 p_co_vec2 uv)\n877\t{\n878\t\n879\tuv_eq_gl_FrontFacing ? uv _dd_ -uv_sm_\n880\t\n881\tvec3 dp1_eq_dFdx(p)_sm_\n882\tvec3 dp2_eq_dFdy(p)_sm_\n883\tvec2 duv1_eq_dFdx(uv)_sm_\n884\tvec2 duv2_eq_dFdy(uv)_sm_\n885\t\n886\tvec3 dp2perp_eq_cross(dp2_co_normal)_sm_\n887\tvec3 dp1perp_eq_cross(normal_co_dp1)_sm_\n888\tvec3 tangent_eq_dp2perp*duv1.x+dp1perp*duv2.x_sm_\n889\tvec3 bitangent_eq_dp2perp*duv1.y+dp1perp*duv2.y_sm_\n890\t\n891\ttangent*_eq_vTangentSpaceParams.x_sm_\n892\tbitangent*_eq_vTangentSpaceParams.y_sm_\n893\t\n894\tfloat invmax_eq_inversesqrt(max(dot(tangent_co_tangent)_co_dot(bitangent_co_bitangent)))_sm_\n895\treturn mat3(tangent*invmax_co_bitangent*invmax_co_normal)_sm_\n896\t}\n897\tvec3 perturbNormal(mat3 cotangentFrame_co_vec2 uv)\n898\t{\n899\tvec3 map_eq_texture2D(bumpSampler_co_uv).xyz_sm_\n900\tmap_eq_map*2.0-1.0_sm_\n901\t#ifdef NORMALXYSCALE\n902\tmap_eq_normalize(map*vec3(vBumpInfos.y_co_vBumpInfos.y_co_1.0))_sm_\n903\t#endif\n904\treturn normalize(cotangentFrame*map)_sm_\n905\t}\n906\t#ifdef PARALLAX\n907\tconst float minSamples_eq_4._sm_\n908\tconst float maxSamples_eq_15._sm_\n909\tconst int iMaxSamples_eq_15_sm_\n910\t\n911\tvec2 parallaxOcclusion(vec3 vViewDirCoT_co_vec3 vNormalCoT_co_vec2 texCoord_co_float parallaxScale) {\n912\tfloat parallaxLimit_eq_length(vViewDirCoT.xy)/vViewDirCoT.z_sm_\n913\tparallaxLimit*_eq_parallaxScale_sm_\n914\tvec2 vOffsetDir_eq_normalize(vViewDirCoT.xy)_sm_\n915\tvec2 vMaxOffset_eq_vOffsetDir*parallaxLimit_sm_\n916\tfloat numSamples_eq_maxSamples+(dot(vViewDirCoT_co_vNormalCoT)*(minSamples-maxSamples))_sm_\n917\tfloat stepSize_eq_1.0/numSamples_sm_\n918\t\n919\tfloat currRayHeight_eq_1.0_sm_\n920\tvec2 vCurrOffset_eq_vec2(0_co_0)_sm_\n921\tvec2 vLastOffset_eq_vec2(0_co_0)_sm_\n922\tfloat lastSampledHeight_eq_1.0_sm_\n923\tfloat currSampledHeight_eq_1.0_sm_\n924\tfor (int i_eq_0_sm_ i&lt_sm_iMaxSamples_sm_ i++)\n925\t{\n926\tcurrSampledHeight_eq_texture2D(bumpSampler_co_vBumpUV+vCurrOffset).w_sm_\n927\t\n928\tif (currSampledHeight&gt_sm_currRayHeight)\n929\t{\n930\tfloat delta1_eq_currSampledHeight-currRayHeight_sm_\n931\tfloat delta2_eq_(currRayHeight+stepSize)-lastSampledHeight_sm_\n932\tfloat ratio_eq_delta1/(delta1+delta2)_sm_\n933\tvCurrOffset_eq_(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset_sm_\n934\t\n935\tbreak_sm_\n936\t}\n937\telse\n938\t{\n939\tcurrRayHeight-_eq_stepSize_sm_\n940\tvLastOffset_eq_vCurrOffset_sm_\n941\tvCurrOffset+_eq_stepSize*vMaxOffset_sm_\n942\tlastSampledHeight_eq_currSampledHeight_sm_\n943\t}\n944\t}\n945\treturn vCurrOffset_sm_\n946\t}\n947\tvec2 parallaxOffset(vec3 viewDir_co_float heightScale)\n948\t{\n949\t\n950\tfloat height_eq_texture2D(bumpSampler_co_vBumpUV).w_sm_\n951\tvec2 texCoordOffset_eq_heightScale*viewDir.xy*height_sm_\n952\treturn -texCoordOffset_sm_\n953\t}\n954\t#endif\n955\t#endif\n956\t#ifdef CLIPPLANE\n957\tvarying float fClipDistance_sm_\n958\t#endif\n959\t#ifdef LOGARITHMICDEPTH\n960\tuniform float logarithmicDepthConstant_sm_\n961\tvarying float vFragmentDepth_sm_\n962\t#endif\n963\t#ifdef FOG\n964\t#define FOGMODE_NONE 0.\n965\t#define FOGMODE_EXP 1.\n966\t#define FOGMODE_EXP2 2.\n967\t#define FOGMODE_LINEAR 3.\n968\t#define E 2.71828\n969\tuniform vec4 vFogInfos_sm_\n970\tuniform vec3 vFogColor_sm_\n971\tvarying vec3 vFogDistance_sm_\n972\tfloat CalcFogFactor()\n973\t{\n974\tfloat fogCoeff_eq_1.0_sm_\n975\tfloat fogStart_eq_vFogInfos.y_sm_\n976\tfloat fogEnd_eq_vFogInfos.z_sm_\n977\tfloat fogDensity_eq_vFogInfos.w_sm_\n978\tfloat fogDistance_eq_length(vFogDistance)_sm_\n979\tif (FOGMODE_LINEAR _eq__eq_ vFogInfos.x)\n980\t{\n981\tfogCoeff_eq_(fogEnd-fogDistance)/(fogEnd-fogStart)_sm_\n982\t}\n983\telse if (FOGMODE_EXP _eq__eq_ vFogInfos.x)\n984\t{\n985\tfogCoeff_eq_1.0/pow(E_co_fogDistance*fogDensity)_sm_\n986\t}\n987\telse if (FOGMODE_EXP2 _eq__eq_ vFogInfos.x)\n988\t{\n989\tfogCoeff_eq_1.0/pow(E_co_fogDistance*fogDistance*fogDensity*fogDensity)_sm_\n990\t}\n991\treturn clamp(fogCoeff_co_0.0_co_1.0)_sm_\n992\t}\n993\t#endif\n994\t#define CUSTOM_FRAGMENT_DEFINITIONS\n995\tvoid main(void) {\n996\t#define CUSTOM_FRAGMENT_MAIN_BEGIN\n997\t#ifdef CLIPPLANE\n998\tif (fClipDistance&gt_sm_0.0)\n999\t{\n1000\tdiscard_sm_\n1001\t}\n1002\t#endif\n1003\tvec3 viewDirectionW_eq_normalize(vEyePosition-vPositionW)_sm_\n1004\t\n1005\tvec4 baseColor_eq_vec4(1._co_1._co_1._co_1.)_sm_\n1006\tvec3 diffuseColor_eq_vDiffuseColor.rgb_sm_\n1007\t\n1008\tfloat alpha_eq_vDiffuseColor.a_sm_\n1009\t\n1010\t#ifdef NORMAL\n1011\tvec3 normalW_eq_normalize(vNormalW)_sm_\n1012\t#else\n1013\tvec3 normalW_eq_normalize(-cross(dFdx(vPositionW)_co_dFdy(vPositionW)))_sm_\n1014\t#endif\n1015\tvec2 uvOffset_eq_vec2(0.0_co_0.0)_sm_\n1016\t#if defined(BUMP) || defined(PARALLAX)\n1017\t#ifdef NORMALXYSCALE\n1018\tfloat normalScale_eq_1.0_sm_\n1019\t#else \n1020\tfloat normalScale_eq_vBumpInfos.y_sm_\n1021\t#endif\n1022\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL)\n1023\tmat3 TBN_eq_vTBN_sm_\n1024\t#else\n1025\tmat3 TBN_eq_cotangent_frame(normalW*normalScale_co_vPositionW_co_vBumpUV)_sm_\n1026\t#endif\n1027\t#endif\n1028\t#ifdef PARALLAX\n1029\tmat3 invTBN_eq_transposeMat3(TBN)_sm_\n1030\t#ifdef PARALLAXOCCLUSION\n1031\tuvOffset_eq_parallaxOcclusion(invTBN*-viewDirectionW_co_invTBN*normalW_co_vBumpUV_co_vBumpInfos.z)_sm_\n1032\t#else\n1033\tuvOffset_eq_parallaxOffset(invTBN*viewDirectionW_co_vBumpInfos.z)_sm_\n1034\t#endif\n1035\t#endif\n1036\t#ifdef BUMP\n1037\t#ifdef OBJECTSPACE_NORMALMAP\n1038\tnormalW_eq_normalize(texture2D(bumpSampler_co_vBumpUV).xyz*2.0-1.0)_sm_\n1039\tnormalW_eq_normalize(mat3(normalMatrix)*normalW)_sm_ \n1040\t#else\n1041\tnormalW_eq_perturbNormal(TBN_co_vBumpUV+uvOffset)_sm_\n1042\t#endif\n1043\t#endif\n1044\t#ifdef TWOSIDEDLIGHTING\n1045\tnormalW_eq_gl_FrontFacing ? normalW _dd_ -normalW_sm_\n1046\t#endif\n1047\t#ifdef DIFFUSE\n1048\tbaseColor_eq_texture2D(diffuseSampler_co_vDiffuseUV+uvOffset)_sm_\n1049\t#ifdef ALPHATEST\n1050\tif (baseColor.a&lt_sm_0.4)\n1051\tdiscard_sm_\n1052\t#endif\n1053\t#ifdef ALPHAFROMDIFFUSE\n1054\talpha*_eq_baseColor.a_sm_\n1055\t#endif\n1056\t#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n1057\tbaseColor.rgb*_eq_vDiffuseInfos.y_sm_\n1058\t#endif\n1059\t#ifdef DEPTHPREPASS\n1060\tgl_FragColor_eq_vec4(0._co_0._co_0._co_1.0)_sm_\n1061\treturn_sm_\n1062\t#endif\n1063\t#ifdef VERTEXCOLOR\n1064\tbaseColor.rgb*_eq_vColor.rgb_sm_\n1065\t#endif\n1066\t#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n1067\t\n1068\tvec3 baseAmbientColor_eq_vec3(1._co_1._co_1.)_sm_\n1069\t#ifdef AMBIENT\n1070\tbaseAmbientColor_eq_texture2D(ambientSampler_co_vAmbientUV+uvOffset).rgb*vAmbientInfos.y_sm_\n1071\t#endif\n1072\t#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n1073\t\n1074\t#ifdef SPECULARTERM\n1075\tfloat glossiness_eq_vSpecularColor.a_sm_\n1076\tvec3 specularColor_eq_vSpecularColor.rgb_sm_\n1077\t#ifdef SPECULAR\n1078\tvec4 specularMapColor_eq_texture2D(specularSampler_co_vSpecularUV+uvOffset)_sm_\n1079\tspecularColor_eq_specularMapColor.rgb_sm_\n1080\t#ifdef GLOSSINESS\n1081\tglossiness_eq_glossiness*specularMapColor.a_sm_\n1082\t#endif\n1083\t#endif\n1084\t#else\n1085\tfloat glossiness_eq_0._sm_\n1086\t#endif\n1087\t\n1088\tvec3 diffuseBase_eq_vec3(0._co_0._co_0.)_sm_\n1089\tlightingInfo info_sm_\n1090\t#ifdef SPECULARTERM\n1091\tvec3 specularBase_eq_vec3(0._co_0._co_0.)_sm_\n1092\t#endif\n1093\tfloat shadow_eq_1._sm_\n1094\t#ifdef LIGHTMAP\n1095\tvec3 lightmapColor_eq_texture2D(lightmapSampler_co_vLightmapUV+uvOffset).rgb*vLightmapInfos.y_sm_\n1096\t#endif\n1097\t#ifdef LIGHT0\n1098\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED0) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR0))\n1099\t\n1100\t#else\n1101\t#ifdef PBR\n1102\t#ifdef SPOTLIGHT0\n1103\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDirection0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1104\t#endif\n1105\t#ifdef HEMILIGHT0\n1106\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightGround0_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1107\t#endif\n1108\t#if defined(POINTLIGHT0) || defined(DIRLIGHT0)\n1109\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1110\t#endif\n1111\t#else\n1112\t#ifdef SPOTLIGHT0\n1113\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDirection0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_glossiness)_sm_\n1114\t#endif\n1115\t#ifdef HEMILIGHT0\n1116\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightGround0_co_glossiness)_sm_\n1117\t#endif\n1118\t#if defined(POINTLIGHT0) || defined(DIRLIGHT0)\n1119\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_glossiness)_sm_\n1120\t#endif\n1121\t#endif\n1122\t#ifdef PROJECTEDLIGHTTEXTURE0\n1123\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler0_co_textureProjectionMatrix0)_sm_\n1124\t#endif\n1125\t#endif\n1126\t#ifdef SHADOW0\n1127\t#ifdef SHADOWCLOSEESM0\n1128\t#if defined(SHADOWCUBE0)\n1129\tshadow_eq_computeShadowWithCloseESMCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_depthValues0)_sm_\n1130\t#else\n1131\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_shadowsInfo0.w)_sm_\n1132\t#endif\n1133\t#else\n1134\t#ifdef SHADOWESM0\n1135\t#if defined(SHADOWCUBE0)\n1136\tshadow_eq_computeShadowWithESMCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_depthValues0)_sm_\n1137\t#else\n1138\tshadow_eq_computeShadowWithESM(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_shadowsInfo0.w)_sm_\n1139\t#endif\n1140\t#else \n1141\t#ifdef SHADOWPCF0\n1142\t#if defined(SHADOWCUBE0)\n1143\tshadow_eq_computeShadowWithPCFCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.y_co_shadowsInfo0.x_co_depthValues0)_sm_\n1144\t#else\n1145\tshadow_eq_computeShadowWithPCF(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.y_co_shadowsInfo0.x_co_shadowsInfo0.w)_sm_\n1146\t#endif\n1147\t#else\n1148\t#if defined(SHADOWCUBE0)\n1149\tshadow_eq_computeShadowCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_depthValues0)_sm_\n1150\t#else\n1151\tshadow_eq_computeShadow(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.w)_sm_\n1152\t#endif\n1153\t#endif\n1154\t#endif\n1155\t#endif\n1156\t#ifdef SHADOWONLY\n1157\t#ifndef SHADOWINUSE\n1158\t#define SHADOWINUSE\n1159\t#endif\n1160\tglobalShadow+_eq_shadow_sm_\n1161\tshadowLightCount+_eq_1.0_sm_\n1162\t#endif\n1163\t#else\n1164\tshadow_eq_1._sm_\n1165\t#endif\n1166\t#ifndef SHADOWONLY\n1167\t#ifdef CUSTOMUSERLIGHTING\n1168\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1169\t#ifdef SPECULARTERM\n1170\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1171\t#endif\n1172\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED0)\n1173\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1174\t#ifdef SPECULARTERM\n1175\t#ifndef LIGHTMAPNOSPECULAR0\n1176\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1177\t#endif\n1178\t#endif\n1179\t#else\n1180\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1181\t#ifdef SPECULARTERM\n1182\tspecularBase+_eq_info.specular*shadow_sm_\n1183\t#endif\n1184\t#endif\n1185\t#endif\n1186\t#endif\n1187\t#ifdef LIGHT1\n1188\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED1) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR1))\n1189\t\n1190\t#else\n1191\t#ifdef PBR\n1192\t#ifdef SPOTLIGHT1\n1193\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDirection1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1194\t#endif\n1195\t#ifdef HEMILIGHT1\n1196\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightGround1_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1197\t#endif\n1198\t#if defined(POINTLIGHT1) || defined(DIRLIGHT1)\n1199\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1200\t#endif\n1201\t#else\n1202\t#ifdef SPOTLIGHT1\n1203\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDirection1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_glossiness)_sm_\n1204\t#endif\n1205\t#ifdef HEMILIGHT1\n1206\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightGround1_co_glossiness)_sm_\n1207\t#endif\n1208\t#if defined(POINTLIGHT1) || defined(DIRLIGHT1)\n1209\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_glossiness)_sm_\n1210\t#endif\n1211\t#endif\n1212\t#ifdef PROJECTEDLIGHTTEXTURE1\n1213\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler1_co_textureProjectionMatrix1)_sm_\n1214\t#endif\n1215\t#endif\n1216\t#ifdef SHADOW1\n1217\t#ifdef SHADOWCLOSEESM1\n1218\t#if defined(SHADOWCUBE1)\n1219\tshadow_eq_computeShadowWithCloseESMCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_depthValues1)_sm_\n1220\t#else\n1221\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_shadowsInfo1.w)_sm_\n1222\t#endif\n1223\t#else\n1224\t#ifdef SHADOWESM1\n1225\t#if defined(SHADOWCUBE1)\n1226\tshadow_eq_computeShadowWithESMCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_depthValues1)_sm_\n1227\t#else\n1228\tshadow_eq_computeShadowWithESM(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_shadowsInfo1.w)_sm_\n1229\t#endif\n1230\t#else \n1231\t#ifdef SHADOWPCF1\n1232\t#if defined(SHADOWCUBE1)\n1233\tshadow_eq_computeShadowWithPCFCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.y_co_shadowsInfo1.x_co_depthValues1)_sm_\n1234\t#else\n1235\tshadow_eq_computeShadowWithPCF(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.y_co_shadowsInfo1.x_co_shadowsInfo1.w)_sm_\n1236\t#endif\n1237\t#else\n1238\t#if defined(SHADOWCUBE1)\n1239\tshadow_eq_computeShadowCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_depthValues1)_sm_\n1240\t#else\n1241\tshadow_eq_computeShadow(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.w)_sm_\n1242\t#endif\n1243\t#endif\n1244\t#endif\n1245\t#endif\n1246\t#ifdef SHADOWONLY\n1247\t#ifndef SHADOWINUSE\n1248\t#define SHADOWINUSE\n1249\t#endif\n1250\tglobalShadow+_eq_shadow_sm_\n1251\tshadowLightCount+_eq_1.0_sm_\n1252\t#endif\n1253\t#else\n1254\tshadow_eq_1._sm_\n1255\t#endif\n1256\t#ifndef SHADOWONLY\n1257\t#ifdef CUSTOMUSERLIGHTING\n1258\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1259\t#ifdef SPECULARTERM\n1260\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1261\t#endif\n1262\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED1)\n1263\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1264\t#ifdef SPECULARTERM\n1265\t#ifndef LIGHTMAPNOSPECULAR1\n1266\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1267\t#endif\n1268\t#endif\n1269\t#else\n1270\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1271\t#ifdef SPECULARTERM\n1272\tspecularBase+_eq_info.specular*shadow_sm_\n1273\t#endif\n1274\t#endif\n1275\t#endif\n1276\t#endif\n1277\t#ifdef LIGHT2\n1278\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED2) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR2))\n1279\t\n1280\t#else\n1281\t#ifdef PBR\n1282\t#ifdef SPOTLIGHT2\n1283\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDirection2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1284\t#endif\n1285\t#ifdef HEMILIGHT2\n1286\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightGround2_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1287\t#endif\n1288\t#if defined(POINTLIGHT2) || defined(DIRLIGHT2)\n1289\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1290\t#endif\n1291\t#else\n1292\t#ifdef SPOTLIGHT2\n1293\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDirection2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_glossiness)_sm_\n1294\t#endif\n1295\t#ifdef HEMILIGHT2\n1296\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightGround2_co_glossiness)_sm_\n1297\t#endif\n1298\t#if defined(POINTLIGHT2) || defined(DIRLIGHT2)\n1299\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_glossiness)_sm_\n1300\t#endif\n1301\t#endif\n1302\t#ifdef PROJECTEDLIGHTTEXTURE2\n1303\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler2_co_textureProjectionMatrix2)_sm_\n1304\t#endif\n1305\t#endif\n1306\t#ifdef SHADOW2\n1307\t#ifdef SHADOWCLOSEESM2\n1308\t#if defined(SHADOWCUBE2)\n1309\tshadow_eq_computeShadowWithCloseESMCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_depthValues2)_sm_\n1310\t#else\n1311\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_shadowsInfo2.w)_sm_\n1312\t#endif\n1313\t#else\n1314\t#ifdef SHADOWESM2\n1315\t#if defined(SHADOWCUBE2)\n1316\tshadow_eq_computeShadowWithESMCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_depthValues2)_sm_\n1317\t#else\n1318\tshadow_eq_computeShadowWithESM(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_shadowsInfo2.w)_sm_\n1319\t#endif\n1320\t#else \n1321\t#ifdef SHADOWPCF2\n1322\t#if defined(SHADOWCUBE2)\n1323\tshadow_eq_computeShadowWithPCFCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.y_co_shadowsInfo2.x_co_depthValues2)_sm_\n1324\t#else\n1325\tshadow_eq_computeShadowWithPCF(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.y_co_shadowsInfo2.x_co_shadowsInfo2.w)_sm_\n1326\t#endif\n1327\t#else\n1328\t#if defined(SHADOWCUBE2)\n1329\tshadow_eq_computeShadowCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_depthValues2)_sm_\n1330\t#else\n1331\tshadow_eq_computeShadow(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.w)_sm_\n1332\t#endif\n1333\t#endif\n1334\t#endif\n1335\t#endif\n1336\t#ifdef SHADOWONLY\n1337\t#ifndef SHADOWINUSE\n1338\t#define SHADOWINUSE\n1339\t#endif\n1340\tglobalShadow+_eq_shadow_sm_\n1341\tshadowLightCount+_eq_1.0_sm_\n1342\t#endif\n1343\t#else\n1344\tshadow_eq_1._sm_\n1345\t#endif\n1346\t#ifndef SHADOWONLY\n1347\t#ifdef CUSTOMUSERLIGHTING\n1348\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1349\t#ifdef SPECULARTERM\n1350\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1351\t#endif\n1352\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED2)\n1353\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1354\t#ifdef SPECULARTERM\n1355\t#ifndef LIGHTMAPNOSPECULAR2\n1356\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1357\t#endif\n1358\t#endif\n1359\t#else\n1360\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1361\t#ifdef SPECULARTERM\n1362\tspecularBase+_eq_info.specular*shadow_sm_\n1363\t#endif\n1364\t#endif\n1365\t#endif\n1366\t#endif\n1367\t#ifdef LIGHT3\n1368\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED3) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR3))\n1369\t\n1370\t#else\n1371\t#ifdef PBR\n1372\t#ifdef SPOTLIGHT3\n1373\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDirection3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1374\t#endif\n1375\t#ifdef HEMILIGHT3\n1376\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightGround3_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1377\t#endif\n1378\t#if defined(POINTLIGHT3) || defined(DIRLIGHT3)\n1379\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1380\t#endif\n1381\t#else\n1382\t#ifdef SPOTLIGHT3\n1383\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDirection3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_glossiness)_sm_\n1384\t#endif\n1385\t#ifdef HEMILIGHT3\n1386\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightGround3_co_glossiness)_sm_\n1387\t#endif\n1388\t#if defined(POINTLIGHT3) || defined(DIRLIGHT3)\n1389\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_glossiness)_sm_\n1390\t#endif\n1391\t#endif\n1392\t#ifdef PROJECTEDLIGHTTEXTURE3\n1393\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler3_co_textureProjectionMatrix3)_sm_\n1394\t#endif\n1395\t#endif\n1396\t#ifdef SHADOW3\n1397\t#ifdef SHADOWCLOSEESM3\n1398\t#if defined(SHADOWCUBE3)\n1399\tshadow_eq_computeShadowWithCloseESMCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_depthValues3)_sm_\n1400\t#else\n1401\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_shadowsInfo3.w)_sm_\n1402\t#endif\n1403\t#else\n1404\t#ifdef SHADOWESM3\n1405\t#if defined(SHADOWCUBE3)\n1406\tshadow_eq_computeShadowWithESMCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_depthValues3)_sm_\n1407\t#else\n1408\tshadow_eq_computeShadowWithESM(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_shadowsInfo3.w)_sm_\n1409\t#endif\n1410\t#else \n1411\t#ifdef SHADOWPCF3\n1412\t#if defined(SHADOWCUBE3)\n1413\tshadow_eq_computeShadowWithPCFCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.y_co_shadowsInfo3.x_co_depthValues3)_sm_\n1414\t#else\n1415\tshadow_eq_computeShadowWithPCF(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.y_co_shadowsInfo3.x_co_shadowsInfo3.w)_sm_\n1416\t#endif\n1417\t#else\n1418\t#if defined(SHADOWCUBE3)\n1419\tshadow_eq_computeShadowCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_depthValues3)_sm_\n1420\t#else\n1421\tshadow_eq_computeShadow(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.w)_sm_\n1422\t#endif\n1423\t#endif\n1424\t#endif\n1425\t#endif\n1426\t#ifdef SHADOWONLY\n1427\t#ifndef SHADOWINUSE\n1428\t#define SHADOWINUSE\n1429\t#endif\n1430\tglobalShadow+_eq_shadow_sm_\n1431\tshadowLightCount+_eq_1.0_sm_\n1432\t#endif\n1433\t#else\n1434\tshadow_eq_1._sm_\n1435\t#endif\n1436\t#ifndef SHADOWONLY\n1437\t#ifdef CUSTOMUSERLIGHTING\n1438\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1439\t#ifdef SPECULARTERM\n1440\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1441\t#endif\n1442\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED3)\n1443\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1444\t#ifdef SPECULARTERM\n1445\t#ifndef LIGHTMAPNOSPECULAR3\n1446\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1447\t#endif\n1448\t#endif\n1449\t#else\n1450\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1451\t#ifdef SPECULARTERM\n1452\tspecularBase+_eq_info.specular*shadow_sm_\n1453\t#endif\n1454\t#endif\n1455\t#endif\n1456\t#endif\n1457\t\n1458\t\n1459\tvec3 refractionColor_eq_vec3(0._co_0._co_0.)_sm_\n1460\t#ifdef REFRACTION\n1461\tvec3 refractionVector_eq_normalize(refract(-viewDirectionW_co_normalW_co_vRefractionInfos.y))_sm_\n1462\t#ifdef REFRACTIONMAP_3D\n1463\trefractionVector.y_eq_refractionVector.y*vRefractionInfos.w_sm_\n1464\tif (dot(refractionVector_co_viewDirectionW)&lt_sm_1.0)\n1465\t{\n1466\trefractionColor_eq_textureCube(refractionCubeSampler_co_refractionVector).rgb*vRefractionInfos.x_sm_\n1467\t}\n1468\t#else\n1469\tvec3 vRefractionUVW_eq_vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z_co_1.0)))_sm_\n1470\tvec2 refractionCoords_eq_vRefractionUVW.xy/vRefractionUVW.z_sm_\n1471\trefractionCoords.y_eq_1.0-refractionCoords.y_sm_\n1472\trefractionColor_eq_texture2D(refraction2DSampler_co_refractionCoords).rgb*vRefractionInfos.x_sm_\n1473\t#endif\n1474\t#endif\n1475\t\n1476\tvec3 reflectionColor_eq_vec3(0._co_0._co_0.)_sm_\n1477\t#ifdef REFLECTION\n1478\tvec3 vReflectionUVW_eq_computeReflectionCoords(vec4(vPositionW_co_1.0)_co_normalW)_sm_\n1479\t#ifdef REFLECTIONMAP_3D\n1480\t#ifdef ROUGHNESS\n1481\tfloat bias_eq_vReflectionInfos.y_sm_\n1482\t#ifdef SPECULARTERM\n1483\t#ifdef SPECULAR\n1484\t#ifdef GLOSSINESS\n1485\tbias*_eq_(1.0-specularMapColor.a)_sm_\n1486\t#endif\n1487\t#endif\n1488\t#endif\n1489\treflectionColor_eq_textureCube(reflectionCubeSampler_co_vReflectionUVW_co_bias).rgb*vReflectionInfos.x_sm_\n1490\t#else\n1491\treflectionColor_eq_textureCube(reflectionCubeSampler_co_vReflectionUVW).rgb*vReflectionInfos.x_sm_\n1492\t#endif\n1493\t#else\n1494\tvec2 coords_eq_vReflectionUVW.xy_sm_\n1495\t#ifdef REFLECTIONMAP_PROJECTION\n1496\tcoords/_eq_vReflectionUVW.z_sm_\n1497\t#endif\n1498\tcoords.y_eq_1.0-coords.y_sm_\n1499\treflectionColor_eq_texture2D(reflection2DSampler_co_coords).rgb*vReflectionInfos.x_sm_\n1500\t#endif\n1501\t#ifdef REFLECTIONFRESNEL\n1502\tfloat reflectionFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_reflectionRightColor.a_co_reflectionLeftColor.a)_sm_\n1503\t#ifdef REFLECTIONFRESNELFROMSPECULAR\n1504\t#ifdef SPECULARTERM\n1505\treflectionColor*_eq_specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1506\t#else\n1507\treflectionColor*_eq_reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1508\t#endif\n1509\t#else\n1510\treflectionColor*_eq_reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1511\t#endif\n1512\t#endif\n1513\t#endif\n1514\t#ifdef REFRACTIONFRESNEL\n1515\tfloat refractionFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_refractionRightColor.a_co_refractionLeftColor.a)_sm_\n1516\trefractionColor*_eq_refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb_sm_\n1517\t#endif\n1518\t#ifdef OPACITY\n1519\tvec4 opacityMap_eq_texture2D(opacitySampler_co_vOpacityUV+uvOffset)_sm_\n1520\t#ifdef OPACITYRGB\n1521\topacityMap.rgb_eq_opacityMap.rgb*vec3(0.3_co_0.59_co_0.11)_sm_\n1522\talpha*_eq_(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y_sm_\n1523\t#else\n1524\talpha*_eq_opacityMap.a*vOpacityInfos.y_sm_\n1525\t#endif\n1526\t#endif\n1527\t#ifdef VERTEXALPHA\n1528\talpha*_eq_vColor.a_sm_\n1529\t#endif\n1530\t#ifdef OPACITYFRESNEL\n1531\tfloat opacityFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_opacityParts.z_co_opacityParts.w)_sm_\n1532\talpha+_eq_opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y_sm_\n1533\t#endif\n1534\t\n1535\tvec3 emissiveColor_eq_vEmissiveColor_sm_\n1536\t#ifdef EMISSIVE\n1537\temissiveColor+_eq_texture2D(emissiveSampler_co_vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y_sm_\n1538\t#endif\n1539\t#ifdef EMISSIVEFRESNEL\n1540\tfloat emissiveFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_emissiveRightColor.a_co_emissiveLeftColor.a)_sm_\n1541\temissiveColor*_eq_emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb_sm_\n1542\t#endif\n1543\t\n1544\t#ifdef DIFFUSEFRESNEL\n1545\tfloat diffuseFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_diffuseRightColor.a_co_diffuseLeftColor.a)_sm_\n1546\tdiffuseBase*_eq_diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb_sm_\n1547\t#endif\n1548\t\n1549\t#ifdef EMISSIVEASILLUMINATION\n1550\tvec3 finalDiffuse_eq_clamp(diffuseBase*diffuseColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1551\t#else\n1552\t#ifdef LINKEMISSIVEWITHDIFFUSE\n1553\tvec3 finalDiffuse_eq_clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1554\t#else\n1555\tvec3 finalDiffuse_eq_clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1556\t#endif\n1557\t#endif\n1558\t#ifdef SPECULARTERM\n1559\tvec3 finalSpecular_eq_specularBase*specularColor_sm_\n1560\t#ifdef SPECULAROVERALPHA\n1561\talpha_eq_clamp(alpha+dot(finalSpecular_co_vec3(0.3_co_0.59_co_0.11))_co_0._co_1.)_sm_\n1562\t#endif\n1563\t#else\n1564\tvec3 finalSpecular_eq_vec3(0.0)_sm_\n1565\t#endif\n1566\t#ifdef REFLECTIONOVERALPHA\n1567\talpha_eq_clamp(alpha+dot(reflectionColor_co_vec3(0.3_co_0.59_co_0.11))_co_0._co_1.)_sm_\n1568\t#endif\n1569\t\n1570\t#ifdef EMISSIVEASILLUMINATION\n1571\tvec4 color_eq_vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor_co_0.0_co_1.0)_co_alpha)_sm_\n1572\t#else\n1573\tvec4 color_eq_vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor_co_alpha)_sm_\n1574\t#endif\n1575\t\n1576\t#ifdef LIGHTMAP\n1577\t#ifndef LIGHTMAPEXCLUDED\n1578\t#ifdef USELIGHTMAPASSHADOWMAP\n1579\tcolor.rgb*_eq_lightmapColor_sm_\n1580\t#else\n1581\tcolor.rgb+_eq_lightmapColor_sm_\n1582\t#endif\n1583\t#endif\n1584\t#endif\n1585\t#define CUSTOM_FRAGMENT_BEFORE_FOG\n1586\tcolor.rgb_eq_max(color.rgb_co_0.)_sm_\n1587\t#ifdef LOGARITHMICDEPTH\n1588\tgl_FragDepthEXT_eq_log2(vFragmentDepth)*logarithmicDepthConstant*0.5_sm_\n1589\t#endif\n1590\t#ifdef FOG\n1591\tfloat fog_eq_CalcFogFactor()_sm_\n1592\tcolor.rgb_eq_fog*color.rgb+(1.0-fog)*vFogColor_sm_\n1593\t#endif\n1594\t\n1595\t\n1596\t#ifdef IMAGEPROCESSINGPOSTPROCESS\n1597\tcolor.rgb_eq_toLinearSpace(color.rgb)_sm_\n1598\t#else\n1599\t#ifdef IMAGEPROCESSING\n1600\tcolor.rgb_eq_toLinearSpace(color.rgb)_sm_\n1601\tcolor_eq_applyImageProcessing(color)_sm_\n1602\t#endif\n1603\t#endif\n1604\t#ifdef PREMULTIPLYALPHA\n1605\t\n1606\tcolor.rgb*_eq_color.a_sm_\n1607\t#endif\n1608\t#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n1609\tgl_FragColor_eq_color_sm_\n1610\t}\n1611\t\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_dumpShadersSource (babylon.js_dd_1_dd_6765)\n\t_prepareEffect (babylon.js_dd_1_dd_11195)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Error_dd_ ERROR_dd_ too many uniforms\n\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11260)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Trying next fallback.\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11469)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] WebGL_dd_ ERROR_dd_ too many uniforms\n\tcompileShader\n\ti (babylon.js_dd_4_dd_31855)\n\tt (babylon.js_dd_4_dd_31705)\n\tcreateShaderProgram (babylon.js_dd_6_dd_18019)\n\t_prepareEffect (babylon.js_dd_1_dd_10164)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Unable to compile effect_dd_\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_10998)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Uniforms_dd_  world_co_ view_co_ viewProjection_co_ vEyePosition_co_ vLightsType_co_ vAmbientColor_co_ vDiffuseColor_co_ vSpecularColor_co_ vEmissiveColor_co_ vFogInfos_co_ vFogColor_co_ pointSize_co_ vDiffuseInfos_co_ vAmbientInfos_co_ vOpacityInfos_co_ vReflectionInfos_co_ vEmissiveInfos_co_ vSpecularInfos_co_ vBumpInfos_co_ vLightmapInfos_co_ vRefractionInfos_co_ mBones_co_ vClipPlane_co_ diffuseMatrix_co_ ambientMatrix_co_ opacityMatrix_co_ reflectionMatrix_co_ emissiveMatrix_co_ specularMatrix_co_ bumpMatrix_co_ normalMatrix_co_ lightmapMatrix_co_ refractionMatrix_co_ diffuseLeftColor_co_ diffuseRightColor_co_ opacityParts_co_ reflectionLeftColor_co_ reflectionRightColor_co_ emissiveLeftColor_co_ emissiveRightColor_co_ refractionLeftColor_co_ refractionRightColor_co_ vReflectionPosition_co_ vReflectionSize_co_ logarithmicDepthConstant_co_ vTangentSpaceParams_co_ vLightData0_co_ vLightDiffuse0_co_ vLightSpecular0_co_ vLightDirection0_co_ vLightGround0_co_ lightMatrix0_co_ shadowsInfo0_co_ depthValues0_co_ diffuseSampler_co_ ambientSampler_co_ opacitySampler_co_ reflectionCubeSampler_co_ reflection2DSampler_co_ emissiveSampler_co_ specularSampler_co_ bumpSampler_co_ lightmapSampler_co_ refractionCubeSampler_co_ refraction2DSampler_co_ shadowSampler0\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11041)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Attributes_dd_  position_co_ normal_co_ matricesIndices_co_ matricesWeights_co_ matricesIndicesExtra_co_ matricesWeightsExtra\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11121)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Vertex shader_dd_ default\n1\t#define DIFFUSEDIRECTUV 0\n2\t#define AMBIENTDIRECTUV 0\n3\t#define OPACITYDIRECTUV 0\n4\t#define EMISSIVEDIRECTUV 0\n5\t#define SPECULARDIRECTUV 0\n6\t#define BUMPDIRECTUV 0\n7\t#define SPECULARTERM\n8\t#define NORMAL\n9\t#define NUM_BONE_INFLUENCERS 8\n10\t#define BonesPerMesh 33\n11\t#define LIGHTMAPDIRECTUV 0\n12\t#define NUM_MORPH_INFLUENCERS 0\n13\t#define VIGNETTEBLENDMODEMULTIPLY\n14\t#define SAMPLER3DGREENDEPTH\n15\t#define SAMPLER3DBGRMAP\n16\t#define LIGHT0\n17\t#define POINTLIGHT0\n18\t\n19\t#define SHADER_NAME vertex_dd_default\n20\tprecision highp float_sm_\n21\t\n22\tuniform mat4 viewProjection_sm_\n23\tuniform mat4 view_sm_\n24\t#ifdef DIFFUSE\n25\tuniform mat4 diffuseMatrix_sm_\n26\tuniform vec2 vDiffuseInfos_sm_\n27\t#endif\n28\t#ifdef AMBIENT\n29\tuniform mat4 ambientMatrix_sm_\n30\tuniform vec2 vAmbientInfos_sm_\n31\t#endif\n32\t#ifdef OPACITY\n33\tuniform mat4 opacityMatrix_sm_\n34\tuniform vec2 vOpacityInfos_sm_\n35\t#endif\n36\t#ifdef EMISSIVE\n37\tuniform vec2 vEmissiveInfos_sm_\n38\tuniform mat4 emissiveMatrix_sm_\n39\t#endif\n40\t#ifdef LIGHTMAP\n41\tuniform vec2 vLightmapInfos_sm_\n42\tuniform mat4 lightmapMatrix_sm_\n43\t#endif\n44\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n45\tuniform vec2 vSpecularInfos_sm_\n46\tuniform mat4 specularMatrix_sm_\n47\t#endif\n48\t#ifdef BUMP\n49\tuniform vec3 vBumpInfos_sm_\n50\tuniform mat4 bumpMatrix_sm_\n51\t#endif\n52\t#ifdef POINTSIZE\n53\tuniform float pointSize_sm_\n54\t#endif\n55\t\n56\t\n57\t#define CUSTOM_VERTEX_BEGIN\n58\tattribute vec3 position_sm_\n59\t#ifdef NORMAL\n60\tattribute vec3 normal_sm_\n61\t#endif\n62\t#ifdef TANGENT\n63\tattribute vec4 tangent_sm_\n64\t#endif\n65\t#ifdef UV1\n66\tattribute vec2 uv_sm_\n67\t#endif\n68\t#ifdef UV2\n69\tattribute vec2 uv2_sm_\n70\t#endif\n71\t#ifdef VERTEXCOLOR\n72\tattribute vec4 color_sm_\n73\t#endif\n74\tconst float PI_eq_3.1415926535897932384626433832795_sm_\n75\tconst float LinearEncodePowerApprox_eq_2.2_sm_\n76\tconst float GammaEncodePowerApprox_eq_1.0/LinearEncodePowerApprox_sm_\n77\tconst vec3 LuminanceEncodeApprox_eq_vec3(0.2126_co_0.7152_co_0.0722)_sm_\n78\tmat3 transposeMat3(mat3 inMatrix) {\n79\tvec3 i0_eq_inMatrix[0]_sm_\n80\tvec3 i1_eq_inMatrix[1]_sm_\n81\tvec3 i2_eq_inMatrix[2]_sm_\n82\tmat3 outMatrix_eq_mat3(\n83\tvec3(i0.x_co_i1.x_co_i2.x)_co_\n84\tvec3(i0.y_co_i1.y_co_i2.y)_co_\n85\tvec3(i0.z_co_i1.z_co_i2.z)\n86\t)_sm_\n87\treturn outMatrix_sm_\n88\t}\n89\t\n90\tmat3 inverseMat3(mat3 inMatrix) {\n91\tfloat a00_eq_inMatrix[0][0]_co_a01_eq_inMatrix[0][1]_co_a02_eq_inMatrix[0][2]_sm_\n92\tfloat a10_eq_inMatrix[1][0]_co_a11_eq_inMatrix[1][1]_co_a12_eq_inMatrix[1][2]_sm_\n93\tfloat a20_eq_inMatrix[2][0]_co_a21_eq_inMatrix[2][1]_co_a22_eq_inMatrix[2][2]_sm_\n94\tfloat b01_eq_a22*a11-a12*a21_sm_\n95\tfloat b11_eq_-a22*a10+a12*a20_sm_\n96\tfloat b21_eq_a21*a10-a11*a20_sm_\n97\tfloat det_eq_a00*b01+a01*b11+a02*b21_sm_\n98\treturn mat3(b01_co_(-a22*a01+a02*a21)_co_(a12*a01-a02*a11)_co_\n99\tb11_co_(a22*a00-a02*a20)_co_(-a12*a00+a02*a10)_co_\n100\tb21_co_(-a21*a00+a01*a20)_co_(a11*a00-a01*a10))/det_sm_\n101\t}\n102\tfloat computeFallOff(float value_co_vec2 clipSpace_co_float frustumEdgeFalloff)\n103\t{\n104\tfloat mask_eq_smoothstep(1.0-frustumEdgeFalloff_co_1.0_co_clamp(dot(clipSpace_co_clipSpace)_co_0._co_1.))_sm_\n105\treturn mix(value_co_1.0_co_mask)_sm_\n106\t}\n107\tvec3 applyEaseInOut(vec3 x){\n108\treturn x*x*(3.0-2.0*x)_sm_\n109\t}\n110\tvec3 toLinearSpace(vec3 color)\n111\t{\n112\treturn pow(color_co_vec3(LinearEncodePowerApprox))_sm_\n113\t}\n114\tvec3 toGammaSpace(vec3 color)\n115\t{\n116\treturn pow(color_co_vec3(GammaEncodePowerApprox))_sm_\n117\t}\n118\tfloat square(float value)\n119\t{\n120\treturn value*value_sm_\n121\t}\n122\tfloat getLuminance(vec3 color)\n123\t{\n124\treturn clamp(dot(color_co_LuminanceEncodeApprox)_co_0._co_1.)_sm_\n125\t}\n126\t\n127\tfloat getRand(vec2 seed) {\n128\treturn fract(sin(dot(seed.xy _co_vec2(12.9898_co_78.233)))*43758.5453)_sm_\n129\t}\n130\tvec3 dither(vec2 seed_co_vec3 color) {\n131\tfloat rand_eq_getRand(seed)_sm_\n132\tcolor+_eq_mix(-0.5/255.0_co_0.5/255.0_co_rand)_sm_\n133\tcolor_eq_max(color_co_0.0)_sm_\n134\treturn color_sm_\n135\t}\n136\t#if NUM_BONE_INFLUENCERS&gt_sm_0\n137\tuniform mat4 mBones[BonesPerMesh]_sm_\n138\tattribute vec4 matricesIndices_sm_\n139\tattribute vec4 matricesWeights_sm_\n140\t#if NUM_BONE_INFLUENCERS&gt_sm_4\n141\tattribute vec4 matricesIndicesExtra_sm_\n142\tattribute vec4 matricesWeightsExtra_sm_\n143\t#endif\n144\t#endif\n145\t\n146\t#ifdef INSTANCES\n147\tattribute vec4 world0_sm_\n148\tattribute vec4 world1_sm_\n149\tattribute vec4 world2_sm_\n150\tattribute vec4 world3_sm_\n151\t#else\n152\tuniform mat4 world_sm_\n153\t#endif\n154\t#ifdef MAINUV1\n155\tvarying vec2 vMainUV1_sm_\n156\t#endif\n157\t#ifdef MAINUV2\n158\tvarying vec2 vMainUV2_sm_\n159\t#endif\n160\t#if defined(DIFFUSE) &amp_sm_&amp_sm_ DIFFUSEDIRECTUV _eq__eq_ 0\n161\tvarying vec2 vDiffuseUV_sm_\n162\t#endif\n163\t#if defined(AMBIENT) &amp_sm_&amp_sm_ AMBIENTDIRECTUV _eq__eq_ 0\n164\tvarying vec2 vAmbientUV_sm_\n165\t#endif\n166\t#if defined(OPACITY) &amp_sm_&amp_sm_ OPACITYDIRECTUV _eq__eq_ 0\n167\tvarying vec2 vOpacityUV_sm_\n168\t#endif\n169\t#if defined(EMISSIVE) &amp_sm_&amp_sm_ EMISSIVEDIRECTUV _eq__eq_ 0\n170\tvarying vec2 vEmissiveUV_sm_\n171\t#endif\n172\t#if defined(LIGHTMAP) &amp_sm_&amp_sm_ LIGHTMAPDIRECTUV _eq__eq_ 0\n173\tvarying vec2 vLightmapUV_sm_\n174\t#endif\n175\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM) &amp_sm_&amp_sm_ SPECULARDIRECTUV _eq__eq_ 0\n176\tvarying vec2 vSpecularUV_sm_\n177\t#endif\n178\t#if defined(BUMP) &amp_sm_&amp_sm_ BUMPDIRECTUV _eq__eq_ 0\n179\tvarying vec2 vBumpUV_sm_\n180\t#endif\n181\t\n182\tvarying vec3 vPositionW_sm_\n183\t#ifdef NORMAL\n184\tvarying vec3 vNormalW_sm_\n185\t#endif\n186\t#ifdef VERTEXCOLOR\n187\tvarying vec4 vColor_sm_\n188\t#endif\n189\t#if defined(BUMP) || defined(PARALLAX)\n190\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL) \n191\tvarying mat3 vTBN_sm_\n192\t#endif\n193\t#endif\n194\t\n195\t#ifdef CLIPPLANE\n196\tuniform vec4 vClipPlane_sm_\n197\tvarying float fClipDistance_sm_\n198\t#endif\n199\t#ifdef FOG\n200\tvarying vec3 vFogDistance_sm_\n201\t#endif\n202\t#ifdef LIGHT0\n203\tuniform vec4 vLightData0_sm_\n204\tuniform vec4 vLightDiffuse0_sm_\n205\t#ifdef SPECULARTERM\n206\tuniform vec3 vLightSpecular0_sm_\n207\t#else\n208\tvec3 vLightSpecular0_eq_vec3(0.)_sm_\n209\t#endif\n210\t#ifdef SHADOW0\n211\t#if defined(SHADOWCUBE0)\n212\tuniform samplerCube shadowSampler0_sm_\n213\t#else\n214\tvarying vec4 vPositionFromLight0_sm_\n215\tvarying float vDepthMetric0_sm_\n216\tuniform sampler2D shadowSampler0_sm_\n217\tuniform mat4 lightMatrix0_sm_\n218\t#endif\n219\tuniform vec4 shadowsInfo0_sm_\n220\tuniform vec2 depthValues0_sm_\n221\t#endif\n222\t#ifdef SPOTLIGHT0\n223\tuniform vec4 vLightDirection0_sm_\n224\t#endif\n225\t#ifdef HEMILIGHT0\n226\tuniform vec3 vLightGround0_sm_\n227\t#endif\n228\t#ifdef PROJECTEDLIGHTTEXTURE0\n229\tuniform mat4 textureProjectionMatrix0_sm_\n230\tuniform sampler2D projectionLightSampler0_sm_\n231\t#endif\n232\t#endif\n233\t#ifdef LIGHT1\n234\tuniform vec4 vLightData1_sm_\n235\tuniform vec4 vLightDiffuse1_sm_\n236\t#ifdef SPECULARTERM\n237\tuniform vec3 vLightSpecular1_sm_\n238\t#else\n239\tvec3 vLightSpecular1_eq_vec3(0.)_sm_\n240\t#endif\n241\t#ifdef SHADOW1\n242\t#if defined(SHADOWCUBE1)\n243\tuniform samplerCube shadowSampler1_sm_\n244\t#else\n245\tvarying vec4 vPositionFromLight1_sm_\n246\tvarying float vDepthMetric1_sm_\n247\tuniform sampler2D shadowSampler1_sm_\n248\tuniform mat4 lightMatrix1_sm_\n249\t#endif\n250\tuniform vec4 shadowsInfo1_sm_\n251\tuniform vec2 depthValues1_sm_\n252\t#endif\n253\t#ifdef SPOTLIGHT1\n254\tuniform vec4 vLightDirection1_sm_\n255\t#endif\n256\t#ifdef HEMILIGHT1\n257\tuniform vec3 vLightGround1_sm_\n258\t#endif\n259\t#ifdef PROJECTEDLIGHTTEXTURE1\n260\tuniform mat4 textureProjectionMatrix1_sm_\n261\tuniform sampler2D projectionLightSampler1_sm_\n262\t#endif\n263\t#endif\n264\t#ifdef LIGHT2\n265\tuniform vec4 vLightData2_sm_\n266\tuniform vec4 vLightDiffuse2_sm_\n267\t#ifdef SPECULARTERM\n268\tuniform vec3 vLightSpecular2_sm_\n269\t#else\n270\tvec3 vLightSpecular2_eq_vec3(0.)_sm_\n271\t#endif\n272\t#ifdef SHADOW2\n273\t#if defined(SHADOWCUBE2)\n274\tuniform samplerCube shadowSampler2_sm_\n275\t#else\n276\tvarying vec4 vPositionFromLight2_sm_\n277\tvarying float vDepthMetric2_sm_\n278\tuniform sampler2D shadowSampler2_sm_\n279\tuniform mat4 lightMatrix2_sm_\n280\t#endif\n281\tuniform vec4 shadowsInfo2_sm_\n282\tuniform vec2 depthValues2_sm_\n283\t#endif\n284\t#ifdef SPOTLIGHT2\n285\tuniform vec4 vLightDirection2_sm_\n286\t#endif\n287\t#ifdef HEMILIGHT2\n288\tuniform vec3 vLightGround2_sm_\n289\t#endif\n290\t#ifdef PROJECTEDLIGHTTEXTURE2\n291\tuniform mat4 textureProjectionMatrix2_sm_\n292\tuniform sampler2D projectionLightSampler2_sm_\n293\t#endif\n294\t#endif\n295\t#ifdef LIGHT3\n296\tuniform vec4 vLightData3_sm_\n297\tuniform vec4 vLightDiffuse3_sm_\n298\t#ifdef SPECULARTERM\n299\tuniform vec3 vLightSpecular3_sm_\n300\t#else\n301\tvec3 vLightSpecular3_eq_vec3(0.)_sm_\n302\t#endif\n303\t#ifdef SHADOW3\n304\t#if defined(SHADOWCUBE3)\n305\tuniform samplerCube shadowSampler3_sm_\n306\t#else\n307\tvarying vec4 vPositionFromLight3_sm_\n308\tvarying float vDepthMetric3_sm_\n309\tuniform sampler2D shadowSampler3_sm_\n310\tuniform mat4 lightMatrix3_sm_\n311\t#endif\n312\tuniform vec4 shadowsInfo3_sm_\n313\tuniform vec2 depthValues3_sm_\n314\t#endif\n315\t#ifdef SPOTLIGHT3\n316\tuniform vec4 vLightDirection3_sm_\n317\t#endif\n318\t#ifdef HEMILIGHT3\n319\tuniform vec3 vLightGround3_sm_\n320\t#endif\n321\t#ifdef PROJECTEDLIGHTTEXTURE3\n322\tuniform mat4 textureProjectionMatrix3_sm_\n323\tuniform sampler2D projectionLightSampler3_sm_\n324\t#endif\n325\t#endif\n326\t\n327\t#ifdef MORPHTARGETS\n328\tuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS]_sm_\n329\t#endif\n330\t\n331\t#ifdef REFLECTIONMAP_SKYBOX\n332\tvarying vec3 vPositionUVW_sm_\n333\t#endif\n334\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n335\tvarying vec3 vDirectionW_sm_\n336\t#endif\n337\t#ifdef LOGARITHMICDEPTH\n338\tuniform float logarithmicDepthConstant_sm_\n339\tvarying float vFragmentDepth_sm_\n340\t#endif\n341\t#define CUSTOM_VERTEX_DEFINITIONS\n342\tvoid main(void) {\n343\t#define CUSTOM_VERTEX_MAIN_BEGIN\n344\tvec3 positionUpdated_eq_position_sm_\n345\t#ifdef NORMAL \n346\tvec3 normalUpdated_eq_normal_sm_\n347\t#endif\n348\t#ifdef TANGENT\n349\tvec4 tangentUpdated_eq_tangent_sm_\n350\t#endif\n351\t\n352\t#ifdef REFLECTIONMAP_SKYBOX\n353\tvPositionUVW_eq_positionUpdated_sm_\n354\t#endif \n355\t#define CUSTOM_VERTEX_UPDATE_POSITION\n356\t#define CUSTOM_VERTEX_UPDATE_NORMAL\n357\t#ifdef INSTANCES\n358\tmat4 finalWorld_eq_mat4(world0_co_world1_co_world2_co_world3)_sm_\n359\t#else\n360\tmat4 finalWorld_eq_world_sm_\n361\t#endif\n362\t#if NUM_BONE_INFLUENCERS&gt_sm_0\n363\tmat4 influence_sm_\n364\tinfluence_eq_mBones[int(matricesIndices[0])]*matricesWeights[0]_sm_\n365\t#if NUM_BONE_INFLUENCERS&gt_sm_1\n366\tinfluence+_eq_mBones[int(matricesIndices[1])]*matricesWeights[1]_sm_\n367\t#endif \n368\t#if NUM_BONE_INFLUENCERS&gt_sm_2\n369\tinfluence+_eq_mBones[int(matricesIndices[2])]*matricesWeights[2]_sm_\n370\t#endif \n371\t#if NUM_BONE_INFLUENCERS&gt_sm_3\n372\tinfluence+_eq_mBones[int(matricesIndices[3])]*matricesWeights[3]_sm_\n373\t#endif \n374\t#if NUM_BONE_INFLUENCERS&gt_sm_4\n375\tinfluence+_eq_mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0]_sm_\n376\t#endif \n377\t#if NUM_BONE_INFLUENCERS&gt_sm_5\n378\tinfluence+_eq_mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1]_sm_\n379\t#endif \n380\t#if NUM_BONE_INFLUENCERS&gt_sm_6\n381\tinfluence+_eq_mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2]_sm_\n382\t#endif \n383\t#if NUM_BONE_INFLUENCERS&gt_sm_7\n384\tinfluence+_eq_mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3]_sm_\n385\t#endif \n386\tfinalWorld_eq_finalWorld*influence_sm_\n387\t#endif\n388\tgl_Position_eq_viewProjection*finalWorld*vec4(positionUpdated_co_1.0)_sm_\n389\tvec4 worldPos_eq_finalWorld*vec4(positionUpdated_co_1.0)_sm_\n390\tvPositionW_eq_vec3(worldPos)_sm_\n391\t#ifdef NORMAL\n392\tmat3 normalWorld_eq_mat3(finalWorld)_sm_\n393\t#ifdef NONUNIFORMSCALING\n394\tnormalWorld_eq_transposeMat3(inverseMat3(normalWorld))_sm_\n395\t#endif\n396\tvNormalW_eq_normalize(normalWorld*normalUpdated)_sm_\n397\t#endif\n398\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n399\tvDirectionW_eq_normalize(vec3(finalWorld*vec4(positionUpdated_co_0.0)))_sm_\n400\t#endif\n401\t\n402\t#ifndef UV1\n403\tvec2 uv_eq_vec2(0._co_0.)_sm_\n404\t#endif\n405\t#ifndef UV2\n406\tvec2 uv2_eq_vec2(0._co_0.)_sm_\n407\t#endif\n408\t#ifdef MAINUV1\n409\tvMainUV1_eq_uv_sm_\n410\t#endif\n411\t#ifdef MAINUV2\n412\tvMainUV2_eq_uv2_sm_\n413\t#endif\n414\t#if defined(DIFFUSE) &amp_sm_&amp_sm_ DIFFUSEDIRECTUV _eq__eq_ 0\n415\tif (vDiffuseInfos.x _eq__eq_ 0.)\n416\t{\n417\tvDiffuseUV_eq_vec2(diffuseMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n418\t}\n419\telse\n420\t{\n421\tvDiffuseUV_eq_vec2(diffuseMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n422\t}\n423\t#endif\n424\t#if defined(AMBIENT) &amp_sm_&amp_sm_ AMBIENTDIRECTUV _eq__eq_ 0\n425\tif (vAmbientInfos.x _eq__eq_ 0.)\n426\t{\n427\tvAmbientUV_eq_vec2(ambientMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n428\t}\n429\telse\n430\t{\n431\tvAmbientUV_eq_vec2(ambientMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n432\t}\n433\t#endif\n434\t#if defined(OPACITY) &amp_sm_&amp_sm_ OPACITYDIRECTUV _eq__eq_ 0\n435\tif (vOpacityInfos.x _eq__eq_ 0.)\n436\t{\n437\tvOpacityUV_eq_vec2(opacityMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n438\t}\n439\telse\n440\t{\n441\tvOpacityUV_eq_vec2(opacityMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n442\t}\n443\t#endif\n444\t#if defined(EMISSIVE) &amp_sm_&amp_sm_ EMISSIVEDIRECTUV _eq__eq_ 0\n445\tif (vEmissiveInfos.x _eq__eq_ 0.)\n446\t{\n447\tvEmissiveUV_eq_vec2(emissiveMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n448\t}\n449\telse\n450\t{\n451\tvEmissiveUV_eq_vec2(emissiveMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n452\t}\n453\t#endif\n454\t#if defined(LIGHTMAP) &amp_sm_&amp_sm_ LIGHTMAPDIRECTUV _eq__eq_ 0\n455\tif (vLightmapInfos.x _eq__eq_ 0.)\n456\t{\n457\tvLightmapUV_eq_vec2(lightmapMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n458\t}\n459\telse\n460\t{\n461\tvLightmapUV_eq_vec2(lightmapMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n462\t}\n463\t#endif\n464\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM) &amp_sm_&amp_sm_ SPECULARDIRECTUV _eq__eq_ 0\n465\tif (vSpecularInfos.x _eq__eq_ 0.)\n466\t{\n467\tvSpecularUV_eq_vec2(specularMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n468\t}\n469\telse\n470\t{\n471\tvSpecularUV_eq_vec2(specularMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n472\t}\n473\t#endif\n474\t#if defined(BUMP) &amp_sm_&amp_sm_ BUMPDIRECTUV _eq__eq_ 0\n475\tif (vBumpInfos.x _eq__eq_ 0.)\n476\t{\n477\tvBumpUV_eq_vec2(bumpMatrix*vec4(uv_co_1.0_co_0.0))_sm_\n478\t}\n479\telse\n480\t{\n481\tvBumpUV_eq_vec2(bumpMatrix*vec4(uv2_co_1.0_co_0.0))_sm_\n482\t}\n483\t#endif\n484\t#if defined(BUMP) || defined(PARALLAX)\n485\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL)\n486\tvec3 tbnNormal_eq_normalize(normalUpdated)_sm_\n487\tvec3 tbnTangent_eq_normalize(tangentUpdated.xyz)_sm_\n488\tvec3 tbnBitangent_eq_cross(tbnNormal_co_tbnTangent)*tangentUpdated.w_sm_\n489\tvTBN_eq_mat3(finalWorld)*mat3(tbnTangent_co_tbnBitangent_co_tbnNormal)_sm_\n490\t#endif\n491\t#endif\n492\t#ifdef CLIPPLANE\n493\tfClipDistance_eq_dot(worldPos_co_vClipPlane)_sm_\n494\t#endif\n495\t#ifdef FOG\n496\tvFogDistance_eq_(view*worldPos).xyz_sm_\n497\t#endif\n498\t#ifdef SHADOWS\n499\t#if defined(SHADOW0) &amp_sm_&amp_sm_ !defined(SHADOWCUBE0)\n500\tvPositionFromLight0_eq_lightMatrix0*worldPos_sm_\n501\tvDepthMetric0_eq_((vPositionFromLight0.z+depthValues0.x)/(depthValues0.y))_sm_\n502\t#endif\n503\t#endif\n504\t#ifdef SHADOWS\n505\t#if defined(SHADOW1) &amp_sm_&amp_sm_ !defined(SHADOWCUBE1)\n506\tvPositionFromLight1_eq_lightMatrix1*worldPos_sm_\n507\tvDepthMetric1_eq_((vPositionFromLight1.z+depthValues1.x)/(depthValues1.y))_sm_\n508\t#endif\n509\t#endif\n510\t#ifdef SHADOWS\n511\t#if defined(SHADOW2) &amp_sm_&amp_sm_ !defined(SHADOWCUBE2)\n512\tvPositionFromLight2_eq_lightMatrix2*worldPos_sm_\n513\tvDepthMetric2_eq_((vPositionFromLight2.z+depthValues2.x)/(depthValues2.y))_sm_\n514\t#endif\n515\t#endif\n516\t#ifdef SHADOWS\n517\t#if defined(SHADOW3) &amp_sm_&amp_sm_ !defined(SHADOWCUBE3)\n518\tvPositionFromLight3_eq_lightMatrix3*worldPos_sm_\n519\tvDepthMetric3_eq_((vPositionFromLight3.z+depthValues3.x)/(depthValues3.y))_sm_\n520\t#endif\n521\t#endif\n522\t\n523\t#ifdef VERTEXCOLOR\n524\t\n525\tvColor_eq_color_sm_\n526\t#endif\n527\t#ifdef POINTSIZE\n528\tgl_PointSize_eq_pointSize_sm_\n529\t#endif\n530\t#ifdef LOGARITHMICDEPTH\n531\tvFragmentDepth_eq_1.0+gl_Position.w_sm_\n532\tgl_Position.z_eq_log2(max(0.000001_co_vFragmentDepth))*logarithmicDepthConstant_sm_\n533\t#endif\n534\t#define CUSTOM_VERTEX_MAIN_END\n535\t}\n536\t\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_dumpShadersSource (babylon.js_dd_1_dd_6720)\n\t_prepareEffect (babylon.js_dd_1_dd_11195)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Fragment shader_dd_ default\n1\t#define DIFFUSEDIRECTUV 0\n2\t#define AMBIENTDIRECTUV 0\n3\t#define OPACITYDIRECTUV 0\n4\t#define EMISSIVEDIRECTUV 0\n5\t#define SPECULARDIRECTUV 0\n6\t#define BUMPDIRECTUV 0\n7\t#define SPECULARTERM\n8\t#define NORMAL\n9\t#define NUM_BONE_INFLUENCERS 8\n10\t#define BonesPerMesh 33\n11\t#define LIGHTMAPDIRECTUV 0\n12\t#define NUM_MORPH_INFLUENCERS 0\n13\t#define VIGNETTEBLENDMODEMULTIPLY\n14\t#define SAMPLER3DGREENDEPTH\n15\t#define SAMPLER3DBGRMAP\n16\t#define LIGHT0\n17\t#define POINTLIGHT0\n18\t\n19\t#define SHADER_NAME fragment_dd_default\n20\tprecision highp float_sm_\n21\tuniform vec4 vDiffuseColor_sm_\n22\t#ifdef SPECULARTERM\n23\tuniform vec4 vSpecularColor_sm_\n24\t#endif\n25\tuniform vec3 vEmissiveColor_sm_\n26\t\n27\t#ifdef DIFFUSE\n28\tuniform vec2 vDiffuseInfos_sm_\n29\t#endif\n30\t#ifdef AMBIENT\n31\tuniform vec2 vAmbientInfos_sm_\n32\t#endif\n33\t#ifdef OPACITY \n34\tuniform vec2 vOpacityInfos_sm_\n35\t#endif\n36\t#ifdef EMISSIVE\n37\tuniform vec2 vEmissiveInfos_sm_\n38\t#endif\n39\t#ifdef LIGHTMAP\n40\tuniform vec2 vLightmapInfos_sm_\n41\t#endif\n42\t#ifdef BUMP\n43\tuniform vec3 vBumpInfos_sm_\n44\tuniform vec2 vTangentSpaceParams_sm_\n45\t#endif\n46\t#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\n47\tuniform mat4 view_sm_\n48\t#endif\n49\t#ifdef REFRACTION\n50\tuniform vec4 vRefractionInfos_sm_\n51\t#ifndef REFRACTIONMAP_3D\n52\tuniform mat4 refractionMatrix_sm_\n53\t#endif\n54\t#ifdef REFRACTIONFRESNEL\n55\tuniform vec4 refractionLeftColor_sm_\n56\tuniform vec4 refractionRightColor_sm_\n57\t#endif\n58\t#endif\n59\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n60\tuniform vec2 vSpecularInfos_sm_\n61\t#endif\n62\t#ifdef DIFFUSEFRESNEL\n63\tuniform vec4 diffuseLeftColor_sm_\n64\tuniform vec4 diffuseRightColor_sm_\n65\t#endif\n66\t#ifdef OPACITYFRESNEL\n67\tuniform vec4 opacityParts_sm_\n68\t#endif\n69\t#ifdef EMISSIVEFRESNEL\n70\tuniform vec4 emissiveLeftColor_sm_\n71\tuniform vec4 emissiveRightColor_sm_\n72\t#endif\n73\t\n74\t#ifdef REFLECTION\n75\tuniform vec2 vReflectionInfos_sm_\n76\t#ifdef REFLECTIONMAP_SKYBOX\n77\t#else\n78\t#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\n79\tuniform mat4 reflectionMatrix_sm_\n80\t#endif\n81\t#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) &amp_sm_&amp_sm_ defined(REFLECTIONMAP_CUBIC)\n82\tuniform vec3 vReflectionPosition_sm_\n83\tuniform vec3 vReflectionSize_sm_ \n84\t#endif\n85\t#endif\n86\t#ifdef REFLECTIONFRESNEL\n87\tuniform vec4 reflectionLeftColor_sm_\n88\tuniform vec4 reflectionRightColor_sm_\n89\t#endif\n90\t#endif\n91\t#if defined(BUMP) || !defined(NORMAL)\n92\t#extension GL_OES_standard_derivatives _dd_ enable\n93\t#endif\n94\t#define CUSTOM_FRAGMENT_BEGIN\n95\t#ifdef LOGARITHMICDEPTH\n96\t#extension GL_EXT_frag_depth _dd_ enable\n97\t#endif\n98\t\n99\t#define RECIPROCAL_PI2 0.15915494\n100\tuniform vec3 vEyePosition_sm_\n101\tuniform vec3 vAmbientColor_sm_\n102\t\n103\tvarying vec3 vPositionW_sm_\n104\t#ifdef NORMAL\n105\tvarying vec3 vNormalW_sm_\n106\t#endif\n107\t#ifdef VERTEXCOLOR\n108\tvarying vec4 vColor_sm_\n109\t#endif\n110\t#ifdef MAINUV1\n111\tvarying vec2 vMainUV1_sm_\n112\t#endif\n113\t#ifdef MAINUV2\n114\tvarying vec2 vMainUV2_sm_\n115\t#endif\n116\t\n117\tconst float PI_eq_3.1415926535897932384626433832795_sm_\n118\tconst float LinearEncodePowerApprox_eq_2.2_sm_\n119\tconst float GammaEncodePowerApprox_eq_1.0/LinearEncodePowerApprox_sm_\n120\tconst vec3 LuminanceEncodeApprox_eq_vec3(0.2126_co_0.7152_co_0.0722)_sm_\n121\tmat3 transposeMat3(mat3 inMatrix) {\n122\tvec3 i0_eq_inMatrix[0]_sm_\n123\tvec3 i1_eq_inMatrix[1]_sm_\n124\tvec3 i2_eq_inMatrix[2]_sm_\n125\tmat3 outMatrix_eq_mat3(\n126\tvec3(i0.x_co_i1.x_co_i2.x)_co_\n127\tvec3(i0.y_co_i1.y_co_i2.y)_co_\n128\tvec3(i0.z_co_i1.z_co_i2.z)\n129\t)_sm_\n130\treturn outMatrix_sm_\n131\t}\n132\t\n133\tmat3 inverseMat3(mat3 inMatrix) {\n134\tfloat a00_eq_inMatrix[0][0]_co_a01_eq_inMatrix[0][1]_co_a02_eq_inMatrix[0][2]_sm_\n135\tfloat a10_eq_inMatrix[1][0]_co_a11_eq_inMatrix[1][1]_co_a12_eq_inMatrix[1][2]_sm_\n136\tfloat a20_eq_inMatrix[2][0]_co_a21_eq_inMatrix[2][1]_co_a22_eq_inMatrix[2][2]_sm_\n137\tfloat b01_eq_a22*a11-a12*a21_sm_\n138\tfloat b11_eq_-a22*a10+a12*a20_sm_\n139\tfloat b21_eq_a21*a10-a11*a20_sm_\n140\tfloat det_eq_a00*b01+a01*b11+a02*b21_sm_\n141\treturn mat3(b01_co_(-a22*a01+a02*a21)_co_(a12*a01-a02*a11)_co_\n142\tb11_co_(a22*a00-a02*a20)_co_(-a12*a00+a02*a10)_co_\n143\tb21_co_(-a21*a00+a01*a20)_co_(a11*a00-a01*a10))/det_sm_\n144\t}\n145\tfloat computeFallOff(float value_co_vec2 clipSpace_co_float frustumEdgeFalloff)\n146\t{\n147\tfloat mask_eq_smoothstep(1.0-frustumEdgeFalloff_co_1.0_co_clamp(dot(clipSpace_co_clipSpace)_co_0._co_1.))_sm_\n148\treturn mix(value_co_1.0_co_mask)_sm_\n149\t}\n150\tvec3 applyEaseInOut(vec3 x){\n151\treturn x*x*(3.0-2.0*x)_sm_\n152\t}\n153\tvec3 toLinearSpace(vec3 color)\n154\t{\n155\treturn pow(color_co_vec3(LinearEncodePowerApprox))_sm_\n156\t}\n157\tvec3 toGammaSpace(vec3 color)\n158\t{\n159\treturn pow(color_co_vec3(GammaEncodePowerApprox))_sm_\n160\t}\n161\tfloat square(float value)\n162\t{\n163\treturn value*value_sm_\n164\t}\n165\tfloat getLuminance(vec3 color)\n166\t{\n167\treturn clamp(dot(color_co_LuminanceEncodeApprox)_co_0._co_1.)_sm_\n168\t}\n169\t\n170\tfloat getRand(vec2 seed) {\n171\treturn fract(sin(dot(seed.xy _co_vec2(12.9898_co_78.233)))*43758.5453)_sm_\n172\t}\n173\tvec3 dither(vec2 seed_co_vec3 color) {\n174\tfloat rand_eq_getRand(seed)_sm_\n175\tcolor+_eq_mix(-0.5/255.0_co_0.5/255.0_co_rand)_sm_\n176\tcolor_eq_max(color_co_0.0)_sm_\n177\treturn color_sm_\n178\t}\n179\t\n180\t#ifdef LIGHT0\n181\tuniform vec4 vLightData0_sm_\n182\tuniform vec4 vLightDiffuse0_sm_\n183\t#ifdef SPECULARTERM\n184\tuniform vec3 vLightSpecular0_sm_\n185\t#else\n186\tvec3 vLightSpecular0_eq_vec3(0.)_sm_\n187\t#endif\n188\t#ifdef SHADOW0\n189\t#if defined(SHADOWCUBE0)\n190\tuniform samplerCube shadowSampler0_sm_\n191\t#else\n192\tvarying vec4 vPositionFromLight0_sm_\n193\tvarying float vDepthMetric0_sm_\n194\tuniform sampler2D shadowSampler0_sm_\n195\tuniform mat4 lightMatrix0_sm_\n196\t#endif\n197\tuniform vec4 shadowsInfo0_sm_\n198\tuniform vec2 depthValues0_sm_\n199\t#endif\n200\t#ifdef SPOTLIGHT0\n201\tuniform vec4 vLightDirection0_sm_\n202\t#endif\n203\t#ifdef HEMILIGHT0\n204\tuniform vec3 vLightGround0_sm_\n205\t#endif\n206\t#ifdef PROJECTEDLIGHTTEXTURE0\n207\tuniform mat4 textureProjectionMatrix0_sm_\n208\tuniform sampler2D projectionLightSampler0_sm_\n209\t#endif\n210\t#endif\n211\t#ifdef LIGHT1\n212\tuniform vec4 vLightData1_sm_\n213\tuniform vec4 vLightDiffuse1_sm_\n214\t#ifdef SPECULARTERM\n215\tuniform vec3 vLightSpecular1_sm_\n216\t#else\n217\tvec3 vLightSpecular1_eq_vec3(0.)_sm_\n218\t#endif\n219\t#ifdef SHADOW1\n220\t#if defined(SHADOWCUBE1)\n221\tuniform samplerCube shadowSampler1_sm_\n222\t#else\n223\tvarying vec4 vPositionFromLight1_sm_\n224\tvarying float vDepthMetric1_sm_\n225\tuniform sampler2D shadowSampler1_sm_\n226\tuniform mat4 lightMatrix1_sm_\n227\t#endif\n228\tuniform vec4 shadowsInfo1_sm_\n229\tuniform vec2 depthValues1_sm_\n230\t#endif\n231\t#ifdef SPOTLIGHT1\n232\tuniform vec4 vLightDirection1_sm_\n233\t#endif\n234\t#ifdef HEMILIGHT1\n235\tuniform vec3 vLightGround1_sm_\n236\t#endif\n237\t#ifdef PROJECTEDLIGHTTEXTURE1\n238\tuniform mat4 textureProjectionMatrix1_sm_\n239\tuniform sampler2D projectionLightSampler1_sm_\n240\t#endif\n241\t#endif\n242\t#ifdef LIGHT2\n243\tuniform vec4 vLightData2_sm_\n244\tuniform vec4 vLightDiffuse2_sm_\n245\t#ifdef SPECULARTERM\n246\tuniform vec3 vLightSpecular2_sm_\n247\t#else\n248\tvec3 vLightSpecular2_eq_vec3(0.)_sm_\n249\t#endif\n250\t#ifdef SHADOW2\n251\t#if defined(SHADOWCUBE2)\n252\tuniform samplerCube shadowSampler2_sm_\n253\t#else\n254\tvarying vec4 vPositionFromLight2_sm_\n255\tvarying float vDepthMetric2_sm_\n256\tuniform sampler2D shadowSampler2_sm_\n257\tuniform mat4 lightMatrix2_sm_\n258\t#endif\n259\tuniform vec4 shadowsInfo2_sm_\n260\tuniform vec2 depthValues2_sm_\n261\t#endif\n262\t#ifdef SPOTLIGHT2\n263\tuniform vec4 vLightDirection2_sm_\n264\t#endif\n265\t#ifdef HEMILIGHT2\n266\tuniform vec3 vLightGround2_sm_\n267\t#endif\n268\t#ifdef PROJECTEDLIGHTTEXTURE2\n269\tuniform mat4 textureProjectionMatrix2_sm_\n270\tuniform sampler2D projectionLightSampler2_sm_\n271\t#endif\n272\t#endif\n273\t#ifdef LIGHT3\n274\tuniform vec4 vLightData3_sm_\n275\tuniform vec4 vLightDiffuse3_sm_\n276\t#ifdef SPECULARTERM\n277\tuniform vec3 vLightSpecular3_sm_\n278\t#else\n279\tvec3 vLightSpecular3_eq_vec3(0.)_sm_\n280\t#endif\n281\t#ifdef SHADOW3\n282\t#if defined(SHADOWCUBE3)\n283\tuniform samplerCube shadowSampler3_sm_\n284\t#else\n285\tvarying vec4 vPositionFromLight3_sm_\n286\tvarying float vDepthMetric3_sm_\n287\tuniform sampler2D shadowSampler3_sm_\n288\tuniform mat4 lightMatrix3_sm_\n289\t#endif\n290\tuniform vec4 shadowsInfo3_sm_\n291\tuniform vec2 depthValues3_sm_\n292\t#endif\n293\t#ifdef SPOTLIGHT3\n294\tuniform vec4 vLightDirection3_sm_\n295\t#endif\n296\t#ifdef HEMILIGHT3\n297\tuniform vec3 vLightGround3_sm_\n298\t#endif\n299\t#ifdef PROJECTEDLIGHTTEXTURE3\n300\tuniform mat4 textureProjectionMatrix3_sm_\n301\tuniform sampler2D projectionLightSampler3_sm_\n302\t#endif\n303\t#endif\n304\t\n305\t\n306\tstruct lightingInfo\n307\t{\n308\tvec3 diffuse_sm_\n309\t#ifdef SPECULARTERM\n310\tvec3 specular_sm_\n311\t#endif\n312\t#ifdef NDOTL\n313\tfloat ndl_sm_\n314\t#endif\n315\t}_sm_\n316\tlightingInfo computeLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec3 diffuseColor_co_vec3 specularColor_co_float range_co_float glossiness) {\n317\tlightingInfo result_sm_\n318\tvec3 lightVectorW_sm_\n319\tfloat attenuation_eq_1.0_sm_\n320\tif (lightData.w _eq__eq_ 0.)\n321\t{\n322\tvec3 direction_eq_lightData.xyz-vPositionW_sm_\n323\tattenuation_eq_max(0._co_1.0-length(direction)/range)_sm_\n324\tlightVectorW_eq_normalize(direction)_sm_\n325\t}\n326\telse\n327\t{\n328\tlightVectorW_eq_normalize(-lightData.xyz)_sm_\n329\t}\n330\t\n331\tfloat ndl_eq_max(0._co_dot(vNormal_co_lightVectorW))_sm_\n332\t#ifdef NDOTL\n333\tresult.ndl_eq_ndl_sm_\n334\t#endif\n335\tresult.diffuse_eq_ndl*diffuseColor*attenuation_sm_\n336\t#ifdef SPECULARTERM\n337\t\n338\tvec3 angleW_eq_normalize(viewDirectionW+lightVectorW)_sm_\n339\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n340\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n341\tresult.specular_eq_specComp*specularColor*attenuation_sm_\n342\t#endif\n343\treturn result_sm_\n344\t}\n345\tlightingInfo computeSpotLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec4 lightDirection_co_vec3 diffuseColor_co_vec3 specularColor_co_float range_co_float glossiness) {\n346\tlightingInfo result_sm_\n347\tvec3 direction_eq_lightData.xyz-vPositionW_sm_\n348\tvec3 lightVectorW_eq_normalize(direction)_sm_\n349\tfloat attenuation_eq_max(0._co_1.0-length(direction)/range)_sm_\n350\t\n351\tfloat cosAngle_eq_max(0._co_dot(lightDirection.xyz_co_-lightVectorW))_sm_\n352\tif (cosAngle&gt_sm__eq_lightDirection.w)\n353\t{\n354\tcosAngle_eq_max(0._co_pow(cosAngle_co_lightData.w))_sm_\n355\tattenuation*_eq_cosAngle_sm_\n356\t\n357\tfloat ndl_eq_max(0._co_dot(vNormal_co_lightVectorW))_sm_\n358\t#ifdef NDOTL\n359\tresult.ndl_eq_ndl_sm_\n360\t#endif\n361\tresult.diffuse_eq_ndl*diffuseColor*attenuation_sm_\n362\t#ifdef SPECULARTERM\n363\t\n364\tvec3 angleW_eq_normalize(viewDirectionW+lightVectorW)_sm_\n365\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n366\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n367\tresult.specular_eq_specComp*specularColor*attenuation_sm_\n368\t#endif\n369\treturn result_sm_\n370\t}\n371\tresult.diffuse_eq_vec3(0.)_sm_\n372\t#ifdef SPECULARTERM\n373\tresult.specular_eq_vec3(0.)_sm_\n374\t#endif\n375\t#ifdef NDOTL\n376\tresult.ndl_eq_0._sm_\n377\t#endif\n378\treturn result_sm_\n379\t}\n380\tlightingInfo computeHemisphericLighting(vec3 viewDirectionW_co_vec3 vNormal_co_vec4 lightData_co_vec3 diffuseColor_co_vec3 specularColor_co_vec3 groundColor_co_float glossiness) {\n381\tlightingInfo result_sm_\n382\t\n383\tfloat ndl_eq_dot(vNormal_co_lightData.xyz)*0.5+0.5_sm_\n384\t#ifdef NDOTL\n385\tresult.ndl_eq_ndl_sm_\n386\t#endif\n387\tresult.diffuse_eq_mix(groundColor_co_diffuseColor_co_ndl)_sm_\n388\t#ifdef SPECULARTERM\n389\t\n390\tvec3 angleW_eq_normalize(viewDirectionW+lightData.xyz)_sm_\n391\tfloat specComp_eq_max(0._co_dot(vNormal_co_angleW))_sm_\n392\tspecComp_eq_pow(specComp_co_max(1._co_glossiness))_sm_\n393\tresult.specular_eq_specComp*specularColor_sm_\n394\t#endif\n395\treturn result_sm_\n396\t}\n397\tvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler_co_mat4 textureProjectionMatrix){\n398\tvec4 strq_eq_textureProjectionMatrix*vec4(vPositionW_co_1.0)_sm_\n399\tstrq/_eq_strq.w_sm_\n400\tvec3 textureColor_eq_texture2D(projectionLightSampler_co_strq.xy).rgb_sm_\n401\t#ifdef PBR\n402\ttextureColor_eq_toLinearSpace(textureColor)_sm_\n403\t#endif\n404\treturn textureColor_sm_\n405\t}\n406\t#ifdef SHADOWS\n407\t#ifndef SHADOWFLOAT\n408\tfloat unpack(vec4 color)\n409\t{\n410\tconst vec4 bit_shift_eq_vec4(1.0/(255.0*255.0*255.0)_co_1.0/(255.0*255.0)_co_1.0/255.0_co_1.0)_sm_\n411\treturn dot(color_co_bit_shift)_sm_\n412\t}\n413\t#endif\n414\tfloat computeShadowCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_vec2 depthValues)\n415\t{\n416\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n417\tfloat depth_eq_length(directionToLight)_sm_\n418\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n419\tdepth_eq_clamp(depth_co_0._co_1.0)_sm_\n420\tdirectionToLight_eq_normalize(directionToLight)_sm_\n421\tdirectionToLight.y_eq_-directionToLight.y_sm_\n422\t#ifndef SHADOWFLOAT\n423\tfloat shadow_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n424\t#else\n425\tfloat shadow_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n426\t#endif\n427\tif (depth&gt_sm_shadow)\n428\t{\n429\treturn darkness_sm_\n430\t}\n431\treturn 1.0_sm_\n432\t}\n433\tfloat computeShadowWithPCFCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float mapSize_co_float darkness_co_vec2 depthValues)\n434\t{\n435\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n436\tfloat depth_eq_length(directionToLight)_sm_\n437\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n438\tdepth_eq_clamp(depth_co_0._co_1.0)_sm_\n439\tdirectionToLight_eq_normalize(directionToLight)_sm_\n440\tdirectionToLight.y_eq_-directionToLight.y_sm_\n441\tfloat visibility_eq_1._sm_\n442\tvec3 poissonDisk[4]_sm_\n443\tpoissonDisk[0]_eq_vec3(-1.0_co_1.0_co_-1.0)_sm_\n444\tpoissonDisk[1]_eq_vec3(1.0_co_-1.0_co_-1.0)_sm_\n445\tpoissonDisk[2]_eq_vec3(-1.0_co_-1.0_co_-1.0)_sm_\n446\tpoissonDisk[3]_eq_vec3(1.0_co_-1.0_co_1.0)_sm_\n447\t\n448\t#ifndef SHADOWFLOAT\n449\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[0]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n450\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[1]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n451\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[2]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n452\tif (unpack(textureCube(shadowSampler_co_directionToLight+poissonDisk[3]*mapSize))&lt_sm_depth) visibility-_eq_0.25_sm_\n453\t#else\n454\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[0]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n455\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[1]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n456\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[2]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n457\tif (textureCube(shadowSampler_co_directionToLight+poissonDisk[3]*mapSize).x&lt_sm_depth) visibility-_eq_0.25_sm_\n458\t#endif\n459\treturn min(1.0_co_visibility+darkness)_sm_\n460\t}\n461\tfloat computeShadowWithESMCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_float depthScale_co_vec2 depthValues)\n462\t{\n463\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n464\tfloat depth_eq_length(directionToLight)_sm_\n465\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n466\tfloat shadowPixelDepth_eq_clamp(depth_co_0._co_1.0)_sm_\n467\tdirectionToLight_eq_normalize(directionToLight)_sm_\n468\tdirectionToLight.y_eq_-directionToLight.y_sm_\n469\t#ifndef SHADOWFLOAT\n470\tfloat shadowMapSample_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n471\t#else\n472\tfloat shadowMapSample_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n473\t#endif\n474\tfloat esm_eq_1.0-clamp(exp(min(87._co_depthScale*shadowPixelDepth))*shadowMapSample_co_0._co_1.-darkness)_sm_ \n475\treturn esm_sm_\n476\t}\n477\tfloat computeShadowWithCloseESMCube(vec3 lightPosition_co_samplerCube shadowSampler_co_float darkness_co_float depthScale_co_vec2 depthValues)\n478\t{\n479\tvec3 directionToLight_eq_vPositionW-lightPosition_sm_\n480\tfloat depth_eq_length(directionToLight)_sm_\n481\tdepth_eq_(depth+depthValues.x)/(depthValues.y)_sm_\n482\tfloat shadowPixelDepth_eq_clamp(depth_co_0._co_1.0)_sm_\n483\tdirectionToLight_eq_normalize(directionToLight)_sm_\n484\tdirectionToLight.y_eq_-directionToLight.y_sm_\n485\t#ifndef SHADOWFLOAT\n486\tfloat shadowMapSample_eq_unpack(textureCube(shadowSampler_co_directionToLight))_sm_\n487\t#else\n488\tfloat shadowMapSample_eq_textureCube(shadowSampler_co_directionToLight).x_sm_\n489\t#endif\n490\tfloat esm_eq_clamp(exp(min(87._co_-depthScale*(shadowPixelDepth-shadowMapSample)))_co_darkness_co_1.)_sm_\n491\treturn esm_sm_\n492\t}\n493\tfloat computeShadow(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float frustumEdgeFalloff)\n494\t{\n495\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n496\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n497\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n498\t{\n499\treturn 1.0_sm_\n500\t}\n501\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n502\t#ifndef SHADOWFLOAT\n503\tfloat shadow_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n504\t#else\n505\tfloat shadow_eq_texture2D(shadowSampler_co_uv).x_sm_\n506\t#endif\n507\tif (shadowPixelDepth&gt_sm_shadow)\n508\t{\n509\treturn computeFallOff(darkness_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n510\t}\n511\treturn 1._sm_\n512\t}\n513\tfloat computeShadowWithPCF(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float mapSize_co_float darkness_co_float frustumEdgeFalloff)\n514\t{\n515\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n516\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n517\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n518\t{\n519\treturn 1.0_sm_\n520\t}\n521\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n522\tfloat visibility_eq_1._sm_\n523\tvec2 poissonDisk[4]_sm_\n524\tpoissonDisk[0]_eq_vec2(-0.94201624_co_-0.39906216)_sm_\n525\tpoissonDisk[1]_eq_vec2(0.94558609_co_-0.76890725)_sm_\n526\tpoissonDisk[2]_eq_vec2(-0.094184101_co_-0.92938870)_sm_\n527\tpoissonDisk[3]_eq_vec2(0.34495938_co_0.29387760)_sm_\n528\t\n529\t#ifndef SHADOWFLOAT\n530\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[0]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n531\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[1]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n532\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[2]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n533\tif (unpack(texture2D(shadowSampler_co_uv+poissonDisk[3]*mapSize))&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n534\t#else\n535\tif (texture2D(shadowSampler_co_uv+poissonDisk[0]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n536\tif (texture2D(shadowSampler_co_uv+poissonDisk[1]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n537\tif (texture2D(shadowSampler_co_uv+poissonDisk[2]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n538\tif (texture2D(shadowSampler_co_uv+poissonDisk[3]*mapSize).x&lt_sm_shadowPixelDepth) visibility-_eq_0.25_sm_\n539\t#endif\n540\treturn computeFallOff(min(1.0_co_visibility+darkness)_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n541\t}\n542\tfloat computeShadowWithESM(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float depthScale_co_float frustumEdgeFalloff)\n543\t{\n544\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n545\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n546\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n547\t{\n548\treturn 1.0_sm_\n549\t}\n550\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_\n551\t#ifndef SHADOWFLOAT\n552\tfloat shadowMapSample_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n553\t#else\n554\tfloat shadowMapSample_eq_texture2D(shadowSampler_co_uv).x_sm_\n555\t#endif\n556\tfloat esm_eq_1.0-clamp(exp(min(87._co_depthScale*shadowPixelDepth))*shadowMapSample_co_0._co_1.-darkness)_sm_\n557\treturn computeFallOff(esm_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n558\t}\n559\tfloat computeShadowWithCloseESM(vec4 vPositionFromLight_co_float depthMetric_co_sampler2D shadowSampler_co_float darkness_co_float depthScale_co_float frustumEdgeFalloff)\n560\t{\n561\tvec3 clipSpace_eq_vPositionFromLight.xyz/vPositionFromLight.w_sm_\n562\tvec2 uv_eq_0.5*clipSpace.xy+vec2(0.5)_sm_\n563\tif (uv.x&lt_sm_0. || uv.x&gt_sm_1.0 || uv.y&lt_sm_0. || uv.y&gt_sm_1.0)\n564\t{\n565\treturn 1.0_sm_\n566\t}\n567\tfloat shadowPixelDepth_eq_clamp(depthMetric_co_0._co_1.0)_sm_ \n568\t#ifndef SHADOWFLOAT\n569\tfloat shadowMapSample_eq_unpack(texture2D(shadowSampler_co_uv))_sm_\n570\t#else\n571\tfloat shadowMapSample_eq_texture2D(shadowSampler_co_uv).x_sm_\n572\t#endif\n573\tfloat esm_eq_clamp(exp(min(87._co_-depthScale*(shadowPixelDepth-shadowMapSample)))_co_darkness_co_1.)_sm_\n574\treturn computeFallOff(esm_co_clipSpace.xy_co_frustumEdgeFalloff)_sm_\n575\t}\n576\t#endif\n577\t\n578\t\n579\t#ifdef DIFFUSE\n580\t#if DIFFUSEDIRECTUV _eq__eq_ 1\n581\t#define vDiffuseUV vMainUV1\n582\t#elif DIFFUSEDIRECTUV _eq__eq_ 2\n583\t#define vDiffuseUV vMainUV2\n584\t#else\n585\tvarying vec2 vDiffuseUV_sm_\n586\t#endif\n587\tuniform sampler2D diffuseSampler_sm_\n588\t#endif\n589\t#ifdef AMBIENT\n590\t#if AMBIENTDIRECTUV _eq__eq_ 1\n591\t#define vAmbientUV vMainUV1\n592\t#elif AMBIENTDIRECTUV _eq__eq_ 2\n593\t#define vAmbientUV vMainUV2\n594\t#else\n595\tvarying vec2 vAmbientUV_sm_\n596\t#endif\n597\tuniform sampler2D ambientSampler_sm_\n598\t#endif\n599\t#ifdef OPACITY \n600\t#if OPACITYDIRECTUV _eq__eq_ 1\n601\t#define vOpacityUV vMainUV1\n602\t#elif OPACITYDIRECTUV _eq__eq_ 2\n603\t#define vOpacityUV vMainUV2\n604\t#else\n605\tvarying vec2 vOpacityUV_sm_\n606\t#endif\n607\tuniform sampler2D opacitySampler_sm_\n608\t#endif\n609\t#ifdef EMISSIVE\n610\t#if EMISSIVEDIRECTUV _eq__eq_ 1\n611\t#define vEmissiveUV vMainUV1\n612\t#elif EMISSIVEDIRECTUV _eq__eq_ 2\n613\t#define vEmissiveUV vMainUV2\n614\t#else\n615\tvarying vec2 vEmissiveUV_sm_\n616\t#endif\n617\tuniform sampler2D emissiveSampler_sm_\n618\t#endif\n619\t#ifdef LIGHTMAP\n620\t#if LIGHTMAPDIRECTUV _eq__eq_ 1\n621\t#define vLightmapUV vMainUV1\n622\t#elif LIGHTMAPDIRECTUV _eq__eq_ 2\n623\t#define vLightmapUV vMainUV2\n624\t#else\n625\tvarying vec2 vLightmapUV_sm_\n626\t#endif\n627\tuniform sampler2D lightmapSampler_sm_\n628\t#endif\n629\t#ifdef REFRACTION\n630\t#ifdef REFRACTIONMAP_3D\n631\tuniform samplerCube refractionCubeSampler_sm_\n632\t#else\n633\tuniform sampler2D refraction2DSampler_sm_\n634\t#endif\n635\t#endif\n636\t#if defined(SPECULAR) &amp_sm_&amp_sm_ defined(SPECULARTERM)\n637\t#if SPECULARDIRECTUV _eq__eq_ 1\n638\t#define vSpecularUV vMainUV1\n639\t#elif SPECULARDIRECTUV _eq__eq_ 2\n640\t#define vSpecularUV vMainUV2\n641\t#else\n642\tvarying vec2 vSpecularUV_sm_\n643\t#endif\n644\tuniform sampler2D specularSampler_sm_\n645\t#endif\n646\t\n647\t#ifdef FRESNEL\n648\tfloat computeFresnelTerm(vec3 viewDirection_co_vec3 worldNormal_co_float bias_co_float power)\n649\t{\n650\tfloat fresnelTerm_eq_pow(bias+abs(dot(viewDirection_co_worldNormal))_co_power)_sm_\n651\treturn clamp(fresnelTerm_co_0._co_1.)_sm_\n652\t}\n653\t#endif\n654\t\n655\t#ifdef REFLECTION\n656\t#ifdef REFLECTIONMAP_3D\n657\tuniform samplerCube reflectionCubeSampler_sm_\n658\t#else\n659\tuniform sampler2D reflection2DSampler_sm_\n660\t#endif\n661\t#ifdef REFLECTIONMAP_SKYBOX\n662\tvarying vec3 vPositionUVW_sm_\n663\t#else\n664\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n665\tvarying vec3 vDirectionW_sm_\n666\t#endif\n667\t#endif\n668\t#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\n669\tvec3 parallaxCorrectNormal( vec3 vertexPos_co_vec3 origVec_co_vec3 cubeSize_co_vec3 cubePos ) {\n670\t\n671\tvec3 invOrigVec_eq_vec3(1.0_co_1.0_co_1.0)/origVec_sm_\n672\tvec3 halfSize_eq_cubeSize*0.5_sm_\n673\tvec3 intersecAtMaxPlane_eq_(cubePos+halfSize-vertexPos)*invOrigVec_sm_\n674\tvec3 intersecAtMinPlane_eq_(cubePos-halfSize-vertexPos)*invOrigVec_sm_\n675\t\n676\tvec3 largestIntersec_eq_max(intersecAtMaxPlane_co_intersecAtMinPlane)_sm_\n677\t\n678\tfloat distance_eq_min(min(largestIntersec.x_co_largestIntersec.y)_co_largestIntersec.z)_sm_\n679\t\n680\tvec3 intersectPositionWS_eq_vertexPos+origVec*distance_sm_\n681\t\n682\treturn intersectPositionWS-cubePos_sm_\n683\t}\n684\t#endif\n685\tvec3 computeReflectionCoords(vec4 worldPos_co_vec3 worldNormal)\n686\t{\n687\t#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\n688\tvec3 direction_eq_vDirectionW_sm_\n689\tfloat t_eq_clamp(direction.y*-0.5+0.5_co_0._co_1.0)_sm_\n690\tfloat s_eq_atan(direction.z_co_direction.x)*RECIPROCAL_PI2+0.5_sm_\n691\t#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\n692\treturn vec3(1.0-s_co_t_co_0)_sm_\n693\t#else\n694\treturn vec3(s_co_t_co_0)_sm_\n695\t#endif\n696\t#endif\n697\t#ifdef REFLECTIONMAP_EQUIRECTANGULAR\n698\tvec3 cameraToVertex_eq_normalize(worldPos.xyz-vEyePosition.xyz)_sm_\n699\tvec3 r_eq_reflect(cameraToVertex_co_worldNormal)_sm_\n700\tfloat t_eq_clamp(r.y*-0.5+0.5_co_0._co_1.0)_sm_\n701\tfloat s_eq_atan(r.z_co_r.x)*RECIPROCAL_PI2+0.5_sm_\n702\treturn vec3(s_co_t_co_0)_sm_\n703\t#endif\n704\t#ifdef REFLECTIONMAP_SPHERICAL\n705\tvec3 viewDir_eq_normalize(vec3(view*worldPos))_sm_\n706\tvec3 viewNormal_eq_normalize(vec3(view*vec4(worldNormal_co_0.0)))_sm_\n707\tvec3 r_eq_reflect(viewDir_co_viewNormal)_sm_\n708\tr.z_eq_r.z-1.0_sm_\n709\tfloat m_eq_2.0*length(r)_sm_\n710\treturn vec3(r.x/m+0.5_co_1.0-r.y/m-0.5_co_0)_sm_\n711\t#endif\n712\t#ifdef REFLECTIONMAP_PLANAR\n713\tvec3 viewDir_eq_worldPos.xyz-vEyePosition.xyz_sm_\n714\tvec3 coords_eq_normalize(reflect(viewDir_co_worldNormal))_sm_\n715\treturn vec3(reflectionMatrix*vec4(coords_co_1))_sm_\n716\t#endif\n717\t#ifdef REFLECTIONMAP_CUBIC\n718\tvec3 viewDir_eq_normalize(worldPos.xyz-vEyePosition.xyz)_sm_\n719\t\n720\tvec3 coords_eq_reflect(viewDir_co_worldNormal)_sm_\n721\t#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\n722\tcoords_eq_parallaxCorrectNormal(worldPos.xyz_co_coords_co_vReflectionSize_co_vReflectionPosition)_sm_\n723\t#endif\n724\tcoords_eq_vec3(reflectionMatrix*vec4(coords_co_0))_sm_\n725\t#ifdef INVERTCUBICMAP\n726\tcoords.y*_eq_-1.0_sm_\n727\t#endif\n728\treturn coords_sm_\n729\t#endif\n730\t#ifdef REFLECTIONMAP_PROJECTION\n731\treturn vec3(reflectionMatrix*(view*worldPos))_sm_\n732\t#endif\n733\t#ifdef REFLECTIONMAP_SKYBOX\n734\treturn vPositionUVW_sm_\n735\t#endif\n736\t#ifdef REFLECTIONMAP_EXPLICIT\n737\treturn vec3(0_co_0_co_0)_sm_\n738\t#endif\n739\t}\n740\t#endif\n741\t#ifdef EXPOSURE\n742\tuniform float exposureLinear_sm_\n743\t#endif\n744\t#ifdef CONTRAST\n745\tuniform float contrast_sm_\n746\t#endif\n747\t#ifdef VIGNETTE\n748\tuniform vec2 vInverseScreenSize_sm_\n749\tuniform vec4 vignetteSettings1_sm_\n750\tuniform vec4 vignetteSettings2_sm_\n751\t#endif\n752\t#ifdef COLORCURVES\n753\tuniform vec4 vCameraColorCurveNegative_sm_\n754\tuniform vec4 vCameraColorCurveNeutral_sm_\n755\tuniform vec4 vCameraColorCurvePositive_sm_\n756\t#endif\n757\t#ifdef COLORGRADING\n758\t#ifdef COLORGRADING3D\n759\tuniform highp sampler3D txColorTransform_sm_\n760\t#else\n761\tuniform sampler2D txColorTransform_sm_\n762\t#endif\n763\tuniform vec4 colorTransformSettings_sm_\n764\t#endif\n765\t#if defined(COLORGRADING) &amp_sm_&amp_sm_ !defined(COLORGRADING3D)\n766\t\n767\tvec3 sampleTexture3D(sampler2D colorTransform_co_vec3 color_co_vec2 sampler3dSetting)\n768\t{\n769\tfloat sliceSize_eq_2.0*sampler3dSetting.x_sm_ \n770\t#ifdef SAMPLER3DGREENDEPTH\n771\tfloat sliceContinuous_eq_(color.g-sampler3dSetting.x)*sampler3dSetting.y_sm_\n772\t#else\n773\tfloat sliceContinuous_eq_(color.b-sampler3dSetting.x)*sampler3dSetting.y_sm_\n774\t#endif\n775\tfloat sliceInteger_eq_floor(sliceContinuous)_sm_\n776\t\n777\t\n778\tfloat sliceFraction_eq_sliceContinuous-sliceInteger_sm_\n779\t#ifdef SAMPLER3DGREENDEPTH\n780\tvec2 sliceUV_eq_color.rb_sm_\n781\t#else\n782\tvec2 sliceUV_eq_color.rg_sm_\n783\t#endif\n784\tsliceUV.x*_eq_sliceSize_sm_\n785\tsliceUV.x+_eq_sliceInteger*sliceSize_sm_\n786\tsliceUV_eq_clamp(sliceUV_co_0._co_1.)_sm_\n787\tvec4 slice0Color_eq_texture2D(colorTransform_co_sliceUV)_sm_\n788\tsliceUV.x+_eq_sliceSize_sm_\n789\tsliceUV_eq_clamp(sliceUV_co_0._co_1.)_sm_\n790\tvec4 slice1Color_eq_texture2D(colorTransform_co_sliceUV)_sm_\n791\tvec3 result_eq_mix(slice0Color.rgb_co_slice1Color.rgb_co_sliceFraction)_sm_\n792\t#ifdef SAMPLER3DBGRMAP\n793\tcolor.rgb_eq_result.rgb_sm_\n794\t#else\n795\tcolor.rgb_eq_result.bgr_sm_\n796\t#endif\n797\treturn color_sm_\n798\t}\n799\t#endif\n800\tvec4 applyImageProcessing(vec4 result) {\n801\t#ifdef EXPOSURE\n802\tresult.rgb*_eq_exposureLinear_sm_\n803\t#endif\n804\t#ifdef VIGNETTE\n805\t\n806\tvec2 viewportXY_eq_gl_FragCoord.xy*vInverseScreenSize_sm_\n807\tviewportXY_eq_viewportXY*2.0-1.0_sm_\n808\tvec3 vignetteXY1_eq_vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw_co_1.0)_sm_\n809\tfloat vignetteTerm_eq_dot(vignetteXY1_co_vignetteXY1)_sm_\n810\tfloat vignette_eq_pow(vignetteTerm_co_vignetteSettings2.w)_sm_\n811\t\n812\tvec3 vignetteColor_eq_vignetteSettings2.rgb_sm_\n813\t#ifdef VIGNETTEBLENDMODEMULTIPLY\n814\tvec3 vignetteColorMultiplier_eq_mix(vignetteColor_co_vec3(1_co_1_co_1)_co_vignette)_sm_\n815\tresult.rgb*_eq_vignetteColorMultiplier_sm_\n816\t#endif\n817\t#ifdef VIGNETTEBLENDMODEOPAQUE\n818\tresult.rgb_eq_mix(vignetteColor_co_result.rgb_co_vignette)_sm_\n819\t#endif\n820\t#endif\n821\t#ifdef TONEMAPPING\n822\tconst float tonemappingCalibration_eq_1.590579_sm_\n823\tresult.rgb_eq_1.0-exp2(-tonemappingCalibration*result.rgb)_sm_\n824\t#endif\n825\t\n826\tresult.rgb_eq_toGammaSpace(result.rgb)_sm_\n827\tresult.rgb_eq_clamp(result.rgb_co_0.0_co_1.0)_sm_\n828\t#ifdef CONTRAST\n829\t\n830\tvec3 resultHighContrast_eq_applyEaseInOut(result.rgb)_sm_\n831\tif (contrast&lt_sm_1.0) {\n832\t\n833\tresult.rgb_eq_mix(vec3(0.5_co_0.5_co_0.5)_co_result.rgb_co_contrast)_sm_\n834\t} else {\n835\t\n836\tresult.rgb_eq_mix(result.rgb_co_resultHighContrast_co_contrast-1.0)_sm_\n837\t}\n838\t#endif\n839\t\n840\t#ifdef COLORGRADING\n841\tvec3 colorTransformInput_eq_result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy_sm_\n842\t#ifdef COLORGRADING3D\n843\tvec3 colorTransformOutput_eq_texture(txColorTransform_co_colorTransformInput).rgb_sm_\n844\t#else\n845\tvec3 colorTransformOutput_eq_sampleTexture3D(txColorTransform_co_colorTransformInput_co_colorTransformSettings.yz).rgb_sm_\n846\t#endif\n847\tresult.rgb_eq_mix(result.rgb_co_colorTransformOutput_co_colorTransformSettings.www)_sm_\n848\t#endif\n849\t#ifdef COLORCURVES\n850\t\n851\tfloat luma_eq_getLuminance(result.rgb)_sm_\n852\tvec2 curveMix_eq_clamp(vec2(luma*3.0-1.5_co_luma*-3.0+1.5)_co_vec2(0.0)_co_vec2(1.0))_sm_\n853\tvec4 colorCurve_eq_vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative_sm_\n854\tresult.rgb*_eq_colorCurve.rgb_sm_\n855\tresult.rgb_eq_mix(vec3(luma)_co_result.rgb_co_colorCurve.a)_sm_\n856\t#endif\n857\treturn result_sm_\n858\t}\n859\t#ifdef BUMP\n860\t#if BUMPDIRECTUV _eq__eq_ 1\n861\t#define vBumpUV vMainUV1\n862\t#elif BUMPDIRECTUV _eq__eq_ 2\n863\t#define vBumpUV vMainUV2\n864\t#else\n865\tvarying vec2 vBumpUV_sm_\n866\t#endif\n867\tuniform sampler2D bumpSampler_sm_\n868\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL) \n869\tvarying mat3 vTBN_sm_\n870\t#endif\n871\t#ifdef OBJECTSPACE_NORMALMAP\n872\tuniform mat4 normalMatrix_sm_\n873\t#endif\n874\t\n875\tmat3 cotangent_frame(vec3 normal_co_vec3 p_co_vec2 uv)\n876\t{\n877\t\n878\tuv_eq_gl_FrontFacing ? uv _dd_ -uv_sm_\n879\t\n880\tvec3 dp1_eq_dFdx(p)_sm_\n881\tvec3 dp2_eq_dFdy(p)_sm_\n882\tvec2 duv1_eq_dFdx(uv)_sm_\n883\tvec2 duv2_eq_dFdy(uv)_sm_\n884\t\n885\tvec3 dp2perp_eq_cross(dp2_co_normal)_sm_\n886\tvec3 dp1perp_eq_cross(normal_co_dp1)_sm_\n887\tvec3 tangent_eq_dp2perp*duv1.x+dp1perp*duv2.x_sm_\n888\tvec3 bitangent_eq_dp2perp*duv1.y+dp1perp*duv2.y_sm_\n889\t\n890\ttangent*_eq_vTangentSpaceParams.x_sm_\n891\tbitangent*_eq_vTangentSpaceParams.y_sm_\n892\t\n893\tfloat invmax_eq_inversesqrt(max(dot(tangent_co_tangent)_co_dot(bitangent_co_bitangent)))_sm_\n894\treturn mat3(tangent*invmax_co_bitangent*invmax_co_normal)_sm_\n895\t}\n896\tvec3 perturbNormal(mat3 cotangentFrame_co_vec2 uv)\n897\t{\n898\tvec3 map_eq_texture2D(bumpSampler_co_uv).xyz_sm_\n899\tmap_eq_map*2.0-1.0_sm_\n900\t#ifdef NORMALXYSCALE\n901\tmap_eq_normalize(map*vec3(vBumpInfos.y_co_vBumpInfos.y_co_1.0))_sm_\n902\t#endif\n903\treturn normalize(cotangentFrame*map)_sm_\n904\t}\n905\t#ifdef PARALLAX\n906\tconst float minSamples_eq_4._sm_\n907\tconst float maxSamples_eq_15._sm_\n908\tconst int iMaxSamples_eq_15_sm_\n909\t\n910\tvec2 parallaxOcclusion(vec3 vViewDirCoT_co_vec3 vNormalCoT_co_vec2 texCoord_co_float parallaxScale) {\n911\tfloat parallaxLimit_eq_length(vViewDirCoT.xy)/vViewDirCoT.z_sm_\n912\tparallaxLimit*_eq_parallaxScale_sm_\n913\tvec2 vOffsetDir_eq_normalize(vViewDirCoT.xy)_sm_\n914\tvec2 vMaxOffset_eq_vOffsetDir*parallaxLimit_sm_\n915\tfloat numSamples_eq_maxSamples+(dot(vViewDirCoT_co_vNormalCoT)*(minSamples-maxSamples))_sm_\n916\tfloat stepSize_eq_1.0/numSamples_sm_\n917\t\n918\tfloat currRayHeight_eq_1.0_sm_\n919\tvec2 vCurrOffset_eq_vec2(0_co_0)_sm_\n920\tvec2 vLastOffset_eq_vec2(0_co_0)_sm_\n921\tfloat lastSampledHeight_eq_1.0_sm_\n922\tfloat currSampledHeight_eq_1.0_sm_\n923\tfor (int i_eq_0_sm_ i&lt_sm_iMaxSamples_sm_ i++)\n924\t{\n925\tcurrSampledHeight_eq_texture2D(bumpSampler_co_vBumpUV+vCurrOffset).w_sm_\n926\t\n927\tif (currSampledHeight&gt_sm_currRayHeight)\n928\t{\n929\tfloat delta1_eq_currSampledHeight-currRayHeight_sm_\n930\tfloat delta2_eq_(currRayHeight+stepSize)-lastSampledHeight_sm_\n931\tfloat ratio_eq_delta1/(delta1+delta2)_sm_\n932\tvCurrOffset_eq_(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset_sm_\n933\t\n934\tbreak_sm_\n935\t}\n936\telse\n937\t{\n938\tcurrRayHeight-_eq_stepSize_sm_\n939\tvLastOffset_eq_vCurrOffset_sm_\n940\tvCurrOffset+_eq_stepSize*vMaxOffset_sm_\n941\tlastSampledHeight_eq_currSampledHeight_sm_\n942\t}\n943\t}\n944\treturn vCurrOffset_sm_\n945\t}\n946\tvec2 parallaxOffset(vec3 viewDir_co_float heightScale)\n947\t{\n948\t\n949\tfloat height_eq_texture2D(bumpSampler_co_vBumpUV).w_sm_\n950\tvec2 texCoordOffset_eq_heightScale*viewDir.xy*height_sm_\n951\treturn -texCoordOffset_sm_\n952\t}\n953\t#endif\n954\t#endif\n955\t#ifdef CLIPPLANE\n956\tvarying float fClipDistance_sm_\n957\t#endif\n958\t#ifdef LOGARITHMICDEPTH\n959\tuniform float logarithmicDepthConstant_sm_\n960\tvarying float vFragmentDepth_sm_\n961\t#endif\n962\t#ifdef FOG\n963\t#define FOGMODE_NONE 0.\n964\t#define FOGMODE_EXP 1.\n965\t#define FOGMODE_EXP2 2.\n966\t#define FOGMODE_LINEAR 3.\n967\t#define E 2.71828\n968\tuniform vec4 vFogInfos_sm_\n969\tuniform vec3 vFogColor_sm_\n970\tvarying vec3 vFogDistance_sm_\n971\tfloat CalcFogFactor()\n972\t{\n973\tfloat fogCoeff_eq_1.0_sm_\n974\tfloat fogStart_eq_vFogInfos.y_sm_\n975\tfloat fogEnd_eq_vFogInfos.z_sm_\n976\tfloat fogDensity_eq_vFogInfos.w_sm_\n977\tfloat fogDistance_eq_length(vFogDistance)_sm_\n978\tif (FOGMODE_LINEAR _eq__eq_ vFogInfos.x)\n979\t{\n980\tfogCoeff_eq_(fogEnd-fogDistance)/(fogEnd-fogStart)_sm_\n981\t}\n982\telse if (FOGMODE_EXP _eq__eq_ vFogInfos.x)\n983\t{\n984\tfogCoeff_eq_1.0/pow(E_co_fogDistance*fogDensity)_sm_\n985\t}\n986\telse if (FOGMODE_EXP2 _eq__eq_ vFogInfos.x)\n987\t{\n988\tfogCoeff_eq_1.0/pow(E_co_fogDistance*fogDistance*fogDensity*fogDensity)_sm_\n989\t}\n990\treturn clamp(fogCoeff_co_0.0_co_1.0)_sm_\n991\t}\n992\t#endif\n993\t#define CUSTOM_FRAGMENT_DEFINITIONS\n994\tvoid main(void) {\n995\t#define CUSTOM_FRAGMENT_MAIN_BEGIN\n996\t#ifdef CLIPPLANE\n997\tif (fClipDistance&gt_sm_0.0)\n998\t{\n999\tdiscard_sm_\n1000\t}\n1001\t#endif\n1002\tvec3 viewDirectionW_eq_normalize(vEyePosition-vPositionW)_sm_\n1003\t\n1004\tvec4 baseColor_eq_vec4(1._co_1._co_1._co_1.)_sm_\n1005\tvec3 diffuseColor_eq_vDiffuseColor.rgb_sm_\n1006\t\n1007\tfloat alpha_eq_vDiffuseColor.a_sm_\n1008\t\n1009\t#ifdef NORMAL\n1010\tvec3 normalW_eq_normalize(vNormalW)_sm_\n1011\t#else\n1012\tvec3 normalW_eq_normalize(-cross(dFdx(vPositionW)_co_dFdy(vPositionW)))_sm_\n1013\t#endif\n1014\tvec2 uvOffset_eq_vec2(0.0_co_0.0)_sm_\n1015\t#if defined(BUMP) || defined(PARALLAX)\n1016\t#ifdef NORMALXYSCALE\n1017\tfloat normalScale_eq_1.0_sm_\n1018\t#else \n1019\tfloat normalScale_eq_vBumpInfos.y_sm_\n1020\t#endif\n1021\t#if defined(TANGENT) &amp_sm_&amp_sm_ defined(NORMAL)\n1022\tmat3 TBN_eq_vTBN_sm_\n1023\t#else\n1024\tmat3 TBN_eq_cotangent_frame(normalW*normalScale_co_vPositionW_co_vBumpUV)_sm_\n1025\t#endif\n1026\t#endif\n1027\t#ifdef PARALLAX\n1028\tmat3 invTBN_eq_transposeMat3(TBN)_sm_\n1029\t#ifdef PARALLAXOCCLUSION\n1030\tuvOffset_eq_parallaxOcclusion(invTBN*-viewDirectionW_co_invTBN*normalW_co_vBumpUV_co_vBumpInfos.z)_sm_\n1031\t#else\n1032\tuvOffset_eq_parallaxOffset(invTBN*viewDirectionW_co_vBumpInfos.z)_sm_\n1033\t#endif\n1034\t#endif\n1035\t#ifdef BUMP\n1036\t#ifdef OBJECTSPACE_NORMALMAP\n1037\tnormalW_eq_normalize(texture2D(bumpSampler_co_vBumpUV).xyz*2.0-1.0)_sm_\n1038\tnormalW_eq_normalize(mat3(normalMatrix)*normalW)_sm_ \n1039\t#else\n1040\tnormalW_eq_perturbNormal(TBN_co_vBumpUV+uvOffset)_sm_\n1041\t#endif\n1042\t#endif\n1043\t#ifdef TWOSIDEDLIGHTING\n1044\tnormalW_eq_gl_FrontFacing ? normalW _dd_ -normalW_sm_\n1045\t#endif\n1046\t#ifdef DIFFUSE\n1047\tbaseColor_eq_texture2D(diffuseSampler_co_vDiffuseUV+uvOffset)_sm_\n1048\t#ifdef ALPHATEST\n1049\tif (baseColor.a&lt_sm_0.4)\n1050\tdiscard_sm_\n1051\t#endif\n1052\t#ifdef ALPHAFROMDIFFUSE\n1053\talpha*_eq_baseColor.a_sm_\n1054\t#endif\n1055\t#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n1056\tbaseColor.rgb*_eq_vDiffuseInfos.y_sm_\n1057\t#endif\n1058\t#ifdef DEPTHPREPASS\n1059\tgl_FragColor_eq_vec4(0._co_0._co_0._co_1.0)_sm_\n1060\treturn_sm_\n1061\t#endif\n1062\t#ifdef VERTEXCOLOR\n1063\tbaseColor.rgb*_eq_vColor.rgb_sm_\n1064\t#endif\n1065\t#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n1066\t\n1067\tvec3 baseAmbientColor_eq_vec3(1._co_1._co_1.)_sm_\n1068\t#ifdef AMBIENT\n1069\tbaseAmbientColor_eq_texture2D(ambientSampler_co_vAmbientUV+uvOffset).rgb*vAmbientInfos.y_sm_\n1070\t#endif\n1071\t#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n1072\t\n1073\t#ifdef SPECULARTERM\n1074\tfloat glossiness_eq_vSpecularColor.a_sm_\n1075\tvec3 specularColor_eq_vSpecularColor.rgb_sm_\n1076\t#ifdef SPECULAR\n1077\tvec4 specularMapColor_eq_texture2D(specularSampler_co_vSpecularUV+uvOffset)_sm_\n1078\tspecularColor_eq_specularMapColor.rgb_sm_\n1079\t#ifdef GLOSSINESS\n1080\tglossiness_eq_glossiness*specularMapColor.a_sm_\n1081\t#endif\n1082\t#endif\n1083\t#else\n1084\tfloat glossiness_eq_0._sm_\n1085\t#endif\n1086\t\n1087\tvec3 diffuseBase_eq_vec3(0._co_0._co_0.)_sm_\n1088\tlightingInfo info_sm_\n1089\t#ifdef SPECULARTERM\n1090\tvec3 specularBase_eq_vec3(0._co_0._co_0.)_sm_\n1091\t#endif\n1092\tfloat shadow_eq_1._sm_\n1093\t#ifdef LIGHTMAP\n1094\tvec3 lightmapColor_eq_texture2D(lightmapSampler_co_vLightmapUV+uvOffset).rgb*vLightmapInfos.y_sm_\n1095\t#endif\n1096\t#ifdef LIGHT0\n1097\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED0) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR0))\n1098\t\n1099\t#else\n1100\t#ifdef PBR\n1101\t#ifdef SPOTLIGHT0\n1102\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDirection0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1103\t#endif\n1104\t#ifdef HEMILIGHT0\n1105\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightGround0_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1106\t#endif\n1107\t#if defined(POINTLIGHT0) || defined(DIRLIGHT0)\n1108\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1109\t#endif\n1110\t#else\n1111\t#ifdef SPOTLIGHT0\n1112\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDirection0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_glossiness)_sm_\n1113\t#endif\n1114\t#ifdef HEMILIGHT0\n1115\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightGround0_co_glossiness)_sm_\n1116\t#endif\n1117\t#if defined(POINTLIGHT0) || defined(DIRLIGHT0)\n1118\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData0_co_vLightDiffuse0.rgb_co_vLightSpecular0_co_vLightDiffuse0.a_co_glossiness)_sm_\n1119\t#endif\n1120\t#endif\n1121\t#ifdef PROJECTEDLIGHTTEXTURE0\n1122\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler0_co_textureProjectionMatrix0)_sm_\n1123\t#endif\n1124\t#endif\n1125\t#ifdef SHADOW0\n1126\t#ifdef SHADOWCLOSEESM0\n1127\t#if defined(SHADOWCUBE0)\n1128\tshadow_eq_computeShadowWithCloseESMCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_depthValues0)_sm_\n1129\t#else\n1130\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_shadowsInfo0.w)_sm_\n1131\t#endif\n1132\t#else\n1133\t#ifdef SHADOWESM0\n1134\t#if defined(SHADOWCUBE0)\n1135\tshadow_eq_computeShadowWithESMCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_depthValues0)_sm_\n1136\t#else\n1137\tshadow_eq_computeShadowWithESM(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.z_co_shadowsInfo0.w)_sm_\n1138\t#endif\n1139\t#else \n1140\t#ifdef SHADOWPCF0\n1141\t#if defined(SHADOWCUBE0)\n1142\tshadow_eq_computeShadowWithPCFCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.y_co_shadowsInfo0.x_co_depthValues0)_sm_\n1143\t#else\n1144\tshadow_eq_computeShadowWithPCF(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.y_co_shadowsInfo0.x_co_shadowsInfo0.w)_sm_\n1145\t#endif\n1146\t#else\n1147\t#if defined(SHADOWCUBE0)\n1148\tshadow_eq_computeShadowCube(vLightData0.xyz_co_shadowSampler0_co_shadowsInfo0.x_co_depthValues0)_sm_\n1149\t#else\n1150\tshadow_eq_computeShadow(vPositionFromLight0_co_vDepthMetric0_co_shadowSampler0_co_shadowsInfo0.x_co_shadowsInfo0.w)_sm_\n1151\t#endif\n1152\t#endif\n1153\t#endif\n1154\t#endif\n1155\t#ifdef SHADOWONLY\n1156\t#ifndef SHADOWINUSE\n1157\t#define SHADOWINUSE\n1158\t#endif\n1159\tglobalShadow+_eq_shadow_sm_\n1160\tshadowLightCount+_eq_1.0_sm_\n1161\t#endif\n1162\t#else\n1163\tshadow_eq_1._sm_\n1164\t#endif\n1165\t#ifndef SHADOWONLY\n1166\t#ifdef CUSTOMUSERLIGHTING\n1167\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1168\t#ifdef SPECULARTERM\n1169\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1170\t#endif\n1171\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED0)\n1172\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1173\t#ifdef SPECULARTERM\n1174\t#ifndef LIGHTMAPNOSPECULAR0\n1175\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1176\t#endif\n1177\t#endif\n1178\t#else\n1179\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1180\t#ifdef SPECULARTERM\n1181\tspecularBase+_eq_info.specular*shadow_sm_\n1182\t#endif\n1183\t#endif\n1184\t#endif\n1185\t#endif\n1186\t#ifdef LIGHT1\n1187\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED1) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR1))\n1188\t\n1189\t#else\n1190\t#ifdef PBR\n1191\t#ifdef SPOTLIGHT1\n1192\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDirection1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1193\t#endif\n1194\t#ifdef HEMILIGHT1\n1195\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightGround1_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1196\t#endif\n1197\t#if defined(POINTLIGHT1) || defined(DIRLIGHT1)\n1198\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1199\t#endif\n1200\t#else\n1201\t#ifdef SPOTLIGHT1\n1202\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDirection1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_glossiness)_sm_\n1203\t#endif\n1204\t#ifdef HEMILIGHT1\n1205\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightGround1_co_glossiness)_sm_\n1206\t#endif\n1207\t#if defined(POINTLIGHT1) || defined(DIRLIGHT1)\n1208\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData1_co_vLightDiffuse1.rgb_co_vLightSpecular1_co_vLightDiffuse1.a_co_glossiness)_sm_\n1209\t#endif\n1210\t#endif\n1211\t#ifdef PROJECTEDLIGHTTEXTURE1\n1212\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler1_co_textureProjectionMatrix1)_sm_\n1213\t#endif\n1214\t#endif\n1215\t#ifdef SHADOW1\n1216\t#ifdef SHADOWCLOSEESM1\n1217\t#if defined(SHADOWCUBE1)\n1218\tshadow_eq_computeShadowWithCloseESMCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_depthValues1)_sm_\n1219\t#else\n1220\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_shadowsInfo1.w)_sm_\n1221\t#endif\n1222\t#else\n1223\t#ifdef SHADOWESM1\n1224\t#if defined(SHADOWCUBE1)\n1225\tshadow_eq_computeShadowWithESMCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_depthValues1)_sm_\n1226\t#else\n1227\tshadow_eq_computeShadowWithESM(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.z_co_shadowsInfo1.w)_sm_\n1228\t#endif\n1229\t#else \n1230\t#ifdef SHADOWPCF1\n1231\t#if defined(SHADOWCUBE1)\n1232\tshadow_eq_computeShadowWithPCFCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.y_co_shadowsInfo1.x_co_depthValues1)_sm_\n1233\t#else\n1234\tshadow_eq_computeShadowWithPCF(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.y_co_shadowsInfo1.x_co_shadowsInfo1.w)_sm_\n1235\t#endif\n1236\t#else\n1237\t#if defined(SHADOWCUBE1)\n1238\tshadow_eq_computeShadowCube(vLightData1.xyz_co_shadowSampler1_co_shadowsInfo1.x_co_depthValues1)_sm_\n1239\t#else\n1240\tshadow_eq_computeShadow(vPositionFromLight1_co_vDepthMetric1_co_shadowSampler1_co_shadowsInfo1.x_co_shadowsInfo1.w)_sm_\n1241\t#endif\n1242\t#endif\n1243\t#endif\n1244\t#endif\n1245\t#ifdef SHADOWONLY\n1246\t#ifndef SHADOWINUSE\n1247\t#define SHADOWINUSE\n1248\t#endif\n1249\tglobalShadow+_eq_shadow_sm_\n1250\tshadowLightCount+_eq_1.0_sm_\n1251\t#endif\n1252\t#else\n1253\tshadow_eq_1._sm_\n1254\t#endif\n1255\t#ifndef SHADOWONLY\n1256\t#ifdef CUSTOMUSERLIGHTING\n1257\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1258\t#ifdef SPECULARTERM\n1259\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1260\t#endif\n1261\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED1)\n1262\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1263\t#ifdef SPECULARTERM\n1264\t#ifndef LIGHTMAPNOSPECULAR1\n1265\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1266\t#endif\n1267\t#endif\n1268\t#else\n1269\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1270\t#ifdef SPECULARTERM\n1271\tspecularBase+_eq_info.specular*shadow_sm_\n1272\t#endif\n1273\t#endif\n1274\t#endif\n1275\t#endif\n1276\t#ifdef LIGHT2\n1277\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED2) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR2))\n1278\t\n1279\t#else\n1280\t#ifdef PBR\n1281\t#ifdef SPOTLIGHT2\n1282\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDirection2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1283\t#endif\n1284\t#ifdef HEMILIGHT2\n1285\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightGround2_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1286\t#endif\n1287\t#if defined(POINTLIGHT2) || defined(DIRLIGHT2)\n1288\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1289\t#endif\n1290\t#else\n1291\t#ifdef SPOTLIGHT2\n1292\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDirection2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_glossiness)_sm_\n1293\t#endif\n1294\t#ifdef HEMILIGHT2\n1295\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightGround2_co_glossiness)_sm_\n1296\t#endif\n1297\t#if defined(POINTLIGHT2) || defined(DIRLIGHT2)\n1298\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData2_co_vLightDiffuse2.rgb_co_vLightSpecular2_co_vLightDiffuse2.a_co_glossiness)_sm_\n1299\t#endif\n1300\t#endif\n1301\t#ifdef PROJECTEDLIGHTTEXTURE2\n1302\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler2_co_textureProjectionMatrix2)_sm_\n1303\t#endif\n1304\t#endif\n1305\t#ifdef SHADOW2\n1306\t#ifdef SHADOWCLOSEESM2\n1307\t#if defined(SHADOWCUBE2)\n1308\tshadow_eq_computeShadowWithCloseESMCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_depthValues2)_sm_\n1309\t#else\n1310\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_shadowsInfo2.w)_sm_\n1311\t#endif\n1312\t#else\n1313\t#ifdef SHADOWESM2\n1314\t#if defined(SHADOWCUBE2)\n1315\tshadow_eq_computeShadowWithESMCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_depthValues2)_sm_\n1316\t#else\n1317\tshadow_eq_computeShadowWithESM(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.z_co_shadowsInfo2.w)_sm_\n1318\t#endif\n1319\t#else \n1320\t#ifdef SHADOWPCF2\n1321\t#if defined(SHADOWCUBE2)\n1322\tshadow_eq_computeShadowWithPCFCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.y_co_shadowsInfo2.x_co_depthValues2)_sm_\n1323\t#else\n1324\tshadow_eq_computeShadowWithPCF(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.y_co_shadowsInfo2.x_co_shadowsInfo2.w)_sm_\n1325\t#endif\n1326\t#else\n1327\t#if defined(SHADOWCUBE2)\n1328\tshadow_eq_computeShadowCube(vLightData2.xyz_co_shadowSampler2_co_shadowsInfo2.x_co_depthValues2)_sm_\n1329\t#else\n1330\tshadow_eq_computeShadow(vPositionFromLight2_co_vDepthMetric2_co_shadowSampler2_co_shadowsInfo2.x_co_shadowsInfo2.w)_sm_\n1331\t#endif\n1332\t#endif\n1333\t#endif\n1334\t#endif\n1335\t#ifdef SHADOWONLY\n1336\t#ifndef SHADOWINUSE\n1337\t#define SHADOWINUSE\n1338\t#endif\n1339\tglobalShadow+_eq_shadow_sm_\n1340\tshadowLightCount+_eq_1.0_sm_\n1341\t#endif\n1342\t#else\n1343\tshadow_eq_1._sm_\n1344\t#endif\n1345\t#ifndef SHADOWONLY\n1346\t#ifdef CUSTOMUSERLIGHTING\n1347\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1348\t#ifdef SPECULARTERM\n1349\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1350\t#endif\n1351\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED2)\n1352\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1353\t#ifdef SPECULARTERM\n1354\t#ifndef LIGHTMAPNOSPECULAR2\n1355\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1356\t#endif\n1357\t#endif\n1358\t#else\n1359\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1360\t#ifdef SPECULARTERM\n1361\tspecularBase+_eq_info.specular*shadow_sm_\n1362\t#endif\n1363\t#endif\n1364\t#endif\n1365\t#endif\n1366\t#ifdef LIGHT3\n1367\t#if defined(SHADOWONLY) || (defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED3) &amp_sm_&amp_sm_ defined(LIGHTMAPNOSPECULAR3))\n1368\t\n1369\t#else\n1370\t#ifdef PBR\n1371\t#ifdef SPOTLIGHT3\n1372\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDirection3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1373\t#endif\n1374\t#ifdef HEMILIGHT3\n1375\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightGround3_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1376\t#endif\n1377\t#if defined(POINTLIGHT3) || defined(DIRLIGHT3)\n1378\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_roughness_co_NdotV_co_specularEnvironmentR0_co_specularEnvironmentR90_co_NdotL)_sm_\n1379\t#endif\n1380\t#else\n1381\t#ifdef SPOTLIGHT3\n1382\tinfo_eq_computeSpotLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDirection3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_glossiness)_sm_\n1383\t#endif\n1384\t#ifdef HEMILIGHT3\n1385\tinfo_eq_computeHemisphericLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightGround3_co_glossiness)_sm_\n1386\t#endif\n1387\t#if defined(POINTLIGHT3) || defined(DIRLIGHT3)\n1388\tinfo_eq_computeLighting(viewDirectionW_co_normalW_co_vLightData3_co_vLightDiffuse3.rgb_co_vLightSpecular3_co_vLightDiffuse3.a_co_glossiness)_sm_\n1389\t#endif\n1390\t#endif\n1391\t#ifdef PROJECTEDLIGHTTEXTURE3\n1392\tinfo.diffuse*_eq_computeProjectionTextureDiffuseLighting(projectionLightSampler3_co_textureProjectionMatrix3)_sm_\n1393\t#endif\n1394\t#endif\n1395\t#ifdef SHADOW3\n1396\t#ifdef SHADOWCLOSEESM3\n1397\t#if defined(SHADOWCUBE3)\n1398\tshadow_eq_computeShadowWithCloseESMCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_depthValues3)_sm_\n1399\t#else\n1400\tshadow_eq_computeShadowWithCloseESM(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_shadowsInfo3.w)_sm_\n1401\t#endif\n1402\t#else\n1403\t#ifdef SHADOWESM3\n1404\t#if defined(SHADOWCUBE3)\n1405\tshadow_eq_computeShadowWithESMCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_depthValues3)_sm_\n1406\t#else\n1407\tshadow_eq_computeShadowWithESM(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.z_co_shadowsInfo3.w)_sm_\n1408\t#endif\n1409\t#else \n1410\t#ifdef SHADOWPCF3\n1411\t#if defined(SHADOWCUBE3)\n1412\tshadow_eq_computeShadowWithPCFCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.y_co_shadowsInfo3.x_co_depthValues3)_sm_\n1413\t#else\n1414\tshadow_eq_computeShadowWithPCF(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.y_co_shadowsInfo3.x_co_shadowsInfo3.w)_sm_\n1415\t#endif\n1416\t#else\n1417\t#if defined(SHADOWCUBE3)\n1418\tshadow_eq_computeShadowCube(vLightData3.xyz_co_shadowSampler3_co_shadowsInfo3.x_co_depthValues3)_sm_\n1419\t#else\n1420\tshadow_eq_computeShadow(vPositionFromLight3_co_vDepthMetric3_co_shadowSampler3_co_shadowsInfo3.x_co_shadowsInfo3.w)_sm_\n1421\t#endif\n1422\t#endif\n1423\t#endif\n1424\t#endif\n1425\t#ifdef SHADOWONLY\n1426\t#ifndef SHADOWINUSE\n1427\t#define SHADOWINUSE\n1428\t#endif\n1429\tglobalShadow+_eq_shadow_sm_\n1430\tshadowLightCount+_eq_1.0_sm_\n1431\t#endif\n1432\t#else\n1433\tshadow_eq_1._sm_\n1434\t#endif\n1435\t#ifndef SHADOWONLY\n1436\t#ifdef CUSTOMUSERLIGHTING\n1437\tdiffuseBase+_eq_computeCustomDiffuseLighting(info_co_diffuseBase_co_shadow)_sm_\n1438\t#ifdef SPECULARTERM\n1439\tspecularBase+_eq_computeCustomSpecularLighting(info_co_specularBase_co_shadow)_sm_\n1440\t#endif\n1441\t#elif defined(LIGHTMAP) &amp_sm_&amp_sm_ defined(LIGHTMAPEXCLUDED3)\n1442\tdiffuseBase+_eq_lightmapColor*shadow_sm_\n1443\t#ifdef SPECULARTERM\n1444\t#ifndef LIGHTMAPNOSPECULAR3\n1445\tspecularBase+_eq_info.specular*shadow*lightmapColor_sm_\n1446\t#endif\n1447\t#endif\n1448\t#else\n1449\tdiffuseBase+_eq_info.diffuse*shadow_sm_\n1450\t#ifdef SPECULARTERM\n1451\tspecularBase+_eq_info.specular*shadow_sm_\n1452\t#endif\n1453\t#endif\n1454\t#endif\n1455\t#endif\n1456\t\n1457\t\n1458\tvec3 refractionColor_eq_vec3(0._co_0._co_0.)_sm_\n1459\t#ifdef REFRACTION\n1460\tvec3 refractionVector_eq_normalize(refract(-viewDirectionW_co_normalW_co_vRefractionInfos.y))_sm_\n1461\t#ifdef REFRACTIONMAP_3D\n1462\trefractionVector.y_eq_refractionVector.y*vRefractionInfos.w_sm_\n1463\tif (dot(refractionVector_co_viewDirectionW)&lt_sm_1.0)\n1464\t{\n1465\trefractionColor_eq_textureCube(refractionCubeSampler_co_refractionVector).rgb*vRefractionInfos.x_sm_\n1466\t}\n1467\t#else\n1468\tvec3 vRefractionUVW_eq_vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z_co_1.0)))_sm_\n1469\tvec2 refractionCoords_eq_vRefractionUVW.xy/vRefractionUVW.z_sm_\n1470\trefractionCoords.y_eq_1.0-refractionCoords.y_sm_\n1471\trefractionColor_eq_texture2D(refraction2DSampler_co_refractionCoords).rgb*vRefractionInfos.x_sm_\n1472\t#endif\n1473\t#endif\n1474\t\n1475\tvec3 reflectionColor_eq_vec3(0._co_0._co_0.)_sm_\n1476\t#ifdef REFLECTION\n1477\tvec3 vReflectionUVW_eq_computeReflectionCoords(vec4(vPositionW_co_1.0)_co_normalW)_sm_\n1478\t#ifdef REFLECTIONMAP_3D\n1479\t#ifdef ROUGHNESS\n1480\tfloat bias_eq_vReflectionInfos.y_sm_\n1481\t#ifdef SPECULARTERM\n1482\t#ifdef SPECULAR\n1483\t#ifdef GLOSSINESS\n1484\tbias*_eq_(1.0-specularMapColor.a)_sm_\n1485\t#endif\n1486\t#endif\n1487\t#endif\n1488\treflectionColor_eq_textureCube(reflectionCubeSampler_co_vReflectionUVW_co_bias).rgb*vReflectionInfos.x_sm_\n1489\t#else\n1490\treflectionColor_eq_textureCube(reflectionCubeSampler_co_vReflectionUVW).rgb*vReflectionInfos.x_sm_\n1491\t#endif\n1492\t#else\n1493\tvec2 coords_eq_vReflectionUVW.xy_sm_\n1494\t#ifdef REFLECTIONMAP_PROJECTION\n1495\tcoords/_eq_vReflectionUVW.z_sm_\n1496\t#endif\n1497\tcoords.y_eq_1.0-coords.y_sm_\n1498\treflectionColor_eq_texture2D(reflection2DSampler_co_coords).rgb*vReflectionInfos.x_sm_\n1499\t#endif\n1500\t#ifdef REFLECTIONFRESNEL\n1501\tfloat reflectionFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_reflectionRightColor.a_co_reflectionLeftColor.a)_sm_\n1502\t#ifdef REFLECTIONFRESNELFROMSPECULAR\n1503\t#ifdef SPECULARTERM\n1504\treflectionColor*_eq_specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1505\t#else\n1506\treflectionColor*_eq_reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1507\t#endif\n1508\t#else\n1509\treflectionColor*_eq_reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb_sm_\n1510\t#endif\n1511\t#endif\n1512\t#endif\n1513\t#ifdef REFRACTIONFRESNEL\n1514\tfloat refractionFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_refractionRightColor.a_co_refractionLeftColor.a)_sm_\n1515\trefractionColor*_eq_refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb_sm_\n1516\t#endif\n1517\t#ifdef OPACITY\n1518\tvec4 opacityMap_eq_texture2D(opacitySampler_co_vOpacityUV+uvOffset)_sm_\n1519\t#ifdef OPACITYRGB\n1520\topacityMap.rgb_eq_opacityMap.rgb*vec3(0.3_co_0.59_co_0.11)_sm_\n1521\talpha*_eq_(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y_sm_\n1522\t#else\n1523\talpha*_eq_opacityMap.a*vOpacityInfos.y_sm_\n1524\t#endif\n1525\t#endif\n1526\t#ifdef VERTEXALPHA\n1527\talpha*_eq_vColor.a_sm_\n1528\t#endif\n1529\t#ifdef OPACITYFRESNEL\n1530\tfloat opacityFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_opacityParts.z_co_opacityParts.w)_sm_\n1531\talpha+_eq_opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y_sm_\n1532\t#endif\n1533\t\n1534\tvec3 emissiveColor_eq_vEmissiveColor_sm_\n1535\t#ifdef EMISSIVE\n1536\temissiveColor+_eq_texture2D(emissiveSampler_co_vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y_sm_\n1537\t#endif\n1538\t#ifdef EMISSIVEFRESNEL\n1539\tfloat emissiveFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_emissiveRightColor.a_co_emissiveLeftColor.a)_sm_\n1540\temissiveColor*_eq_emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb_sm_\n1541\t#endif\n1542\t\n1543\t#ifdef DIFFUSEFRESNEL\n1544\tfloat diffuseFresnelTerm_eq_computeFresnelTerm(viewDirectionW_co_normalW_co_diffuseRightColor.a_co_diffuseLeftColor.a)_sm_\n1545\tdiffuseBase*_eq_diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb_sm_\n1546\t#endif\n1547\t\n1548\t#ifdef EMISSIVEASILLUMINATION\n1549\tvec3 finalDiffuse_eq_clamp(diffuseBase*diffuseColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1550\t#else\n1551\t#ifdef LINKEMISSIVEWITHDIFFUSE\n1552\tvec3 finalDiffuse_eq_clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1553\t#else\n1554\tvec3 finalDiffuse_eq_clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor_co_0.0_co_1.0)*baseColor.rgb_sm_\n1555\t#endif\n1556\t#endif\n1557\t#ifdef SPECULARTERM\n1558\tvec3 finalSpecular_eq_specularBase*specularColor_sm_\n1559\t#ifdef SPECULAROVERALPHA\n1560\talpha_eq_clamp(alpha+dot(finalSpecular_co_vec3(0.3_co_0.59_co_0.11))_co_0._co_1.)_sm_\n1561\t#endif\n1562\t#else\n1563\tvec3 finalSpecular_eq_vec3(0.0)_sm_\n1564\t#endif\n1565\t#ifdef REFLECTIONOVERALPHA\n1566\talpha_eq_clamp(alpha+dot(reflectionColor_co_vec3(0.3_co_0.59_co_0.11))_co_0._co_1.)_sm_\n1567\t#endif\n1568\t\n1569\t#ifdef EMISSIVEASILLUMINATION\n1570\tvec4 color_eq_vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor_co_0.0_co_1.0)_co_alpha)_sm_\n1571\t#else\n1572\tvec4 color_eq_vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor_co_alpha)_sm_\n1573\t#endif\n1574\t\n1575\t#ifdef LIGHTMAP\n1576\t#ifndef LIGHTMAPEXCLUDED\n1577\t#ifdef USELIGHTMAPASSHADOWMAP\n1578\tcolor.rgb*_eq_lightmapColor_sm_\n1579\t#else\n1580\tcolor.rgb+_eq_lightmapColor_sm_\n1581\t#endif\n1582\t#endif\n1583\t#endif\n1584\t#define CUSTOM_FRAGMENT_BEFORE_FOG\n1585\tcolor.rgb_eq_max(color.rgb_co_0.)_sm_\n1586\t#ifdef LOGARITHMICDEPTH\n1587\tgl_FragDepthEXT_eq_log2(vFragmentDepth)*logarithmicDepthConstant*0.5_sm_\n1588\t#endif\n1589\t#ifdef FOG\n1590\tfloat fog_eq_CalcFogFactor()_sm_\n1591\tcolor.rgb_eq_fog*color.rgb+(1.0-fog)*vFogColor_sm_\n1592\t#endif\n1593\t\n1594\t\n1595\t#ifdef IMAGEPROCESSINGPOSTPROCESS\n1596\tcolor.rgb_eq_toLinearSpace(color.rgb)_sm_\n1597\t#else\n1598\t#ifdef IMAGEPROCESSING\n1599\tcolor.rgb_eq_toLinearSpace(color.rgb)_sm_\n1600\tcolor_eq_applyImageProcessing(color)_sm_\n1601\t#endif\n1602\t#endif\n1603\t#ifdef PREMULTIPLYALPHA\n1604\t\n1605\tcolor.rgb*_eq_color.a_sm_\n1606\t#endif\n1607\t#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n1608\tgl_FragColor_eq_color_sm_\n1609\t}\n1610\t\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_dumpShadersSource (babylon.js_dd_1_dd_6765)\n\t_prepareEffect (babylon.js_dd_1_dd_11195)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Error_dd_ ERROR_dd_ too many uniforms\n\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11260)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob\n[Error] BJS - [11_dd_39_dd_28]_dd_ Trying next fallback.\n\t_ErrorEnabled (babylon.js_dd_4_dd_8244)\n\t_prepareEffect (babylon.js_dd_1_dd_11469)\n\t(anonymous function) (babylon.js_dd_1_dd_4037)\n\tpromiseReactionJob_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-26T16:14:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk this is the important part_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t#define DIFFUSEDIRECTUV 0 2 #define AMBIENTDIRECTUV 0 3 #define OPACITYDIRECTUV 0 4 #define EMISSIVEDIRECTUV 0 5 #define SPECULARDIRECTUV 0 6 #define BUMPDIRECTUV 0 7 #define SPECULARTERM 8 #define NORMAL 9 #define NUM_BONE_INFLUENCERS 4 10 #define BonesPerMesh 33 11 #define LIGHTMAPDIRECTUV 0 12 #define MORPHTARGETS 13 #define NUM_MORPH_INFLUENCERS 1 14 #define VIGNETTEBLENDMODEMULTIPLY 15 #define SAMPLER3DGREENDEPTH 16 #define SAMPLER3DBGRMAP 17 #define LIGHT0 18 #define POINTLIGHT0\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo you have 33 bones + morph targets + 1 light\n_lt_/p_gt_\n\n_lt_p_gt_\n\tso 33 bones means 33 * 4  _eq_ 132. You are already out of budget here\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-26T23:21:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_206163_qt_ data-ipsquote-contentid_eq__qt_35860_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1519661658_qt_ data-ipsquote-userid_eq__qt_4442_qt_ data-ipsquote-username_eq__qt_Deltakosh_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t7 hours ago_co_ Deltakosh said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tOk this is the important part_dd_\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t#define DIFFUSEDIRECTUV 0 2 #define AMBIENTDIRECTUV 0 3 #define OPACITYDIRECTUV 0 4 #define EMISSIVEDIRECTUV 0 5 #define SPECULARDIRECTUV 0 6 #define BUMPDIRECTUV 0 7 #define SPECULARTERM 8 #define NORMAL 9 #define NUM_BONE_INFLUENCERS 4 10 #define BonesPerMesh 33 11 #define LIGHTMAPDIRECTUV 0 12 #define MORPHTARGETS 13 #define NUM_MORPH_INFLUENCERS 1 14 #define VIGNETTEBLENDMODEMULTIPLY 15 #define SAMPLER3DGREENDEPTH 16 #define SAMPLER3DBGRMAP 17 #define LIGHT0 18 #define POINTLIGHT0\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tSo you have 33 bones + morph targets + 1 light\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tso 33 bones means 33 * 4  _eq_ 132. You are already out of budget here\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOk cool. Now I gotta figure out how it got to 33.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo let me get this straight.  Morph targets are 1 uniform per morph or just 1 for all morphs? and light is just 1 uniform?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-27T05:31:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFIXED IT!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWell_co_ I found a suitable workaround.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI had 26 bones (in the original demo) which was too much.  I normally have 24 but I added 2 more for the eyes.  I noticed that the hands never moved in the animation so I just removed the hand bones and it all works in iOS now.  Shadows_co_ skyboxes_co_ gloss and morph targets all fine.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2018-02-27T13:39:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tJust out of interest_co_ is this an operating system problem or hardware problem?  Because all the Android devices allow 256 uniforms but all the iPhones (even latest iPhoneX) only allows 128 uniforms.  Wondering why Apple can_t_t just change this in an OS update.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso_co_ does openGL (or Metal) have a different limitation?  _t_cos I swear I_t_ve seen avatars with finger joints in iPhone apps\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-02-27T16:34:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI would say that Apple is not really motivated to give more power to the web _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_1_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOpenGL has far better support as this is for native apps\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-02-27T18:00:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis is why I kept pestering about uniform buffers needing support in the framework for the WebGL 2.0 port.  Their OpenGL ES doc shows they support up to 12 128-float uniform buffers.  Course_co_ they could also never support WebGL 2.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]