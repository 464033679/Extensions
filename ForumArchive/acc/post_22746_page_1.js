[{"Owner":"Numa","Date":"2016-05-24T04:09:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi there_co_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\tby default it seems the ANIMATIONTYPE_QUATERNION slerps between 2 quaternions the short way (270 degrees turns into -90 for instance).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf I compute the angle between the 2 quaterinon and determine that it_t_s more than 180_co_ how would I go about slerping it the long way?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI tried looking at the code but variable names such as num1 num2 num3 num4 num5 num6 didn_t_t really help _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ Any help appreciated!\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tCheers_co_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_Quaternion.Slerp _eq_ function (left_co_ right_co_ amount) {\n            var num2_sm_\n            var num3_sm_\n            var num _eq_ amount_sm_\n            var num4 _eq_ (((left.x * right.x) + (left.y * right.y)) + (left.z * right.z)) + (left.w * right.w)_sm_\n            var flag _eq_ false_sm_\n            if (num4 &lt_sm_ 0) {\n                flag _eq_ true_sm_\n                num4 _eq_ -num4_sm_\n            }\n            if (num4 &gt_sm_ 0.999999) {\n                num3 _eq_ 1 - num_sm_\n                num2 _eq_ flag ? -num _dd_ num_sm_\n            }\n            else {\n                var num5 _eq_ Math.acos(num4)_sm_\n                var num6 _eq_ (1.0 / Math.sin(num5))_sm_\n                num3 _eq_ (Math.sin((1.0 - num) * num5)) * num6_sm_\n                num2 _eq_ flag ? ((-Math.sin(num * num5)) * num6) _dd_ ((Math.sin(num * num5)) * num6)_sm_\n            }\n            return new Quaternion((num3 * left.x) + (num2 * right.x)_co_ (num3 * left.y) + (num2 * right.y)_co_ (num3 * left.z) + (num2 * right.z)_co_ (num3 * left.w) + (num2 * right.w))_sm_\n        }_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-05-24T22:42:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHere is a playground_dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2INAYY%232_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2INAYY#2_lt_/a_gt_ but as we all know it rotates the short way.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOn line 29/30 could I split the rotation into 2 chained animations maybe?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-05-24T22:47:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tLemme check _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-05-24T22:50:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI_t_m wondering if the _qt_problem_qt_ could come from toQuaternion instead of the lerp\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-05-25T01:34:20Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe slerp function explicitly flips things when the angle is greater than 180 (when num4 &lt_sm_ 0). I tried to take all that out but it caused some objects in my scene to be moved infinitely in a direction_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_Quaternion.Slerp _eq_ function (left_co_ right_co_ amount) {\n            var num2_sm_\n            var num3_sm_\n            var num _eq_ amount_sm_\n            var num4 _eq_ (((left.x * right.x) + (left.y * right.y)) + (left.z * right.z)) + (left.w * right.w)_sm_\n            /*var flag _eq_ false_sm_*/\n            if (num4 &lt_sm_ 0) {\n                //flag _eq_ true_sm_\n                //num4 _eq_ -num4_sm_\n            }\n            if (num4 &gt_sm_ 0.999999) {\n                num3 _eq_ 1 - num_sm_\n                num2 _eq_ /*flag ? -num _dd_*/ num_sm_\n            }\n            else {\n                var num5 _eq_ Math.acos(num4)_sm_\n                var num6 _eq_ (1.0 / Math.sin(num5))_sm_\n                num3 _eq_ (Math.sin((1.0 - num) * num5)) * num6_sm_\n                num2 _eq_ /*flag ? ((-Math.sin(num * num5)) * num6) _dd_ */((Math.sin(num * num5)) * num6)_sm_\n            }\n            return new Quaternion((num3 * left.x) + (num2 * right.x)_co_ (num3 * left.y) + (num2 * right.y)_co_ (num3 * left.z) + (num2 * right.z)_co_ (num3 * left.w) + (num2 * right.w))_sm_\n        }_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-05-25T02:44:02Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI also tried to reproduce the Slerp alogithm from the Ogre engine_co_ I_t_m pretty sure I got it right but it still doesn_t_t rotate properly / makes objects disappear until the last frame is reached_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_Quaternion.Slerp _eq_ function (left_co_ right_co_ amount) {\n\n            var shortestPath _eq_ false_sm_\n            \n            var dotProduct _eq_ (left.x * right.x) + (left.y * right.y) + (left.z * right.z) + (left.w * right.w)_sm_\n            \n            if (dotProduct &lt_sm_ 0.0 &amp_sm_&amp_sm_ shortestPath)\n            {\n                dotProduct _eq_ -dotProduct_sm_\n                right _eq_ right.scale(-1)_sm_\n            }            \n\n            if (Math.abs(dotProduct &lt_sm_ 0.99999))\n            {\n                var sin _eq_ Math.sqrt(1 - Math.sqrt(dotProduct))_sm_\n                var angle _eq_ Math.atan2(sin_co_ dotProduct)_sm_\n                var inverseSin _eq_ 1.0 / sin_sm_\n                var coeff0 _eq_ Math.sin((1.0 - amount) * angle) * inverseSin_sm_\n                var coeff1 _eq_ Math.sin(amount * angle) * inverseSin_sm_\n\n                return new Quaternion((coeff0 * left.x) + (coeff1 * right.x)_co_ (coeff0 * left.y) + (coeff1 * right.y)_co_ (coeff0 * left.z) + (coeff1 * right.z)_co_ (coeff0 * left.w) + (coeff1 * right.w))_sm_\n            }\n            else\n            {            \n                var coeff0 _eq_ (1.0 - amount)_sm_\n                var coeff1 _eq_ amount_sm_\n\n                var t _eq_ new Quaternion((coeff0 * left.x) + (coeff1 * right.x)_co_ (coeff0 * left.y) + (coeff1 * right.y)_co_ (coeff0 * left.z) + (coeff1 * right.z)_co_ (coeff0 * left.w) + (coeff1 * right.w))_sm_\n                return t.normalize()_sm_\n            }\n        }_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-25T11:33:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2INAYY%233_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2INAYY#3_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI commented out the\n_lt_/p_gt_\n\n_lt_p_gt_\n\tif (num4 &gt_sm_ 0.999999) {\n_lt_/p_gt_\n\n_lt_p_gt_\n\tin BABYLON.Quaternion.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-05-25T18:25:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tok...sounds like a good update.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tDo you want submitting a PR with an additional parameter to lerp to enable _qt_long version_qt_?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-05-25T23:27:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_129846_qt_ data-ipsquote-contentid_eq__qt_22746_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1464175998_qt_ data-ipsquote-userid_eq__qt_4289_qt_ data-ipsquote-username_eq__qt_adam_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t12 hours ago_co_ adam said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2INAYY%233_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2INAYY#3_lt_/a_gt_\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tI commented out the\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tif (num4 &gt_sm_ 0.999999) {\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tin BABYLON.Quaternion.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tOh yeah it actually works in the playground!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt still doesn_t_t work on my project though_co_ everything disappears during the animation and I only get the last frame. Any idea why? I tried plugging in my values in the playground and they work fine but for some reason it breaks my animation_co_ and there_t_s nothing in the logs.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t----------------------_lt_br /_gt_\n\tThat IF actually _lt_strong_gt_needs_lt_/strong_gt_ to be there (it still works if you leave it as long as you remove the flag part).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf the dot product of 2 quaternions nears _lt_strong_gt_-1_lt_/strong_gt__co_ they are nearly parallel and the spherical interpolation isn_t_t numerically stable so we must do a linear interpolation there.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf the dot product nears _lt_strong_gt_1_lt_/strong_gt__co_ they are almost identical and there is no need for a spherical interpolation either so again we do a linear one.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthat IF normally checks for the dot product_t_s absolute value since we flip num4 if it_t_s negative. If you get rid of that first IF then you need to use Math.abs otherwise we_t_re missing the case where the dot product nears -1. So the long-way version should look like this_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.Quaternion.Slerp _eq_ function (left_co_ right_co_ amount) {\n            var num2_sm_\n            var num3_sm_\n            var num _eq_ amount_sm_\n            var num4 _eq_ (((left.x * right.x) + (left.y * right.y)) + (left.z * right.z)) + (left.w * right.w)_sm_\n            if (Math.abs(num4) &gt_sm_ 0.999999) {\n                \n                // DO LINEAR INTERPOLATION\n                num3 _eq_ 1 - num_sm_\n                num2 _eq_ num_sm_\n                // which later translates to_dd_ (1.0 - amount) * left + amount * right_sm_                \n            }\n            else {\n                var num5 _eq_ Math.acos(num4)_sm_\n                var num6 _eq_ (1.0 / Math.sin(num5))_sm_\n                num3 _eq_ (Math.sin((1.0 - num) * num5)) * num6_sm_\n                num2 _eq_ (Math.sin(num * num5)) * num6)_sm_\n            }\n            return new BABYLON.Quaternion((num3 * left.x) + (num2 * right.x)_co_ (num3 * left.y) + (num2 * right.y)_co_ (num3 * left.z) + (num2 * right.z)_co_ (num3 * left.w) + (num2 * right.w))_sm_\n        }_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2016-05-26T15:27:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tand did you tested if without long way enabled?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Numa","Date":"2016-06-01T19:51:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi_co_ sorry I_t_ve been away for a while. It turns out those fixes worked fine_co_ my graphics card seems to be the issue_co_ it_t_s a bit old and for some reason was giving up on the animation all together. I tried it on a different computer and it played fine both ways _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks for your help everyone _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]