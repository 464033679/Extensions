[{"Owner":"babylero","Date":"2017-06-14T16:02:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHey there_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ve been working on a FPS-like project for a while now and so far it_t_s been a lot of fun_co_ so first of all thanks to all of you who created this great engine! Now there seems to be a little problem with the camera movement and I would be very happy if someone could help me out with it.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am using FreeCamera combined with collision checking and gravity to create first-person-style controls. Now for some reason the player doesn_t_t always move smoothly but instead sometimes slows down for a few seconds before speeding up again_co_ making the controls feel very jittery and jumpy. My first guess were performance issues but the framerate seems to be stable aroubt 50-60 fps_co_ even during the _qt_jumps_qt_ of the camera. Now I noticed that something similar occurs when I switch the browser tab for a few seconds and then return to the tab with my Babylon.js application_dd_  As soon as I hit the forward key_co_ the camera movement gets a _lt_em_gt_massive_lt_/em_gt_ boost into the according direction for a few seconds_co_ before slowing down again. Could this be some issue with the rendering loop? Because it somehow feels as if the engine is somehow trying to catch up with the frames it _qt_missed_qt_ while another tab was active.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tUnfortunately my project_t_s structure is very modularized and so I cannot easily reproduce my problem in the playground. But here_t_s the code of my Player class_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_import * as BABYLON from _t_babylonjs_t__sm_\n\nexport default class Player {\n\n    constructor(startPosition_co_ container_co_ scene) {\n        this.startPosition _eq_ startPosition_sm_\n        this.container _eq_ container_sm_\n        this.scene _eq_ scene_sm_\n\n        this.speed _eq_ 1_sm_\n        this.angularSensibility _eq_ 1000_sm_\n\n        this.initCamera()_sm_\n        this.initControls()_sm_\n        this.initTriggerMesh()_sm_\n    }\n\n    initCamera() {\n        const position _eq_ BABYLON.Vector3.FromArray(this.startPosition_co_ 0)_sm_\n        this.camera _eq_ new BABYLON.FreeCamera(_t_player_t__co_ position_co_ this.scene)_sm_\n    }\n\n    initControls() {\n        this.camera.attachControl(this.container_co_ false)_sm_\n\n        const width _eq_ 1_sm_\n        const height _eq_ 1_sm_\n        this.camera.ellipsoid _eq_ new BABYLON.Vector3(width_co_ height_co_ width)_sm_\n        this.camera.checkCollisions _eq_ true_sm_\n        this.camera.applyGravity _eq_ true_sm_\n\n        this.camera.speed _eq_ this.speed_sm_\n        this.camera.angularSensibility _eq_ this.angularSensibility_sm_\n\n        this.camera.keysUp _eq_ [38_co_ 87]_sm_\n        this.camera.keysDown _eq_ [40_co_ 83]_sm_\n        this.camera.keysLeft _eq_ [37_co_ 65]_sm_\n        this.camera.keysRight _eq_ [39_co_ 68]_sm_\n    }\n\n    initTriggerMesh() {\n        this.triggerMesh _eq_ new BABYLON.Mesh.CreateBox(_t_box_t__co_ 2_co_ this.scene)_sm_\n        this.triggerMesh.parent _eq_ this.camera_sm_\n    }\n}\n_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tAnd my gravity settings_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_this.scene.gravity _eq_ new BABYLON.Vector3(0_co_ -10_co_ 0)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tMaybe someone of you already knows this issue and how to solve it. If not I_t_ll try to somehow reproduce it in a playground!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-06-14T16:14:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tUnfortunately your setup seems fine. So this could come from other sources_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- Can you check that the collision meshes are simple. Do not use the ground mesh for instance but simple planes or boxes.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- The issue when switching tab is because the scene time was updated in background but the render did not occur so babylon.js thinks it is a framedrop and tries to compensate\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"babylero","Date":"2017-06-14T16:39:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks for your quick answer! I_t_ve replaced the ground mesh by a simple plane mesh now but unfortunately this didn_t_t solve the problem. Maybe I should remove parts of my scene bit by bit to find out if some certain object is causing the trouble...\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs there some way to solve the tab switching issue_co_ maybe by pausing the game when another tab gets focused? If not_co_ I_t_ll just have to make my game so immersive that nobody will even think about opening another tab while playing it _lt_img alt_eq__qt__sm_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ title_eq__qt__sm_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-06-14T17:02:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLol great idea _lt_img alt_eq__qt__dd_D_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ title_eq__qt__dd_D_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tTo stop the switching issue_co_ just set engine.deltaTime to 0 when getting back to your tab\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tFor your laggyness issue_co_ this should be caused by a big meshes with check collisions enabled_dd_ your mission_co_ if you accept it_co_ is to find which one _lt_img alt_eq__qt__sm_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ title_eq__qt__sm_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"babylero","Date":"2017-06-14T17:26:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tActually_co_ there are some quite complex meshes in my scene_co_ but they don_t_t have collision checking enabled. Instead I am using a simple box around them as a collision mesh_co_ so that shouldn_t_t be the problem. My ground plane is quite big_co_ 1000 units_co_ but making it smaller didn_t_t improve the situation. Well_co_ I_t_ll continue my search for the villain mesh.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_em_gt_EDIT_dd_ I replaced the complex meshes (each with about 5000 vertices) by simple boxes and now the camera movement seems to be a bit less laggy. So I probably should reduce the number of vertices_co_ although 5000 per model don_t_t seem that much to me. I already tried mesh.simplify() but it didn_t_t really impact the performance._lt_/em_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAbout the switching issue_dd_ I added the following event listener to my application but the frame skipping issue is still there_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_document.addEventListener(_t_visibilitychange_t__co_ () _eq_&gt_sm_ {\n    if (document.visibilityState _eq__eq__eq_ _t_visible_t_) this.engine.deltaTime _eq_ 0_sm_\n})_sm_\n_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-06-14T19:54:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI will need a repro in the PG_co_ this is not possible to help without code _lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"babylero","Date":"2017-06-15T07:34:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tOkay_co_ I_t_ll try to isolate the problem and reproduce it in the PG!\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]