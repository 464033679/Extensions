[{"Owner":"Pab144","Date":"2017-09-21T21:34:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi guy_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have a very large scene(2541 meshes) and I wrote a bit of code to loop through the meshes array and get specific meshes(Oak trees) so that they could be pushed into the shadows render list_co_ however the shadows quality is very poor...see image.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is the code for my shadowGenerator_co_ as you can see I just want simple shadows no need for ESM or blurred shadows of any kind.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t            var shadowGenerator _eq_ new BABYLON.ShadowGenerator(8192_co_ sunLight)_sm__lt_br /_gt_\n\t            _lt_br /_gt_\n\t            for(var i _eq_ 0_sm_ i &lt_sm_ scene.meshes.length_sm_ i++){_lt_br /_gt_\n\t                if(scene.meshes_lt_em_gt_.name.includes(_qt_oak_qt_)){_lt_/em_gt__lt_br /_gt__lt_em_gt_\n\t                    var tree _eq_ scene.meshes_lt_/em_gt__lt_em_gt__lt_em_gt__sm__lt_/em_gt__lt_/em_gt__lt_br /_gt__lt_em_gt__lt_em_gt_\n\t                    shadowGenerator.getShadowMap().renderList.push(tree)_sm__lt_/em_gt__lt_/em_gt__lt_br /_gt__lt_em_gt__lt_em_gt_\n\t                }_lt_/em_gt__lt_/em_gt__lt_br /_gt__lt_em_gt__lt_em_gt_\n\t            }\n_lt_/em_gt__lt_/em_gt__lt_/p_gt_\n_lt_em_gt__lt_em_gt_\n\n_lt_/em_gt__lt_/em_gt__lt_p_gt__lt_em_gt__lt_em_gt_\n\tThe issue seems to be shadowMap related and I truly don_t_t know what to do about it. In some areas of my level the trees don_t_t even seem to cast a shadow as if they were outside of the light_t_s view. If you guys have any tips or ideas I_t_d appreciate the help a lot.\n_lt_/em_gt__lt_/em_gt__lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_09/site-shadows-1.jpg.8754f0c4a9e5d998a62b8027b946b7bd.jpg_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_14939_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_09/site-shadows-1.thumb.jpg.42c511dafc65032cd2ddfd9e91cf70c2.jpg_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_site-shadows-1.jpg_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-09-22T18:01:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMake sure that the light is as closest as possible to the scene (you can use light.position for that)\n_lt_/p_gt_\n\n_lt_p_gt_\n\ton a different topic_co_  2541 meshes is quite a lot. Perhaps you may want to merge some meshes\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pab144","Date":"2017-09-22T20:50:38Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi David_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhen you say to put the light as close to my scene as possible what exactly do you mean? I_t_m sorry I_t_m a bit confused.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy level is about 5000 units by 5000 units in size_co_ so my light_t_s vector3 position  is_sm_  5000_co_ 5000_co_ 1000. Is my scene too big for the light(see image of level)?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDoes the unit size of the scene affect the shadowMap quality?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank you for your help.\n_lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_09/site-general-1.jpg.b13ce9e2fe55e8b1d274dedae5cc9ce0.jpg_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_14955_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_09/site-general-1.thumb.jpg.bbde687fd23338c6a4f33c19ac7a4a22.jpg_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_site-general-1.jpg_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-09-22T21:26:21Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThat_t_s a big map.  Did you look at softening the shadow?_lt_br /_gt_\n\t    shadowGenerator.useBlurExponentialShadowMap _eq_ true_sm__lt_br /_gt_\n\t    shadowGenerator.useKernelBlur _eq_ true_sm__lt_br /_gt_\n\t    shadowGenerator.blurKernel _eq_ 64_sm_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnother thing is increasing the size of the shadowMap - you have 8192.  What have you tried?  I spent a lot of time getting shadows right - lights_co_ intensities_co_ positions_co_ shadowMinZ_co_ shadowMaxZ_co_ self shadowing...\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pab144","Date":"2017-09-22T23:52:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tWell the reason the shadowMap size is 8196 is that anything smaller doesn_t_t show a shadow at all.  when I use _qt_useBlurExponentialShadowMap _eq_ true_sm__qt_  like you suggested the shadows get nice and blurred and it looks pretty good_co_ however_co_ FPS dips to 15 and I_t_m using an nVidia GeForce GTX 970 which is a decent card. Perhaps my scene is just too big_co_ it_t_s already and between the 2500 plus meshes_co_ 12 million plus vertices  and 78 drawcalls .\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2017-09-23T03:21:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI spent a fair amount of time in blender getting my vertices count way down_co_ but you have millions!  I don_t_t know what the impact would be of making your scene 1/2 as big_co_ but it is a lot of effort if it doesn_t_t make a difference.  I think DK_t_s suggestion to merge meshes would help a lot_co_ if that is possible - ie_dd_ are your building walls with the same material one mesh?  I have a GTX1050 and with certain shadow/light settings my computer struggles to get 30FPS on much smaller levels_co_ so it was a lot of tweaking_co_ but i am made visual sacrifices for useBlurExponentialShadowMap _eq_ true.  Obviously my levels look nowhere as realistic as yours _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_  hopefully somebody with more experience on big levels can give you some pointers...\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pab144","Date":"2017-09-23T04:34:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI mainly use 3dsmax for my modeling and some AutoCAD as my background is in architecture. I baked all the materials into single texture atlas so each house and even the trees are using just 1 diffuse map 1 ambient and 1 bump if required. The scene only has a total of 81 materials. I guess on better rig the scene would probably fly_co_ but at the moment the shadows is what matters the most to me. I appreciate the help a lot though honestly all tips help_co_ if you ever need any help with graphics feel free to ask me anything.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-09-23T16:32:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYou have pretty big numbers _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tSo here are some hints_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- Use instances as soon as possible. For trees_co_ for houses\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- 78 draw calls is a good number but...\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- 12 millions is not a good one_dd_ You clearly need to simplify the scene\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- Is light moving? If not_co_ just bake the shadows in the ambient channel in 3ds max and turn off dynamic shadows. This is one this scene was done_dd_ _lt_a href_eq__qt_https_dd_//www.babylonjs.com/demos/espilit_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs.com/demos/espilit_lt_/a_gt_ \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Pab144","Date":"2017-09-24T00:59:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI will try and use LOD on the tree_t_s and houses_co_ I was trying to avoid more  3d modeling but I guess it can_t_t be helped.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMost of my meshes are instances already there_t_s just so many of them perhaps too many.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can try baking the shadows too as the light is not a moving light. Don_t_t really know how that will work for such a large scene_co_ maybe if i break it into smaller pieces and use LOD as the camera moves around.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank you for all the help guys!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]