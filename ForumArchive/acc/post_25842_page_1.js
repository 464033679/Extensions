[{"Owner":"aconite","Date":"2016-10-19T09:34:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello everybody_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m trying to implement the drag and drop functionality into my project like it is done in this example _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/?18_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/?18_lt_/a_gt_. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tBut it just won_t_t work and I don_t_t know why. I_t_ve tried to debug but it seems that the functions like onPointerMove are never called. Can you give me a hint to the right direction?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_// The babylon engine\nvar engine_sm_\n// The current scene\nvar scene_sm_\n// The HTML canvas\nvar canvas_sm_\n\n// The function onload is loaded when the DOM has been loaded\ndocument.addEventListener(_qt_DOMContentLoaded_qt__co_ function () {\n    init()_sm_\n}_co_ false)_sm_\n\n// Resize the babylon engine when the window is resized\nwindow.addEventListener(_qt_resize_qt__co_ function () {\n    if (engine) {\n        engine.resize()_sm_\n    }\n}_co_false)_sm_\n\n/**\n * Onload function _dd_ creates the babylon engine and the scene\n */\nvar init _eq_ function () {\n    // Engine creation\n    canvas _eq_ document.getElementById(_qt_renderCanvas_qt_)_sm_\n    engine _eq_ new BABYLON.Engine(canvas_co_ true)_sm_\n\n    // Scene creation\n    initScene()_sm_\n\n    // The render function\n    engine.runRenderLoop(function () {\n        scene.render()_sm_\n    })_sm_\n\n}_sm_\n\nvar initScene _eq_ function() {\n    // scene _eq_ new BABYLON.Scene(engine)_sm_\n\n    scene _eq_ addDragAndDropFunctionality(ground)_sm_\n\n\n    var camera _eq_ new BABYLON.ArcRotateCamera(_qt_Camera_qt__co_ 0_co_ 0_co_ 10_co_ new BABYLON.Vector3(0_co_ 0_co_ 0)_co_ scene)_sm_\n    camera.setPosition(new BABYLON.Vector3(20_co_ 200_co_ 400))_sm_\n\n    camera.lowerBetaLimit _eq_ 0.1_sm_\n    camera.upperBetaLimit _eq_ (Math.PI / 2) * 0.99_sm_\n    camera.lowerRadiusLimit _eq_ 150_sm_\n\n    scene.clearColor _eq_ new BABYLON.Color3(0_co_ 0_co_ 0)_sm_\n\n    var h _eq_ new BABYLON.HemisphericLight(_qt_hemi_qt__co_ new BABYLON.Vector3(0_co_ 1_co_ -1)_co_ scene)_sm_\n\n    var d1 _eq_ new BABYLON.DirectionalLight(_qt_dir_qt__co_ new BABYLON.Vector3(1_co_ -1_co_ -2)_co_ scene)_sm_\n    d1.position _eq_ new BABYLON.Vector3(-300_co_300_co_600)_sm_\n\n    var ground _eq_ BABYLON.Mesh.CreateGround(_qt_ground_qt__co_ 500_co_ 500_co_ 2_co_ scene_co_ false)_sm_\n    ground.material _eq_ new BABYLON.StandardMaterial(_qt_ground_qt__co_ scene)_sm_\n    ground.material.diffuseColor _eq_ BABYLON.Color3.FromInts(193_co_ 181_co_ 151)_sm_\n    ground.material.specularColor _eq_ BABYLON.Color3.Black()_sm_\n\n}_sm_\n\nfunction addDragAndDropFunctionality(ground) {\n    var scene _eq_ new BABYLON.Scene(engine)_sm_\n\n    var canvas _eq_ engine.getRenderingCanvas()_sm_\n    var startingPoint_sm_\n    var currentMesh_sm_\n\n    var getGroundPosition _eq_ function () {\n        // Use a predicate to get position on the ground\n        var pickinfo _eq_ scene.pick(scene.pointerX_co_ scene.pointerY_co_ function (mesh) { return mesh _eq__eq_ ground_sm_ })_sm_\n        if (pickinfo.hit) {\n            return pickinfo.pickedPoint_sm_\n        }\n\n        return null_sm_\n    }\n\n    var onPointerDown _eq_ function (evt) {\n        debugger_sm_\n        if (evt.button !_eq__eq_ 0) {\n            return_sm_\n        }\n\n        // check if we are under a mesh\n        var pickInfo _eq_ scene.pick(scene.pointerX_co_ scene.pointerY_co_ function (mesh) { return mesh !_eq__eq_ ground_sm_ })_sm_\n        if (pickInfo.hit) {\n            currentMesh _eq_ pickInfo.pickedMesh_sm_\n            startingPoint _eq_ getGroundPosition(evt)_sm_\n\n            if (startingPoint) { // we need to disconnect camera from canvas\n                setTimeout(function () {\n                    camera.detachControl(canvas)_sm_\n                }_co_ 0)_sm_\n            }\n        }\n    }_sm_\n\n    var onPointerUp _eq_ function () {\n        debugger_sm_\n        if (startingPoint) {\n            camera.attachControl(canvas_co_ true)_sm_\n            startingPoint _eq_ null_sm_\n        }\n    }_sm_\n\n    var onPointerMove _eq_ function (evt) {\n        debugger_sm_\n        if (!startingPoint) {\n            return_sm_\n        }\n\n        var current _eq_ getGroundPosition(evt)_sm_\n\n        if (!current) {\n            return_sm_\n        }\n\n        var diff _eq_ current.subtract(startingPoint)_sm_\n        currentMesh.position.addInPlace(diff)_sm_\n\n        startingPoint _eq_ current_sm_\n\n    }_sm_\n\n    canvas.addEventListener(_qt_pointerdown_qt__co_ onPointerDown_co_ false)_sm_\n    canvas.addEventListener(_qt_pointerup_qt__co_ onPointerUp_co_ false)_sm_\n    canvas.addEventListener(_qt_pointermove_qt__co_ onPointerMove_co_ false)_sm_\n\n    scene.onDispose _eq_ function () {\n        canvas.removeEventListener(_qt_pointerdown_qt__co_ onPointerDown)_sm_\n        canvas.removeEventListener(_qt_pointerup_qt__co_ onPointerUp)_sm_\n        canvas.removeEventListener(_qt_pointermove_qt__co_ onPointerMove)_sm_\n    }_sm_\n\n    this.canvas _eq_ canvas_sm_\n\n    return scene_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JohnK","Date":"2016-10-19T15:47:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWelcome to BabylonJS and to the forum. Have you looked at the Javascipt console for any errors there?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou seem to have called your function addDragAndDropFunctionality with the parameter ground before ground is created.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSuggest you try to do the task in the Playground first before you go off and write the full code. Then if this does not work it is much easier to ask for and get help.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso passing scene as a parameter through different functions can make your code messy. Stick to the playground method of using\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_var createScene _eq_ function() {\n\n// Your BJS code here\n\n    return scene_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tto keep code clean.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tRead more on why this is a good approach _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/generals/A_Babylon.js_Primer#babylonjs-playground_qt_ rel_eq__qt_external nofollow_qt__gt_here._lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2016-10-19T16:13:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi guys.  Welcome to the forum_co_ _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/24034-aconite/?do_eq_hovercard_qt_ data-mentionid_eq__qt_24034_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/24034-aconite/_qt_ rel_eq__qt__qt__gt_@aconite_lt_/a_gt_! \n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere_t_s a quick playground.  I agree with John... using a function to _qt_add drag and drop functionality_qt_ is a little strange... but what the heck.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#GUBMT%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#GUBMT#1_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis playground has some minor problems.  It looks like line 83 has problems with the variable _lt_em_gt_scene_lt_/em_gt_..._lt_em_gt_ _lt_/em_gt_surely a scope problem. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tNotice I send many more args... to addDragAndDropFunctionality() call. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI adjusted the cam_co_ shrunk the ground_co_ did a few other minor little things.  No biggie.  The Get Zip button will work_co_ if anyone wants the _qt_home version_qt_.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe dragging is working.  Yay.  I_t_ll let you experts play with this playground_co_ for now... to work on the scoping problem. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tYet another free playground... by Mister Wingnut.  (oh boy) _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_  Hey_co_ new forum users_co_ you know?  I like to welcome them with a sugar-coated handshake.  heh.  \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"aconite","Date":"2016-10-19T17:17:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks for your answers_co_ I really appreciate that.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_ve just started working with webgl and babylon js_co_ so my code might seem a little messed up. I_t_ll rework it like you suggested _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2016-10-19T18:21:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tCool.  Yeah_co_ maybe not messed up.  Perhaps... a little unexpected_co_ that_t_s all.  I didn_t_t expect to see the drag_t_n_t_drop code... put into a function like that.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSort of an _lt_em_gt_activateDragAndDrop()_lt_/em_gt_ function.  Actually_co_ I kind of like that idea.  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ But I screwed-up your init() function.  (actually killed it).  Sorry.  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tHave you studied it_co_ much?  That drag_t_n_t_drop is very dependent-upon that _lt_em_gt_getGroundPosition() _lt_/em_gt_function... and the ground has to be present.  Want to see something weird?  I knew ya did.  _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#GUBMT%232_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#GUBMT#2_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTry to drag-on mesh areas... that _lt_strong_gt_do not_lt_/strong_gt_ have ground behind them.  They won_t_t drag_co_ right?  Wherever you click-to-drag... must have some ground behind it... because the _lt_em_gt_getGroundPosition()_lt_/em_gt_ NEEDS it.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis can cause trouble when your camera is low and horizon-tal.  _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#GUBMT%233_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#GUBMT#3_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDragging mesh can be a bit more challenging... with the low-altitude camera.  (Just thought I_t_d warn you about possible low-altitude camera issues)  _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_  Party on!\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]