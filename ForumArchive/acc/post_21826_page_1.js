[{"Owner":"ozRocker","Date":"2016-04-10T02:43:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI_t_m trying to create an animation sequence of idle_co_ walk and run in Blender to use in babylon.js.  I can_t_t seem to get it right though.  I_t_ve attached a video of my Blender setup_dd_\n_lt_/p_gt_\n\n_lt_div class_eq__qt_ipsEmbeddedVideo_qt__gt_\n\t_lt_div_gt_\n\t\t_lt_iframe allowfullscreen_eq__qt_true_qt_ frameborder_eq__qt_0_qt_ height_eq__qt_344_qt_ src_eq__qt_https_dd_//www.youtube.com/embed/xD4ZynRQ3sw?feature_eq_oembed_qt_ width_eq__qt_459_qt__gt__lt_/iframe_gt_\n\t_lt_/div_gt_\n_lt_/div_gt_\n\n_lt_p_gt_\n\tYou can also download the Blender file from here_dd_ _lt_a href_eq__qt_http_dd_//www.punkoffice.com/animtest/sequence.blend_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.punkoffice.com/animtest/sequence.blend_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m using the NLA editor here.  My sequence is set up like this_dd_\n_lt_/p_gt_\n\n_lt_ul_gt__lt_li_gt_\n\t\tIdle - frames 1 to 47\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tWalk - frames 48 to 72\n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tRun - frames 73 to 87\n\t_lt_/li_gt_\n_lt_/ul_gt__lt_p_gt_\n\tHowever_co_ the exported .babylon file lists the animations like this_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt__qt_ranges_qt__dd_[{_qt_name_qt__dd__qt_Idle_qt__co__qt_from_qt__dd_1_co__qt_to_qt__dd_47}_co_{_qt_name_qt__dd__qt_Run_qt__co__qt_from_qt__dd_48_co__qt_to_qt__dd_62}_co_{_qt_name_qt__dd__qt_Walk_qt__co__qt_from_qt__dd_63_co__qt_to_qt__dd_86}]_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tIf you want to see the final result go to the page here_dd_ _lt_a href_eq__qt_http_dd_//www.punkoffice.com/animtest_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.punkoffice.com/animtest_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMy code is very simple.  I_t_m just doing the basic setup_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.SceneLoader.Load(_qt_3D/_qt__co_ _qt_main.babylon_qt__co_ engine_co_ function (newScene) {\t\n\tnewScene.executeWhenReady(function () {\n\t\tvar scene _eq_ newScene_sm_\n\t\tvar camera _eq_ new BABYLON.FreeCamera (_qt_FreeCamera_qt__co_ new BABYLON.Vector3 (0_co_ 1_co_ -5)_co_ scene)_sm_\t\t\t\t\t\t\t\t\t\t\n\t\tcamera.attachControl(canvas_co_ true)_sm_\n\n\t\tvar light _eq_ new BABYLON.HemisphericLight(_qt_hemi_qt__co_ new BABYLON.Vector3(0_co_ 1_co_ 0)_co_ scene)_sm_\n\n\t\tmesh _eq_ scene.meshes[0]_sm_\n\n\t\t// to view it correctly\n\t\tmesh.rotate (BABYLON.Axis.X_co_ -Math.PI / 2_co_ BABYLON.Space.LOCAL)_sm_\n\n\t\tskeleton _eq_ newScene.getSkeletonById(0)_sm_\n\t\tanimations _eq_ newScene.beginAnimation(skeleton_co_ 0_co_ 87_co_ true_co_ 1)_sm_\n\n\t\tengine.runRenderLoop(function () {\n\t\t\tscene.render()_sm_\n\t\t})_sm_\n\t})_sm_\n}_co_ function (evt) {\n})_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tDoes anyone know what I might be doing wrong?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2016-04-10T04:30:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIt looks like this guy had a similar problem \n_lt_/p_gt_\n_lt_iframe data-embedcontent_eq__qt__qt_ frameborder_eq__qt_0_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/topic/17878-how-to-load-animations-from-multiple-files/?do_eq_embed&amp_sm_embedComment_eq_101290&amp_sm_embedDo_eq_findComment_qt__gt__lt_/iframe_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-10T05:23:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI think the exporter looks at the action editor rather than the nla editor.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2016-04-10T05:51:37Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_124405_qt_ data-ipsquote-contentid_eq__qt_21826_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1460265836_qt_ data-ipsquote-userid_eq__qt_16886_qt_ data-ipsquote-username_eq__qt_satguru_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t26 minutes ago_co_ satguru said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tI think the exporter looks at the action editor rather than the nla editor.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYep_co_ you_t_re right about that.  I cleared out the NLA editor and it got the right animations. It warps a bit though.  I cleared the mesh parent and re-parented mesh to armature but it still warps.  I updated my code so you can see what it looks like now.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2016-04-10T07:08:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tturns out I forgot to separately apply rotation to mesh and armature.  Well that made the animations look better_co_ but they are still a bit warped.  Definitely different to the original Blender animation.  Is there an up-to-date tutorial on exporting multiple animations for one mesh in Blender?\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-10T08:24:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLooks like there is a small bug in blender exporter 4.4.3. The from and to range are off by 1. There is a new version out _co_ 4.4.4 which seems to have fixed this.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you exported using 4.4.3 then make sure that in your code you increment the _qt_range.to_qt_ and _qt_range.from_qt_ by 1 for each animationrange.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnother thing to keep in mind is the  issue of _qt_rest position_qt_ of your mesh / skeleton.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tA workflow which works for me is\n_lt_/p_gt_\n\n_lt_p style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t1) I create an action containing at least two frames in which the skeleton is in rest position (all transform is set to zero). In my case this normally results in the skeleton in T-Pose.\n_lt_/p_gt_\n\n_lt_p style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t(why two frames ? Seems like babylonjs cannot play an animation containing just 1 frame. bug?)\n_lt_/p_gt_\n\n_lt_p style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t2) just before I start the export I make sure the action in action editor is set to this _qt_rest position_qt_ action and thus my mesh / skeleton are in rest position.\n_lt_/p_gt_\n\n_lt_p style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2016-04-10T08:50:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_124416_qt_ data-ipsquote-contentid_eq__qt_21826_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1460276641_qt_ data-ipsquote-userid_eq__qt_16886_qt_ data-ipsquote-username_eq__qt_satguru_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t26 minutes ago_co_ satguru said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tLooks like there is a small bug in blender exporter 4.4.3. The from and to range are off by 1. There is a new version out _co_ 4.4.4 which seems to have fixed this.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tsweet!  I didn_t_t realise 4.4.4 was out.  I installed that and it actually fixed the warping problem.  If you try out my page now use W_co_A_co_S_co_D and SHIFT to run ( _lt_span style_eq__qt_color_dd_rgb(39_co_42_co_52)_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_float_dd_none_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt__lt_span_gt_ _lt_/span_gt__lt_/span_gt__lt_a href_eq__qt_http_dd_//www.punkoffice.com/animtest_qt_ rel_eq__qt_external nofollow_qt_ style_eq__qt_color_dd_rgb(60_co_105_co_148)_sm_text-decoration_dd_underline_sm_font-family_dd__t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_normal_sm_letter-spacing_dd_normal_sm_line-height_dd_22.4px_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm_background-color_dd_rgb(255_co_255_co_255)_sm__qt__gt_http_dd_//www.punkoffice.com/animtest_lt_/a_gt_ ).  The animations look how they are meant to.  Looping isn_t_t perfect though.  Not sure why.  I got the anims from Mixamo and they also have perfectly looping anims.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"ozRocker","Date":"2016-04-10T09:07:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHmm...this doesn_t_t seem right.  The ranges are missing a frame in-between\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt__qt_ranges_qt__dd_[{_qt_name_qt__dd__qt_Idle_qt__co__qt_from_qt__dd_1_co__qt_to_qt__dd_46}_co_{_qt_name_qt__dd__qt_Run_qt__co__qt_from_qt__dd_48_co__qt_to_qt__dd_61}_co_{_qt_name_qt__dd__qt_Walk_qt__co__qt_from_qt__dd_63_co__qt_to_qt__dd_85}]}]_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tIf I change Run to 47 - 62 that seems to fix it but I_t_ve tried adjusting the Walk range (start and end) and I just can_t_t get the perfect loop.  I think the very last walk frame hadn_t_t been exported\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-10T16:40:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIn blenders do your actions start with frame 0 or frame 1?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf frame 0_co_ shift them to start with frame 1.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI had issues with actions starting with frame 0 so this might help.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2016-04-10T16:54:41Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFirst_co_ 4.4.2 &amp_sm_ 4.4.3 had skeleton animation problems introduced by action support &amp_sm_ inverse kinematics tolerance in 4.4.0.  Took me a while to figure out what went wrong.  It did not show up in my tests.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere should be a 1 frame gap between each action.  I put that in just sanity purposes.  The ranges SHOULD match up to the frames of most of the bones though.  FYI_co_ if a given bone does not move for a given frame_co_ there is no frame for it generated.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere were line breaks put in for 4.4.3_co_ so you can easily view the frames of each bone on separate lines.  Verify that there is no frame 47.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnimationRanges is new as of 2.3.  Blender is the only exporter which currently supports them.  Very little testing has been done.  It needs to be verified whether the export has all the frames_co_ or it BJS is just not playing the last one.  Try a really crazy last frame.  Might help more to determine if it is a export / BJS / or user problem.  Might also be only be visible on the last range_co_ where the first frames of the next range sort of fix it.  Maybe I should change the gap to 10_co_ 100_co_ or 1000.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tMight also be relevant to the 2 frame animation problem.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-10T19:00:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI think the last frame of each action is being dropped.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tand like you mentioned this issue is masked for all actions except the last one.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI created a two frame action. In the second frame I positioned the bones at crazy angles.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI then copied the action to create another action. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tKept one as the last action and the other as second last.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tExported it\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn each action the second frame got dropped.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tAnother issue.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNot directly linked to the above discussion.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis has to do with serialization.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe babylon file exported from blender has one AnimationRange Array and  that is _qt_attached_qt_ to the skeleton_co_ I think.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe babylon file created by serializing the scene (containing the animation exported from blender) has multiple AnimationRange Arrays_co_ one attached to each bone.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2016-04-10T19:10:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tOne final check_co_ now manually edit the exported .babylon_co_ setting the last range end to 1000.  Run it.  If the crazy frame runs it is a BJS error_co_ else a Blender error.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-10T19:54:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOk did that.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCrazy frame does not run.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tInstead i get the following error\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_TypeError_dd_ this._keys[s] is undefined_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]