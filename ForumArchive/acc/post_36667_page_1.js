[{"Owner":"HoloLite","Date":"2018-03-27T18:59:25Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI am hitting into this weird problem on a scene which I imported from a 3ds max project into .Babylon format._lt_br /_gt_\n\tThe scene is quite static_co_ it just has lots of static meshes. Nothing moving at all. No animations.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am viewing the scene in vr mode_co_ and looking at the stats panel_co_ a few stat info looks rather abnormal_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- meshes count_dd_ 235      (this is ok_co_ given there is lot of static meshes in the scene)_lt_br /_gt_\n\t- draw calls_dd_ 332             (this seems too high)_lt_br /_gt_\n\t- texture collisions_dd_ 130 (this also seems too high)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t(Note_dd_ the draw calls and texture collisions rates double up as soon as I enter vr mode_co_ this itself is normal I guess)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhat caused the high draw calls ?_lt_br /_gt_\n\tWhat is texture collision ? why is it so high ?_lt_br /_gt_\n\tAs I mentioned the scene has no moving/animations stuff. It looks very static.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you have tips on how to improve this_co_ please let me know. Thanks\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"V!nc3r","Date":"2018-03-28T08:55:30Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIt depends on many parameters_co_ starting by the computer which supposed to runs the app. Maybe you can share some materials? Maybe your textures size can be reduce? Maybe you make a try for _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/how_to/optimizing_your_scene_qt_ rel_eq__qt_external nofollow_qt__gt_each tips here_lt_/a_gt_? Have you too many dynamic lights_co_ plus dynamic shadows? If yes_co_ why not baking shadows to lightmaps instead?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tEvery scenes are different and can be optimised in different ways.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-03-28T15:50:20Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYou have more details about the texture collision counter here_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//doc.babylonjs.com/how_to/optimizing_your_scene#sceneinstrumentation_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/how_to/optimizing_your_scene#sceneinstrumentation_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_qt__lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_Number of time a texture has to be removed to free a texture slot. Generally_co_ there are 16 texture slots on most recent hardwares. Babylon.js will try to use all of them as the process of binding a texture is expensive. It is a good idea to try to keep this number as low as possible._qt__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_You can reduce this number by sharing materials between meshes._lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_You have a high number of drawcalls (higher than the number of meshes) probably because some meshes may have submeshes_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_I love optimizing scenes so here are some ideas_dd__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_- Run a profiler to see if evaluateActiveMeshes is a top function. If yes then call scene.freezeActiveMeshes()_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_- If not please report here which functions are the more extensive_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span style_eq__qt_background-color_dd_#ffffff_sm_ color_dd_#000000_sm_ font-size_dd_medium_sm_ text-align_dd_left_qt__gt_A good read about optimizations_dd_ _lt_a href_eq__qt_http_dd_//doc.babylonjs.com/how_to/optimizing_your_scene_qt_ ipsnoembed_eq__qt_true_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//doc.babylonjs.com/how_to/optimizing_your_scene_lt_/a_gt__lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-03-28T19:28:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/20526-vnc3r/?do_eq_hovercard_qt_ data-mentionid_eq__qt_20526_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/20526-vnc3r/_qt_ rel_eq__qt__qt__gt_@V!nc3r_lt_/a_gt_ and _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ for the replies!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThose are really good suggestions which I will look into.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tA few questions I have_dd_\n_lt_/p_gt_\n\n_lt_ul_gt_\n\t_lt_li_gt_\n\t\tThe scene was actually built by the max exporter_co_ I had little control over it._lt_br /_gt_\n\t\tYou are actually right that many similar textures are being used in the scene_co_ they can be shared actually_co_ but the exporter is not doing this optimization._lt_br /_gt_\n\t\t_lt_span style_eq__qt_float_dd_none_sm_background-color_dd_transparent_sm_color_dd_rgb(53_co_60_co_65)_sm_font-family_dd_Roboto_co_ _t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_400_sm_letter-spacing_dd_normal_sm_text-align_dd_left_sm_text-decoration_dd_none_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm__qt__gt_I guess I need to manually optimize the loaded meshes/textures in the scene and save them back into .Babylon format ?_lt_br /_gt_\n\t\tDo we have some kind of scene editor that can be used for this type of purpose ?_lt_/span_gt__lt_br /_gt_\n\t\t \n\t_lt_/li_gt_\n\t_lt_li_gt_\n\t\tWhich profiler are you referring here ? I_t_ve never done web profiling before_co_ any suggestions on the tools ?\n\t_lt_/li_gt_\n_lt_/ul_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"JCPalmer","Date":"2018-03-28T20:34:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tCould not the # of texture collisions be reduced also by doing a one time sort of meshes by material_co_ after all created?  Even for meshes with multi-materials_co_ slots re-use would also be helped_co_ if they were ordered together.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis assumes you are sharing materials across meshes already.  You should probably check the source code of your exporter_co_ or do a google search like _t_3ds max share materials_t_.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-03-28T21:07:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYes I was thinking the same thing. The textures optimization can be done in the exporter. Since I am not too familiar with the exporter codes_co_  this is currently not the path I am thinking to take. \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-03-28T22:42:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI was thinking about the F12 profiler in your browser.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso regarding the exporter_co_ it is not something that can be done at exportation time as we cannot decide for you if materials must be shared or not (because you may NEED to have separate materials for your own logic)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-03-29T02:22:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ what I was thinking was that the exporter actually keeps track the hash of each texture file content.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThus it knows whether the a texture is a dup or not_co_ based on the hash. It then can simply ignore the dup texture and share the one it already has in its catalog. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe user does not need to worry if he is applying dup textures all of the place_co_ the exporter eliminates the dup for you. _lt_span style_eq__qt_float_dd_none_sm_background-color_dd_transparent_sm_color_dd_rgb(53_co_60_co_65)_sm_font-family_dd_Roboto_co_ _t_Helvetica Neue_t__co_ Helvetica_co_ Arial_co_ sans-serif_sm_font-size_dd_14px_sm_font-style_dd_normal_sm_font-variant_dd_normal_sm_font-weight_dd_400_sm_letter-spacing_dd_normal_sm_text-align_dd_left_sm_text-decoration_dd_none_sm_text-indent_dd_0px_sm_text-transform_dd_none_sm_white-space_dd_normal_sm_word-spacing_dd_0px_sm__qt__gt_Isn_t_t this possible ?_lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-03-30T16:03:00Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFor texture this is the case_dd_ babylon.js will share all texture data\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI thought you were mentioning materials and materials require multiple simultaneous textures forcing the system to remove unused one as there are only 16 slots hence the collisions\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-04-04T00:57:46Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThere are lots of dup materials in the scene which share the same textures._lt_br /_gt_\n\tI did optimize the number of dup material and texture objects in the scene by around 100 each_co_ and got no improvement in the draw calls and fps. (This is exactly as you said).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe scene does have lots of materials. Some people recommend combining the materials/textures into a single file_co_ a technique called Texture Atlas. This is supposed to reduce the # of draw calls._lt_br /_gt_\n\tTexture atlas has an xml/index file which tells you where each texture is located in the master texture file. That said_co_ would babylonjs be able to work with texture atlas file ? Will the max exporter be able to export it?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-04-04T02:40:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe last question on texture atlas is kinda buried deep in this thread. I will post new thread on this.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-04-14T01:29:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tA few updates on the perf issue_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- I optimized the texture such that texture collision is down to 0. But much to my surprise_co_ the draw call# does not change_co_ thus the fps stays the same too._lt_br /_gt_\n\tThis looks unexpected to me as I thought texture collision would lead to draw calls_co_ right ?? But it is what it is_co_ at least in my app. _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt_ \n_lt_/p_gt_\n\n_lt_p_gt_\n\t- After profiling the perf_co_ it turned out the calls to intersectsTriangle spent most of the time._lt_br /_gt_\n\tFirst suspect was the teleport_co_ and disabling it actually improved the fps by almost twice! (what a surprise)_lt_br /_gt_\n\tWhew! did not know teleport can take that much processing. The scene does have lots of vertices though (over 1.2 millions)._lt_br /_gt_\n\tNow I have to think about how to enable teleport only when the user intends to and disable it automatically after every use. Not sure if this is possible but will investigate.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-04-16T20:18:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t- texture collisions are not linked to draw call as one single draw call can drive up to 8 different textures. Reducing texture collisions helps at driver / GPU level but if you are not GPU bound it won_t_t change a lot\n_lt_/p_gt_\n\n_lt_p_gt_\n\t- You can reduce it by playing with the predicate that detects which objects can be a ground. I also highly encourage having a simple (and not visible) object to use a ground. Like here_dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Website/blob/master/Demos/HillValleyVR/demo.js#L11_qt_ ipsnoembed_eq__qt_false_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Website/blob/master/Demos/HillValleyVR/demo.js#L11_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"HoloLite","Date":"2018-04-16T20:27:23Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThanks for the explanations. The app is indeed cpu bound. The scripting takes a lot more time than rendering. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI will look into the ground object per your suggestion. \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]