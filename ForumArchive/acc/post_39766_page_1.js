[{"Owner":"Luis","Date":"2018-09-01T01:17:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHello there!\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI need to generate a DynamicTexture with a bunch of compositing on the canvas.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOne of the things will be to first draw an image and then_co_ on top of it_co_ write some text.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe only way I could find in docs and google was using the _qt_new Image() and async loading_qt_ approach. But this is not very good for my use case (at least the way it is coded here now).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is because_co_ as the app starts_co_ all the textures I will use are loaded in the loadingscreen_co_ stored as StandardMaterials and then reused/relinked as the app needed.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo the question is_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAfter a StandardMaterial is created (and a diffusetexture is loaded and linked)_co_ then I start creating a DynamicTexture_co_ is it possible to do something like this?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tvar dyntex _eq_ new DynamicTexture()_sm_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tvar ctx _eq_ dyntex.getContext()_sm_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tctx.drawImage( image_from_diffusetexture_co_ 0_co_ 0_co_ width_co_ height)_sm_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSorry for the missing PG. I would not know how to do this in there.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Gijs","Date":"2018-09-02T14:29:38Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi! It was an interesting thing to figure out. Here is a solution_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_CanvasRenderingContext2D.prototype.drawTexture _eq_ function(texture_co_ x_co_ y){\n    let size _eq_ texture.getSize()_sm_\n    let pixels _eq_ texture.readPixels()_sm_\n    this.putImageData(new ImageData(new Uint8ClampedArray(pixels)_co_ size.width_co_ size.height)_co_ x_co_ y)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tSo then you would call _lt_em_gt_drawTexture_lt_/em_gt_ instead of _lt_em_gt_ drawImage_lt_/em_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luis","Date":"2018-09-03T02:12:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi Gijs_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt almost work.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe problem is that in this way_co_ apparently_co_ I can_t_t shrink the texture being applied to the canvas  (to be drawn only in a defined constrained rectangle)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI tried this.scale() and manual scale but it seems to apply to the canvas but not to the texture being applied.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso rotation seems not to work. (and I do rotate the canvas to write text in vertical and horizontal).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI will try my best to make a PG that reproduce the problem.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThanks for the help!\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-09-03T02:40:38Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi Luis - Welcome to the forum! _lt_span_gt__lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf you are getting into rotations and shrinking_co_ you could apply an AdvancedDynamicTexture to the diffuseTexture of a  StandardMaterial_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//doc.babylonjs.com/how_to/gui#advanceddynamictexture_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//doc.babylonjs.com/how_to/gui#advanceddynamictexture_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tOn AdvancedDynamicTexture you can put an image with text over top using the 2D GUI controls like Rectangle_co_ TextBlock and GuiImage.  You have rotations_co_ padding_co_ scaling all available and well tested.  You can see by default how it is applied here to a StandardMaterial_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/gui/src/2D/advancedDynamicTexture.ts#L727_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/gui/src/2D/advancedDynamicTexture.ts#L727_lt_/a_gt__lt_br /_gt_\n\tThe PG will be helpful to see if AdvancedDynamicTexture and GUI can be of use.  Cheers.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Gijs","Date":"2018-09-03T16:43:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_226990_qt_ data-ipsquote-contentid_eq__qt_39766_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1535940763_qt_ data-ipsquote-userid_eq__qt_32660_qt_ data-ipsquote-username_eq__qt_Luis_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t14 hours ago_co_ Luis said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tHi Gijs_co_\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tIt almost work.\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tThe problem is that in this way_co_ apparently_co_ I can_t_t shrink the texture being applied to the canvas  (to be drawn only in a defined constrained rectangle)\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tI tried this.scale() and manual scale but it seems to apply to the canvas but not to the texture being applied.\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tAlso rotation seems not to work. (and I do rotate the canvas to write text in vertical and horizontal).\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tI will try my best to make a PG that reproduce the problem.\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\tThanks for the help!\n\t\t_lt_/p_gt_\n\n\t\t_lt_p_gt_\n\t\t\t \n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tYou_t_re welcome... and right of course_co_ my answer wasn_t_t exactly what you asked!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is more like it_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_function getTextureImage(texture_co_ _canvas){\n    let canvas _eq_ _canvas ? _canvas _dd_ document.createElement(_t_canvas_t_)_sm_\n    let ctx _eq_ canvas.getContext(_t_2d_t_)_sm_\n    let size _eq_ texture.getSize()_sm_\n    let pixels _eq_ texture.readPixels()_sm_\n    canvas.width _eq_ size.width_sm_\n    canvas.height _eq_ size.height_sm_\n    ctx.putImageData(new ImageData(new Uint8ClampedArray(pixels)_co_ size.width_co_ size.height)_co_ 0_co_ 0)_sm_\n    return canvas_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tThat would be your _lt_em_gt_image_from_diffusetexture_lt_/em_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Luis","Date":"2018-09-09T23:00:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHi brianzinn and Gijs_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI think I have finished my tests with success._lt_br /_gt_\n\tIt was not what I wanted but was what I needed._lt_br /_gt_\n\tThe path taken was accord brianzinn sugestion_co_ through AdvancedDynamicTextures.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe good part was that I could achieve_dd__lt_br /_gt_\n\t- Multi-texturing with color blending and alpha control_lt_br /_gt_\n\t- Write texts on the object._lt_br /_gt_\n\t- Good control over UV coordinates_lt_br /_gt_\n\t- Work with faces on individual basis_lt_br /_gt_\n\t- Good set of built-in controls\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe bad part was_dd__lt_br /_gt_\n\t- The textures (in GUI.Image) needed to be loaded in runtime. It would be better if they could be loaded with AssetsManager_co_ while LoadScreen was presented_co_ and then reused/linked as we go. (that was the reason of my initial question in this thread)_lt_br /_gt_\n\t- The TextBlock control lacks an important feature for my case_co_ the fourth parameter of the function fillText() (that shrinks the text respecting a maximum width)._lt_br /_gt_\n\t- I lost the ability to download the generated texture because ADT don_t_t store the texture in the canvas (in getContext()). This was not a requirement per se_co_ but i used this to see what was the underling generated texture. PG proved to be a very good tool in this regard and saved the day._lt_br /_gt_\n\t- The bigger itch was that after finished the ADT_co_ I could only apply it to the emissiveTexture. This almost ruined the test but after disabling light to the mesh it was acceptable. Unfortunately the object now can_t_t have shadowed and specular faces (not as beauty as using diffuseTexture)._lt_br /_gt_\n\t- Working in right hand system as in my case was a little confusing (had to work in left and switch after all finished)\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI_t_m glad that i could accomplish all the stuff i needed and the result was good. Just naming here the difficulties to give some feedback._lt_br /_gt_\n\tI read in more than one place in the forums people trying to achieve multi-texturing. Perhaps if we could use the ADT in diffuseTexture that could be another option?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is the PG_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#YU58J3%238_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#YU58J3#8_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tline 22 and 23 is meant to be commented and uncommented to be able to change the view to the texture or the cube.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthank you two for the time and effort to help. Much appretiated.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t-Luis\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-09-09T23:56:09Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_227624_qt_ data-ipsquote-contentid_eq__qt_39766_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1536534050_qt_ data-ipsquote-userid_eq__qt_32660_qt_ data-ipsquote-username_eq__qt_Luis_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t45 minutes ago_co_ Luis said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tIt would be better if they could be loaded with AssetsManager\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI haven_t_t tried_co_ but is it possible to use the image task?\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_var imageTask _eq_ assetsManager.addImageTask(_qt_image task_qt__co_ _qt_img.png_qt_)_sm_\nimageTask.onSuccess _eq_ function(task) {\n    console.log(task.image)_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tThe src could then be _lt_span style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#545454_sm_font-size_dd_small_sm_text-align_dd_left_sm__qt__gt__qt__lt_/span_gt__lt_em style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#6a6a6a_sm_font-size_dd_small_sm_text-align_dd_left_sm__qt__gt_data_lt_/em_gt__lt_span style_eq__qt_background-color_dd_#ffffff_sm_color_dd_#545454_sm_font-size_dd_small_sm_text-align_dd_left_sm__qt__gt__dd_image/png_sm_base64_co_..._lt_/span_gt__qt_?\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_227624_qt_ data-ipsquote-contentid_eq__qt_39766_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1536534050_qt_ data-ipsquote-userid_eq__qt_32660_qt_ data-ipsquote-username_eq__qt_Luis_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t48 minutes ago_co_ Luis said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tThe TextBlock control lacks an important feature for my case_co_ the fourth parameter of the function fillText()\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tThat_t_s good feedback.  In the meantime_co_ can you get away with using measureText() with different font sizes to get the right fontSize?  I have heard this before about auto-fitting text_co_ so I think others would find something like that useful as well.\n_lt_/p_gt_\n\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_227624_qt_ data-ipsquote-contentid_eq__qt_39766_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1536534050_qt_ data-ipsquote-userid_eq__qt_32660_qt_ data-ipsquote-username_eq__qt_Luis_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t52 minutes ago_co_ Luis said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\tThe bigger itch was that after finished the ADT_co_ I could only apply it to the emissiveTexture.\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tIf you look at how it is assigned to mesh_co_ it does get applied to the diffuseTexture (by default it is applied to emissive and opacity_co_ but for alpha blending_co_ otherwise emissive and diffuse)_lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/gui/src/2D/advancedDynamicTexture.ts#L758_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/gui/src/2D/advancedDynamicTexture.ts#L758_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tGlad you got it working.  Interested if these other ideas will work.  Cheers.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]