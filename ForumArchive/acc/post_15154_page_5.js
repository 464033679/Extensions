[{"Owner":"jerome","Date":"2015-06-29T08:35:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I_t_m investigating on the GC with the CPU profiler._lt_/p_gt__lt_p_gt_I get rid off the closure that was in th SPS _lt_em_gt_setParticles()_lt_/em_gt_ code_co_ just in case closures were the cause of the memory allocations. Nothing changed._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Here is an very simple example _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2320_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#20_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_As you can see_co_ there is no animation _dd_ a SPS is built_co_ then _lt_em_gt_setParticles()_lt_/em_gt_ is called each frame. Particle positions are just set before to an initial random position with _lt_em_gt_initParticles()_lt_/em_gt_. That_t_s all._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_To exonerate _lt_em_gt_computeNormals()_lt_/em_gt_ and _lt_em_gt_computeWorldMatrix()_lt_/em_gt__co_ they aren_t_t used in this example_co_ so they can_t_t have effect on the GC. I even tried to get rid off the rotation matrix computation _dd_ nothing changed_co_ same GC activity._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_This looks like something deeper in BJS allocates memory... unless I can_t_t see something obvious in my own code._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Well_co_ this is not the point of this post._lt_/p_gt__lt_p_gt_In the example_co_ if you rotate the cam and carefully look at the cubes_co_ you will notice the z-sort is not correct._lt_/p_gt__lt_p_gt_All the cubes are just little parts of a single big mesh. So I don_t_t understand why the z-sort isn_t_t correctly applied/updated here._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Any idea ?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_[EDIT] _dd_ for the _lt_em_gt_computeNormals_lt_/em_gt_ + GC side_co_ I just ran this old test for minutes on my computer _lt_a href_eq__qt_http_dd_//jerome.bousquie.fr/BJS/computeNormals/optimized.html_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//jerome.bousquie.fr/BJS/computeNormals/optimized.html_lt_/a_gt__lt_/p_gt__lt_p_gt_no GC is triggered !_lt_/p_gt__lt_p_gt_So the problem seems to have another source._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T09:48:06Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I think I almost solve the GC problem (from my own code_co_ not BJS internals _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ alt_eq__qt__sm_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ )_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The z-sort problem remains ..._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jahow","Date":"2015-06-29T09:48:39Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hey Jerome_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_About the z-sorting issue_dd_ since you use _lt_span style_eq__qt_font-family_dd__t_courier new_t__co_ courier_co_ monospace_sm__qt__gt_mesh.hasVertexAlpha _eq_ true_sm__lt_/span_gt_ in the _lt_span style_eq__qt_font-family_dd__t_courier new_t__co_ courier_co_ monospace_sm__qt__gt_SolidParticleSystem.buildMesh_lt_/span_gt_ method_co_ your global mesh is recognized as alpha-blended and thus_co_ no writing in the depth buffer is done. You cannot have semi-transparent objects AND depth writing_co_ sadly._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_What could be done is sorting all the particles by distance to camera_co_ in the case of semi-transparent particles._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T09:52:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Gotcha !!!!_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Thank you _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T11:59:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_@Jahow _dd_ you were totally right._lt_/p_gt__lt_p_gt_Disabling the _lt_em_gt_mesh.hasVertexAlpha_lt_/em_gt_ gives back a correct z-sort._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_About sorting all the particles by distance from the camera in this very case only (_lt_em_gt_hasVertexAlpha _eq_ true_lt_/em_gt_)_co_ I don_t_t really understand how it is possible as we have only one mesh here._lt_/p_gt__lt_p_gt_Maybe re-sorting the mesh_lt_em_gt_ indices_lt_/em_gt_ array_co_ it is to say reorganize the whole mesh geometry_co_ each frame would do the job_co_ if we assume the first faces (indice triplets in the array) declared will be drawn before the last... not even sure._lt_/p_gt__lt_p_gt_And it would be a very expensive extra-pass since particles can have different shapes in the SPS _dd_ need to sort things and set them back in the same array with potentially different stride for each particle index. Arrg_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So_co_ I think I will remove the hasVertexAlpha valued to true by default. Everyone will then set it as he needs_co_ knowing the rule you said _dd_ _lt_em_gt__qt_You cannot have semi-transparent objects AND depth writing_co_ sadly._qt__lt_/em_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Maybe_co_ later_co_ I will add_co_ only for this case_co_ the kind of sort you just talked about... but I have no idea how to do it because of the single mesh issue._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jahow","Date":"2015-06-29T12:09:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_You_t_re right in that it would mean reorder the indices array. Also that would require rebuilding completely the geometry buffers each frame. It is not unrealistic in terms of performance_co_ but may be hard to code_co_ I don_t_t know (I_t_m not familiar enough with the SPS code)._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Rewriting the buffers each frame is really not that uncommon. That_t_s what the base BJS particle &amp_sm_ sprite systems do after all!_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T12:22:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Ok_co_ I_t_ll probably give a try ... later._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The only difficulty is to manage a different stride per particle in the indice array. Well_co_ headache on debug _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_p_gt_I suppose the distance particle.position/camera.position would be a good criterium to reorder particles... I mean_co_ without taking care about each particle size (because they can different also)_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T13:11:15Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi (again) people_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_here is a first _lt_em_gt_setParticles()_lt_/em_gt_ optimization _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2321_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#21_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The GC has been drastically decreased in the CPU profile on my computer. Only four integer variables (indexes) are now used in this function._lt_/p_gt__lt_p_gt_FYI_co_ the best gain was got when deleting a _lt_em_gt_that_lt_/em_gt_  (_lt_em_gt_that _eq_ this_sm__lt_/em_gt_) variable needed by a closure. The closure itselft had no real effect on the GC_co_ but the _lt_em_gt_that_lt_/em_gt_ variable usage had one (don_t_t know why)._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_In this example_co_ you_t_ve got 200 cubes and 200 torus knots slowly rotating according to their initial random position in space. No normal recomputation each frame and no vertex alpha._lt_/p_gt__lt_p_gt_The GC here_co_ in a local example (outside PG) is profiled at 3% max._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_What I learnt from this _dd_ if a function is to be called in the render loop_co_ it is better to avoid the maximum temporary local variables_co_ _lt_u_gt_even scalar values_lt_/u_gt_._lt_/p_gt__lt_p_gt_If you have to choose between accessing a value through a property _lt_em_gt_this.foo.bar.x_lt_/em_gt_ many times or store this value once _lt_em_gt_var x _eq_ this.foo.bar.x_lt_/em_gt_ and then to use many times this variable_co_ you should choose the first solution._lt_/p_gt__lt_p_gt_Indeed the per property access cost seems lower than the GC variable cleanup cost once the render loop has started._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T13:41:34Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_just for fun ... _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2322_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#22_lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T14:06:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Ok_co_ I just found where (I guess) the other temp variable allocations are._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_In the _lt_em_gt_setParticles()_lt_/em_gt_ method_co_ I need to call_co_ for each vertex of each rotating particle the _lt_em_gt_Matrix.RotationYawPitchRollToRef()_lt_/em_gt_ method._lt_/p_gt__lt_p_gt_This method calls itself two other methods (_lt_em_gt_toRotationMatrix()_lt_/em_gt_ and _lt_em_gt_Quaternion.RotationYawPitchRollToRef()_lt_/em_gt_ ) which both create many temporary variables _dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Math/babylon.math.ts#L1680_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Math/babylon.math.ts#L1680_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Math/babylon.math.ts#L1557_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Math/babylon.math.ts#L1557_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Leads _dd__lt_/p_gt__lt_p_gt_add a condition to compute the (numerous) vertex rotation matrices only if the particle rotation is different from zero (won_t_t change anything for rotationg particles)_lt_/p_gt__lt_p_gt_or_lt_/p_gt__lt_p_gt_reimplement all that stuff _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ alt_eq__qt__dd_(_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-06-29T14:44:14Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Do you plan to keep it as an extension?_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T14:48:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Don_t_t know..._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_It harder than I tought so far (because of the very good ideas from Fenomas and Jahow) and I_t_m fighting with the JS code._lt_/p_gt__lt_p_gt_Not sure I will have the energy to port it to TS then _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_tongue.png_qt_ alt_eq__qt__dd_P_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/tongue@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ ..._lt_/p_gt__lt_p_gt_Maybe if I _lt_em_gt_really_lt_/em_gt_ can achieve it (this means _dd_ the expected features and the best local optimization)_co_ I will feel proud and then will port it._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Don_t_t reall know for now_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-06-29T14:57:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Keeping it as an extension is perfectly fine for me (just need a little doc though_dd_))_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T15:01:20Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_it is already documented _dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJSX/SolidParticleSystem_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJSX/SolidParticleSystem_lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T15:13:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_now the billboard mode works for solids also_lt_/p_gt__lt_p_gt_no PG now_co_ I_t_m leaving_co_ but you can use the last PG if you want to play _dd_ I pushed the last SPS lib on-line_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_[edit] done here _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2323_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#23_lt_/a_gt__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_setParticles(true)_sm__lt_/pre_gt__lt_p_gt_line 74_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2015-06-29T16:09:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hi Jerome!  Good stuff!_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Why use addTriangles?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_PS.addPolygons(100_co_ 10_co_ 3)_sm__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_PS.addTriangles(100_co_ 10)_sm__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Don_t_t these two lines do the same thing?  Just curious.  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_  _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2324_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#24_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_------------------_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Also... hmm...  maybe PS.addPolygons(100_co_ 10_co_ 3_co_ material)_sm_    ?   In that demo_co_ where are the particles getting their diffuseColor from?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_In another demo... _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2325_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#25_lt_/a_gt_. I tried using the particle .color... a color4_dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_PS.initParticles _eq_ function () {     var fact _eq_ 120_sm_     for (var p _eq_ 0_sm_ p &lt_sm_ this.nbParticles_sm_ p++) {       this.particles[p].position _eq_ new BABYLON.Vector3((Math.random() - 0.5) * fact_co_ (Math.random() - 0.5) * fact_co_ (Math.random() - 0.5) * fact)_sm_       this.particles[p].rotation _eq_ new BABYLON.Vector3(Math.random()_co_ Math.random()_co_ Math.random())_sm_       this.particles[p].color _eq_ new BABYLON.Color4(Math.random()_co_ Math.random()_co_ Math.random()_co_ 1)_sm_    }   }_sm__lt_/pre_gt__lt_p_gt_That didn_t_t work so well.  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_ Thoughts?  (thx)  Maybe use .material instead of .color?  *shrug*  Performance hell?_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-29T18:33:57Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hey Wingy_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The explanation about the difference between triangles_co_ quads or any other polygons _dd_ _lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/15154-mesh-based-particle-system/?p_eq_87217_qt__gt_http_dd_//www.html5gamedevs.com/topic/15154-mesh-based-particle-system/?p_eq_87217_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_[EDIT] moreover a triangle is only one face (triangle) and a quad only two faces whereas a 3 vertex polygon is 3 faces_co_ a 4 vertex polygon is 4 faces_co_ etc. It has a real effect when dealing with thousands of particles._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_You can set a Color4 to each particle of course_co_ the alpha channel will be taken in account as usual by activating _dd_ _lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_PSP.mesh.hasVertexAlpha _eq_ true_sm__lt_/pre_gt__lt_p_gt_Maybe_co_ I did a bug on color feature when refactoring the lib_co_ I_t_ll check tomorrow. It used to work so far._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-30T08:11:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_@Wingy _dd_ color bug fixed !_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_It was my fault_co_ I set_lt_em_gt_ color.x_co_ y_co_ z_co_ w_lt_/em_gt_ properties (as for Vector4) in the SPS code instead of _lt_em_gt_color.r_co_ g_co_ b_co_ a_lt_/em_gt_ properties_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_You can have evolving colors if you set them in the _lt_em_gt_updateParticle(particle)_lt_/em_gt_ function also_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2327_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#27_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_black particles slightly getting red_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-30T09:39:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_As it called for every vertex of every solid particles_co_ I just added an internal _lt_em_gt_Quaternion.RotationYawPitchRoll()_lt_/em_gt_ method _dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJSX/SolidParticleSystem/blob/master/solidparticlesystem.js#L401_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJSX/SolidParticleSystem/blob/master/solidparticlesystem.js#L401_lt_/a_gt_ with no temp local variables_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_In my local tests with the Chrome CPU profiler_co_ the GC decreases now under 1.5 % !_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Last version pushed to the link of the  PG_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_[Edit] added another tiny optimization _dd_ the quaternions are now computed only if a mesh or particle rotation if different from zero._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-30T13:33:14Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Some stress tests with Chrome here _dd__lt_/p_gt__lt_p_gt_each particle has its own velocity_co_ scale_co_ color and rotation_co__lt_/p_gt__lt_p_gt_measures with debugLayer_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I put here the limits (rounded to thousands) before it becomes lower than 60 fps_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_plane particles _dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_billboard mode_co_ no normal _dd_ 3000 triangles + 1000 quads + 1000 pentagons + 1000 hexagons _eq_ 6000 plane particles facing the cam_lt_/p_gt__lt_p_gt_billboard mode with light reflection _dd_ 1500 triangles + 1000 quads + 1000 pentagons + 1000 hexagons _eq_ 4500 plane particles facing the cam + reflecting_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_normal mode_co_ no normal _dd_ 7000 triangles + 1000 quads + 1000 pentagons + 1000 hexagons _eq_ 10 K plane particles_lt_/p_gt__lt_p_gt_normal mode with light reflection_dd_ 2000 triangles + 1000 quads + 1000 pentagons + 1000 hexagons _eq_ 5000 plane particles_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_3D particles (I don_t_t test the billboard mode here) _dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_no normals _dd_ 2500 tetrahedrons + 1000 cubes _eq_ 3500 solid particles_lt_/p_gt__lt_p_gt_with normals _dd_ 1500 tetrahedrons + 500 cubes _eq_ 2000 solid particles reflecting light_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_If you then use some custom shapes with _lt_em_gt_SPS.addShape()_lt_/em_gt__co_ like cylinders_co_ spheres_co_ torus_co_ ribbons_co_ whatever_co_ the performance is directly related to the amount of vertices and indices to manage._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_In order to compare_co_ we keep the same particle properties here (own velocity_co_ color_co_ rotation and scale) and we set the SPS in the same _qt_mode_qt_ than the BJS particle system or the Fenomas mesh particle system._lt_/p_gt__lt_p_gt_It is to say _dd_ only quads in billboard mode and no normals._lt_/p_gt__lt_p_gt_The SPS here reach 10 K particles._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_I guess both other system do better in terms of performance._lt_/p_gt__lt_p_gt_For plane particles_co_ the SPS is slower but has a better compositing than the BJS internal one and the ability to rotate (mesh and particles)_co_ to reflect the light or to mix different shapes which are absent features in one or the other._lt_/p_gt__lt_p_gt_Moreover the SPS has no integrated behavior_co_ it is to say no emitter whereas BJS and Fenomas ones provide an emitter. You have to code it by your own here._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_For solid particles_co_ I_t_m afraid you don_t_t have the choice so far..._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_have fun _dd_ _lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#2KSQ1R%2328_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#2KSQ1R#28_lt_/a_gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2015-06-30T15:17:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Wow_co_ what a demo.  8 trillion things happening... in 76 lines of JS (with a bit of help from the includes)  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ alt_eq__qt__sm_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt_  Just amazing!_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-06-30T18:59:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_and above all _dd_ just one mesh  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ alt_eq__qt__sm_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_[EDIT] tested at home on my pushcart laptop _dd_ runs at 60 fps !_lt_/p_gt__lt_p_gt_I_t_m very proud of it because I know I wouldn_t_t have succeeded to make 400 different meshes rotate and orbitate with the classical way on this computer_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Wingnut","Date":"2015-07-01T01:37:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_So_co_ now_co_ a snow blower?  (mesh blower)  One meter of fresh mesh has fallen on the small Canadian village of Polygonia_co_ Manitoba.  Your job is to build the first mesh blower.  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__lt_img src_eq__qt_https_dd_//s-media-cache-ak0.pinimg.com/736x/78/55/a0/7855a05bbad6fec064df4fc4e0202203.jpg_qt_ alt_eq__qt_7855a05bbad6fec064df4fc4e0202203.jpg_qt__gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_errr... maybe not. _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2015-07-01T10:33:52Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_What is this machine from another galaxy ?  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_biggrin.png_qt_ alt_eq__qt__dd_D_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/biggrin@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_br_gt_They could have put a hood/cap to hide the engine  _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_tongue.png_qt_ alt_eq__qt__dd_P_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/tongue@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-07-01T13:54:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_aargg... I have a new super feature_co_ but meanwhile I broke the billboard mode on rotating meshes and I just can_t_t find the bug_lt_/p_gt__lt_p_gt_iiiiiirrrrkkkk _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_angry.png_qt_ alt_eq__qt__dd_angry_dd__qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]