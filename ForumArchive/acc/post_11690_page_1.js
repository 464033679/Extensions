[{"Owner":"jerome","Date":"2015-01-13T15:41:18Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hello guys/gals_co__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Here_t_s a short feedback about dynamicTexture usage._lt_/p_gt__lt_p_gt_The soft I_t_m coding intends to display live network monitoring _dd__lt_/p_gt__lt_ul_gt__lt_li_gt_data -bandwith_co_ nb of unicast/multicast/tcp/udp packets_co_ etc - are collected (snmp) server-side at a regular frequency from many switches down the local company network and written in a json file published on the web server_co__lt_/li_gt__lt_li_gt_the client (the browser) displays a 3D graph representing this network and sends periodical xhr requests to the web server to get the fresh data_co__lt_/li_gt__lt_li_gt_it then updates graphically (animated particles ? not yet implemented) this graph and displays textual data_co__lt_/li_gt__lt_li_gt_between two collects_co_ textual data (numeric values) evolve according to some simple tween to give the user the feeling of a continuous variation_co_ and thus the understanding of how they vary (increasing/decreasing_co_ slowly/fast) instead of snapshot-like display._lt_/li_gt__lt_/ul_gt__lt_p_gt_So_co_ I use dynamicTexture objects._lt_/p_gt__lt_p_gt_Assuming I have_co_ say_co_ 40 measures to display_co_ I create 40 sprites at fixed position on my graph._lt_/p_gt__lt_p_gt_Before any updates in the render loop_co_ all my browsers display and animate the graph with arcRotateCamera at 60 fps._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_first case _dd__lt_/p_gt__lt_p_gt_each measure to be displayed has got its own spriteManager and its lone sprite._lt_/p_gt__lt_p_gt_each spriteManager is textured with a different dynamicTexture._lt_/p_gt__lt_p_gt_each frame_co_ every dynamicTexture is updated ( _lt_em_gt_drawText()_lt_/em_gt_ ) with new text values._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__eq_&gt_sm_ performance falls down dramatically to 30 fps with Chromium and about 8-9 fps with FF (Linux user _dd_ I don_t_t have IE but I guess it will compete with chrome)_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_second case _dd__lt_/p_gt__lt_p_gt_a global dynamicTexture is created._lt_/p_gt__lt_p_gt_each measure to be displayed has got its own spriteManager and its lone sprite._lt_/p_gt__lt_p_gt_each spriteManager is textured with  the global dynamicTexture (to be then offsetted)._lt_/p_gt__lt_p_gt_each frame_co_ the global dynamicTexture is update _lt_strong_gt_once_lt_/strong_gt_ with new text values concatened as I know the canvas2D fillText() is a very costly operation._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__eq_&gt_sm_ quite good improvment _dd_ Chromium at 60 fps and FF now at 30 fps !_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_third case _dd__lt_/p_gt__lt_p_gt_a global dynamicTexture is created._lt_/p_gt__lt_p_gt_a global spriteManager is created._lt_/p_gt__lt_p_gt_each measure to be displayed hos got the same global spriteManager but its own sprite._lt_/p_gt__lt_p_gt_the global spriteManager is textured with the global dynamicTexture._lt_/p_gt__lt_p_gt_each frame_co_ the global dynamicTexture is update _lt_strong_gt_once_lt_/strong_gt_ with new text values concatened._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt__eq_&gt_sm_ exactly the same results than the second case._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So ..._lt_/p_gt__lt_p_gt_BJS is quite optimized (who could think different here ?) as it can manage as well 1 or 40 spriteManagers with no performance drop._lt_/p_gt__lt_p_gt_DynamicTexture is a powerful but dangerous tool._lt_/p_gt__lt_p_gt_It_t_s not a pure BJS problem (I had the same results with threejs and a home made dynamicTexture-like implementation) but a well known among html5 2D game coders canvas2D problem._lt_/p_gt__lt_p_gt_The canvas2D fillText() method is really really costly in terms of performance and should then be used as little as possible in animations._lt_/p_gt__lt_p_gt_As moreover it can_t_t handle automatic new lines_co_ changing colors_co_ fonts_co_ size in the same text line (you need a call with new parameters each time to do this)_co_ it could be fast a mess to display many different text values._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Hope it will help you guys stuck in the same text updating problems _sm_-)_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_ _lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-01-13T19:04:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Hey thank you_co_ this would be pretty useful for new developers. Our new documentation site will be open soon and I would like to suggest you to write an article on it about this !_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-01-13T19:42:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_oki_lt_/p_gt__lt_p_gt_I_t_ll do it_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-01-15T11:05:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I just made a last test to refine what was really the cause of the performance drop as I knew fillText() is expensive but not _lt_em_gt_that_lt_/em_gt_ expensive _dd_ we update score values_co_ infos_co_ etc each frame in 2D games._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So my last test was to _lt_strong_gt_not_lt_/strong_gt_ use dynamicTexture.drawText() and still write many text values each frame (not only once) in one global texture (_lt_em_gt_dataTexture var_lt_/em_gt_)._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_the content of my render loop looks like _dd__lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_var  i _eq_ 1_sm_var dataHeight _eq_ 50_sm_dataTexture.drawText(_qt__qt__co_ 0_co_ 0_co_ null_co_ null_co_ _qt_transparent_qt_)_sm_  // lazy way to clear the former textctx.font _eq_ _qt_36px arial_qt__sm_     // ctx _eq_ dataTexture.getContext()_sm_ set once beforectx.fillStyle _eq_ _qt_#000000_qt__sm_for (var mes in metrics) {  var text _eq_ someFunction(metrics[mes])_sm_  ctx.fillText(text_co_ 5_co_ i * dataHeight)_sm_  i++_sm_ // dataTexture.update(false)_sm_  // if uncommented here_co_ performance drops !}dataTexture.update(false)_sm__lt_/pre_gt__lt_p_gt__eq_&gt_sm_ FF at 30 fps and Chromium at 60 fps_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Here we are between _lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/11690-dynamic-texture-feedback/?p_eq_67519_qt__gt_first and second_lt_/a_gt_ case _dd__lt_/p_gt__lt_p_gt_I use only one global texture for my sprites but I still call _lt_em_gt_fillText()_lt_/em_gt__co_ as many times as the number of sprites_co_ per frame._lt_/p_gt__lt_p_gt_I just call the _lt_em_gt_dynamicTexture.update()_lt_/em_gt_ _lt_strong_gt_once_lt_/strong_gt_ each frame._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_So it seems the real bottleneck_co_ though the relative cost of canvas 2D _lt_em_gt_fillText()_lt_/em_gt__co_ is the _lt_em_gt_dynamicTexture.update()_lt_/em_gt_ _dd_-(_lt_/p_gt__lt_p_gt_If the _lt_em_gt_update()_lt_/em_gt_ method is called after each _lt_em_gt_fillText()_co__lt_/em_gt_ so many times per frame_co_ the performance drops dramatically (state machine ?)_co__lt_/p_gt__lt_p_gt_If it_t_s only called once after all the _lt_em_gt_fillText()_co__lt_/em_gt_ so only once per frame_co_ performance keeps good._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Maybe would it be pertinent _lt_strong_gt_not_lt_/strong_gt_ to call _lt_em_gt_update()_lt_/em_gt_ method within the _lt_em_gt_dynamicTexture.drawText()_lt_/em_gt_ method and explicity call it to have then the text passed to the texture somewhere else in the code when the developer needs it ?_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_line 79 _dd_ _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/Babylon/Materials/Textures/babylon.dynamicTexture.ts#L79_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/Babylon/Materials/Textures/babylon.dynamicTexture.ts#L79_lt_/a_gt__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_don_t_t know ..._lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-01-15T15:42:42Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Another thing about dynamicTexture _dd__lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_The clearColor parameter is used to fill a rectangle background before the text is written onto this colored rectangle._lt_/p_gt__lt_p_gt_This color can be obviously set to _lt_em_gt__qt_transparent_qt__lt_/em_gt_ or to _lt_em_gt__qt_rgba(0_co_ 0_co_ 0_co_ 0)_qt_ _lt_/em_gt_if you need a transparent background._lt_/p_gt__lt_p_gt_Therefore if you use such a transparent background_co_ you should know that the texture won_t_t be cleared if you update an existing texture _dd_ a transparent background is filled above the former one and your text is written... above the former one._lt_/p_gt__lt_p_gt_If you use some colored background with no transparency_co_ the clearColor parameter will do the job as the former content is repainted with your plain color._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_If you really need to _lt_strong_gt_clear_lt_/strong_gt_ the texture content (so_co_ mandatory only on transparent backgrounds) you have to explicity use the canvas2D_lt_em_gt_ clearRect()_lt_/em_gt_ method._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_example _dd_ a blue text on a transparent background_co_ this can be updated in the render loop (_lt_em_gt_incremental var i_lt_/em_gt_)_lt_/p_gt__lt_pre class_eq__qt_ipsCode prettyprint_qt__gt_var texture _eq_ new BABYLON.DynamicTexture(_qt_DynamicTexture_qt__co_ 512_co_ scene_co_ true)_sm_ // instanciated before render loop...// in the render loopvar text _eq_ _qt_My nice text #_qt_+i_sm_var ctx _eq_ texture.getContext()_sm_ctx.clearRect(0_co_ 0_co_ 512_co_ 512)_sm_  // sized to the dynamic texture. This actually really clears the canvas !texture.drawText(text_co_ 5_co_ 200_co_ _qt_normal bold 48px Arial_qt__co_ _qt_blue_qt__co_ null_co_ false)_sm__lt_/pre_gt__lt_p_gt_Maybe a _lt_em_gt_dynamicTexture.clear()_lt_/em_gt__lt_em_gt_ _lt_/em_gt_method would be useful so ?_lt_/p_gt__lt_p_gt_I wish I could code it but I haven_t_t learnt enough typescript to do it right so far _dd_-(_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-01-15T20:32:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I agree a clear could be useful as well as an optional update parameter to drawtext._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_Do you want to submit a PR for this (to get credits) or I can do it either _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-01-16T08:35:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_I_t_m afraid that you would have coded_co_ tested_co_ pushed it_co_ then have some holidays to hawaii again before I just could compile a simple hello-world-script in typescript here._lt_/p_gt__lt_p_gt_So please do it if you don_t_t mind._lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_But I promise I_t_ll get into TS (and then submit PR) soon !_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2015-01-16T18:19:32Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_Done _lt_img src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ alt_eq__qt__dd_)_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ width_eq__qt_20_qt_ height_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"jerome","Date":"2015-01-16T19:09:55Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_TS Lucky Luke !!!_lt_/p_gt__lt_p_gt_ _lt_/p_gt__lt_p_gt_cinq iou_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]