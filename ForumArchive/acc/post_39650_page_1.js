[{"Owner":"darkknight8","Date":"2018-08-27T03:11:44Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI have an existing scene with a group of meshes that represents a character. I want to attach a hat to the character. However_co_ when I want to import the hat mesh into the scene with the character_co_ it appears on top of the character like I expected but it_t_s not attached to the character_co_ which makes sense because it_t_s a different mesh. What_t_s the best approach to make the hat be part of the character mesh?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-08-27T05:41:45Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWelcome to the forum!!  You need to _lt_em_gt_parent_lt_/em_gt_ the hat to the character mesh.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_let characterMesh _eq_ ....\nlet hatMesh _eq_ ...\nhatMesh.setParent(characterMesh)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tsetParent() method will maintain the relative position and properties (ie_dd_ rotation_co_ scaling) of the hat (unlike hatMesh.parent - characterMesh).  Now when you move the character_co_ the hat will move along with the character!\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"darkknight8","Date":"2018-08-27T12:36:10Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFor some reason_co_ it_t_s not working. Here is my code so far_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.SceneLoader.Append(_qt_/assets/_qt__co_ _qt_character.glb_qt__co_ scene_co_ function (scene) {\n     scene.createDefaultCameraOrLight(true)_sm_\n\n     let characterMesh _eq_ scene.meshes_sm_\n\n     BABYLON.SceneLoader.ImportMesh(null_co_ _qt_/assets/_qt__co_ _qt_hat.glb_qt__co_ scene_co_ function (meshes_co_ particleSystems_co_ skeletons) {\n                        \n meshes.setParent(characterMesh)_sm_\n console.log(meshes.parent)_sm_\n\n                    })_sm_\n\n})_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tWhat am I doing wrong here? Sorry_co_ the code formatting tool is not working for some reason.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-08-27T14:12:02Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tmeshes is an array_co_ so you need to add one at a time. ie_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_BABYLON.SceneLoader.ImportMesh(null_co_ _qt_/assets/_qt__co_ _qt_hat.glb_qt__co_ scene_co_ function (meshes_co_ articleSystems_co_ skeletons) {\n  meshes.forEach(m _eq_&gt_sm_ m.setParent(characterMesh))_sm_\n  // console.log(meshes.parent)_sm_\n})_sm_\n_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tI haven_t_t see hat.glb_co_ but it might already have a root node_co_ so you_t_d only need to set that one mesh - then it would be\n_lt_/p_gt_\n\n_lt_p_gt_\n\t meshes[0].setParent(characterMesh)_co_ where 0 is the index of the root mesh.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"darkknight8","Date":"2018-08-27T21:21:02Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis works_co_ but the hat appearance looks messed up_co_ do you know what could be causing this? Is it the way that I am importing it?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-08-27T22:14:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tWe may need to see it in the playground to help a bit more _lt_img alt_eq__qt__sm_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_wink.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/wink@2x.png 2x_qt_ title_eq__qt__sm_)_qt_ width_eq__qt_20_qt__gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"darkknight8","Date":"2018-08-28T00:03:12Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ I can_t_t make a full playground with it_co_ since I can_t_t release those mesh (though I can PM them to you if you need to see them _lt_span_gt__lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/span_gt_). But I have taken screenshots to show what I mean. The first screenshot shows the hat when you import it into the sandbox or you just import it regularly via append. The second picture shows what happens when you import it and attach it to the character_t_s head. As you can see_co_ the colors are way off and it happens to all the hat_co_ not just this specific one. I am assuming it has to do with material issues.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis is how the code looks_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_     var delayCreateScene _eq_ function () {\n\n                // create a basic BJS Scene object\n                let scene _eq_ new BABYLON.Scene(engine)_sm_\n\n                \n\n                scene.clearColor _eq_ new BABYLON.Color4(0_co_ 0_co_ 0_co_ 1)_sm_\n\n                \n                BABYLON.SceneLoader.Append(_qt_/assets/_qt__co_ _qt_character.glb_qt__co_ scene_co_ function (scene) {\n                    scene.createDefaultCameraOrLight(true)_sm_\n\n\n \n                    scene.activeCamera.useFramingBehavior _eq_ true_sm_\n\n                    // Forces our glTF file to face forward\n                    scene.activeCamera.alpha +_eq_ Math.PI_sm_\n\n\n                    scene.activeCamera.fov _eq_ 0.6_sm_\n\n                    const framingBehavior _eq_ scene.activeCamera.getBehaviorByName(_qt_Framing_qt_)_sm_\n\n                    framingBehavior.framingTime _eq_ 0_sm_\n                    framingBehavior.elevationReturnTime _eq_ -1_sm_\n\n                    const worldExtends _eq_ scene.getWorldExtends()_sm_\n                    framingBehavior.zoomOnBoundingInfo(worldExtends.min_co_ worldExtends.max)_sm_\n\n       \n\n\n                    let characterMesh _eq_ scene.meshes_sm_ // here we have the character meshes (8 to be exact)\n       _sm_\n\n\n                    BABYLON.SceneLoader.ImportMesh(null_co_ _qt_/assets/_qt__co_ _qt_hat.glb_qt__co_ scene_co_ function (meshes_co_ particleSystems_co_ skeletons) {\n                        for (let i _eq_ 1_sm_ i &lt_sm_ meshes.length_sm_ i++) {\n                            meshes[i].setParent(characterMesh[0])_sm_\n                        }\n\n\n\n                    })_sm_\n\n                    window.addEventListener(_t_resize_t__co_ function () {\n                        engine.resize()_sm_\n                    })_sm_\n\n\n                    engine.runRenderLoop(function () {\n                        scene.render()_sm_\n                    })_sm_\n\n\n\n\n\n\n                })_sm_\n\n\n                return scene_sm_\n\n\n            }_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/1669778062_Screenshotfrom2018-08-2719-52-42.png.e403932340885488b332bc24c21cdee8.png_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_19786_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/1669778062_Screenshotfrom2018-08-2719-52-42.png.e403932340885488b332bc24c21cdee8.png_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_Screenshot from 2018-08-27 19-52-42.png_qt__gt__lt_/a_gt__lt_/p_gt_\n_lt_p_gt__lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/1456996760_Screenshotfrom2018-08-2719-54-28.png.d28a14daccedd6e6d4db513aa2953dec.png_qt_ class_eq__qt_ipsAttachLink ipsAttachLink_image_qt__gt__lt_img data-fileid_eq__qt_19787_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/1456996760_Screenshotfrom2018-08-2719-54-28.png.d28a14daccedd6e6d4db513aa2953dec.png_qt_ class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ alt_eq__qt_Screenshot from 2018-08-27 19-54-28.png_qt__gt__lt_/a_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-08-28T02:34:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_blockquote class_eq__qt_ipsQuote_qt_ data-ipsquote_eq__qt__qt_ data-ipsquote-contentapp_eq__qt_forums_qt_ data-ipsquote-contentclass_eq__qt_forums_Topic_qt_ data-ipsquote-contentcommentid_eq__qt_226370_qt_ data-ipsquote-contentid_eq__qt_39650_qt_ data-ipsquote-contenttype_eq__qt_forums_qt_ data-ipsquote-timestamp_eq__qt_1535414592_qt_ data-ipsquote-userid_eq__qt_32607_qt_ data-ipsquote-username_eq__qt_darkknight8_qt__gt_\n\t_lt_div class_eq__qt_ipsQuote_citation_qt__gt_\n\t\t2 hours ago_co_ darkknight8 said_dd_\n\t_lt_/div_gt_\n\n\t_lt_div class_eq__qt_ipsQuote_contents_qt__gt_\n\t\t_lt_p_gt_\n\t\t\twhat happens when you import it and attach it to the character_t_s head\n\t\t_lt_/p_gt_\n\t_lt_/div_gt_\n_lt_/blockquote_gt_\n\n_lt_p_gt_\n\tI mentioned it earlier_co_ but perhaps it didn_t_t jump out.  Probably each of those models already has a root element that the other meshes are already _lt_strong_gt_parent_lt_/strong_gt_ed to.  So_co_ there is a mesh index and when you import the mesh_co_ the other meshes are already have the .parent property set to that one (or another one in their hierarchy).  So_co_ if that is the case_co_ you only need to setParent() from the root node of the hat (1 mesh) with the root node of the character.  Really can_t_t tell without the models themselves.  It_t_s rudimentary_co_ but do a console.log on the meshes and check the parent properties - another option is to create a TransformNode and parent both root nodes to that.  This won_t_t work likely_co_ but is a hint what you are after_dd_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_for (let i _eq_ 0_sm_ i &lt_sm_ meshes.length_sm_ i++) { // your loop starts at 1_co_ but array index is 0_t_s based\n if (!meshes[i].parent) {\n    meshes[i].setParent(characterMesh[0]﻿)_sm_\n }\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"darkknight8","Date":"2018-08-28T03:12:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYes_co_ so the character mesh and the hat mesh both has their own parents. So if I understand you correctly_co_ I should be doing this_lt_br /_gt_\n\t \n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_let hatMeshRoot _eq_ meshes[0] // the root mesh of the hat_co_ the hat mesh has 2 nodes_co_ the first is root\n\nlet characterRoot _eq_ characterMesh[0] // character mesh has 9 nodes_co_ the first is also root\n\nhatMeshRoot.setParent(characterRoot)_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tIs this correct? Also_co_ I want to point out that the code works great_co_ the hat moves with the character as expected_co_ but now the issue is the hat does not have its original texture. Do you know if this is a problem with parenting meshes or is this another issue altogether? I can PM the models to you if you want to take a look.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-08-28T04:01:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGlad that we have made some progress and that the parenting is working out!  Still not ready to celebrate though _lt_span_gt__lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe only thing that I can think of right now is that the scaling or rotating is causing an issue with the texture.  The actual code is here_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Mesh/babylon.transformNode.ts#L543_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/blob/master/src/Mesh/babylon.transformNode.ts#L543_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou can test if that is the case by instead of calling setParent() to directly set the parent property (the code in method linked above is not ran then_lt_span class_eq__qt_ipsEmoji_qt__gt_😞_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_hatMeshRoot.parent _eq_ characterRoot_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tYou may need to adjust the hat position once you do that - the position will be in local space to character root (ie_dd_ hatMeshRoot.position.y +_eq_ 1).\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"darkknight8","Date":"2018-08-28T04:14:20Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI am not scaling anything in this case. I also remove any rotation and the color is still strange. I wonder if it might be an import bug? _lt_span_gt__lt_span_gt__lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt_ /_gt_ I also realized the texture is messed up even before using the setParent method on the hat mesh._lt_/span_gt__lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"brianzinn","Date":"2018-08-28T04:51:36Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tTry in the sandbox_co_ if the textures don_t_t load there then start a new question with details on the model format.  Just drag_t_n_t_drop your model_dd__lt_br /_gt_\n\t_lt_a href_eq__qt_https_dd_//sandbox.babylonjs.com/_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//sandbox.babylonjs.com/_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tedit_dd_ and I think there is a separate subforum for importing textures that will be more suitable... _lt_span_gt__lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/span_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"dbawel","Date":"2018-08-28T07:00:59Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tFreeze all transforms before importing. Also_co_ look at the pivot point and set in babylon.js if needed. Also_co_ I rarely use materials and textures from external applications. I know many will disagree_co_ but if you have problems with materials and textures from an exported application_co_ why not simplify and forget about troubleshooting - unless you_t_re not on a deadline and trying to work out a solid reliable pipeline. build your materials and textures in BJS_co_ as there is far more flexibility.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDB\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]