[{"Owner":"JohnK","Date":"2017-10-02T13:41:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_u_gt__lt_strong_gt_The problem_lt_/strong_gt__lt_/u_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCreate a box\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15080_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/box1.jpg.a9a70eb1b828609dfaef3f8179e299e5.jpg_qt_ alt_eq__qt_box1.jpg.a9a70eb1b828609dfaef3f8179e299e5.jpg_qt_ /_gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_o_1breiskpneoc13unhbtcfaqa3g_qt_ src_eq__qt__qt_ alt_eq__qt__qt_ /_gt_fig 1\n_lt_/p_gt_\n\n_lt_p_gt_\n\tUse\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_box.setPivotMatrix(BABYLON.Matrix.Translation(-0.5_co_ 0.5_co_ 0.5))_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tTo set the pivot at the lower right front corner (shown by small grey sphere).\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15081_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/box2.jpg.ed11f243828a9df941f4345d97cc82f1.jpg_qt_ alt_eq__qt_box2.jpg.ed11f243828a9df941f4345d97cc82f1.jpg_qt_ /_gt_ fig 2\n_lt_/p_gt_\n\n_lt_p_gt_\n\tPosition the box at (2_co_ 0_co_ 0) and note that it is the pivot that is positioned at (2_co_ 0_co_ 0).\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_box.position _eq_ new BABYLON.Vector3(2_co_ 0_co_ 0)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15082_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/box3.jpg.1dffef80226553475cf4d5b488de3c9c.jpg_qt_ alt_eq__qt_box3.jpg.1dffef80226553475cf4d5b488de3c9c.jpg_qt_ /_gt_fig 3\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDelete box.position and replace with\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_box.translate(BABYLON.Axis.X_co_ 2_co_ BABYLON.Space.LOCAL)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tAs you would expect since the local and world axes are in alignment you get the same result.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15082_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/box3.jpg.1dffef80226553475cf4d5b488de3c9c.jpg_qt_ alt_eq__qt_box3.jpg.1dffef80226553475cf4d5b488de3c9c.jpg_qt_ /_gt_fig 4\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNow replace LOCAL with WORLD\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_box.translate(BABYLON.Axis.X_co_ 2_co_ BABYLON.Space.WORLD)_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tSince local and world axes are in alignment and translate is a vector displacement and the displacement is the same then you would expect the box to be at the same position. However it is not as is seen below.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_15083_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2017_10/box4.jpg.ffe0567c8ee01355b2a15ed21a593e12.jpg_qt_ alt_eq__qt_box4.jpg.ffe0567c8ee01355b2a15ed21a593e12.jpg_qt_ /_gt_fig 5\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_u_gt__lt_strong_gt_Probable Issue_lt_/strong_gt__lt_/u_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tGetting the position of the box for fig 2 it is at (0_co_ 0_co_ 0) ie the position of the pivot_co_ the absolutePosition for the box in fig 2 is (-0.5_co_ 0.5_co_ 0.5) the position of the box_t_s center in world space.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo a translation in either local or world space would give the boxes position as (2_co_ 0_co_ 0) and its absolute position as (1.5_co_ 0.5_co_ 0.5) which it is for fig 3 using position and for fig 4 for translate in local space.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHowever translation in world space gives a position of (1.5_co_ 0.5_co_ 0.5) and an absolutePosition of (1_co_ 1_co_ 1) _eq_ (1.5_co_ 0.5_co_ 0.5) + (-0.5_co_ 0.5_co_ 0.5) . It is out by the pivot vector.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTracking down translate in Mesh/babylon.abstractMesh.ts\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_public translate(axis_dd_ Vector3_co_ distance_dd_ number_co_ space?_dd_ Space)_dd_ AbstractMesh {\n  var displacementVector _eq_ axis.scale(distance)_sm_\n  if (!space || (space as any) _eq__eq__eq_ Space.LOCAL) {\n     var tempV3 _eq_ this.getPositionExpressedInLocalSpace().add(displacementVector)_sm_\n     this.setPositionWithLocalVector(tempV3)_sm_\n  }\n  else {\n     this.setAbsolutePosition(this.getAbsolutePosition().add(displacementVector))_sm_\n  }\n  return this_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\twhere for Space.WORLD there is a call to _t_setAbsolutePosition_t_ the code for which is\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_public setAbsolutePosition(absolutePosition_dd_ Vector3)_dd_ AbstractMesh {\n  if (!absolutePosition) {\n     return_sm_\n  }\n  var absolutePositionX_sm_\n  var absolutePositionY_sm_\n  var absolutePositionZ_sm_\n  if (absolutePosition.x _eq__eq__eq_ undefined) {\n     if (arguments.length &lt_sm_ 3) {\n       return_sm_\n     }\n     absolutePositionX _eq_ arguments[0]_sm_\n     absolutePositionY _eq_ arguments[1]_sm_\n     absolutePositionZ _eq_ arguments[2]_sm_\n   }\n   else {\n     absolutePositionX _eq_ absolutePosition.x_sm_\n     absolutePositionY _eq_ absolutePosition.y_sm_\n     absolutePositionZ _eq_ absolutePosition.z_sm_\n   }\n   if (this.parent) {\n      var invertParentWorldMatrix _eq_ this.parent.getWorldMatrix().clone()_sm_\n      invertParentWorldMatrix.invert()_sm_\n      var worldPosition _eq_ new Vector3(absolutePositionX_co_ absolutePositionY_co_ absolutePositionZ)_sm_\n      this.position _eq_ Vector3.TransformCoordinates(worldPosition_co_ invertParentWorldMatrix)_sm_\n   } else {\n       this.position.x _eq_ absolutePositionX_sm_\n       this.position.y _eq_ absolutePositionY_sm_\n       this.position.z _eq_ absolutePositionZ_sm_\n   }\n   return this_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\twhich takes into account a parent but not a pivot. Also it sets the absolutePosition by setting only the position. However as is seen above when using a pivot_co_ like for the parent case_co_ position and absolute position are different by the pivot vector.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_u_gt__lt_strong_gt_Possible Solution_lt_/strong_gt__lt_/u_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould be very nervous of suggesting changes to _t_setAbsolutePosition_t_ as I would not know what else it might affect.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo suggest the following change to translate - _t_add(this.getPivotPoint())_t_  - but am not submitting a PR since I am not absolutely certain this is the correct way to go. Have tried it locally and it gives me what I expect but do not know whether it affects anything else and will wait until better BJS minds than mine check it out.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_public translate(axis_dd_ Vector3_co_ distance_dd_ number_co_ space?_dd_ Space)_dd_ AbstractMesh {\n  var displacementVector _eq_ axis.scale(distance)_sm_\n  if (!space || (space as any) _eq__eq__eq_ Space.LOCAL) {\n     var tempV3 _eq_ this.getPositionExpressedInLocalSpace().add(displacementVector)_sm_\n     this.setPositionWithLocalVector(tempV3)_sm_\n  }\n  else {\n     this.setAbsolutePosition(this.getAbsolutePosition().add(displacementVector).add(this.getPivotPoint()))_sm_\n  }\n  return this_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Sebavan","Date":"2017-10-02T15:52:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tAmazing details_co_ thx. I completely agree it is an issue and I will try deeper your proposed solution today.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe fix should be in tonight.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Sebavan","Date":"2017-10-03T06:33:53Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tI was not able to test deeply enough today_co_ I ll check more tomorrow.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Sebavan","Date":"2017-10-03T23:44:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe issue looks deeper. We ll check with _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4442_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4442-deltakosh/_qt_ rel_eq__qt__qt__gt_@Deltakosh_lt_/a_gt_ next week as there is more issues and potential impacts than expected.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI close it from here and you can follow the open issue on Github_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/issues/2896_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/issues/2896_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-10-06T21:51:49Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tWill work on it this monday _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2017-10-09T22:22:35Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIt is fixed.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI introduced a way to set a pivot matrix only (and not a premult only matrix)_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_https_dd_//www.babylonjs-playground.com/#KCMKTC_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//www.babylonjs-playground.com/#KCMKTC_lt_/a_gt_ (check line #28)\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]