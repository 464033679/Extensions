[{"Owner":"Dad72","Date":"2018-08-24T14:43:01Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_span_gt__lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/?do_eq_hovercard_qt_ data-mentionid_eq__qt_29361_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/_qt_ rel_eq__qt__qt__gt_@trevordev_lt_/a_gt__co_ Hi_co__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span_gt_I found a pretty sneaky bug when I try to activate a gizmo with this line_dd_ (It_t_s random this error.)_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span_gt_var manipulator _eq_ new BABYLON.GizmoManager(scene)_sm__lt_br /_gt_\n\tmanipulator.usePointerToAttachGizmos _eq_ false_sm__lt_br /_gt_\n\t manipulator.attachToMesh(mesh)_sm__lt_br /_gt_\n\t_lt_strong_gt_manipulator.positionGizmoEnabled _eq_ true_sm__lt_/strong_gt__lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span_gt_this return  getEngine of null_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_span_gt_Code in Babylon in the function UtilityLayerRenderer()_lt_/span_gt_\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_// Create scene which will be rendered in the foreground and remove it from being referenced by engine to avoid interfering with existing app\nthis.utilityLayerScene _eq_ new BABYLON.Scene(originalScene.getEngine())_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tBasically_co_ when I set positionGizmoEnabled to true_co_ the _lt_strong_gt_originalScene_lt_/strong_gt_ parameter does not exist.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI can not reproduce it on the PG and I do not understand why it happens on my project_co_ it_t_s been 4 hours that I try to understand and there I give up_co_ I do not understand the logic to this problem.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo that I can not display gizmo on my stage. Maybe you have an idea of what can produce this. This looks like a very sneaky bug for some project.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt_t_s just the _lt_strong_gt_originalScene_lt_/strong_gt_ that is not recovering and I do not see what I can do with bad eyes that I inform the scene in the GizmoManager.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThank you Trevor\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T15:14:58Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI have another problem too when my gizmo want to show up.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf the image 1 we can see that the gizmo is inside the cube and not before like on the demos on the PG\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_19750_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/521084826_2018-08-2417_05_46-Greenshot.png.aa59748358290638aa63dbff42f02c6e.png_qt_ alt_eq__qt_521084826_2018-08-2417_05_46-Greenshot.png.aa59748358290638aa63dbff42f02c6e.png_qt_ /_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tTo properly display the gizmo I am forced to put _lt_strong_gt_1_lt_/strong_gt_ render group id then reset it to _lt_strong_gt_0_lt_/strong_gt_.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a class_eq__qt_ipsAttachLink ipsAttachLink_image_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/80498309_2018-08-2417_06_01-Greenshot.png.2f39e164ff86099cc2a07fec93a61e22.png_qt_ data-fileid_eq__qt_19749_qt_ rel_eq__qt__qt__gt__lt_img class_eq__qt_ipsImage ipsImage_thumbnailed_qt_ data-fileid_eq__qt_19749_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/91970594_2018-08-2417_06_01-Greenshot.thumb.png.5f48d29c93dad3a6d8f055a306d65094.png_qt_ alt_eq__qt_91970594_2018-08-2417_06_01-Greenshot.thumb.png.5f48d29c93dad3a6d8f055a306d65094.png_qt_ /_gt__lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWe can see that now that it is correctly display.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAt no time do I create my objects using renderGroupId. Why is the gizmo is not in first plan(in front of the box) ? would link to the first bug higher?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Deltakosh","Date":"2018-08-24T15:36:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tPinging _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/?do_eq_hovercard_qt_ data-mentionid_eq__qt_29361_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/_qt_ rel_eq__qt__qt__gt_@trevordev_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-24T17:05:16Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/5292-dad72/?do_eq_hovercard_qt_ data-mentionid_eq__qt_5292_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/5292-dad72/_qt_ rel_eq__qt__qt__gt_@Dad72_lt_/a_gt_ Any chance you are doing anything with the gizmos or UtilityLayerRenderer.DefaultUtilityLayer prior to the scene being created_co_ or are you creating multiple scenes?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTo repro are you refreshing the webpage or are you using another mechanism to rerun the code?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe 2 issues you listed seem somewhat related pointing to the fact that UtilityLayerRenderer.DefaultUtilityLayer might not be getting initialized correctly if UtilityLayerRenderer.DefaultUtilityLayer.originalScene is null or undefined.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T17:32:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tIn fact on my editor_co_ I start by creating an empty scene._lt_br /_gt_\n\tThen I can create more terrain._lt_br /_gt_\n\tMy editor allows me to select with a selection menu a terrain that loads the scene.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWhen I change a terrain_co_ I dispose the scene and I create a new one.  So I recreate a new GizmoManager. I do not dispose the engine.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tEdit_dd_ By testing what you say_co_ in fact_co_ I think that when I dispose () the scene_co_ UtilityLayerRender is not disposed (??)\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T17:50:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_span_gt__lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/?do_eq_hovercard_qt_ data-mentionid_eq__qt_29361_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/29361-trevordev/_qt_ rel_eq__qt__qt__gt_@trevordev_lt_/a_gt_ _lt_/span_gt_In fact I just realized that when I dispose the scene_co_ the GizmoManager is not disposed.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIf I dispose GizmoManager before of dispose the scene_co_ same thing_co_ the GizmoManager is not disposed\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T18:14:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI did a pg that reproduce\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#8GY6J8%23115_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#8GY6J8#115_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSee in the console. The GizmoManager is not disposed.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-24T18:29:47Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSo will adding a scene.dispose listener in the gizmoManager manager class that disposes of it when the scene is disposed solve your issue? You will then have to recreate a new gizmos/manager for the new scene.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tEdit_dd_ another option would be to reuse only one scene and when changing scenes dispose of all the objects in the current scene and load new objects into it.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T18:32:15Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNo_co_ scene.dispose ()_co_ do not eliminate gizmoManager_lt_br /_gt_\n\tgizmo.dispose () does not eliminate the gizmoManager.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tdispose () does not work.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-24T18:43:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tSee this PG_dd_ _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#8MGKWK%2333_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#8MGKWK#33_lt_/a_gt_ when m is pressed the gizmo manager will be disposed and when that happens it will dispose all of it_t_s inner gizmos aswell.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAlso if I add something like line 17 into the gizmo manager it will automatically get disposed when the scene is disposed (you can see it output in the console when run is pressed).\n_lt_/p_gt_\n\n_lt_p_gt_\n\tWould that work for you or am I still not understanding?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T19:07:51Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThe gizmo is eliminated from the scene_co_ but it remains present if you look in the console_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#8MGKWK%2336_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#8MGKWK#36_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-24T19:46:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis is how dispose works in JS_co_ the garbage collector should collect any object that nothing else is referenced_co_ for certain objects that store hard references (webGL buffers) dispose is needed to be called. After dispose is called on the manager_co_ all internal references are released so it looks to behave as expected. You can always set manager _eq_ null_sm_ after calling dispose to force an error if you continue to use a disposed object.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T19:52:23Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tYes. So on the PG it works as expected. but on my project I do not know what_t_s going on._lt_br /_gt_\n\tI_t_m trying to understand why_co_ but I think I_t_m going to eliminate the engine too and recreating it to solve can be my problem.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T20:02:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tBy recreating the engine_co_ it corrects my problem. I do not really know why._lt_br /_gt_\n\tBy cons_co_ I still have the problem of gizmo which is inside the object as in this image_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_img alt_eq__qt_2018-08-24 17_05_46-Greenshot.png_qt_ class_eq__qt_ipsImage_qt_ height_eq__qt_323_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/monthly_2018_08/521084826_2018-08-2417_05_46-Greenshot.png.aa59748358290638aa63dbff42f02c6e.png_qt_ width_eq__qt_297_qt_ data-fileid_eq__qt_19750_qt_ /_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAn idea of what can cause this.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-24T20:48:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThat would happen if the gizmos and the box are in the same scene somehow_co_ are you passing in the scene parameter when creating the box and can you confirm that it is the main scene?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T20:53:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThank you for all your help Trevor. I finally understood why.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat_t_s why I used that when I loaded the camera.\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_let pass _eq_ new BABYLON.PassPostProcess(_qt_pass_qt__co_ 1_co_ scene.activeCamera)_sm_\npass.samples _eq_ 8_sm__lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tBy removing that. it works now.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-24T21:43:33Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tMaybe you have an explanation of why this postProcess create this problem?_lt_br /_gt_\n\tJust by curiosity.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"trevordev","Date":"2018-08-27T21:16:50Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis actually looks like a bug_co_ I got a PG repro here_dd_ _lt_a href_eq__qt_http_dd_//playground.babylonjs.com/#8MGKWK%2338_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//playground.babylonjs.com/#8MGKWK#38_lt_/a_gt_ from a spectorjs capture it looks like when the depth buffer clear is done its occurring on the wrong buffer so when the gizmos are drawn they get occluded. Created _lt_a href_eq__qt_https_dd_//github.com/BabylonJS/Babylon.js/issues/5013_qt_ rel_eq__qt_external nofollow_qt__gt_https_dd_//github.com/BabylonJS/Babylon.js/issues/5013_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Dad72","Date":"2018-08-28T00:34:17Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThank you for checking this and for the explanation.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]