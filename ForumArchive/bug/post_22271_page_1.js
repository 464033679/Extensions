[{"Owner":"satguru","Date":"2016-04-30T18:55:04Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tNot sure if this is a bug or just my misunderstanding.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am trying to make a mesh  parent of another mesh without changing the transforms (position_co_ rotation and scaling) of the  child mesh in the world frame of reference\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSimilar to this discussion\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.html5gamedevs.com/topic/21494-keep-childs-world-position-when-parenting/#comment-125340_qt_ rel_eq__qt__qt__gt_Keep child_t_s world position when parenting_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs shown in the above discussion I use the following kind of function to do this\n_lt_/p_gt_\n\n_lt_pre_gt_\n_lt_code_gt_function makeParent(child_co_ parent) {\n  var invParentMatrix _eq_ Matrix.Invert(parent.getWorldMatrix())_sm_  \n  var newMatrix _eq_ child.getWorldMatrix().multiply(invParentMatrix)_sm_\n  newMatrix.decompose(child.scaling_co_ child.rotationQuaternion_co_ child.position)_sm_\n  child.parent _eq_ parent_sm_\n}_lt_/code_gt__lt_/pre_gt_\n\n_lt_p_gt_\n\tThis works fine as long as the scaling of the parent is the same in x_co_ y and z direction.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt breaks down if I change the parent scaling in any one of those direction.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere is a playground example\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%234_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#4_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tHere we have two meshes - box1 and box2.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am trying to make box1 parent of box2.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tClicking the canvas calls a parenting function (similar to the one above) to do so.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tTo try\n_lt_/p_gt_\n\n_lt_p_gt_\n\tFirst time_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tdo a Run and then click the canvas.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tbox1 will become parent of box2 and nothing will change  on the screen - as expected.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSecond time\n_lt_/p_gt_\n\n_lt_p_gt_\n\tuncomment line 19 - this changes the scale of box1 in the z direction.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAgain click run and then click the canvas.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThis time box2 is distorted.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tSorry for the long post.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI have spent hours on this and can_t_t figure out what_t_s wrong _lt_img alt_eq__qt__dd_(_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_sad.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/sad@2x.png 2x_qt_ title_eq__qt__dd_(_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Kesshi","Date":"2016-04-30T20:03:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tMatrix.decompose() is working correctly in this case._lt_br /_gt_\n\tThe problem is that the two boxes are rotated differently. If you scale the parent it means that you will create a shearing on the child because your are not scaling in the local coordinate system of the child anymore. Its impossible to decompose the shearing matrix into plain local transforms (scale_co_ rotate_co_ position)\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-04-30T20:19:28Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/16973-kesshi/?do_eq_hovercard_qt_ data-mentionid_eq__qt_16973_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/16973-kesshi/_qt_ rel_eq__qt__qt__gt_@Kesshi_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSo if we cannot use decompose() to do this then what is the alternative ?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Kesshi","Date":"2016-04-30T20:49:40Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tYou can use decompose but only under the conditions_dd__lt_br /_gt_\n\t- if you need to scale the parent_co_ you can_t_t rotate the child_lt_br /_gt_\n\t- if you need to rotate the child_co_ you cant_t_ scale the parent_lt_br /_gt__lt_br /_gt_\n\tSorry but i don_t_t know a real solution for this issue.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-02T20:22:03Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis is the best solution I could come up with_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%238_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#8_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSince you can only scale a mesh by x_co_ y_co_ z (width_co_ height_co_ depth)_co_ I gave box2 a container mesh to invert the scale of box1.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt isn_t_t perfect_co_ but it might be good enough for what you are trying to accomplish.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-02T20:55:13Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI fixed the problem with box2 rotation after parenting_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%239_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#9_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-05-03T03:39:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4289_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/_qt_ rel_eq__qt__qt__gt_@adam_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat is great !!\n_lt_/p_gt_\n\n_lt_p_gt_\n\tDon_t_t understand all the maths though _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt__qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt_ /_gt__lt_/p_gt_\n\n_lt_p_gt_\n\tThanks for working on this.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs far as decompose is concerned I am still not convinced that it can_t_t handle different scales.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/16973-kesshi/?do_eq_hovercard_qt_ data-mentionid_eq__qt_16973_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/16973-kesshi/_qt_ rel_eq__qt__qt__gt_@Kesshi_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tNot sure why you think this is a case of shear matrix.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tAs far as my little understanding of transform matrix goes_co_ a shear matrix would occur if the axis of a frame of reference are not at right angles to each other.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThat is not the case here even though the effect looks like a shear \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"Kesshi","Date":"2016-05-03T06:55:07Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/16886-satguru/?do_eq_hovercard_qt_ data-mentionid_eq__qt_16886_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/16886-satguru/_qt_ rel_eq__qt__qt__gt_@satguru_lt_/a_gt_ The workaround from _lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4289_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/_qt_ rel_eq__qt__qt__gt_@adam_lt_/a_gt_ works because he adds an additional object in the hierarchie._lt_br /_gt_\n\tSo you have box1 -&gt_sm_ box2 -&gt_sm_ innerbox2_lt_br /_gt_\n\tinnerbox2 is the box geometry which can be freely rotated and scaled. box2 is an helper which is used to negate the transformations of box1._lt_br /_gt_\n\tBecause box2 is not rotated you will not have shearing ... the scaling directions are identical._lt_br /_gt__lt_br /_gt_\n\tI used this kind of workaround in AutoCad some years ago.There you have the same problem if you group (block) objects._lt_br /_gt_\n\tIf you scale the parent and one children is rotated_co_ you can_t_t ungroup them anymore.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-03T10:13:43Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t_lt_p_gt_\n\tIf there was a function that would allow us to scale an object on any axis_co_ then your first method would work.  The benefit of using this workaround is that after you parent the object to a scaled mesh_co_ you can freely rotate the inner box/mesh and not have to worry about the scaling.  If you didn_t_t use an inner mesh_co_ you_t_d have to update the scaling when rotating the child mesh.\n_lt_/p_gt_\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-03T11:14:11Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI discovered a bug when the parent is rotated.  Here is the fix_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%2311_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#11_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"adam","Date":"2016-05-04T15:51:19Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI created a parentMesh function that adds the extra mesh to the parent only if it is needed_dd_\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#28IXSE%2313_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#28IXSE#13_lt_/a_gt_\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-05-06T22:29:31Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\t_lt_a contenteditable_eq__qt_false_qt_ data-ipshover_eq__qt__qt_ data-ipshover-target_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/?do_eq_hovercard_qt_ data-mentionid_eq__qt_4289_qt_ href_eq__qt_http_dd_//www.html5gamedevs.com/profile/4289-adam/_qt_ rel_eq__qt__qt__gt_@adam_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tnice. thanks\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]