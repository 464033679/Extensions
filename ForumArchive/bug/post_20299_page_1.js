[{"Owner":"satguru","Date":"2016-02-03T04:48:29Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLoad a scene from a file_co_ serialize it and count the number of materials in  the serialized string.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou will see that the material count in the string is double the count in the file.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSerialization doubles the count.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI checked the code and I think it has to do with the way the loader and serializer work together.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tLoader_co_ while loading_co_  loads  each material in the file as  StandardMaterial into the scene.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe Serializer while serializing adds all the material in the scene to the JSON object and then adds the material again if it is StandardMaterial - effectively doubling the count.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am working on an app which allows the user to serialize and save the scene to a file and I noticed that over subsequent saves the file kept getting bigger and bigger even though no changes were made to the scene_co_ which is when I started looking into this issue.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n_lt_p_gt_\n\t \n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-02-03T08:52:27Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tHey_co_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tcan you reproduce this in the playground?\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI will check the code again. The serialized was rewritten for 2.3 (functions were moved and altered)_co_ it is more than possible that we missed something _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-02-03T08:54:54Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tOh_co_ and one more question - are you appending the new scene_co_ or loading it? If I understand correctly_co_ the main problem is that the loader is not checking if the material exists already. Is that true?\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-02-03T14:03:26Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tI will try and reproduce it in the playground today\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI am not appending the scene. I am just loading the scene from a file.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthe loader loads each material as standard material_co_ that is for each material in the file it creates a standard material and then set its property to that found in the file\n_lt_/p_gt_\n\n_lt_p_gt_\n\tthe serializer ends up loading each material from the scene into the serialization object twice as follows.\n_lt_/p_gt_\n\n_lt_p_gt_\n\t It first loads all the materials into the serialization object then goes through the list of material one more time_co_ this time checking if it is a standard material and if it finds it to be so then it loads it again into the serialization object. Thanks to the loader each material is a standard material and thus gets loaded twice.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-02-03T15:46:05Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tLooks like the problem might have been solved in 2.3\n_lt_/p_gt_\n\n_lt_p_gt_\n\tI tried reproducing this in playground but failed. Then I noticed that playground has switched to 2.3\n_lt_/p_gt_\n\n_lt_p_gt_\n\tCheck this out\n_lt_/p_gt_\n\n_lt_p_gt_\n\t_lt_a href_eq__qt_http_dd_//www.babylonjs-playground.com/#1EF9PW%231_qt_ rel_eq__qt_external nofollow_qt__gt_http_dd_//www.babylonjs-playground.com/#1EF9PW#1_lt_/a_gt_\n_lt_/p_gt_\n\n_lt_p_gt_\n\tSee if you can run this in 2.2\n_lt_/p_gt_\n\n_lt_p_gt_\n\tYou will see different result then.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tThe example linked above is a simple example\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt creates one additional material.\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIt then prints out the number of materials in the scene. \n_lt_/p_gt_\n\n_lt_p_gt_\n\tit then serializes the scene and then prints out the number of materials in the serialized object\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn 2.2 the count show up as 2 and 4\n_lt_/p_gt_\n\n_lt_p_gt_\n\tIn 2.3 the count show up as 2 and 2\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"RaananW","Date":"2016-02-03T17:24:56Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tThis was solved then _dd_-)  2.3 was just released_co_ use it instead of 2.2.\n_lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"},{"Owner":"satguru","Date":"2016-02-03T22:17:22Z","Content":"_lt_div class_eq__qt_mages_qt__gt_\n\t\t\t\n_lt_p_gt_\n\tGreat ! Will do that _lt_img alt_eq__qt__dd_)_qt_ data-emoticon_eq__qt_true_qt_ height_eq__qt_20_qt_ src_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/default_smile.png_qt_ srcset_eq__qt_http_dd_//www.html5gamedevs.com/uploads/emoticons/smile@2x.png 2x_qt_ title_eq__qt__dd_)_qt_ width_eq__qt_20_qt__gt__lt_/p_gt_\n\n\n\t\t\t\n\t\t_lt_/div_gt_\n\n\t\t_lt_div class_eq__qt_ipsI_qt__gt__lt_/div_gt__lt_/div_gt_"}]